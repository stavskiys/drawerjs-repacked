!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("drawerjs-repacked",[],e):"object"==typeof exports?exports["drawerjs-repacked"]=e():t["drawerjs-repacked"]=e()}(window,function(){return function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=23)}([function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(module,exports,__webpack_require__){(function(Buffer,process){
/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"1.7.2"};exports.fabric=fabric,"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=__webpack_require__(44).jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E")),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode=void 0!==Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.charWidthsCache={},fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,function(){function t(t,e){if(this.__eventListeners[t]){var i=this.__eventListeners[t];e?i[i.indexOf(e)]=!1:fabric.util.array.fill(i,!1)}}function e(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function i(e,i){if(this.__eventListeners){if(0===arguments.length)for(e in this.__eventListeners)t.call(this,e);else if(1===arguments.length&&"object"==typeof arguments[0])for(var o in e)t.call(this,o,e[o]);else t.call(this,e,i);return this}}function o(t,e){if(this.__eventListeners){var i=this.__eventListeners[t];if(i){for(var o=0,n=i.length;o<n;o++)i[o]&&i[o].call(this,e||{});return this.__eventListeners[t]=i.filter(function(t){return!1!==t}),this}}}fabric.Observable={observe:e,stopObserving:i,fire:o,on:e,off:i,trigger:o}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,e=arguments.length;t<e;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(t,e,i){var o=this.getObjects();return i?o[e]=t:o.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var t,e=this.getObjects(),i=!1,o=0,n=arguments.length;o<n;o++)-1!==(t=e.indexOf(arguments[o]))&&(i=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[o]));return this.renderOnAddRemove&&i&&this.renderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),o=0,n=i.length;o<n;o++)t.call(e,i[o],o,i);return this},getObjects:function(t){return void 0===t?this._objects:this._objects.filter(function(e){return e.type===t})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(t){return this.getObjects().indexOf(t)>-1},complexity:function(){return this.getObjects().reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)}},function(t){var e=Math.sqrt,i=Math.atan2,o=Math.pow,n=Math.abs,r=Math.PI/180;fabric.util={removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*r},radiansToDegrees:function(t){return t/r},rotatePoint:function(t,e,i){t.subtractEquals(e);var o=fabric.util.rotateVector(t,i);return new fabric.Point(o.x,o.y).addEquals(e)},rotateVector:function(t,e){var i=Math.sin(e),o=Math.cos(e);return{x:t.x*o-t.y*i,y:t.x*i+t.y*o}},transformPoint:function(t,e,i){return i?new fabric.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new fabric.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=fabric.util.array.min(e),o=fabric.util.array.max(e),n=Math.abs(i-o),r=[t[0].y,t[1].y,t[2].y,t[3].y],s=fabric.util.array.min(r),a=fabric.util.array.max(r);return{left:i,top:s,width:n,height:Math.abs(s-a)}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],o=fabric.util.transformPoint({x:t[4],y:t[5]},i,!0);return i[4]=-o.x,i[5]=-o.y,i},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),o=parseFloat(t);switch(e||(e=fabric.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return o*fabric.DPI/25.4;case"cm":return o*fabric.DPI/2.54;case"in":return o*fabric.DPI;case"pt":return o*fabric.DPI/72;case"pc":return o*fabric.DPI/72*12;case"em":return o*e;default:return o}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},resolveNamespace:function(e){if(!e)return fabric;var i,o=e.split("."),n=o.length,r=t||fabric.window;for(i=0;i<n;++i)r=r[o[i]];return r},loadImage:function(t,e,i,o){if(t){var n=fabric.util.createImage();n.onload=function(){e&&e.call(i,n),n=n.onload=n.onerror=null},n.onerror=function(){fabric.log("Error loading "+n.src),e&&e.call(i,null,!0),n=n.onload=n.onerror=null},0!==t.indexOf("data")&&o&&(n.crossOrigin=o),n.src=t}else e&&e.call(i,t)},enlivenObjects:function(t,e,i,o){function n(){++s===a&&e&&e(r)}var r=[],s=0,a=(t=t||[]).length;a?t.forEach(function(t,e){if(t&&t.type){var s=fabric.util.getKlass(t.type,i);s.async?s.fromObject(t,function(i,s){s||(r[e]=i,o&&o(t,r[e])),n()}):(r[e]=s.fromObject(t),o&&o(t,r[e]),n())}else n()}):e&&e(r)},groupSVGElements:function(t,e,i){var o;return o=new fabric.PathGroup(t,e),void 0!==i&&o.setSourcePath(i),o},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var o=0,n=i.length;o<n;o++)i[o]in t&&(e[i[o]]=t[i[o]])},drawDashedLine:function(t,o,n,r,s,a){var h=r-o,l=s-n,c=e(h*h+l*l),u=i(l,h),p=a.length,d=0,f=!0;for(t.save(),t.translate(o,n),t.moveTo(0,0),t.rotate(u),o=0;c>o;)(o+=a[d++%p])>c&&(o=c),t[f?"lineTo":"moveTo"](o,0),f=!f;t.restore()},createCanvasElement:function(t){return t||(t=fabric.document.createElement("canvas")),t.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(t),t},createImage:function(){return fabric.isLikelyNode?new(__webpack_require__(10).Image):fabric.document.createElement("img")},createAccessors:function(t){var e,i,o,n,r,s=t.prototype;for(e=s.stateProperties.length;e--;)n="set"+(o=(i=s.stateProperties[e]).charAt(0).toUpperCase()+i.slice(1)),s[r="get"+o]||(s[r]=new Function('return this.get("'+i+'")')),s[n]||(s[n]=new Function("value",'return this.set("'+i+'", value)'))},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var n=i(t[1],t[0]),s=o(t[0],2)+o(t[1],2),a=e(s),h=(t[0]*t[3]-t[2]*t[1])/a,l=i(t[0]*t[2]+t[1]*t[3],s);return{angle:n/r,scaleX:a,scaleY:h,skewX:l/r,skewY:0,translateX:t[4],translateY:t[5]}},customTransformMatrix:function(t,e,i){var o=[1,0,n(Math.tan(i*r)),1],s=[n(t),0,0,n(e)];return fabric.util.multiplyTransformMatrices(s,o,!0)},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.setAngle(0)},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,o){o>0&&(e>o?e-=o:e=0,i>o?i-=o:i=0);var n,r=!0,s=t.getImageData(e,i,2*o||1,2*o||1),a=s.data.length;for(n=3;n<a&&!1!==(r=s.data[n]<=0);n+=4);return s=null,r},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",o=t.split(" ");return o&&o.length&&("meet"!==(i=o.pop())&&"slice"!==i?(e=i,i="meet"):o.length&&(e=o.pop())),{meetOrSlice:i,alignX:"none"!==e?e.slice(1,4):"none",alignY:"none"!==e?e.slice(5,8):"none"}},clearFabricFontCache:function(t){t?fabric.charWidthsCache[t]&&delete fabric.charWidthsCache[t]:fabric.charWidthsCache={}}}}(exports),function(){var t={},e={},i={},o=Array.prototype.join;function n(e,i,n,a,h,l,c){var u=o.call(arguments);if(t[u])return t[u];var p=Math.PI,d=c*p/180,f=Math.sin(d),g=Math.cos(d),v=0,b=0,m=-g*e*.5-f*i*.5,y=-g*i*.5+f*e*.5,_=(n=Math.abs(n))*n,w=(a=Math.abs(a))*a,C=y*y,T=m*m,S=_*w-_*C-w*T,O=0;if(S<0){var E=Math.sqrt(1-S/(_*w));n*=E,a*=E}else O=(h===l?-1:1)*Math.sqrt(S/(_*C+w*T));var x=O*n*y/a,I=-O*a*m/n,A=g*x-f*I+.5*e,D=f*x+g*I+.5*i,k=s(1,0,(m-x)/n,(y-I)/a),P=s((m-x)/n,(y-I)/a,(-m-x)/n,(-y-I)/a);0===l&&P>0?P-=2*p:1===l&&P<0&&(P+=2*p);for(var M=Math.ceil(Math.abs(P/p*2)),B=[],j=P/M,R=8/3*Math.sin(j/4)*Math.sin(j/4)/Math.sin(j/2),L=k+j,N=0;N<M;N++)B[N]=r(k,L,g,f,n,a,A,D,R,v,b),v=B[N][4],b=B[N][5],k=L,L+=j;return t[u]=B,B}function r(t,i,n,r,s,a,h,l,c,u,p){var d=o.call(arguments);if(e[d])return e[d];var f=Math.cos(t),g=Math.sin(t),v=Math.cos(i),b=Math.sin(i),m=n*s*v-r*a*b+h,y=r*s*v+n*a*b+l,_=u+c*(-n*s*g-r*a*f),w=p+c*(-r*s*g+n*a*f),C=m+c*(n*s*b+r*a*v),T=y+c*(r*s*b-n*a*v);return e[d]=[_,w,C,T,m,y],e[d]}function s(t,e,i,o){var n=Math.atan2(e,t),r=Math.atan2(o,i);return r>=n?r-n:2*Math.PI-(n-r)}function a(t,e,n,r,s,a,h,l){var c=o.call(arguments);if(i[c])return i[c];var u,p,d,f,g,v,b,m,y=Math.sqrt,_=Math.min,w=Math.max,C=Math.abs,T=[],S=[[],[]];p=6*t-12*n+6*s,u=-3*t+9*n-9*s+3*h,d=3*n-3*t;for(var O=0;O<2;++O)if(O>0&&(p=6*e-12*r+6*a,u=-3*e+9*r-9*a+3*l,d=3*r-3*e),C(u)<1e-12){if(C(p)<1e-12)continue;0<(f=-d/p)&&f<1&&T.push(f)}else(b=p*p-4*d*u)<0||(0<(g=(-p+(m=y(b)))/(2*u))&&g<1&&T.push(g),0<(v=(-p-m)/(2*u))&&v<1&&T.push(v));for(var E,x,I,A=T.length,D=A;A--;)E=(I=1-(f=T[A]))*I*I*t+3*I*I*f*n+3*I*f*f*s+f*f*f*h,S[0][A]=E,x=I*I*I*e+3*I*I*f*r+3*I*f*f*a+f*f*f*l,S[1][A]=x;S[0][D]=t,S[1][D]=e,S[0][D+1]=h,S[1][D+1]=l;var k=[{x:_.apply(null,S[0]),y:_.apply(null,S[1])},{x:w.apply(null,S[0]),y:w.apply(null,S[1])}];return i[c]=k,k}fabric.util.drawArc=function(t,e,i,o){for(var r=o[0],s=o[1],a=o[2],h=o[3],l=o[4],c=[[],[],[],[]],u=n(o[5]-e,o[6]-i,r,s,h,l,a),p=0,d=u.length;p<d;p++)c[p][0]=u[p][0]+e,c[p][1]=u[p][1]+i,c[p][2]=u[p][2]+e,c[p][3]=u[p][3]+i,c[p][4]=u[p][4]+e,c[p][5]=u[p][5]+i,t.bezierCurveTo.apply(t,c[p])},fabric.util.getBoundsOfArc=function(t,e,i,o,r,s,h,l,c){for(var u,p=0,d=0,f=[],g=n(l-t,c-e,i,o,s,h,r),v=0,b=g.length;v<b;v++)u=a(p,d,g[v][0],g[v][1],g[v][2],g[v][3],g[v][4],g[v][5]),f.push({x:u[0].x+t,y:u[0].y+e}),f.push({x:u[1].x+t,y:u[1].y+e}),p=g[v][4],d=g[v][5];return f},fabric.util.getBoundsOfCurve=a}(),function(){var t=Array.prototype.slice;function e(t,e,i){if(t&&0!==t.length){var o=t.length-1,n=e?t[o][e]:t[o];if(e)for(;o--;)i(t[o][e],n)&&(n=t[o][e]);else for(;o--;)i(t[o],n)&&(n=t[o]);return n}}Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var o=0;if(arguments.length>0&&((o=Number(arguments[1]))!=o?o=0:0!==o&&o!==Number.POSITIVE_INFINITY&&o!==Number.NEGATIVE_INFINITY&&(o=(o>0||-1)*Math.floor(Math.abs(o)))),o>=i)return-1;for(var n=o>=0?o:Math.max(i-Math.abs(o),0);n<i;n++)if(n in e&&e[n]===t)return n;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var i=0,o=this.length>>>0;i<o;i++)i in this&&t.call(e,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(t,e){for(var i=[],o=0,n=this.length>>>0;o<n;o++)o in this&&(i[o]=t.call(e,this[o],o,this));return i}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var i=0,o=this.length>>>0;i<o;i++)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t,e){for(var i=0,o=this.length>>>0;i<o;i++)if(i in this&&t.call(e,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(t,e){for(var i,o=[],n=0,r=this.length>>>0;n<r;n++)n in this&&(i=this[n],t.call(e,i,n,this)&&o.push(i));return o}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var e,i=this.length>>>0,o=0;if(arguments.length>1)e=arguments[1];else for(;;){if(o in this){e=this[o++];break}if(++o>=i)throw new TypeError}for(;o<i;o++)o in this&&(e=t.call(null,e,this[o],o,this));return e}),fabric.util.array={fill:function(t,e){for(var i=t.length;i--;)t[i]=e;return t},invoke:function(e,i){for(var o=t.call(arguments,2),n=[],r=0,s=e.length;r<s;r++)n[r]=o.length?e[r][i].apply(e[r],o):e[r][i].call(e[r]);return n},min:function(t,i){return e(t,i,function(t,e){return t<e})},max:function(t,i){return e(t,i,function(t,e){return t>=e})}}}(),function(){function t(e,i,o){if(o)if(!fabric.isLikelyNode&&i instanceof Element)e=i;else if(i instanceof Array){e=[];for(var n=0,r=i.length;n<r;n++)e[n]=t({},i[n],o)}else if(i&&"object"==typeof i)for(var s in i)i.hasOwnProperty(s)&&(e[s]=t({},i[s],o));else e=i;else for(var s in i)e[s]=i[s];return e}fabric.util.object={extend:t,clone:function(e,i){return t({},e,i)}}}(),function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}}(),function(){var t=Array.prototype.slice,e=Function.prototype.apply,i=function(){};Function.prototype.bind||(Function.prototype.bind=function(o){var n,r=this,s=t.call(arguments,1);return n=s.length?function(){return e.call(r,this instanceof i?this:o,s.concat(t.call(arguments)))}:function(){return e.call(r,this instanceof i?this:o,arguments)},i.prototype=this.prototype,n.prototype=new i,n})}(),function(){var t=Array.prototype.slice,e=function(){},i=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),o=function(t,e,o){for(var n in e)n in t.prototype&&"function"==typeof t.prototype[n]&&(e[n]+"").indexOf("callSuper")>-1?t.prototype[n]=function(t){return function(){var i=this.constructor.superclass;this.constructor.superclass=o;var n=e[t].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==t)return n}}(n):t.prototype[n]=e[n],i&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};function n(){}function r(e){var i=this.constructor.superclass.prototype[e];return arguments.length>1?i.apply(this,t.call(arguments,1)):i.call(this)}fabric.util.createClass=function(){var i=null,s=t.call(arguments,0);function a(){this.initialize.apply(this,arguments)}"function"==typeof s[0]&&(i=s.shift()),a.superclass=i,a.subclasses=[],i&&(n.prototype=i.prototype,a.prototype=new n,i.subclasses.push(a));for(var h=0,l=s.length;h<l;h++)o(a,s[h],i);return a.prototype.initialize||(a.prototype.initialize=e),a.prototype.constructor=a,a.prototype.callSuper=r,a}}(),function(){var t="unknown";function e(t){var e,i,o=Array.prototype.slice.call(arguments,1),n=o.length;for(i=0;i<n;i++)if(e=typeof t[o[i]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}var i,o,n=function(){var t=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+t++)}}();function r(t,e){return{handler:e,wrappedHandler:function(t,e){return function(o){e.call(i(t),o||fabric.window.event)}}(t,e)}}!function(){var t={};i=function(e){return t[e]},o=function(e,i){t[e]=i}}();var s,a,h=e(fabric.document.documentElement,"addEventListener","removeEventListener")&&e(fabric.window,"addEventListener","removeEventListener"),l=e(fabric.document.documentElement,"attachEvent","detachEvent")&&e(fabric.window,"attachEvent","detachEvent"),c={},u={};h?(s=function(t,e,i){t.addEventListener(e,i,!1)},a=function(t,e,i){t.removeEventListener(e,i,!1)}):l?(s=function(t,e,i){var s=n(t);o(s,t),c[s]||(c[s]={}),c[s][e]||(c[s][e]=[]);var a=r(s,i);c[s][e].push(a),t.attachEvent("on"+e,a.wrappedHandler)},a=function(t,e,i){var o,r=n(t);if(c[r]&&c[r][e])for(var s=0,a=c[r][e].length;s<a;s++)(o=c[r][e][s])&&o.handler===i&&(t.detachEvent("on"+e,o.wrappedHandler),c[r][e][s]=null)}):(s=function(t,e,i){var o=n(t);if(u[o]||(u[o]={}),!u[o][e]){u[o][e]=[];var r=t["on"+e];r&&u[o][e].push(r),t["on"+e]=function(t,e){return function(i){if(u[t]&&u[t][e])for(var o=u[t][e],n=0,r=o.length;n<r;n++)o[n].call(this,i||fabric.window.event)}}(o,e)}u[o][e].push(i)},a=function(t,e,i){var o=n(t);if(u[o]&&u[o][e])for(var r=u[o][e],s=0,a=r.length;s<a;s++)r[s]===i&&r.splice(s,1)}),fabric.util.addListener=s,fabric.util.removeListener=a;var p=function(e){return typeof e.clientX!==t?e.clientX:0},d=function(e){return typeof e.clientY!==t?e.clientY:0};function f(t,e,i){var o="touchend"===t.type?"changedTouches":"touches";return t[o]&&t[o][0]&&t[o][0][e]-(t[o][0][e]-t[o][0][i])||t[i]}fabric.isTouchSupported&&(p=function(t){return f(t,"pageX","clientX")},d=function(t){return f(t,"pageY","clientY")}),fabric.util.getPointer=function(e){e||(e=fabric.window.event);var i=e.target||(typeof e.srcElement!==t?e.srcElement:null),o=fabric.util.getScrollLeftTop(i);return{x:p(e)+o.left,y:d(e)+o.top}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){var t=fabric.document.createElement("div"),e="string"==typeof t.style.opacity,i="string"==typeof t.style.filter,o=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(t){return t};e?n=function(t,e){return t.style.opacity=e,t}:i&&(n=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),o.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(o,e)):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=function(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?n(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var o in e)"opacity"===o?n(t,e[o]):i["float"===o||"cssFloat"===o?void 0===i.styleFloat?"cssFloat":"styleFloat":o]=e[o];return t}}(),function(){var t=Array.prototype.slice;var e,i,o=function(e){return t.call(e,0)};try{e=o(fabric.document.childNodes)instanceof Array}catch(t){}function n(t,e){var i=fabric.document.createElement(t);for(var o in e)"class"===o?i.className=e[o]:"for"===o?i.htmlFor=e[o]:i.setAttribute(o,e[o]);return i}function r(t){for(var e=0,i=0,o=fabric.document.documentElement,n=fabric.document.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===fabric.document?(e=n.scrollLeft||o.scrollLeft||0,i=n.scrollTop||o.scrollTop||0):(e+=t.scrollLeft||0,i+=t.scrollTop||0),1!==t.nodeType||"fixed"!==fabric.util.getElementStyle(t,"position")););return{left:e,top:i}}e||(o=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),i=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(t,e){var i=fabric.document.defaultView.getComputedStyle(t,null);return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},function(){var t=fabric.document.documentElement.style,e="userSelect"in t?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),e?t.style[e]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},fabric.util.makeElementSelectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=null),e?t.style[e]="":"string"==typeof t.unselectable&&(t.unselectable=""),t}}(),function(){fabric.util.getScript=function(t,e){var i=fabric.document.getElementsByTagName("head")[0],o=fabric.document.createElement("script"),n=!0;o.onload=o.onreadystatechange=function(t){if(n){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;n=!1,e(t||fabric.window.event),o=o.onload=o.onreadystatechange=null}},o.src=t,i.appendChild(o)}}(),fabric.util.getById=function(t){return"string"==typeof t?fabric.document.getElementById(t):t},fabric.util.toArray=o,fabric.util.makeElement=n,fabric.util.addClass=function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},fabric.util.wrapElement=function(t,e,i){return"string"==typeof e&&(e=n(e,i)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},fabric.util.getScrollLeftTop=r,fabric.util.getElementOffset=function(t){var e,o,n=t&&t.ownerDocument,s={left:0,top:0},a={left:0,top:0},h={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!n)return a;for(var l in h)a[h[l]]+=parseInt(i(t,l),10)||0;return e=n.documentElement,void 0!==t.getBoundingClientRect&&(s=t.getBoundingClientRect()),o=r(t),{left:s.left+o.left-(e.clientLeft||0)+a.left,top:s.top+o.top-(e.clientTop||0)+a.top}},fabric.util.getElementStyle=i}(),function(){var t=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=t.length;e--;)try{if(t[e]())return t[e]}catch(t){}}();function e(){}fabric.util.request=function(i,o){o||(o={});var n=o.method?o.method.toUpperCase():"GET",r=o.onComplete||function(){},s=t(),a=o.body||o.parameters;return s.onreadystatechange=function(){4===s.readyState&&(r(s),s.onreadystatechange=e)},"GET"===n&&(a=null,"string"==typeof o.parameters&&(i=function(t,e){return t+(/\?/.test(t)?"&":"?")+e}(i,o.parameters))),s.open(n,i,!0),"POST"!==n&&"PUT"!==n||s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(a),s}}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(t){void 0!==console[t]&&"function"==typeof console[t].apply&&(fabric[t]=function(){return console[t].apply(console,arguments)})}),function(){var t=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){fabric.window.setTimeout(t,1e3/60)};function e(){return t.apply(fabric.window,arguments)}fabric.util.animate=function(t){e(function(i){t||(t={});var o,n=i||+new Date,r=t.duration||500,s=n+r,a=t.onChange||function(){},h=t.abort||function(){return!1},l=t.easing||function(t,e,i,o){return-i*Math.cos(t/o*(Math.PI/2))+i+e},c="startValue"in t?t.startValue:0,u="endValue"in t?t.endValue:100,p=t.byValue||u-c;t.onStart&&t.onStart(),function i(u){var d=(o=u||+new Date)>s?r:o-n;h()?t.onComplete&&t.onComplete():(a(l(d,c,p,r)),o>s?t.onComplete&&t.onComplete():e(i))}(n)})},fabric.util.requestAnimFrame=e}(),function(){fabric.util.animateColor=function(t,e,i,o){var n=new fabric.Color(t).getSource(),r=new fabric.Color(e).getSource();o=o||{},fabric.util.animate(fabric.util.object.extend(o,{duration:i||500,startValue:n,endValue:r,byValue:r,easing:function(t,e,i,n){return function(t,e,i){var o="rgba("+parseInt(t[0]+i*(e[0]-t[0]),10)+","+parseInt(t[1]+i*(e[1]-t[1]),10)+","+parseInt(t[2]+i*(e[2]-t[2]),10);return o+=","+(t&&e?parseFloat(t[3]+i*(e[3]-t[3])):1),o+=")"}(e,i,o.colorEasing?o.colorEasing(t,n):1-Math.cos(t/n*(Math.PI/2)))}}))}}(),function(){function t(t,e,i,o){return t<Math.abs(e)?(t=e,o=i/4):o=0===e&&0===t?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:o}}function e(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin((e*i-t.s)*(2*Math.PI)/t.p)}function i(t,e,i,n){return i-o(n-t,0,i,n)+e}function o(t,e,i,o){return(t/=o)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}fabric.util.ease={easeInQuad:function(t,e,i,o){return i*(t/=o)*t+e},easeOutQuad:function(t,e,i,o){return-i*(t/=o)*(t-2)+e},easeInOutQuad:function(t,e,i,o){return(t/=o/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,o){return i*(t/=o)*t*t+e},easeOutCubic:function(t,e,i,o){return i*((t=t/o-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,o){return(t/=o/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,o){return i*(t/=o)*t*t*t+e},easeOutQuart:function(t,e,i,o){return-i*((t=t/o-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,o){return(t/=o/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,o){return i*(t/=o)*t*t*t*t+e},easeOutQuint:function(t,e,i,o){return i*((t=t/o-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,o){return(t/=o/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,o){return-i*Math.cos(t/o*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,o){return i*Math.sin(t/o*(Math.PI/2))+e},easeInOutSine:function(t,e,i,o){return-i/2*(Math.cos(Math.PI*t/o)-1)+e},easeInExpo:function(t,e,i,o){return 0===t?e:i*Math.pow(2,10*(t/o-1))+e},easeOutExpo:function(t,e,i,o){return t===o?e+i:i*(1-Math.pow(2,-10*t/o))+e},easeInOutExpo:function(t,e,i,o){return 0===t?e:t===o?e+i:(t/=o/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,o){return-i*(Math.sqrt(1-(t/=o)*t)-1)+e},easeOutCirc:function(t,e,i,o){return i*Math.sqrt(1-(t=t/o-1)*t)+e},easeInOutCirc:function(t,e,i,o){return(t/=o/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(i,o,n,r){var s=0;return 0===i?o:1==(i/=r)?o+n:(s||(s=.3*r),-e(t(n,n,s,1.70158),i,r)+o)},easeOutElastic:function(e,i,o,n){var r=0,s=o;if(0===e)return i;if(1==(e/=n))return i+o;r||(r=.3*n);var a=t(s,o,r,1.70158);return a.a*Math.pow(2,-10*e)*Math.sin((e*n-a.s)*(2*Math.PI)/a.p)+a.c+i},easeInOutElastic:function(i,o,n,r){var s=0,a=n;if(0===i)return o;if(2==(i/=r/2))return o+n;s||(s=r*(.3*1.5));var h=t(a,n,s,1.70158);return i<1?-.5*e(h,i,r)+o:h.a*Math.pow(2,-10*(i-=1))*Math.sin((i*r-h.s)*(2*Math.PI)/h.p)*.5+h.c+o},easeInBack:function(t,e,i,o,n){return void 0===n&&(n=1.70158),i*(t/=o)*t*((n+1)*t-n)+e},easeOutBack:function(t,e,i,o,n){return void 0===n&&(n=1.70158),i*((t=t/o-1)*t*((n+1)*t+n)+1)+e},easeInOutBack:function(t,e,i,o,n){return void 0===n&&(n=1.70158),(t/=o/2)<1?i/2*(t*t*((1+(n*=1.525))*t-n))+e:i/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+e},easeInBounce:i,easeOutBounce:o,easeInOutBounce:function(t,e,n,r){return t<r/2?.5*i(2*t,0,n,r)+e:.5*o(2*t-r,0,n,r)+.5*n+e}}}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.util.string.capitalize,n=e.util.object.clone,r=e.util.toFixed,s=e.util.parseUnit,a=e.util.multiplyTransformMatrices,h=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,l=/^(symbol|image|marker|pattern|view|svg)$/i,c=/^(?:pattern|defs|symbol|metadata)$/i,u=/^(symbol|g|a|svg)$/i,p={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},d={stroke:"strokeOpacity",fill:"fillOpacity"};function f(t){return t in p?p[t]:t}function g(t,i,o,n){var r,h="[object Array]"===Object.prototype.toString.call(i);return"fill"!==t&&"stroke"!==t||"none"!==i?"strokeDashArray"===t?i="none"===i?null:i.replace(/,/g," ").split(/\s+/).map(function(t){return parseFloat(t)}):"transformMatrix"===t?i=o&&o.transformMatrix?a(o.transformMatrix,e.parseTransformAttribute(i)):e.parseTransformAttribute(i):"visible"===t?(i="none"!==i&&"hidden"!==i,o&&!1===o.visible&&(i=!1)):"originX"===t?i="start"===i?"left":"end"===i?"right":"center":r=h?i.map(s):s(i,n):i="",!h&&isNaN(r)?i:r}function v(t,e){for(var i,o,n=[],r=0;r<e.length;r++)i=e[r],o=t.getElementsByTagName(i),n=n.concat(Array.prototype.slice.call(o));return n}function b(t,e){var i,o=!0;return(i=m(t,e.pop()))&&e.length&&(o=function(t,e){var i,o=!0;for(;t.parentNode&&1===t.parentNode.nodeType&&e.length;)o&&(i=e.pop()),t=t.parentNode,o=m(t,i);return 0===e.length}(t,e)),i&&o&&0===e.length}function m(t,e){var i,o=t.nodeName,n=t.getAttribute("class"),r=t.getAttribute("id");if(i=new RegExp("^"+o,"i"),e=e.replace(i,""),r&&e.length&&(i=new RegExp("#"+r+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")),n&&e.length)for(var s=(n=n.split(" ")).length;s--;)i=new RegExp("\\."+n[s]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"");return 0===e.length}function y(t,e){var i;if(t.getElementById&&(i=t.getElementById(e)),i)return i;var o,n,r=t.getElementsByTagName("*");for(n=0;n<r.length;n++)if(e===(o=r[n]).getAttribute("id"))return o}e.cssRules={},e.gradientDefs={},e.parseTransformAttribute=function(){var t=[1,0,0,1,0,0],i=e.reNum,o="(?:\\s+,?\\s*|,\\s*)",n="(?:"+("(?:(matrix)\\s*\\(\\s*("+i+")"+o+"("+i+")"+o+"("+i+")"+o+"("+i+")"+o+"("+i+")"+o+"("+i+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+i+")(?:"+o+"("+i+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+i+")(?:"+o+"("+i+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+i+")(?:"+o+"("+i+")"+o+"("+i+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+i+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+i+")\\s*\\))")+")",r=new RegExp("^\\s*(?:"+("(?:"+n+"(?:"+o+"*"+n+")*)")+"?)\\s*$"),s=new RegExp(n,"g");return function(i){var o=t.concat(),a=[];if(!i||i&&!r.test(i))return o;i.replace(s,function(i){var r=new RegExp(n).exec(i).filter(function(t){return!!t}),s=r[1],h=r.slice(2).map(parseFloat);switch(s){case"translate":!function(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}(o,h);break;case"rotate":h[0]=e.util.degreesToRadians(h[0]),function(t,e){var i=e[0],o=3===e.length?e[1]:0,n=3===e.length?e[2]:0;t[0]=Math.cos(i),t[1]=Math.sin(i),t[2]=-Math.sin(i),t[3]=Math.cos(i),t[4]=o-(t[0]*o+t[2]*n),t[5]=n-(t[1]*o+t[3]*n)}(o,h);break;case"scale":!function(t,e){var i=e[0],o=2===e.length?e[1]:e[0];t[0]=i,t[3]=o}(o,h);break;case"skewX":!function(t,i){t[2]=Math.tan(e.util.degreesToRadians(i[0]))}(o,h);break;case"skewY":!function(t,i){t[1]=Math.tan(e.util.degreesToRadians(i[0]))}(o,h);break;case"matrix":o=h}a.push(o.concat()),o=t.concat()});for(var h=a[0];a.length>1;)a.shift(),h=e.util.multiplyTransformMatrices(h,a[0]);return h}}();var _=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function w(t){var i,o,n,r,a,h,c=t.getAttribute("viewBox"),u=1,p=1,d=t.getAttribute("width"),f=t.getAttribute("height"),g=t.getAttribute("x")||0,v=t.getAttribute("y")||0,b=t.getAttribute("preserveAspectRatio")||"",m=!c||!l.test(t.nodeName)||!(c=c.match(_)),y=!d||!f||"100%"===d||"100%"===f,w=m&&y,C={},T="";if(C.width=0,C.height=0,C.toBeParsed=w,w)return C;if(m)return C.width=s(d),C.height=s(f),C;if(i=-parseFloat(c[1]),o=-parseFloat(c[2]),n=parseFloat(c[3]),r=parseFloat(c[4]),y?(C.width=n,C.height=r):(C.width=s(d),C.height=s(f),u=C.width/n,p=C.height/r),"none"!==(b=e.util.parsePreserveAspectRatioAttribute(b)).alignX&&(p=u=u>p?p:u),1===u&&1===p&&0===i&&0===o&&0===g&&0===v)return C;if((g||v)&&(T=" translate("+s(g)+" "+s(v)+") "),a=T+" matrix("+u+" 0 0 "+p+" "+i*u+" "+o*p+") ","svg"===t.nodeName){for(h=t.ownerDocument.createElement("g");t.firstChild;)h.appendChild(t.firstChild);t.appendChild(h)}else a=(h=t).getAttribute("transform")+a;return h.setAttribute("transform",a),C}e.parseSVGDocument=function(){return function(t,i,o){if(t){!function(t){for(var e=v(t,["use","svg:use"]),i=0;e.length&&i<e.length;){var o,n,r,s,a=e[i],h=a.getAttribute("xlink:href").substr(1),l=a.getAttribute("x")||0,c=a.getAttribute("y")||0,u=y(t,h).cloneNode(!0),p=(u.getAttribute("transform")||"")+" translate("+l+", "+c+")",d=e.length;if(w(u),/^svg$/i.test(u.nodeName)){var f=u.ownerDocument.createElement("g");for(n=0,s=(r=u.attributes).length;n<s;n++)o=r.item(n),f.setAttribute(o.nodeName,o.nodeValue);for(;u.firstChild;)f.appendChild(u.firstChild);u=f}for(n=0,s=(r=a.attributes).length;n<s;n++)"x"!==(o=r.item(n)).nodeName&&"y"!==o.nodeName&&"xlink:href"!==o.nodeName&&("transform"===o.nodeName?p=o.nodeValue+" "+p:u.setAttribute(o.nodeName,o.nodeValue));u.setAttribute("transform",p),u.setAttribute("instantiated_by_use","1"),u.removeAttribute("id"),a.parentNode.replaceChild(u,a),e.length===d&&i++}}(t);var r=new Date,s=e.Object.__uid++,a=w(t),l=e.util.toArray(t.getElementsByTagName("*"));if(a.svgUid=s,0===l.length&&e.isLikelyNode){for(var u=[],p=0,d=(l=t.selectNodes('//*[name(.)!="svg"]')).length;p<d;p++)u[p]=l[p];l=u}var f=l.filter(function(t){return w(t),h.test(t.nodeName.replace("svg:",""))&&!function(t,e){for(;t&&(t=t.parentNode);)if(t.nodeName&&e.test(t.nodeName.replace("svg:",""))&&!t.getAttribute("instantiated_by_use"))return!0;return!1}(t,c)});!f||f&&!f.length?i&&i([],{}):(e.gradientDefs[s]=e.getGradientDefs(t),e.cssRules[s]=e.getCSSRules(t),e.parseElements(f,function(t){e.documentParsingTime=new Date-r,i&&i(t,a)},n(a),o))}}}();var C={has:function(t,e){e(!1)},get:function(){},set:function(){}};function T(t,e,i){e[i]&&e[i].toSVG&&t.push('\t<pattern x="0" y="0" id="',i,'Pattern" ','width="',e[i].source.width,'" height="',e[i].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',e[i].source.width,'" height="',e[i].source.height,'" xlink:href="',e[i].source.src,'"></image>\n\t</pattern>\n')}var S=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");i(e,{parseFontDeclaration:function(t,e){var i=t.match(S);if(i){var o=i[1],n=i[3],r=i[4],a=i[5],h=i[6];o&&(e.fontStyle=o),n&&(e.fontWeight=isNaN(parseFloat(n))?n:parseFloat(n)),r&&(e.fontSize=s(r)),h&&(e.fontFamily=h),a&&(e.lineHeight="normal"===a?1:a)}},getGradientDefs:function(t){var e,i,o,n=v(t,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),r=0,s={},a={};for(r=n.length;r--;)o=(e=n[r]).getAttribute("xlink:href"),i=e.getAttribute("id"),o&&(a[i]=o.substr(1)),s[i]=e;for(i in a){var h=s[a[i]].cloneNode(!0);for(e=s[i];h.firstChild;)e.appendChild(h.firstChild)}return s},parseAttributes:function(t,o,n){if(t){var s,a,h={};void 0===n&&(n=t.getAttribute("svgUid")),t.parentNode&&u.test(t.parentNode.nodeName)&&(h=e.parseAttributes(t.parentNode,o,n)),a=h&&h.fontSize||t.getAttribute("font-size")||e.Text.DEFAULT_SVG_FONT_SIZE;var l=o.reduce(function(e,i){return(s=t.getAttribute(i))&&(i=f(i),s=g(i,s,h,a),e[i]=s),e},{});return(l=i(l,i(function(t,i){var o={};for(var n in e.cssRules[i])if(b(t,n.split(" ")))for(var r in e.cssRules[i][n])o[r]=e.cssRules[i][n][r];return o}(t,n),e.parseStyleAttribute(t)))).font&&e.parseFontDeclaration(l.font,l),function(t){for(var i in d)if(void 0!==t[d[i]]&&""!==t[i]){if(void 0===t[i]){if(!e.Object.prototype[i])continue;t[i]=e.Object.prototype[i]}if(0!==t[i].indexOf("url(")){var o=new e.Color(t[i]);t[i]=o.setAlpha(r(o.getAlpha()*t[d[i]],2)).toRgba()}}return t}(i(h,l))}},parseElements:function(t,i,o,n){new e.ElementsParser(t,i,o,n).parse()},parseStyleAttribute:function(t){var e={},i=t.getAttribute("style");return i?("string"==typeof i?function(t,e){var i,o;t.replace(/;\s*$/,"").split(";").forEach(function(t){var n=t.split(":");i=f(n[0].trim().toLowerCase()),o=g(i,n[1].trim()),e[i]=o})}(i,e):function(t,e){var i,o;for(var n in t)void 0!==t[n]&&(o=g(i=f(n.toLowerCase()),t[n]),e[i]=o)}(i,e),e):e},parsePointsAttribute:function(t){if(!t)return null;var e,i,o=[];for(e=0,i=(t=(t=t.replace(/,/g," ").trim()).split(/\s+/)).length;e<i;e+=2)o.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])});return o},getCSSRules:function(t){for(var i=t.getElementsByTagName("style"),o={},n=0,r=i.length;n<r;n++){var s=i[n].textContent||i[n].text;""!==(s=s.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&s.match(/[^{]*\{[\s\S]*?\}/g).map(function(t){return t.trim()}).forEach(function(t){for(var i=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),n={},r=i[2].trim().replace(/;$/,"").split(/\s*;\s*/),s=0,a=r.length;s<a;s++){var h=r[s].split(/\s*:\s*/),l=f(h[0]),c=g(l,h[1],h[0]);n[l]=c}(t=i[1]).split(",").forEach(function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(o[t]?e.util.object.extend(o[t],n):o[t]=e.util.object.clone(n))})})}return o},loadSVGFromURL:function(t,i,n){function r(o){var r=o.responseXML;r&&!r.documentElement&&e.window.ActiveXObject&&o.responseText&&((r=new ActiveXObject("Microsoft.XMLDOM")).async="false",r.loadXML(o.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),r&&r.documentElement||i&&i(null),e.parseSVGDocument(r.documentElement,function(o,n){C.set(t,{objects:e.util.array.invoke(o,"toObject"),options:n}),i&&i(o,n)},n)}t=t.replace(/^\n\s*/,"").trim(),C.has(t,function(n){n?C.get(t,function(t){var n=function(t){var i=t.objects,n=t.options;return{objects:i=i.map(function(t){return e[o(t.type)].fromObject(t)}),options:n}}(t);i(n.objects,n.options)}):new e.util.request(t,{method:"get",onComplete:r})})},loadSVGFromString:function(t,i,o){var n;if(t=t.trim(),"undefined"!=typeof DOMParser){var r=new DOMParser;r&&r.parseFromString&&(n=r.parseFromString(t,"text/xml"))}else e.window.ActiveXObject&&((n=new ActiveXObject("Microsoft.XMLDOM")).async="false",n.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e.parseSVGDocument(n.documentElement,function(t,e){i(t,e)},o)},createSVGFontFacesMarkup:function(t){for(var i,o,n,r,s,a,h="",l={},c=e.fontPaths,u=0,p=t.length;u<p;u++)if(o=(i=t[u]).fontFamily,-1!==i.type.indexOf("text")&&!l[o]&&c[o]&&(l[o]=!0,i.styles))for(s in n=i.styles)for(a in r=n[s])!l[o=r[a].fontFamily]&&c[o]&&(l[o]=!0);for(var d in l)h+=["\t\t@font-face {\n","\t\t\tfont-family: '",d,"';\n","\t\t\tsrc: url('",c[d],"');\n","\t\t}\n"].join("");return h&&(h=['\t<style type="text/css">',"<![CDATA[\n",h,"]]>","</style>\n"].join("")),h},createSVGRefElementsMarkup:function(t){var e=[];return T(e,t,"backgroundColor"),T(e,t,"overlayColor"),e.join("")}})}(exports),fabric.ElementsParser=function(t,e,i,o){this.elements=t,this.callback=e,this.options=i,this.reviver=o,this.svgUid=i&&i.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var t=0,e=this.elements.length;t<e;t++)this.elements[t].setAttribute("svgUid",this.svgUid),function(t,e){setTimeout(function(){t.createObject(t.elements[e],e)},0)}(this,t)},fabric.ElementsParser.prototype.createObject=function(t,e){var i=fabric[fabric.util.string.capitalize(t.tagName.replace("svg:",""))];if(i&&i.fromElement)try{this._createObject(i,t,e)}catch(t){fabric.log(t)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(t,e,i){if(t.async)t.fromElement(e,this.createCallback(i,e),this.options);else{var o=t.fromElement(e,this.options);this.resolveGradient(o,"fill"),this.resolveGradient(o,"stroke"),this.reviver&&this.reviver(e,o),this.instances[i]=o,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(t,e){var i=this;return function(o){i.resolveGradient(o,"fill"),i.resolveGradient(o,"stroke"),i.reviver&&i.reviver(e,o),i.instances[t]=o,i.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(t,e){var i=t.get(e);if(/^url\(/.test(i)){var o=i.slice(5,i.length-1);fabric.gradientDefs[this.svgUid][o]&&t.set(e,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][o],t))}},fabric.ElementsParser.prototype.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances))},function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t,e){this.x=t,this.y=e}e.Point?e.warn("fabric.Point is already defined"):(e.Point=i,i.prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){return void 0===e&&(e=.5),e=Math.max(Math.min(1,e),0),new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i},clone:function(){return new i(this.x,this.y)}})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){this.status=t,this.points=[]}e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=i,e.Intersection.prototype={constructor:i,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},e.Intersection.intersectLineLine=function(t,o,n,r){var s,a=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),h=(o.x-t.x)*(t.y-n.y)-(o.y-t.y)*(t.x-n.x),l=(r.y-n.y)*(o.x-t.x)-(r.x-n.x)*(o.y-t.y);if(0!==l){var c=a/l,u=h/l;0<=c&&c<=1&&0<=u&&u<=1?(s=new i("Intersection")).appendPoint(new e.Point(t.x+c*(o.x-t.x),t.y+c*(o.y-t.y))):s=new i}else s=new i(0===a||0===h?"Coincident":"Parallel");return s},e.Intersection.intersectLinePolygon=function(t,e,o){for(var n,r,s,a=new i,h=o.length,l=0;l<h;l++)n=o[l],r=o[(l+1)%h],s=i.intersectLineLine(t,e,n,r),a.appendPoints(s.points);return a.points.length>0&&(a.status="Intersection"),a},e.Intersection.intersectPolygonPolygon=function(t,e){for(var o=new i,n=t.length,r=0;r<n;r++){var s=t[r],a=t[(r+1)%n],h=i.intersectLinePolygon(s,a,e);o.appendPoints(h.points)}return o.points.length>0&&(o.status="Intersection"),o},e.Intersection.intersectPolygonRectangle=function(t,o,n){var r=o.min(n),s=o.max(n),a=new e.Point(s.x,r.y),h=new e.Point(r.x,s.y),l=i.intersectLinePolygon(r,a,t),c=i.intersectLinePolygon(a,s,t),u=i.intersectLinePolygon(s,h,t),p=i.intersectLinePolygon(h,r,t),d=new i;return d.appendPoints(l.points),d.appendPoints(c.points),d.appendPoints(u.points),d.appendPoints(p.points),d.points.length>0&&(d.status="Intersection"),d})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function o(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}e.Color?e.warn("fabric.Color is already defined."):(e.Color=i,e.Color.prototype={_tryParsingColor:function(t){var e;t in i.colorNameMap&&(t=i.colorNameMap[t]),"transparent"===t&&(e=[255,255,255,0]),e||(e=i.sourceFromHex(t)),e||(e=i.sourceFromRgb(t)),e||(e=i.sourceFromHsl(t)),e||(e=[0,0,0,1]),e&&this.setSource(e)},_rgbToHsl:function(t,i,o){t/=255,i/=255,o/=255;var n,r,s,a=e.util.array.max([t,i,o]),h=e.util.array.min([t,i,o]);if(s=(a+h)/2,a===h)n=r=0;else{var l=a-h;switch(r=s>.5?l/(2-a-h):l/(a+h),a){case t:n=(i-o)/l+(i<o?6:0);break;case i:n=(o-t)/l+2;break;case o:n=(t-i)/l+4}n/=6}return[Math.round(360*n),Math.round(100*r),Math.round(100*s)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,o=this.getSource();return t=1===(t=o[0].toString(16)).length?"0"+t:t,e=1===(e=o[1].toString(16)).length?"0"+e:e,i=1===(i=o[2].toString(16)).length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),o=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,o]),this},overlayWith:function(t){t instanceof i||(t=new i(t));for(var e=[],o=this.getAlpha(),n=this.getSource(),r=t.getSource(),s=0;s<3;s++)e.push(Math.round(.5*n[s]+.5*r[s]));return e[3]=o,this.setSource(e),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},e.Color.fromRgb=function(t){return i.fromSource(i.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var e=t.match(i.reRGBa);if(e){var o=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),n=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),r=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(o,10),parseInt(n,10),parseInt(r,10),e[4]?parseFloat(e[4]):1]}},e.Color.fromRgba=i.fromRgb,e.Color.fromHsl=function(t){return i.fromSource(i.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var e=t.match(i.reHSLa);if(e){var n,r,s,a=(parseFloat(e[1])%360+360)%360/360,h=parseFloat(e[2])/(/%$/.test(e[2])?100:1),l=parseFloat(e[3])/(/%$/.test(e[3])?100:1);if(0===h)n=r=s=l;else{var c=l<=.5?l*(h+1):l+h-l*h,u=2*l-c;n=o(u,c,a+1/3),r=o(u,c,a),s=o(u,c,a-1/3)}return[Math.round(255*n),Math.round(255*r),Math.round(255*s),e[4]?parseFloat(e[4]):1]}},e.Color.fromHsla=i.fromHsl,e.Color.fromHex=function(t){return i.fromSource(i.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(i.reHex)){var e=t.slice(t.indexOf("#")+1),o=3===e.length||4===e.length,n=8===e.length||4===e.length,r=o?e.charAt(0)+e.charAt(0):e.substring(0,2),s=o?e.charAt(1)+e.charAt(1):e.substring(2,4),a=o?e.charAt(2)+e.charAt(2):e.substring(4,6),h=n?o?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(r,16),parseInt(s,16),parseInt(a,16),parseFloat((parseInt(h,16)/255).toFixed(2))]}},e.Color.fromSource=function(t){var e=new i;return e.setSource(t),e})}(exports),function(){function t(t){var e,i,o,n=t.getAttribute("style"),r=t.getAttribute("offset")||0;if(r=(r=parseFloat(r)/(/%$/.test(r)?100:1))<0?0:r>1?1:r,n){var s=n.split(/\s*;\s*/);""===s[s.length-1]&&s.pop();for(var a=s.length;a--;){var h=s[a].split(/\s*:\s*/),l=h[0].trim(),c=h[1].trim();"stop-color"===l?e=c:"stop-opacity"===l&&(o=c)}}return e||(e=t.getAttribute("stop-color")||"rgb(0,0,0)"),o||(o=t.getAttribute("stop-opacity")),i=(e=new fabric.Color(e)).getAlpha(),o=isNaN(parseFloat(o))?1:parseFloat(o),o*=i,{offset:r,color:e.toRgb(),opacity:o}}function e(t,e,i){var o,n=0,r=1,s="";for(var a in e)"Infinity"===e[a]?e[a]=1:"-Infinity"===e[a]&&(e[a]=0),o=parseFloat(e[a],10),r="string"==typeof e[a]&&/^\d+%$/.test(e[a])?.01:1,"x1"===a||"x2"===a||"r2"===a?(r*="objectBoundingBox"===i?t.width:1,n="objectBoundingBox"===i&&t.left||0):"y1"!==a&&"y2"!==a||(r*="objectBoundingBox"===i?t.height:1,n="objectBoundingBox"===i&&t.top||0),e[a]=o*r+n;if("ellipse"===t.type&&null!==e.r2&&"objectBoundingBox"===i&&t.rx!==t.ry){var h=t.ry/t.rx;s=" scale(1, "+h+")",e.y1&&(e.y1/=h),e.y2&&(e.y2/=h)}return s}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(t){t||(t={});var e={};this.id=fabric.Object.__uid++,this.type=t.type||"linear",e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice(),t.gradientTransform&&(this.gradientTransform=t.gradientTransform),this.offsetX=t.offsetX||this.offsetX,this.offsetY=t.offsetY||this.offsetY},addColorStop:function(t){for(var e in t){var i=new fabric.Color(t[e]);this.colorStops.push({offset:e,color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(t){var e={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return fabric.util.populateWithProperties(this,e,t),e},toSVG:function(t){var e,i,o=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(t,e){return t.offset-e.offset}),!t.group||"path-group"!==t.group.type)for(var n in o)"x1"===n||"x2"===n||"r2"===n?o[n]+=this.offsetX-t.width/2:"y1"!==n&&"y2"!==n||(o[n]+=this.offsetY-t.height/2);i='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(i+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?e=["<linearGradient ",i,' x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,'">\n']:"radial"===this.type&&(e=["<radialGradient ",i,' cx="',o.x2,'" cy="',o.y2,'" r="',o.r2,'" fx="',o.x1,'" fy="',o.y1,'">\n']);for(var r=0;r<this.colorStops.length;r++)e.push("<stop ",'offset="',100*this.colorStops[r].offset+"%",'" style="stop-color:',this.colorStops[r].color,null!==this.colorStops[r].opacity?";stop-opacity: "+this.colorStops[r].opacity:";",'"/>\n');return e.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),e.join("")},toLive:function(t,e){var i,o,n=fabric.util.object.clone(this.coords);if(this.type){if(e.group&&"path-group"===e.group.type)for(o in n)"x1"===o||"x2"===o?n[o]+=-this.offsetX+e.width/2:"y1"!==o&&"y2"!==o||(n[o]+=-this.offsetY+e.height/2);"linear"===this.type?i=t.createLinearGradient(n.x1,n.y1,n.x2,n.y2):"radial"===this.type&&(i=t.createRadialGradient(n.x1,n.y1,n.r1,n.x2,n.y2,n.r2));for(var r=0,s=this.colorStops.length;r<s;r++){var a=this.colorStops[r].color,h=this.colorStops[r].opacity,l=this.colorStops[r].offset;void 0!==h&&(a=new fabric.Color(a).setAlpha(h).toRgba()),i.addColorStop(parseFloat(l),a)}return i}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(i,o){var n,r,s,a=i.getElementsByTagName("stop"),h=i.getAttribute("gradientUnits")||"objectBoundingBox",l=i.getAttribute("gradientTransform"),c=[];"linear"===(n="linearGradient"===i.nodeName||"LINEARGRADIENT"===i.nodeName?"linear":"radial")?r=function(t){return{x1:t.getAttribute("x1")||0,y1:t.getAttribute("y1")||0,x2:t.getAttribute("x2")||"100%",y2:t.getAttribute("y2")||0}}(i):"radial"===n&&(r=function(t){return{x1:t.getAttribute("fx")||t.getAttribute("cx")||"50%",y1:t.getAttribute("fy")||t.getAttribute("cy")||"50%",r1:0,x2:t.getAttribute("cx")||"50%",y2:t.getAttribute("cy")||"50%",r2:t.getAttribute("r")||"50%"}}(i));for(var u=a.length;u--;)c.push(t(a[u]));s=e(o,r,h);var p=new fabric.Gradient({type:n,coords:r,colorStops:c,offsetX:-o.left,offsetY:-o.top});return(l||""!==s)&&(p.gradientTransform=fabric.parseTransformAttribute((l||"")+s)),p},forObject:function(t,i){return i||(i={}),e(t,i.coords,"userSpaceOnUse"),new fabric.Gradient(i)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){if(t||(t={}),this.id=fabric.Object.__uid++,t.source)if("string"==typeof t.source)if(void 0!==fabric.util.getFunctionBody(t.source))this.source=new Function(fabric.util.getFunctionBody(t.source));else{var e=this;this.source=fabric.util.createImage(),fabric.util.loadImage(t.source,function(t){e.source=t})}else this.source=t.source;t.repeat&&(this.repeat=t.repeat),t.offsetX&&(this.offsetX=t.offsetX),t.offsetY&&(this.offsetY=t.offsetY)},toObject:function(t){var e,i;return"function"==typeof this.source?e=String(this.source):"string"==typeof this.source.src?e=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(e=this.source.toDataURL()),i={source:e,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY},fabric.util.populateWithProperties(this,i,t),i},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.getWidth(),o=e.height/t.getHeight(),n=this.offsetX/t.getWidth(),r=this.offsetY/t.getHeight(),s="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(o=1),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1),e.src?s=e.src:e.toDataURL&&(s=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+n+'" y="'+r+'" width="'+i+'" height="'+o+'">\n<image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+s+'"></image>\n</pattern>\n'},toLive:function(t){var e="function"==typeof this.source?this.source():this.source;if(!e)return"";if(void 0!==e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.toFixed;e.Shadow?e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(t){for(var i in"string"==typeof t&&(t=this._parseShadow(t)),t)this[i]=t[i];this.id=e.Object.__uid++},_parseShadow:function(t){var i=t.trim(),o=e.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(o[1],10)||0,offsetY:parseInt(o[2],10)||0,blur:parseInt(o[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var o=40,n=40,r=e.Object.NUM_FRACTION_DIGITS,s=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-t.angle));return t.width&&t.height&&(o=100*i((Math.abs(s.x)+this.blur)/t.width,r)+20,n=100*i((Math.abs(s.y)+this.blur)/t.height,r)+20),t.flipX&&(s.x*=-1),t.flipY&&(s.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+n+'%" height="'+(100+2*n)+'%" x="-'+o+'%" width="'+(100+2*o)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,r)+'"></feGaussianBlur>\n\t<feOffset dx="'+i(s.x,r)+'" dy="'+i(s.y,r)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var t={},i=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(e){this[e]!==i[e]&&(t[e]=this[e])},this),t}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}(exports),function(){"use strict";if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var t=fabric.util.object.extend,e=fabric.util.getElementOffset,i=fabric.util.removeFromArray,o=fabric.util.toFixed,n=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(t,e){e||(e={}),this._initStatic(t,e)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(t,e){var i=fabric.StaticCanvas.prototype.renderAll.bind(this);this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,i),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,i),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,i),e.overlayColor&&this.setOverlayColor(e.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(t,e,i,o){return"string"==typeof e?fabric.util.loadImage(e,function(e){e&&(this[t]=new fabric.Image(e,o)),i&&i(e)},this,o&&o.crossOrigin):(o&&e.setOptions(o),this[t]=e,i&&i(e)),this},__setBgOverlayColor:function(t,e,i){if(e&&e.source){var o=this;fabric.util.loadImage(e.source,function(n){o[t]=new fabric.Pattern({source:n,repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY}),i&&i()})}else this[t]=e,i&&i();return this},_createCanvasElement:function(t){var e=fabric.util.createCanvasElement(t);if(e.style||(e.style={}),!e)throw n;if(void 0===e.getContext)throw n;return e},_initOptions:function(t){for(var e in t)this[e]=t[e];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(t),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;for(var o in e=e||{},t)i=t[o],e.cssOnly||(this._setBackstoreDimension(o,t[o]),i+="px"),e.backstoreOnly||this._setCssDimension(o,i);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),e.cssOnly||this.renderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(t){var e,i=this._activeGroup;this.viewportTransform=t;for(var o=0,n=this._objects.length;o<n;o++)(e=this._objects[o]).group||e.setCoords(!1,!0);return i&&i.setCoords(!1,!0),this.renderAll(),this},zoomToPoint:function(t,e){var i=t,o=this.viewportTransform.slice(0);t=fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform)),o[0]=e,o[3]=e;var n=fabric.util.transformPoint(t,o);return o[4]+=i.x-n.x,o[5]+=i.y-n.y,this.setViewportTransform(o)},setZoom:function(t){return this.zoomToPoint(new fabric.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new fabric.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("selection:cleared",this._canvasITextSelectionClearedHanlder),this.off("object:selected",this._canvasITextSelectionClearedHanlder),this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderCanvas:function(t,e){this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),t.save(),t.transform.apply(t,this.viewportTransform),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render")},_renderObjects:function(t,e){for(var i=0,o=e.length;i<o;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"];i&&(t.fillStyle=i.toLive?i.toLive(t):i,t.fillRect(i.offsetX||0,i.offsetY||0,this.width,this.height)),(i=this[e+"Image"])&&(this[e+"Vpt"]&&(t.save(),t.transform.apply(t,this.viewportTransform)),i.render(t),this[e+"Vpt"]&&t.restore())},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(t){return this._centerObject(t,new fabric.Point(this.getCenter().left,t.getCenterPoint().y))},centerObjectV:function(t){return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,this.getCenter().top))},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new fabric.Point(e.left,e.top))},viewportCenterObject:function(t){var e=this.getVpCenter();return this._centerObject(t,e)},viewportCenterObjectH:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(e.x,t.getCenterPoint().y)),this},viewportCenterObjectV:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,e.y))},getVpCenter:function(){var t=this.getCenter(),e=fabric.util.invertTransform(this.viewportTransform);return fabric.util.transformPoint({x:t.left,y:t.top},e)},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),this.renderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var o={objects:this._toObjects(e,i)};return t(o,this.__serializeBgOverlay(e,i)),fabric.util.populateWithProperties(this,o,i),o},_toObjects:function(t,e){return this.getObjects().filter(function(t){return!t.excludeFromExport}).map(function(i){return this._toObject(i,t,e)},this)},_toObject:function(t,e,i){var o;this.includeDefaultValues||(o=t.includeDefaultValues,t.includeDefaultValues=!1);var n=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=o),n},__serializeBgOverlay:function(t,e){var i={};return this.backgroundColor&&(i.background=this.backgroundColor.toObject?this.backgroundColor.toObject(e):this.backgroundColor),this.overlayColor&&(i.overlay=this.overlayColor.toObject?this.overlayColor.toObject(e):this.overlayColor),this.backgroundImage&&(i.backgroundImage=this._toObject(this.backgroundImage,t,e)),this.overlayImage&&(i.overlayImage=this._toObject(this.overlayImage,t,e)),i},svgViewportTransformation:!0,toSVG:function(t,e){t||(t={});var i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage",e),this._setSVGObjects(i,e),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage",e),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var i,n=e.width||this.width,r=e.height||this.height,s='viewBox="0 0 '+this.width+" "+this.height+'" ',a=fabric.Object.NUM_FRACTION_DIGITS;e.viewBox?s='viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,s='viewBox="'+o(-i[4]/i[0],a)+" "+o(-i[5]/i[3],a)+" "+o(this.width/i[0],a)+" "+o(this.height/i[3],a)+'" '),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n,'" ','height="',r,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,s,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(t,e){for(var i,o=0,n=this.getObjects(),r=n.length;o<r;o++)(i=n[o]).excludeFromExport||this._setSVGObject(t,i,e)},_setSVGObject:function(t,e,i){t.push(e.toSVG(i))},_setSVGBgOverlayImage:function(t,e,i){this[e]&&this[e].toSVG&&t.push(this[e].toSVG(i))},_setSVGBgOverlayColor:function(t,e){this[e]&&this[e].source?t.push('<rect x="',this[e].offsetX,'" y="',this[e].offsetY,'" ','width="',"repeat-y"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.width:this.width,'" height="',"repeat-x"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.height:this.height,'" fill="url(#'+e+'Pattern)"',"></rect>\n"):this[e]&&"overlayColor"===e&&t.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[e],'"',"></rect>\n")},sendToBack:function(t){if(!t)return this;var e,o,n,r=this._activeGroup;if(t===r)for(e=(n=r._objects).length;e--;)o=n[e],i(this._objects,o),this._objects.unshift(o);else i(this._objects,t),this._objects.unshift(t);return this.renderAll&&this.renderAll()},bringToFront:function(t){if(!t)return this;var e,o,n,r=this._activeGroup;if(t===r)for(n=r._objects,e=0;e<n.length;e++)o=n[e],i(this._objects,o),this._objects.push(o);else i(this._objects,t),this._objects.push(t);return this.renderAll&&this.renderAll()},sendBackwards:function(t,e){if(!t)return this;var o,n,r,s,a,h=this._activeGroup;if(t===h)for(a=h._objects,o=0;o<a.length;o++)n=a[o],0!==(r=this._objects.indexOf(n))&&(s=r-1,i(this._objects,n),this._objects.splice(s,0,n));else 0!==(r=this._objects.indexOf(t))&&(s=this._findNewLowerIndex(t,r,e),i(this._objects,t),this._objects.splice(s,0,t));return this.renderAll&&this.renderAll(),this},_findNewLowerIndex:function(t,e,i){var o;if(i){o=e;for(var n=e-1;n>=0;--n){if(t.intersectsWithObject(this._objects[n])||t.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(t)){o=n;break}}}else o=e-1;return o},bringForward:function(t,e){if(!t)return this;var o,n,r,s,a,h=this._activeGroup;if(t===h)for(o=(a=h._objects).length;o--;)n=a[o],(r=this._objects.indexOf(n))!==this._objects.length-1&&(s=r+1,i(this._objects,n),this._objects.splice(s,0,n));else(r=this._objects.indexOf(t))!==this._objects.length-1&&(s=this._findNewUpperIndex(t,r,e),i(this._objects,t),this._objects.splice(s,0,t));return this.renderAll&&this.renderAll(),this},_findNewUpperIndex:function(t,e,i){var o;if(i){o=e;for(var n=e+1;n<this._objects.length;++n){if(t.intersectsWithObject(this._objects[n])||t.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(t)){o=n;break}}}else o=e+1;return o},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),t(fabric.StaticCanvas.prototype,fabric.Observable),t(fabric.StaticCanvas.prototype,fabric.Collection),t(fabric.StaticCanvas.prototype,fabric.DataURLExporter),t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=fabric.util.createCanvasElement();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return void 0!==i.getImageData;case"setLineDash":return void 0!==i.setLineDash;case"toDataURL":return void 0!==e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(t){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var t=this.canvas.contextTop,e=this.canvas.getZoom();t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*e,t.shadowOffsetX=this.shadow.offsetX*e,t.shadowOffsetY=this.shadow.offsetY*e}},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){this._points.push(t)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);this._addPoint(e)},_render:function(){var t=this.canvas.contextTop,e=this.canvas.viewportTransform,i=this._points[0],o=this._points[1];t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.beginPath(),2===this._points.length&&i.x===o.x&&i.y===o.y&&(i.x-=.5,o.x+=.5),t.moveTo(i.x,i.y);for(var n=1,r=this._points.length;n<r;n++){var s=i.midPointFrom(o);t.quadraticCurveTo(i.x,i.y,s.x,s.y),i=this._points[n],o=this._points[n+1]}t.lineTo(i.x,i.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var e=[],i=new fabric.Point(t[0].x,t[0].y),o=new fabric.Point(t[1].x,t[1].y);e.push("M ",t[0].x," ",t[0].y," ");for(var n=1,r=t.length;n<r;n++){var s=i.midPointFrom(o);e.push("Q ",i.x," ",i.y," ",s.x," ",s.y," "),i=new fabric.Point(t[n].x,t[n].y),n+1<t.length&&(o=new fabric.Point(t[n+1].x,t[n+1].y))}return e.push("L ",i.x," ",i.y," "),e},createPath:function(t){var e=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"!==t){var e=this.createPath(t);this.canvas.add(e),e.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:e})}else this.canvas.renderAll()}}),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop,o=this.canvas.viewportTransform;i.save(),i.transform(o[0],o[1],o[2],o[3],o[4],o[5]),i.fillStyle=e.fill,i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.closePath(),i.fill(),i.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,o=this.points.length;i<o;i++){var n=this.points[i],r=new fabric.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill});this.shadow&&r.setShadow(this.shadow),e.push(r)}var s=new fabric.Group(e,{originX:"center",originY:"center"});s.canvas=this.canvas,this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,o=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=o,this.points.push(e),e}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render()},onMouseMove:function(t){this.addSprayChunk(t),this.render()},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,o=this.sprayChunks.length;i<o;i++)for(var n=this.sprayChunks[i],r=0,s=n.length;r<s;r++){var a=new fabric.Rect({width:n[r].width,height:n[r].width,left:n[r].x+1,top:n[r].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&a.setShadow(this.shadow),e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var h=new fabric.Group(e,{originX:"center",originY:"center"});h.canvas=this.canvas,this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},_getOptimizedRects:function(t){for(var e,i={},o=0,n=t.length;o<n;o++)i[e=t[o].left+""+t[o].top]||(i[e]=t[o]);var r=[];for(e in i)r.push(i[e]);return r},render:function(){var t=this.canvas.contextTop;t.fillStyle=this.color;var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]);for(var i=0,o=this.sprayChunkPoints.length;i<o;i++){var n=this.sprayChunkPoints[i];void 0!==n.opacity&&(t.globalAlpha=n.opacity),t.fillRect(n.x,n.y,n.width,n.width)}t.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];for(var e,i,o,n=this.width/2,r=0;r<this.density;r++){e=fabric.util.getRandomInt(t.x-n,t.x+n),i=fabric.util.getRandomInt(t.y-n,t.y+n),o=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var s=new fabric.Point(e,i);s.width=o,this.randomOpacity&&(s.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=fabric.document.createElement("canvas"),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var e=this.callSuper("createPath",t),i=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),e}}),function(){var t=fabric.util.getPointer,e=fabric.util.degreesToRadians,i=fabric.util.radiansToDegrees,o=Math.atan2,n=Math.abs,r=fabric.StaticCanvas.supports("setLineDash");for(var s in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){e||(e={}),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,e=this.getActiveGroup(),i=this.getActiveObject(),o=[],n=[];if(!e&&!i||this.preserveObjectStacking)o=this._objects;else{for(var r=0,s=this._objects.length;r<s;r++)t=this._objects[r],e&&e.contains(t)||t===i?n.push(t):o.push(t);e&&(e._set("_objects",n),o.push(e)),i&&o.push(i)}return o},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.selection&&this._groupSelector&&this._drawSelection(t),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(t.target)?"rotate"===t.action?this._setOriginToCenter(t.target):("center"!==t.originX&&("right"===t.originX?t.mouseXSign=-1:t.mouseXSign=1),"center"!==t.originY&&("bottom"===t.originY?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(t,e,i){var o,n=i||this.getPointer(t,!0);return o=e.group&&e.group===this.getActiveGroup()?this._normalizePointer(e.group,n):{x:n.x,y:n.y},e.containsPoint(o)||e._findTargetCorner(n)},_normalizePointer:function(t,e){var i=t.calcTransformMatrix(),o=fabric.util.invertTransform(i),n=this.restorePointerVpt(e);return fabric.util.transformPoint(n,o)},isTargetTransparent:function(t,e,i){var o=t.hasBorders,n=t.transparentCorners,r=this.contextCache,s=t.selectionBackgroundColor;t.hasBorders=t.transparentCorners=!1,t.selectionBackgroundColor="",r.save(),r.transform.apply(r,this.viewportTransform),t.render(r),r.restore(),t.active&&t._renderControls(r),t.hasBorders=o,t.transparentCorners=n,t.selectionBackgroundColor=s;var a=fabric.util.isTransparent(r,e,i,this.targetFindTolerance);return this.clearContext(r),a},_shouldClearSelection:function(t,e){var i=this.getActiveGroup(),o=this.getActiveObject();return!e||e&&i&&!i.contains(e)&&i!==e&&!t[this.selectionKey]||e&&!e.evented||e&&!e.selectable&&o&&o!==e},_shouldCenterTransform:function(t){if(t){var e,i=this._currentTransform;return"scale"===i.action||"scaleX"===i.action||"scaleY"===i.action?e=this.centeredScaling||t.centeredScaling:"rotate"===i.action&&(e=this.centeredRotation||t.centeredRotation),e?!i.altKey:i.altKey}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":"mr"!==e&&"tr"!==e&&"br"!==e||(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":"bl"!==e&&"mb"!==e&&"br"!==e||(i.y="top"),i},_getActionFromCorner:function(t,e,i){if(!e)return"drag";switch(e){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,i){if(i){var o=this.getPointer(t),n=i._findTargetCorner(this.getPointer(t,!0)),r=this._getActionFromCorner(i,n,t),s=this._getOriginFromCorner(i,n);this._currentTransform={target:i,action:r,corner:n,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:o.x-i.left,offsetY:o.y-i.top,originX:s.x,originY:s.y,ex:o.x,ey:o.y,lastX:o.x,lastY:o.y,left:i.left,top:i.top,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]},this._currentTransform.original={left:i.left,top:i.top,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,originX:s.x,originY:s.y},this._resetCurrentTransform()}},_translateObject:function(t,e){var i=this._currentTransform,o=i.target,n=t-i.offsetX,r=e-i.offsetY,s=!o.get("lockMovementX")&&o.left!==n,a=!o.get("lockMovementY")&&o.top!==r;return s&&o.set("left",n),a&&o.set("top",r),s||a},_changeSkewTransformOrigin:function(t,e,i){var o="originX",n={0:"center"},r=e.target.skewX,s="left",a="right",h="mt"===e.corner||"ml"===e.corner?1:-1,l=1;t=t>0?1:-1,"y"===i&&(r=e.target.skewY,s="top",a="bottom",o="originY"),n[-1]=s,n[1]=a,e.target.flipX&&(l*=-1),e.target.flipY&&(l*=-1),0===r?(e.skewSign=-h*t*l,e[o]=n[-t]):(r=r>0?1:-1,e.skewSign=r,e[o]=n[r*h*l])},_skewObject:function(t,e,i){var o,n=this._currentTransform,r=n.target,s=r.get("lockSkewingX"),a=r.get("lockSkewingY");if(s&&"x"===i||a&&"y"===i)return!1;var h,l,c=r.getCenterPoint(),u=r.toLocalPoint(new fabric.Point(t,e),"center","center")[i],p=r.toLocalPoint(new fabric.Point(n.lastX,n.lastY),"center","center")[i],d=r._getTransformedDimensions();return this._changeSkewTransformOrigin(u-p,n,i),h=r.toLocalPoint(new fabric.Point(t,e),n.originX,n.originY)[i],l=r.translateToOriginPoint(c,n.originX,n.originY),o=this._setObjectSkew(h,n,i,d),n.lastX=t,n.lastY=e,r.setPositionByOrigin(l,n.originX,n.originY),o},_setObjectSkew:function(t,e,i,o){var n,r,s,a,h,l,c,u,p,d,f=e.target,g=e.skewSign;return"x"===i?(h="y",l="Y",c="X",p=0,d=f.skewY):(h="x",l="X",c="Y",p=f.skewX,d=0),a=f._getTransformedDimensions(p,d),(u=2*Math.abs(t)-a[i])<=2?n=0:(n=g*Math.atan(u/f["scale"+c]/(a[h]/f["scale"+l])),n=fabric.util.radiansToDegrees(n)),r=f["skew"+c]!==n,f.set("skew"+c,n),0!==f["skew"+l]&&(s=f._getTransformedDimensions(),n=o[h]/s[h]*f["scale"+l],f.set("scale"+l,n)),r},_scaleObject:function(t,e,i){var o=this._currentTransform,n=o.target,r=n.get("lockScalingX"),s=n.get("lockScalingY"),a=n.get("lockScalingFlip");if(r&&s)return!1;var h,l=n.translateToOriginPoint(n.getCenterPoint(),o.originX,o.originY),c=n.toLocalPoint(new fabric.Point(t,e),o.originX,o.originY),u=n._getTransformedDimensions();return this._setLocalMouse(c,o),h=this._setObjectScale(c,o,r,s,i,a,u),n.setPositionByOrigin(l,o.originX,o.originY),h},_setObjectScale:function(t,e,i,o,n,r,s){var a,h,l,c,u=e.target,p=!1,d=!1,f=!1;return l=t.x*u.scaleX/s.x,c=t.y*u.scaleY/s.y,a=u.scaleX!==l,h=u.scaleY!==c,r&&l<=0&&l<u.scaleX&&(p=!0),r&&c<=0&&c<u.scaleY&&(d=!0),"equally"!==n||i||o?n?"x"!==n||u.get("lockUniScaling")?"y"!==n||u.get("lockUniScaling")||d||o||u.set("scaleY",c)&&(f=f||h):p||i||u.set("scaleX",l)&&(f=f||a):(p||i||u.set("scaleX",l)&&(f=f||a),d||o||u.set("scaleY",c)&&(f=f||h)):p||d||(f=this._scaleObjectEqually(t,u,e,s)),e.newScaleX=l,e.newScaleY=c,p||d||this._flipObject(e,n),f},_scaleObjectEqually:function(t,e,i,o){var n,r=t.y+t.x,s=o.y*i.original.scaleY/e.scaleY+o.x*i.original.scaleX/e.scaleX;return i.newScaleX=i.original.scaleX*r/s,i.newScaleY=i.original.scaleY*r/s,n=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY,e.set("scaleX",i.newScaleX),e.set("scaleY",i.newScaleY),n},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),n(t.x)>i.padding?t.x<0?t.x+=i.padding:t.x-=i.padding:t.x=0,n(t.y)>i.padding?t.y<0?t.y+=i.padding:t.y-=i.padding:t.y=0},_rotateObject:function(t,e){var n=this._currentTransform;if(n.target.get("lockRotation"))return!1;var r=o(n.ey-n.top,n.ex-n.left),s=o(e-n.top,t-n.left),a=i(s-r+n.theta),h=!0;if(a<0&&(a=360+a),a%=360,n.target.snapAngle>0){var l=n.target.snapAngle,c=n.target.snapThreshold||l,u=Math.ceil(a/l)*l,p=Math.floor(a/l)*l;Math.abs(a-p)<c?a=p:Math.abs(a-u)<c&&(a=u),n.target.angle===a&&(h=!1)}return n.target.angle=a,h},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.setAngle(0)},_drawSelection:function(t){var e=this._groupSelector,i=e.left,o=e.top,s=n(i),a=n(o);if(this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(i>0?0:-i),e.ey-(o>0?0:-o),s,a)),this.selectionLineWidth&&this.selectionBorderColor)if(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!r){var h=e.ex+.5-(i>0?0:s),l=e.ey+.5-(o>0?0:a);t.beginPath(),fabric.util.drawDashedLine(t,h,l,h+s,l,this.selectionDashArray),fabric.util.drawDashedLine(t,h,l+a-1,h+s,l+a-1,this.selectionDashArray),fabric.util.drawDashedLine(t,h,l,h,l+a,this.selectionDashArray),fabric.util.drawDashedLine(t,h+s-1,l,h+s-1,l+a,this.selectionDashArray),t.closePath(),t.stroke()}else fabric.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(e.ex+.5-(i>0?0:s),e.ey+.5-(o>0?0:a),s,a)},findTarget:function(t,e){if(!this.skipTargetFind){var i,o=this.getPointer(t,!0),n=this.getActiveGroup(),r=this.getActiveObject();if(n&&!e&&this._checkTarget(o,n))return this._fireOverOutEvents(n,t),n;if(r&&r._findTargetCorner(o))return this._fireOverOutEvents(r,t),r;if(r&&this._checkTarget(o,r)){if(!this.preserveObjectStacking)return this._fireOverOutEvents(r,t),r;i=r}this.targets=[];var s=this._searchPossibleTargets(this._objects,o);return t[this.altSelectionKey]&&s&&i&&s!==i&&(s=i),this._fireOverOutEvents(s,t),s}},_fireOverOutEvents:function(t,e){t?this._hoveredTarget!==t&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:t,e:e}),t.fire("mouseover"),this._hoveredTarget=t):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(t,e){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,t.x,t.y))return!0}},_searchPossibleTargets:function(t,e){for(var i,o,n,r=t.length;r--;)if(this._checkTarget(e,t[r])){"group"===(i=t[r]).type&&i.subTargetCheck&&(o=this._normalizePointer(i,e),(n=this._searchPossibleTargets(i._objects,o))&&this.targets.push(n));break}return i},restorePointerVpt:function(t){return fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(e,i,o){o||(o=this.upperCanvasEl);var n,r=t(e),s=o.getBoundingClientRect(),a=s.width||0,h=s.height||0;return a&&h||("top"in s&&"bottom"in s&&(h=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(a=Math.abs(s.right-s.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,i||(r=this.restorePointerVpt(r)),n=0===a||0===h?{width:1,height:1}:{width:o.width/a,height:o.height/h},{x:r.x*n.width,y:r.y*n.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.getWidth()||t.width,i=this.getHeight()||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(t){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=t,t.set("active",!0)},setActiveObject:function(t,e){return this._setActiveObject(t),this.renderAll(),this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e}),this},getActiveObject:function(){return this._activeObject},_onObjectRemoved:function(t){this.getActiveObject()===t&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),this.callSuper("_onObjectRemoved",t)},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(t){var e=this._activeObject;return this.fire("before:selection:cleared",{target:e,e:t}),this._discardActiveObject(),this.fire("selection:cleared",{e:t}),e&&e.fire("deselected",{e:t}),this},_setActiveGroup:function(t){this._activeGroup=t,t&&t.set("active",!0)},setActiveGroup:function(t,e){return this._setActiveGroup(t),t&&(this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var t=this.getActiveGroup();t&&t.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(t){var e=this.getActiveGroup();return this.fire("before:selection:cleared",{e:t,target:e}),this._discardActiveGroup(),this.fire("selection:cleared",{e:t}),this},deactivateAll:function(){for(var t,e=this.getObjects(),i=0,o=e.length;i<o;i++)(t=e[i])&&t.set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(t){var e=this.getActiveGroup(),i=this.getActiveObject();return(i||e)&&this.fire("before:selection:cleared",{target:i||e,e:t}),this.deactivateAll(),(i||e)&&(this.fire("selection:cleared",{e:t,target:i}),i&&i.fire("deselected")),this},dispose:function(){this.callSuper("dispose");var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,this},clear:function(){return this.discardActiveGroup(),this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this.getActiveGroup();e?e._renderControls(t):this._drawObjectsControls(t)},_drawObjectsControls:function(t){for(var e=0,i=this._objects.length;e<i;++e)this._objects[e]&&this._objects[e].active&&this._objects[e]._renderControls(t)},_toObject:function(t,e,i){var o=this._realizeGroupTransformOnObject(t),n=this.callSuper("_toObject",t,e,i);return this._unwindGroupTransformOnObject(t,o),n},_realizeGroupTransformOnObject:function(t){if(t.group&&t.group===this.getActiveGroup()){var e={};return["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"].forEach(function(i){e[i]=t[i]}),this.getActiveGroup().realizeTransform(t),e}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,i){var o;o=this._realizeGroupTransformOnObject(e),this.callSuper("_setSVGObject",t,e,i),this._unwindGroupTransformOnObject(e,o)}}),fabric.StaticCanvas)"prototype"!==s&&(fabric.Canvas[s]=fabric.StaticCanvas[s]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var t={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=fabric.util.addListener,i=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),e(fabric.window,"resize",this._onResize),e(this.upperCanvasEl,"mousedown",this._onMouseDown),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"mouseout",this._onMouseOut),e(this.upperCanvasEl,"mouseenter",this._onMouseEnter),e(this.upperCanvasEl,"wheel",this._onMouseWheel),e(this.upperCanvasEl,"contextmenu",this._onContextMenu),e(this.upperCanvasEl,"touchstart",this._onMouseDown),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this)},removeListeners:function(){i(fabric.window,"resize",this._onResize),i(this.upperCanvasEl,"mousedown",this._onMouseDown),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"mouseout",this._onMouseOut),i(this.upperCanvasEl,"mouseenter",this._onMouseEnter),i(this.upperCanvasEl,"wheel",this._onMouseWheel),i(this.upperCanvasEl,"contextmenu",this._onContextMenu),i(this.upperCanvasEl,"touchstart",this._onMouseDown),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t})},_onMouseEnter:function(t){this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onMouseDown:function(t){this.__onMouseDown(t),e(fabric.document,"touchend",this._onMouseUp),e(fabric.document,"touchmove",this._onMouseMove),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===t.type?i(this.upperCanvasEl,"mousedown",this._onMouseDown):(e(fabric.document,"mouseup",this._onMouseUp),e(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(t){if(this.__onMouseUp(t),i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"touchend",this._onMouseUp),i(fabric.document,"mousemove",this._onMouseMove),i(fabric.document,"touchmove",this._onMouseMove),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===t.type){var o=this;setTimeout(function(){e(o.upperCanvasEl,"mousedown",o._onMouseDown)},400)}},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t,e){var i=this.getActiveGroup()||this.getActiveObject();return(!i||!i.isEditing)&&!!(t&&(t.isMoving||t!==i)||!t&&i||!t&&!i&&!this._groupSelector||e&&this._previousPointer&&this.selection&&(e.x!==this._previousPointer.x||e.y!==this._previousPointer.y))},__onMouseUp:function(t){var e,i=!0,o=this._currentTransform,n=this._groupSelector,r=!n||0===n.left&&0===n.top;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(t);else{o&&(this._finalizeCurrentTransform(),i=!o.actionPerformed),e=i?this.findTarget(t,!0):o.target;var s=this._shouldRender(e,this.getPointer(t));e||!r?this._maybeGroupObjects(t):(this._groupSelector=null,this._currentTransform=null),e&&(e.isMoving=!1),this._handleCursorAndEvent(t,e,"up"),e&&(e.__corner=0),s&&this.renderAll()}},_handleCursorAndEvent:function(t,e,i){this._setCursorFromEvent(t,e),this._handleEvent(t,i,e||null)},_handleEvent:function(t,e,i){var o=void 0===typeof i?this.findTarget(t):i,n=this.targets||[],r={e:t,target:o,subTargets:n};this.fire("mouse:"+e,r),o&&o.fire("mouse"+e,r);for(var s=0;s<n.length;s++)n[s].fire("mouse"+e,r)},_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;e._scaling&&(e._scaling=!1),e.setCoords(),this._restoreOriginXY(e),(t.actionPerformed||this.stateful&&e.hasStateChanged())&&(this.fire("object:modified",{target:e}),e.fire("modified"))},_restoreOriginXY:function(t){if(this._previousOriginX&&this._previousOriginY){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.discardActiveObject(t).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e)}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(t,"up")},__onMouseDown:function(t){var e=this.findTarget(t),i=this.getPointer(t,!0);if("which"in t?3===t.which:2===t.button)this.fireRightClick&&this._handleEvent(t,"down",e||null);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(!this._currentTransform){this._previousPointer=i;var o=this._shouldRender(e,i),n=this._shouldGroup(t,e);this._shouldClearSelection(t,e)?this._clearSelection(t,e,i):n&&(this._handleGrouping(t,e),e=this.getActiveGroup()),e&&(!e.selectable||!e.__corner&&n||(this._beforeTransform(t,e),this._setupCurrentTransform(t,e)),e!==this.getActiveGroup()&&e!==this.getActiveObject()&&(this.deactivateAll(),e.selectable&&this.setActiveObject(e,t))),this._handleEvent(t,"down",e||null),o&&this.renderAll()}},_beforeTransform:function(t,e){this.stateful&&e.saveState(),e._findTargetCorner(this.getPointer(t))&&this.onBeforeScaleRotate(e)},_clearSelection:function(t,e,i){this.deactivateAllWithDispatch(t),e&&e.selectable?this.setActiveObject(e,t):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center",t.originY="center",t.left=e.x,t.top=e.y,this._currentTransform.left=t.left,this._currentTransform.top=t.top},_setCenterToOrigin:function(t){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(t){var e,i;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(!(void 0!==t.touches&&t.touches.length>1)){var o=this._groupSelector;o?(i=this.getPointer(t,!0),o.left=i.x-o.ex,o.top=i.y-o.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t),this._setCursorFromEvent(t,e)),this._handleEvent(t,"move",e||null)}},__onMouseWheel:function(t){this.fire("mouse:wheel",{e:t})},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,i.shiftKey=t.shiftKey,i.altKey=t[this.centeredKey],this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),i.actionPerformed&&this.renderAll()},_performTransformAction:function(t,e,i){var o=i.x,n=i.y,r=e.target,s=e.action,a=!1;"rotate"===s?(a=this._rotateObject(o,n))&&this._fire("rotating",r,t):"scale"===s?(a=this._onScale(t,e,o,n))&&this._fire("scaling",r,t):"scaleX"===s?(a=this._scaleObject(o,n,"x"))&&this._fire("scaling",r,t):"scaleY"===s?(a=this._scaleObject(o,n,"y"))&&this._fire("scaling",r,t):"skewX"===s?(a=this._skewObject(o,n,"x"))&&this._fire("skewing",r,t):"skewY"===s?(a=this._skewObject(o,n,"y"))&&this._fire("skewing",r,t):(a=this._translateObject(o,n))&&(this._fire("moving",r,t),this.setCursor(r.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||a},_fire:function(t,e,i){this.fire("object:"+t,{target:e,e:i}),e.fire(t,{e:i})},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var i=this._shouldCenterTransform(e.target);(i&&("center"!==e.originX||"center"!==e.originY)||!i&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(),e.reset=!0)}},_onScale:function(t,e,i,o){return!t[this.uniScaleKey]&&!this.uniScaleTransform||e.target.get("lockUniScaling")?(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(),e.currentAction="scaleEqually",this._scaleObject(i,o,"equally")):(e.currentAction="scale",this._scaleObject(i,o))},_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var i=e.hoverCursor||this.hoverCursor;if(e.selectable){var o=this.getActiveGroup(),n=e._findTargetCorner&&(!o||!o.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));n?this._setCornerCursor(n,e,t):this.setCursor(i)}else this.setCursor(i);return!0},_setCornerCursor:function(e,i,o){if(e in t)this.setCursor(this._getRotatedCornerCursor(e,i,o));else{if("mtr"!==e||!i.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(e,i,o){var n=Math.round(i.getAngle()%360/45);return n<0&&(n+=8),n+=t[e],o[this.altActionKey]&&t[e]%2==0&&(n+=2),n%=8,this.cursorMap[n]}})}(),function(){var t=Math.min,e=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var i=this.getActiveObject();return t[this.selectionKey]&&e&&e.selectable&&(this.getActiveGroup()||i&&i!==e)&&this.selection},_handleGrouping:function(t,e){var i=this.getActiveGroup();(e!==i||(e=this.findTarget(t,!0)))&&(i?this._updateActiveGroup(e,t):this._createActiveGroup(e,t),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(t,e){var i=this.getActiveGroup();if(i.contains(t)){if(i.removeWithUpdate(t),t.set("active",!1),1===i.size())return this.discardActiveGroup(e),void this.setActiveObject(i.item(0))}else i.addWithUpdate(t);this.fire("selection:created",{target:i,e:e}),i.set("active",!0)},_createActiveGroup:function(t,e){if(this._activeObject&&t!==this._activeObject){var i=this._createGroup(t);i.addWithUpdate(),this.setActiveGroup(i),this._activeObject=null,this.fire("selection:created",{target:i,e:e})}t.set("active",!0)},_createGroup:function(t){var e=this.getObjects(),i=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.Group(i,{canvas:this})},_groupSelectedObjects:function(t){var e=this._collectObjects();1===e.length?this.setActiveObject(e[0],t):e.length>1&&((e=new fabric.Group(e.reverse(),{canvas:this})).addWithUpdate(),this.setActiveGroup(e,t),e.saveCoords(),this.fire("selection:created",{target:e}),this.renderAll())},_collectObjects:function(){for(var i,o=[],n=this._groupSelector.ex,r=this._groupSelector.ey,s=n+this._groupSelector.left,a=r+this._groupSelector.top,h=new fabric.Point(t(n,s),t(r,a)),l=new fabric.Point(e(n,s),e(r,a)),c=n===s&&r===a,u=this._objects.length;u--&&!((i=this._objects[u])&&i.selectable&&i.visible&&(i.intersectsWithRect(h,l)||i.isContainedWithinRect(h,l)||i.containsPoint(h)||i.containsPoint(l))&&(i.set("active",!0),o.push(i),c)););return o},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t);var e=this.getActiveGroup();e&&(e.setObjectsCoords().setCoords(),e.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),function(){var t=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,o=t.multiplier||1,n={left:t.left||0,top:t.top||0,width:t.width||0,height:t.height||0};return this.__toDataURLWithMultiplier(e,i,n,o)},__toDataURLWithMultiplier:function(t,e,i,o){var n=this.getWidth(),r=this.getHeight(),s=(i.width||this.getWidth())*o,a=(i.height||this.getHeight())*o,h=this.getZoom()*o,l=this.viewportTransform,c=[h,0,0,h,(l[4]-i.left)*o,(l[5]-i.top)*o],u=this.interactive;this.viewportTransform=c,this.interactive&&(this.interactive=!1),n!==s||r!==a?this.setDimensions({width:s,height:a}):this.renderAll();var p=this.__toDataURL(t,e,i);return u&&(this.interactive=u),this.viewportTransform=l,this.setDimensions({width:n,height:r}),p},__toDataURL:function(e,i){var o=this.contextContainer.canvas;return"jpg"===e&&(e="jpeg"),t?o.toDataURL("image/"+e,i):o.toDataURL("image/"+e)},toDataURLWithMultiplier:function(t,e,i){return this.toDataURL({format:t,multiplier:e,quality:i})}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){if(t){var o="string"==typeof t?JSON.parse(t):fabric.util.object.clone(t);this.clear();var n=this;return this._enlivenObjects(o.objects,function(){n._setBgOverlay(o,function(){for(var t in delete o.objects,delete o.backgroundImage,delete o.overlayImage,delete o.background,delete o.overlay,o)n[t]=o[t];e&&e()})},i),this}},_setBgOverlay:function(t,e){var i=this,o={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(t.backgroundImage||t.overlayImage||t.background||t.overlay){var n=function(){o.backgroundImage&&o.overlayImage&&o.backgroundColor&&o.overlayColor&&(i.renderAll(),e&&e())};this.__setBgOverlay("backgroundImage",t.backgroundImage,o,n),this.__setBgOverlay("overlayImage",t.overlayImage,o,n),this.__setBgOverlay("backgroundColor",t.background,o,n),this.__setBgOverlay("overlayColor",t.overlay,o,n),n()}else e&&e()},__setBgOverlay:function(t,e,i,o){var n=this;e?"backgroundImage"===t||"overlayImage"===t?fabric.Image.fromObject(e,function(e){n[t]=e,i[t]=!0,o&&o()}):this["set"+fabric.util.string.capitalize(t,!0)](e,function(){i[t]=!0,o&&o()}):i[t]=!0},_enlivenObjects:function(t,e,i){var o=this;if(t&&0!==t.length){var n=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(t,function(t){t.forEach(function(t,e){o.insertAt(t,e)}),o.renderOnAddRemove=n,e&&e()},null,i)}else e&&e()},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(o){i(o.toDataURLWithMultiplier(t,e))})},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(e){e.loadFromJSON(i,function(){t&&t(e)})})},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas");e.width=this.getWidth(),e.height=this.getHeight();var i=new fabric.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.util.toFixed,n=e.util.string.capitalize,r=e.util.degreesToRadians,s=e.StaticCanvas.supports("setLineDash"),a=!e.isLikelyNode;e.Object||(e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:a,statefullCache:!1,noScaleCache:!0,dirty:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit fillRule backgroundColor".split(" "),initialize:function(t){(t=t||{})&&this.setOptions(t),this.objectCaching&&(this._createCacheCanvas(),this.setupState({propertySet:"cacheProperties"}))},_createCacheCanvas:function(){this._cacheCanvas=e.document.createElement("canvas"),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas()},_getCacheCanvasDimensions:function(){var t=this.canvas&&this.canvas.getZoom()||1,i=this.getObjectScaling(),o=this._getNonTransformedDimensions(),n=this.canvas&&this.canvas._isRetinaScaling()?e.devicePixelRatio:1,r=i.scaleX*t*n,s=i.scaleY*t*n;return{width:o.x*r,height:o.y*s,zoomX:r,zoomY:s}},_updateCacheCanvas:function(){if(this.noScaleCache&&this.canvas&&this.canvas._currentTransform&&"scale"===this.canvas._currentTransform.action.slice(0,5))return!1;var t=this._getCacheCanvasDimensions(),e=t.width,i=t.height,o=t.zoomX,n=t.zoomY;return(e!==this.cacheWidth||i!==this.cacheHeight)&&(this._cacheCanvas.width=e,this._cacheCanvas.height=i,this._cacheContext.translate(e/2,i/2),this._cacheContext.scale(o,n),this.cacheWidth=e,this.cacheHeight=i,this.zoomX=o,this.zoomY=n,!0)},_initGradient:function(t){!t.fill||!t.fill.colorStops||t.fill instanceof e.Gradient||this.set("fill",new e.Gradient(t.fill)),!t.stroke||!t.stroke.colorStops||t.stroke instanceof e.Gradient||this.set("stroke",new e.Gradient(t.stroke))},_initPattern:function(t){!t.fill||!t.fill.source||t.fill instanceof e.Pattern||this.set("fill",new e.Pattern(t.fill)),!t.stroke||!t.stroke.source||t.stroke instanceof e.Pattern||this.set("stroke",new e.Pattern(t.stroke))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var i=e.util.getFunctionBody(t.clipTo);void 0!==i&&(this.clipTo=new Function("ctx",i))}},setOptions:function(t){for(var e in t)this.set(e,t[e]);this._initGradient(t),this._initPattern(t),this._initClipping(t)},transform:function(t,e){this.group&&!this.group._transformDone&&this.group===this.canvas._activeGroup&&this.group.transform(t);var i=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(i.x,i.y),t.rotate(r(this.angle)),t.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1)),t.transform(1,0,Math.tan(r(this.skewX)),1,0,0),t.transform(1,Math.tan(r(this.skewY)),0,1,0,0)},toObject:function(t){var i=e.Object.NUM_FRACTION_DIGITS,n={type:this.type,originX:this.originX,originY:this.originY,left:o(this.left,i),top:o(this.top,i),width:o(this.width,i),height:o(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:o(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:o(this.strokeMiterLimit,i),scaleX:o(this.scaleX,i),scaleY:o(this.scaleY,i),angle:o(this.getAngle(),i),flipX:this.flipX,flipY:this.flipY,opacity:o(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:o(this.skewX,i),skewY:o(this.skewY,i)};return e.util.populateWithProperties(this,n,t),this.includeDefaultValues||(n=this._removeDefaultValues(n)),n},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var i=e.util.getKlass(t.type).prototype;return i.stateProperties.forEach(function(e){t[e]===i[e]&&delete t[e],"[object Array]"===Object.prototype.toString.call(t[e])&&"[object Array]"===Object.prototype.toString.call(i[e])&&0===t[e].length&&0===i[e].length&&delete t[e]}),t},toString:function(){return"#<fabric."+n(this.type)+">"},get:function(t){return this[t]},getObjectScaling:function(){var t=this.scaleX,e=this.scaleY;if(this.group){var i=this.group.getObjectScaling();t*=i.scaleX,e*=i.scaleY}return{scaleX:t,scaleY:e}},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,i){return("scaleX"===t||"scaleY"===t)&&(i=this._constrainScale(i)),"scaleX"===t&&i<0?(this.flipX=!this.flipX,i*=-1):"scaleY"===t&&i<0?(this.flipY=!this.flipY,i*=-1):"shadow"!==t||!i||i instanceof e.Shadow||(i=new e.Shadow(i)),this[t]=i,this.cacheProperties.indexOf(t)>-1&&(this.dirty=!0),"width"!==t&&"height"!==t||(this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))),this},setOnGroup:function(){},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},setSourcePath:function(t){return this.sourcePath=t,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(t,i){0===this.width&&0===this.height||!this.visible||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),i||this.transform(t),this._setOpacity(t),this._setShadow(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.clipTo&&e.util.clipContext(this,t),this.objectCaching&&!this.group?(this.isCacheDirty(i)&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,i),this.dirty=!1),this.drawCacheOnCanvas(t)):(this.drawObject(t,i),i&&this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&t.restore(),t.restore())},drawObject:function(t,e){this._renderBackground(t),this._setStrokeStyles(t),this._setFillStyles(t),this._render(t,e)},drawCacheOnCanvas:function(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheWidth/2,-this.cacheHeight/2)},isCacheDirty:function(t){if(!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(!t){var e=this._getNonTransformedDimensions();this._cacheContext.clearRect(-e.x/2,-e.y/2,e.x,e.y)}return!0}return!1},_renderBackground:function(t){if(this.backgroundColor){var e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}},_setOpacity:function(t){t.globalAlpha*=this.opacity},_setStrokeStyles:function(t){this.stroke&&(t.lineWidth=this.strokeWidth,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t,this):this.stroke)},_setFillStyles:function(t){this.fill&&(t.fillStyle=this.fill.toLive?this.fill.toLive(t,this):this.fill)},_setLineDash:function(t,e,i){e&&(1&e.length&&e.push.apply(e,e),s?t.setLineDash(e):i&&i(t))},_renderControls:function(t,i){if(!(!this.active||i||this.group&&this.group!==this.canvas.getActiveGroup())){var o,n=this.getViewportTransform(),s=this.calcTransformMatrix();s=e.util.multiplyTransformMatrices(n,s),o=e.util.qrDecompose(s),t.save(),t.translate(o.translateX,o.translateY),t.lineWidth=1*this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.group&&this.group===this.canvas.getActiveGroup()?(t.rotate(r(o.angle)),this.drawBordersInGroup(t,o)):(t.rotate(r(this.angle)),this.drawBorders(t)),this.drawControls(t),t.restore()}},_setShadow:function(t){if(this.shadow){var i=this.canvas&&this.canvas.viewportTransform[0]||1,o=this.canvas&&this.canvas.viewportTransform[3]||1,n=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(i*=e.devicePixelRatio,o*=e.devicePixelRatio),t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*(i+o)*(n.scaleX+n.scaleY)/4,t.shadowOffsetX=this.shadow.offsetX*i*n.scaleX,t.shadowOffsetY=this.shadow.offsetY*o*n.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_renderFill:function(t){if(this.fill){if(t.save(),this.fill.gradientTransform){var e=this.fill.gradientTransform;t.transform.apply(t,e)}this.fill.toLive&&t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore()}},_renderStroke:function(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke),this.stroke.gradientTransform){var e=this.stroke.gradientTransform;t.transform.apply(t,e)}this.stroke.toLive&&t.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0),t.stroke(),t.restore()}},clone:function(t,i){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(i),t):new e.Object(this.toObject(i))},cloneAsImage:function(t,i){var o=this.toDataURL(i);return e.util.loadImage(o,function(i){t&&t(new e.Image(i))}),this},toDataURL:function(t){t||(t={});var i=e.util.createCanvasElement(),o=this.getBoundingRect();i.width=o.width,i.height=o.height,e.util.wrapElement(i,"div");var n=new e.StaticCanvas(i,{enableRetinaScaling:t.enableRetinaScaling});"jpg"===t.format&&(t.format="jpeg"),"jpeg"===t.format&&(n.backgroundColor="#fff");var r={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new e.Point(n.getWidth()/2,n.getHeight()/2),"center","center");var s=this.canvas;n.add(this);var a=n.toDataURL(t);return this.set(r).setCoords(),this.canvas=s,n.dispose(),n=null,a},isType:function(t){return this.type===t},complexity:function(){return 0},toJSON:function(t){return this.toObject(t)},setGradient:function(t,i){i||(i={});var o={colorStops:[]};for(var n in o.type=i.type||(i.r1||i.r2?"radial":"linear"),o.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(o.coords.r1=i.r1,o.coords.r2=i.r2),i.gradientTransform&&(o.gradientTransform=i.gradientTransform),i.colorStops){var r=new e.Color(i.colorStops[n]);o.colorStops.push({offset:n,color:r.toRgb(),opacity:r.getAlpha()})}return this.set(t,e.Gradient.forObject(this,o))},setPatternFill:function(t){return this.set("fill",new e.Pattern(t))},setShadow:function(t){return this.set("shadow",t?new e.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},setAngle:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},remove:function(){return this.canvas&&this.canvas.remove(this),this},getLocalPointer:function(t,i){i=i||this.canvas.getPointer(t);var o=new e.Point(i.x,i.y),n=this._getLeftTopCoords();return this.angle&&(o=e.util.rotatePoint(o,n,e.util.degreesToRadians(-this.angle))),{x:o.x-n.x,y:o.y-n.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors(e.Object),e.Object.prototype.rotate=e.Object.prototype.setAngle,i(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.__uid=0)}(exports),function(){var t=fabric.util.degreesToRadians,e={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(t,o,n,r,s){var a,h,l,c=t.x,u=t.y;return"string"==typeof o?o=e[o]:o-=.5,"string"==typeof r?r=e[r]:r-=.5,a=r-o,"string"==typeof n?n=i[n]:n-=.5,"string"==typeof s?s=i[s]:s-=.5,h=s-n,(a||h)&&(l=this._getTransformedDimensions(),c=t.x+a*l.x,u=t.y+h*l.y),new fabric.Point(c,u)},translateToCenterPoint:function(e,i,o){var n=this.translateToGivenOrigin(e,i,o,"center","center");return this.angle?fabric.util.rotatePoint(n,e,t(this.angle)):n},translateToOriginPoint:function(e,i,o){var n=this.translateToGivenOrigin(e,"center","center",i,o);return this.angle?fabric.util.rotatePoint(n,e,t(this.angle)):n},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,o){var n,r,s=this.getCenterPoint();return n=void 0!==i&&void 0!==o?this.translateToGivenOrigin(s,"center","center",i,o):new fabric.Point(this.left,this.top),r=new fabric.Point(e.x,e.y),this.angle&&(r=fabric.util.rotatePoint(r,s,-t(this.angle))),r.subtractEquals(n)},setPositionByOrigin:function(t,e,i){var o=this.translateToCenterPoint(t,e,i),n=this.translateToOriginPoint(o,this.originX,this.originY);this.set("left",n.x),this.set("top",n.y)},adjustPosition:function(i){var o,n,r=t(this.angle),s=this.getWidth(),a=Math.cos(r)*s,h=Math.sin(r)*s;o="string"==typeof this.originX?e[this.originX]:this.originX-.5,n="string"==typeof i?e[i]:i-.5,this.left+=a*(n-o),this.top+=h*(n-o),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function t(t){return[new fabric.Point(t.tl.x,t.tl.y),new fabric.Point(t.tr.x,t.tr.y),new fabric.Point(t.br.x,t.br.y),new fabric.Point(t.bl.x,t.bl.y)]}var e=fabric.util.degreesToRadians,i=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(e,i){var o=t(this.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(o,e,i).status},intersectsWithObject:function(e){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(t(this.oCoords),t(e.oCoords)).status||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)},isContainedWithinObject:function(e){for(var i=t(this.oCoords),o=0;o<4;o++)if(!e.containsPoint(i[o]))return!1;return!0},isContainedWithinRect:function(t,e){var i=this.getBoundingRect();return i.left>=t.x&&i.left+i.width<=e.x&&i.top>=t.y&&i.top+i.height<=e.y},containsPoint:function(t){this.oCoords||this.setCoords();var e=this._getImageLines(this.oCoords),i=this._findCrossPoints(t,e);return 0!==i&&i%2==1},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,o,n,r,s=0;for(var a in e)if(!((r=e[a]).o.y<t.y&&r.d.y<t.y||r.o.y>=t.y&&r.d.y>=t.y||(r.o.x===r.d.x&&r.o.x>=t.x?n=r.o.x:(i=0,o=(r.d.y-r.o.y)/(r.d.x-r.o.x),n=-(t.y-i*t.x-(r.o.y-o*r.o.x))/(i-o)),n>=t.x&&(s+=1),2!==s)))break;return s},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(t){var e=this.calcCoords(t);return fabric.util.makeBoundingBoxFromPoints([e.tl,e.tr,e.br,e.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t},scale:function(t){return(t=this._constrainScale(t))<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,t*=-1),this.scaleX=t,this.scaleY=t,this.setCoords()},scaleToWidth:function(t){var e=this.getBoundingRect().width/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRect().height/this.getHeight();return this.scale(t/this.height/e)},calcCoords:function(t){var i=e(this.angle),o=this.getViewportTransform(),n=t?this._getTransformedDimensions():this._calculateCurrentDimensions(),r=n.x,s=n.y,a=Math.sin(i),h=Math.cos(i),l=r>0?Math.atan(s/r):0,c=r/Math.cos(l)/2,u=Math.cos(l+i)*c,p=Math.sin(l+i)*c,d=this.getCenterPoint(),f=t?d:fabric.util.transformPoint(d,o),g=new fabric.Point(f.x-u,f.y-p),v=new fabric.Point(g.x+r*h,g.y+r*a),b=new fabric.Point(g.x-s*a,g.y+s*h),m=new fabric.Point(f.x+u,f.y+p);if(!t)var y=new fabric.Point((g.x+b.x)/2,(g.y+b.y)/2),_=new fabric.Point((v.x+g.x)/2,(v.y+g.y)/2),w=new fabric.Point((m.x+v.x)/2,(m.y+v.y)/2),C=new fabric.Point((m.x+b.x)/2,(m.y+b.y)/2),T=new fabric.Point(_.x+a*this.rotatingPointOffset,_.y-h*this.rotatingPointOffset);f={tl:g,tr:v,br:m,bl:b};return t||(f.ml=y,f.mt=_,f.mr=w,f.mb=C,f.mtr=T),f},setCoords:function(t,e){return this.oCoords=this.calcCoords(t),e||t||(this.absoluteCoords=this.calcCoords(!0)),t||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var t=e(this.angle),i=Math.cos(t),o=Math.sin(t);return[i,o,-o,i,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var t=this.getCenterPoint(),e=[1,0,0,1,t.x,t.y],o=this._calcRotateMatrix(),n=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),r=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];return r=i(r,e),r=i(r,o),r=i(r,n)},_calcDimensionsTransformMatrix:function(t,o,n){var r=[1,0,Math.tan(e(t)),1],s=[1,Math.tan(e(o)),0,1],a=this.scaleX*(n&&this.flipX?-1:1),h=this.scaleY*(n&&this.flipY?-1:1),l=i([a,0,0,h],r,!0);return i(l,s,!0)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),function(){function t(t,e){if(e){if(e.toLive)return t+": url(#SVGID_"+e.id+"); ";var i=new fabric.Color(e),o=t+": "+i.toRgb()+"; ",n=i.getAlpha();return 1!==n&&(o+=t+"-opacity: "+n.toString()+"; "),o}return t+": none; "}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(e){var i=this.fillRule,o=this.strokeWidth?this.strokeWidth:"0",n=this.strokeDashArray?this.strokeDashArray.join(" "):"none",r=this.strokeLineCap?this.strokeLineCap:"butt",s=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=void 0!==this.opacity?this.opacity:"1",l=this.visible?"":" visibility: hidden;",c=e?"":this.getSvgFilter(),u=t("fill",this.fill);return[t("stroke",this.stroke),"stroke-width: ",o,"; ","stroke-dasharray: ",n,"; ","stroke-linecap: ",r,"; ","stroke-linejoin: ",s,"; ","stroke-miterlimit: ",a,"; ",u,"fill-rule: ",i,"; ","opacity: ",h,";",c,l].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?'id="'+this.id+'" ':""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var t=fabric.util.toFixed,e=this.getAngle(),i=this.getSkewX()%360,o=this.getSkewY()%360,n=this.getCenterPoint(),r=fabric.Object.NUM_FRACTION_DIGITS,s="path-group"===this.type?"":"translate("+t(n.x,r)+" "+t(n.y,r)+")",a=0!==e?" rotate("+t(e,r)+")":"",h=1===this.scaleX&&1===this.scaleY?"":" scale("+t(this.scaleX,r)+" "+t(this.scaleY,r)+")",l=0!==i?" skewX("+t(i,r)+")":"",c=0!==o?" skewY("+t(o,r)+")":"",u="path-group"===this.type?this.width:0,p=this.flipX?" matrix(-1 0 0 1 "+u+" 0) ":"",d="path-group"===this.type?this.height:0;return[s,a,h,p,this.flipY?" matrix(1 0 0 -1 0 "+d+")":"",l,c].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var t=[];return this.fill&&this.fill.toLive&&t.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&t.push(this.stroke.toSVG(this,!1)),this.shadow&&t.push(this.shadow.toSVG(this)),t}})}(),function(){var t=fabric.util.object.extend;function e(e,i,o){var n={};o.forEach(function(t){n[t]=e[t]}),t(e[i],n,!0)}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(t){return!function t(e,i,o){if(!fabric.isLikelyNode&&e instanceof Element)return e===i;if(e instanceof Array){if(e.length!==i.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==i[n])return!1;return!0}if(e&&"object"==typeof e){if(!o&&Object.keys(e).length!==Object.keys(i).length)return!1;for(var s in e)if(!t(e[s],i[s]))return!1;return!0}return e===i}(this[t="_"+(t=t||"stateProperties")],this,!0)},saveState:function(t){var i=t&&t.propertySet||"stateProperties",o="_"+i;return this[o]?(e(this,o,this[i]),t&&t.stateProperties&&e(this,o,t.stateProperties),this):this.setupState(t)},setupState:function(t){var e=(t=t||{}).propertySet||"stateProperties";return t.propertySet=e,this["_"+e]={},this.saveState(t),this}})}(),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||!this.active)return!1;var e,i,o=t.x,n=t.y;for(var r in this.__corner=0,this.oCoords)if(this.isControlVisible(r)&&("mtr"!==r||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==r&&"mr"!==r&&"mb"!==r&&"ml"!==r)&&(i=this._getImageLines(this.oCoords[r].corner),0!==(e=this._findCrossPoints({x:o,y:n},i))&&e%2==1))return this.__corner=r,r;return!1},_setCornerCoords:function(){var e,i,o=this.oCoords,n=t(45-this.angle),r=.707106*this.cornerSize,s=r*Math.cos(n),a=r*Math.sin(n);for(var h in o)e=o[h].x,i=o[h].y,o[h].corner={tl:{x:e-a,y:i-s},tr:{x:e+s,y:i-a},bl:{x:e-s,y:i+a},br:{x:e+a,y:i+s}}},_getNonTransformedDimensions:function(){var t=this.strokeWidth;return{x:this.width+t,y:this.height+t}},_getTransformedDimensions:function(t,e){void 0===t&&(t=this.skewX),void 0===e&&(e=this.skewY);var i,o,n=this._getNonTransformedDimensions(),r=n.x/2,s=n.y/2,a=[{x:-r,y:-s},{x:r,y:-s},{x:-r,y:s},{x:r,y:s}],h=this._calcDimensionsTransformMatrix(t,e,!1);for(i=0;i<a.length;i++)a[i]=fabric.util.transformPoint(a[i],h);return{x:(o=fabric.util.makeBoundingBoxFromPoints(a)).width,y:o.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions();return fabric.util.transformPoint(e,t,!0).scalarAdd(2*this.padding)},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.group||!this.active)return this;e.save();var i=this.getCenterPoint(),o=this._calculateCurrentDimensions(),n=this.canvas.viewportTransform;return e.translate(i.x,i.y),e.scale(1/n[0],1/n[3]),e.rotate(t(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-o.x/2,-o.y/2,o.x,o.y),e.restore(),this},drawBorders:function(t){if(!this.hasBorders)return this;var e=this._calculateCurrentDimensions(),i=1/this.borderScaleFactor,o=e.x+i,n=e.y+i;if(t.save(),t.strokeStyle=this.borderColor,this._setLineDash(t,this.borderDashArray,null),t.strokeRect(-o/2,-n/2,o,n),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var r=-n/2;t.beginPath(),t.moveTo(0,r),t.lineTo(0,r-this.rotatingPointOffset),t.closePath(),t.stroke()}return t.restore(),this},drawBordersInGroup:function(t,e){if(!this.hasBorders)return this;var i=this._getNonTransformedDimensions(),o=fabric.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),n=fabric.util.transformPoint(i,o),r=1/this.borderScaleFactor,s=n.x+r,a=n.y+r;return t.save(),this._setLineDash(t,this.borderDashArray,null),t.strokeStyle=this.borderColor,t.strokeRect(-s/2,-a/2,s,a),t.restore(),this},drawControls:function(t){if(!this.hasControls)return this;var e=this._calculateCurrentDimensions(),i=e.x,o=e.y,n=this.cornerSize,r=-(i+n)/2,s=-(o+n)/2,a=this.transparentCorners?"stroke":"fill";return t.save(),t.strokeStyle=t.fillStyle=this.cornerColor,this.transparentCorners||(t.strokeStyle=this.cornerStrokeColor),this._setLineDash(t,this.cornerDashArray,null),this._drawControl("tl",t,a,r,s),this._drawControl("tr",t,a,r+i,s),this._drawControl("bl",t,a,r,s+o),this._drawControl("br",t,a,r+i,s+o),this.get("lockUniScaling")||(this._drawControl("mt",t,a,r+i/2,s),this._drawControl("mb",t,a,r+i/2,s+o),this._drawControl("mr",t,a,r+i,s+o/2),this._drawControl("ml",t,a,r,s+o/2)),this.hasRotatingPoint&&this._drawControl("mtr",t,a,r+i/2,s-this.rotatingPointOffset),t.restore(),this},_drawControl:function(t,e,i,o,n){if(this.isControlVisible(t)){var r=this.cornerSize,s=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":e.beginPath(),e.arc(o+r/2,n+r/2,r/2,0,2*Math.PI,!1),e[i](),s&&e.stroke();break;default:"undefined"!=typeof G_vmlCanvasManager||this.transparentCorners||e.clearRect(o,n,r,r),e[i+"Rect"](o,n,r,r),s&&e.strokeRect(o,n,r,r)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){for(var e in t||(t={}),t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){var i=function(){},o=(e=e||{}).onComplete||i,n=e.onChange||i,r=this;return fabric.util.animate({startValue:t.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),r.renderAll(),n()},onComplete:function(){t.setCoords(),o()}}),this},fxCenterObjectV:function(t,e){var i=function(){},o=(e=e||{}).onComplete||i,n=e.onChange||i,r=this;return fabric.util.animate({startValue:t.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),r.renderAll(),n()},onComplete:function(){t.setCoords(),o()}}),this},fxRemove:function(t,e){var i=function(){},o=(e=e||{}).onComplete||i,n=e.onChange||i,r=this;return fabric.util.animate({startValue:t.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){t.set("active",!1)},onChange:function(e){t.set("opacity",e),r.renderAll(),n()},onComplete:function(){r.remove(t),o()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var o=0,n=i.length;o<n;o++)t=i[o],e=o!==n-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(t,e,i,o){var n,r=this;e=e.toString(),i=i?fabric.util.object.clone(i):{},~t.indexOf(".")&&(n=t.split("."));var s=n?this.get(n[0])[n[1]]:this.get(t);"from"in i||(i.from=s),e=~e.indexOf("=")?s+parseFloat(e.replace("=","")):parseFloat(e),fabric.util.animate({startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(r)},onChange:function(e){n?r[n[0]][n[1]]=e:r.set(t,e),o||i.onChange&&i.onChange()},onComplete:function(){o||(r.setCoords(),i.onComplete&&i.onComplete())}})}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o={x1:1,x2:1,y1:1,y2:1},n=e.StaticCanvas.supports("setLineDash");if(e.Line)e.warn("fabric.Line is already defined");else{var r=e.Object.prototype.cacheProperties.concat();r.push("x1","x2","y1","y2"),e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:r,initialize:function(t,e){t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==o[t]&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t,e){if(t.beginPath(),e){var i=this.getCenterPoint();t.translate(i.x-this.strokeWidth/2,i.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&n){var o=this.calcLinePoints();t.moveTo(o.x1,o.y1),t.lineTo(o.x2,o.y2)}t.lineWidth=this.strokeWidth;var r=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=r},_renderDashedStroke:function(t){var i=this.calcLinePoints();t.beginPath(),e.util.drawDashedLine(t,i.x1,i.y1,i.x2,i.y2,this.strokeDashArray),t.closePath()},toObject:function(t){return i(this.callSuper("toObject",t),this.calcLinePoints())},_getNonTransformedDimensions:function(){var t=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===t.x&&(t.y-=this.strokeWidth),0===t.y&&(t.x-=this.strokeWidth)),t},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,o=e*this.height*.5;return{x1:i,x2:t*this.width*-.5,y1:o,y2:e*this.height*-.5}},toSVG:function(t){var e=this._createBaseSVGMarkup(),i={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(i=this.calcLinePoints()),e.push("<line ",this.getSvgId(),'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(t,o){var n=e.parseAttributes(t,e.Line.ATTRIBUTE_NAMES),r=[n.x1||0,n.y1||0,n.x2||0,n.y2||0];return new e.Line(r,i(n,o))},e.Line.fromObject=function(t,i){var o=[t.x1,t.y1,t.x2,t.y2],n=new e.Line(o,t);return i&&i(n),n}}function s(t,e){var i=t.origin,o=t.axis1,n=t.axis2,r=t.dimension,s=e.nearest,a=e.center,h=e.farthest;return function(){switch(this.get(i)){case s:return Math.min(this.get(o),this.get(n));case a:return Math.min(this.get(o),this.get(n))+.5*this.get(r);case h:return Math.max(this.get(o),this.get(n))}}}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.PI,o=e.util.object.extend;if(e.Circle)e.warn("fabric.Circle is already defined.");else{var n=e.Object.prototype.cacheProperties.concat();n.push("radius"),e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*i,cacheProperties:n,initialize:function(t){this.callSuper("initialize",t),this.set("radius",t&&t.radius||0)},_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),o=0,n=0,r=(this.endAngle-this.startAngle)%(2*i);if(0===r)this.group&&"path-group"===this.group.type&&(o=this.left+this.radius,n=this.top+this.radius),e.push("<circle ",this.getSvgId(),'cx="'+o+'" cy="'+n+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var s=Math.cos(this.startAngle)*this.radius,a=Math.sin(this.startAngle)*this.radius,h=Math.cos(this.endAngle)*this.radius,l=Math.sin(this.endAngle)*this.radius,c=r>i?"1":"0";e.push('<path d="M '+s+" "+a," A "+this.radius+" "+this.radius," 0 ",+c+" 1"," "+h+" "+l,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.arc(e?this.left+this.radius:0,e?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(t),this._renderStroke(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",2*t).set("height",2*t)},complexity:function(){return 1}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(t,i){i||(i={});var n=e.parseAttributes(t,e.Circle.ATTRIBUTE_NAMES);if(!function(t){return"radius"in t&&t.radius>=0}(n))throw new Error("value of `r` attribute is required and can not be negative");n.left=n.left||0,n.top=n.top||0;var r=new e.Circle(o(n,i));return r.left-=r.radius,r.top-=r.radius,r},e.Circle.fromObject=function(t,i){var o=new e.Circle(t);return i&&i(o),o}}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(t){this.callSuper("initialize",t),this.set("width",t&&t.width||100).set("height",t&&t.height||100)},_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var i=this.width/2,o=this.height/2;t.beginPath(),e.util.drawDashedLine(t,-i,o,0,-o,this.strokeDashArray),e.util.drawDashedLine(t,0,-o,i,o,this.strokeDashArray),e.util.drawDashedLine(t,i,o,-i,o,this.strokeDashArray),t.closePath()},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.width/2,o=this.height/2,n=[-i+" "+o,"0 "+-o,i+" "+o].join(",");return e.push("<polygon ",this.getSvgId(),'points="',n,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Triangle.fromObject=function(t,i){var o=new e.Triangle(t);return i&&i(o),o})}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=2*Math.PI,o=e.util.object.extend;if(e.Ellipse)e.warn("fabric.Ellipse is already defined.");else{var n=e.Object.prototype.cacheProperties.concat();n.push("rx","ry"),e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:n,initialize:function(t){this.callSuper("initialize",t),this.set("rx",t&&t.rx||0),this.set("ry",t&&t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=0,o=0;return this.group&&"path-group"===this.group.type&&(i=this.left+this.rx,o=this.top+this.ry),e.push("<ellipse ",this.getSvgId(),'cx="',i,'" cy="',o,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(e?this.left+this.rx:0,e?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,i,!1),t.restore(),this._renderFill(t),this._renderStroke(t)},complexity:function(){return 1}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(t,i){i||(i={});var n=e.parseAttributes(t,e.Ellipse.ATTRIBUTE_NAMES);n.left=n.left||0,n.top=n.top||0;var r=new e.Ellipse(o(n,i));return r.top-=r.ry,r.left-=r.rx,r},e.Ellipse.fromObject=function(t,i){var o=new e.Ellipse(t);return i&&i(o),o}}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;if(e.Rect)e.warn("fabric.Rect is already defined");else{var o=e.Object.prototype.stateProperties.concat();o.push("rx","ry"),e.Rect=e.util.createClass(e.Object,{stateProperties:o,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(t){this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t,e){if(1!==this.width||1!==this.height){var i=this.rx?Math.min(this.rx,this.width/2):0,o=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,r=this.height,s=e?this.left:-this.width/2,a=e?this.top:-this.height/2,h=0!==i||0!==o,l=.4477152502;t.beginPath(),t.moveTo(s+i,a),t.lineTo(s+n-i,a),h&&t.bezierCurveTo(s+n-l*i,a,s+n,a+l*o,s+n,a+o),t.lineTo(s+n,a+r-o),h&&t.bezierCurveTo(s+n,a+r-l*o,s+n-l*i,a+r,s+n-i,a+r),t.lineTo(s+i,a+r),h&&t.bezierCurveTo(s+l*i,a+r,s,a+r-l*o,s,a+r-o),t.lineTo(s,a+o),h&&t.bezierCurveTo(s,a+l*o,s+l*i,a,s+i,a),t.closePath(),this._renderFill(t),this._renderStroke(t)}else t.fillRect(-.5,-.5,1,1)},_renderDashedStroke:function(t){var i=-this.width/2,o=-this.height/2,n=this.width,r=this.height;t.beginPath(),e.util.drawDashedLine(t,i,o,i+n,o,this.strokeDashArray),e.util.drawDashedLine(t,i+n,o,i+n,o+r,this.strokeDashArray),e.util.drawDashedLine(t,i+n,o+r,i,o+r,this.strokeDashArray),e.util.drawDashedLine(t,i,o+r,i,o,this.strokeDashArray),t.closePath()},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.left,o=this.top;return this.group&&"path-group"===this.group.type||(i=-this.width/2,o=-this.height/2),e.push("<rect ",this.getSvgId(),'x="',i,'" y="',o,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(t,o){if(!t)return null;o=o||{};var n=e.parseAttributes(t,e.Rect.ATTRIBUTE_NAMES);n.left=n.left||0,n.top=n.top||0;var r=new e.Rect(i(o?e.util.object.clone(o):{},n));return r.visible=r.visible&&r.width>0&&r.height>0,r},e.Rect.fromObject=function(t,i){var o=new e.Rect(t);return i&&i(o),o}}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={});if(e.Polyline)e.warn("fabric.Polyline is already defined");else{var i=e.Object.prototype.cacheProperties.concat();i.push("points"),e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,minX:0,minY:0,cacheProperties:i,initialize:function(t,i){return e.Polygon.prototype.initialize.call(this,t,i)},_calcDimensions:function(){return e.Polygon.prototype._calcDimensions.call(this)},toObject:function(t){return e.Polygon.prototype.toObject.call(this,t)},toSVG:function(t){return e.Polygon.prototype.toSVG.call(this,t)},_render:function(t,i){e.Polygon.prototype.commonRender.call(this,t,i)&&(this._renderFill(t),this._renderStroke(t))},_renderDashedStroke:function(t){var i,o;t.beginPath();for(var n=0,r=this.points.length;n<r;n++)i=this.points[n],o=this.points[n+1]||i,e.util.drawDashedLine(t,i.x,i.y,o.x,o.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElement=function(t,i){if(!t)return null;i||(i={});var o=e.parsePointsAttribute(t.getAttribute("points")),n=e.parseAttributes(t,e.Polyline.ATTRIBUTE_NAMES);return new e.Polyline(o,e.util.object.extend(n,i))},e.Polyline.fromObject=function(t,i){var o=new e.Polyline(t.points,t);return i&&i(o),o}}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.util.array.min,n=e.util.array.max,r=e.util.toFixed;if(e.Polygon)e.warn("fabric.Polygon is already defined");else{var s=e.Object.prototype.cacheProperties.concat();s.push("points"),e.Polygon=e.util.createClass(e.Object,{type:"polygon",points:null,minX:0,minY:0,cacheProperties:s,initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX),this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var t=this.points,e=o(t,"x"),i=o(t,"y"),r=n(t,"x"),s=n(t,"y");this.width=r-e||0,this.height=s-i||0,this.minX=e||0,this.minY=i||0},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},toSVG:function(t){for(var e,i=[],o=this._createBaseSVGMarkup(),n=0,s=this.points.length;n<s;n++)i.push(r(this.points[n].x,2),",",r(this.points[n].y,2)," ");return this.group&&"path-group"===this.group.type||(e=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),o.push("<",this.type," ",this.getSvgId(),'points="',i.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),e," ",this.getSvgTransformMatrix(),'"/>\n'),t?t(o.join("")):o.join("")},_render:function(t,e){this.commonRender(t,e)&&(this._renderFill(t),(this.stroke||this.strokeDashArray)&&(t.closePath(),this._renderStroke(t)))},commonRender:function(t,e){var i,o=this.points.length,n=e?0:this.pathOffset.x,r=e?0:this.pathOffset.y;if(!o||isNaN(this.points[o-1].y))return!1;t.beginPath(),t.moveTo(this.points[0].x-n,this.points[0].y-r);for(var s=0;s<o;s++)i=this.points[s],t.lineTo(i.x-n,i.y-r);return!0},_renderDashedStroke:function(t){e.Polyline.prototype._renderDashedStroke.call(this,t),t.closePath()},complexity:function(){return this.points.length}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(t,o){if(!t)return null;o||(o={});var n=e.parsePointsAttribute(t.getAttribute("points")),r=e.parseAttributes(t,e.Polygon.ATTRIBUTE_NAMES);return new e.Polygon(n,i(r,o))},e.Polygon.fromObject=function(t,i){var o=new e.Polygon(t.points,t);return i&&i(o),o}}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,o=e.util.array.max,n=e.util.object.extend,r=Object.prototype.toString,s=e.util.drawArc,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"};if(e.Path)e.warn("fabric.Path is already defined");else{var l=e.Object.prototype.cacheProperties.concat();l.push("path"),e.Path=e.util.createClass(e.Object,{type:"path",path:null,minX:0,minY:0,cacheProperties:l,initialize:function(t,e){(e=e||{})&&this.setOptions(e),t||(t=[]);var i="[object Array]"===r.call(t);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._setPositionDimensions(e),e.sourcePath&&this.setSourcePath(e.sourcePath),this.objectCaching&&(this._createCacheCanvas(),this.setupState({propertySet:"cacheProperties"})))},_setPositionDimensions:function(t){var e=this._parseDimensions();this.minX=e.left,this.minY=e.top,this.width=e.width,this.height=e.height,void 0===t.left&&(this.left=e.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0)),void 0===t.top&&(this.top=e.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0)),this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(t){var e,i,o,n=null,r=0,a=0,h=0,l=0,c=0,u=0,p=-this.pathOffset.x,d=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(p=0,d=0),t.beginPath();for(var f=0,g=this.path.length;f<g;++f){switch((e=this.path[f])[0]){case"l":h+=e[1],l+=e[2],t.lineTo(h+p,l+d);break;case"L":h=e[1],l=e[2],t.lineTo(h+p,l+d);break;case"h":h+=e[1],t.lineTo(h+p,l+d);break;case"H":h=e[1],t.lineTo(h+p,l+d);break;case"v":l+=e[1],t.lineTo(h+p,l+d);break;case"V":l=e[1],t.lineTo(h+p,l+d);break;case"m":r=h+=e[1],a=l+=e[2],t.moveTo(h+p,l+d);break;case"M":r=h=e[1],a=l=e[2],t.moveTo(h+p,l+d);break;case"c":i=h+e[5],o=l+e[6],c=h+e[3],u=l+e[4],t.bezierCurveTo(h+e[1]+p,l+e[2]+d,c+p,u+d,i+p,o+d),h=i,l=o;break;case"C":h=e[5],l=e[6],c=e[3],u=e[4],t.bezierCurveTo(e[1]+p,e[2]+d,c+p,u+d,h+p,l+d);break;case"s":i=h+e[3],o=l+e[4],null===n[0].match(/[CcSs]/)?(c=h,u=l):(c=2*h-c,u=2*l-u),t.bezierCurveTo(c+p,u+d,h+e[1]+p,l+e[2]+d,i+p,o+d),c=h+e[1],u=l+e[2],h=i,l=o;break;case"S":i=e[3],o=e[4],null===n[0].match(/[CcSs]/)?(c=h,u=l):(c=2*h-c,u=2*l-u),t.bezierCurveTo(c+p,u+d,e[1]+p,e[2]+d,i+p,o+d),h=i,l=o,c=e[1],u=e[2];break;case"q":i=h+e[3],o=l+e[4],c=h+e[1],u=l+e[2],t.quadraticCurveTo(c+p,u+d,i+p,o+d),h=i,l=o;break;case"Q":i=e[3],o=e[4],t.quadraticCurveTo(e[1]+p,e[2]+d,i+p,o+d),h=i,l=o,c=e[1],u=e[2];break;case"t":i=h+e[1],o=l+e[2],null===n[0].match(/[QqTt]/)?(c=h,u=l):(c=2*h-c,u=2*l-u),t.quadraticCurveTo(c+p,u+d,i+p,o+d),h=i,l=o;break;case"T":i=e[1],o=e[2],null===n[0].match(/[QqTt]/)?(c=h,u=l):(c=2*h-c,u=2*l-u),t.quadraticCurveTo(c+p,u+d,i+p,o+d),h=i,l=o;break;case"a":s(t,h+p,l+d,[e[1],e[2],e[3],e[4],e[5],e[6]+h+p,e[7]+l+d]),h+=e[6],l+=e[7];break;case"A":s(t,h+p,l+d,[e[1],e[2],e[3],e[4],e[5],e[6]+p,e[7]+d]),h=e[6],l=e[7];break;case"z":case"Z":h=r,l=a,t.closePath()}n=e}},_render:function(t){this._renderPathCommands(t),this._renderFill(t),this._renderStroke(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return n(this.callSuper("toObject",["sourcePath","pathOffset"].concat(t)),{path:this.path.map(function(t){return t.slice()})})},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.path=this.sourcePath),delete e.sourcePath,e},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),o="",n=0,r=this.path.length;n<r;n++)e.push(this.path[n].join(" "));var s=e.join(" ");return this.group&&"path-group"===this.group.type||(o=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),i.push("<path ",this.getSvgId(),'d="',s,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),o,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),t?t(i.join("")):i.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,o,n,r=[],s=[],l=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,c=0,u=this.path.length;c<u;c++){for(o=(t=this.path[c]).slice(1).trim(),s.length=0;i=l.exec(o);)s.push(i[0]);n=[t.charAt(0)];for(var p=0,d=s.length;p<d;p++)e=parseFloat(s[p]),isNaN(e)||n.push(e);var f=n[0],g=a[f.toLowerCase()],v=h[f]||f;if(n.length-1>g)for(var b=1,m=n.length;b<m;b+=g)r.push([f].concat(n.slice(b,b+g))),f=v;else r.push(n)}return r},_parseDimensions:function(){for(var t,n,r,s,a=[],h=[],l=null,c=0,u=0,p=0,d=0,f=0,g=0,v=0,b=this.path.length;v<b;++v){switch((t=this.path[v])[0]){case"l":p+=t[1],d+=t[2],s=[];break;case"L":p=t[1],d=t[2],s=[];break;case"h":p+=t[1],s=[];break;case"H":p=t[1],s=[];break;case"v":d+=t[1],s=[];break;case"V":d=t[1],s=[];break;case"m":c=p+=t[1],u=d+=t[2],s=[];break;case"M":c=p=t[1],u=d=t[2],s=[];break;case"c":n=p+t[5],r=d+t[6],f=p+t[3],g=d+t[4],s=e.util.getBoundsOfCurve(p,d,p+t[1],d+t[2],f,g,n,r),p=n,d=r;break;case"C":p=t[5],d=t[6],f=t[3],g=t[4],s=e.util.getBoundsOfCurve(p,d,t[1],t[2],f,g,p,d);break;case"s":n=p+t[3],r=d+t[4],null===l[0].match(/[CcSs]/)?(f=p,g=d):(f=2*p-f,g=2*d-g),s=e.util.getBoundsOfCurve(p,d,f,g,p+t[1],d+t[2],n,r),f=p+t[1],g=d+t[2],p=n,d=r;break;case"S":n=t[3],r=t[4],null===l[0].match(/[CcSs]/)?(f=p,g=d):(f=2*p-f,g=2*d-g),s=e.util.getBoundsOfCurve(p,d,f,g,t[1],t[2],n,r),p=n,d=r,f=t[1],g=t[2];break;case"q":n=p+t[3],r=d+t[4],f=p+t[1],g=d+t[2],s=e.util.getBoundsOfCurve(p,d,f,g,f,g,n,r),p=n,d=r;break;case"Q":f=t[1],g=t[2],s=e.util.getBoundsOfCurve(p,d,f,g,f,g,t[3],t[4]),p=t[3],d=t[4];break;case"t":n=p+t[1],r=d+t[2],null===l[0].match(/[QqTt]/)?(f=p,g=d):(f=2*p-f,g=2*d-g),s=e.util.getBoundsOfCurve(p,d,f,g,f,g,n,r),p=n,d=r;break;case"T":n=t[1],r=t[2],null===l[0].match(/[QqTt]/)?(f=p,g=d):(f=2*p-f,g=2*d-g),s=e.util.getBoundsOfCurve(p,d,f,g,f,g,n,r),p=n,d=r;break;case"a":s=e.util.getBoundsOfArc(p,d,t[1],t[2],t[3],t[4],t[5],t[6]+p,t[7]+d),p+=t[6],d+=t[7];break;case"A":s=e.util.getBoundsOfArc(p,d,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),p=t[6],d=t[7];break;case"z":case"Z":p=c,d=u}l=t,s.forEach(function(t){a.push(t.x),h.push(t.y)}),a.push(p),h.push(d)}var m=i(a)||0,y=i(h)||0;return{left:m,top:y,width:(o(a)||0)-m,height:(o(h)||0)-y}}}),e.Path.fromObject=function(t,i){var o;if("string"!=typeof t.path)return o=new e.Path(t.path,t),i&&i(o),o;e.loadSVGFromURL(t.path,function(n){var r=t.path;o=n[0],delete t.path,e.util.object.extend(o,t),o.setSourcePath(r),i&&i(o)})},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(t,i,o){var r=e.parseAttributes(t,e.Path.ATTRIBUTE_NAMES);i&&i(new e.Path(r.d,n(r,o)))},e.Path.async=!0}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.PathGroup?e.warn("fabric.PathGroup is already defined"):(e.PathGroup=e.util.createClass(e.Object,{type:"path-group",fill:"",initialize:function(t,e){e=e||{},this.paths=t||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;e.toBeParsed&&(this.parseDimensionsFromPaths(e),delete e.toBeParsed),this.setOptions(e),this.setCoords(),e.sourcePath&&this.setSourcePath(e.sourcePath),this.objectCaching&&(this._createCacheCanvas(),this.setupState({propertySet:"cacheProperties"}))},parseDimensionsFromPaths:function(t){for(var i,o,n,r,s,a,h=[],l=[],c=this.paths.length;c--;){r=(n=this.paths[c]).height+n.strokeWidth,s=n.width+n.strokeWidth,i=[{x:n.left,y:n.top},{x:n.left+s,y:n.top},{x:n.left,y:n.top+r},{x:n.left+s,y:n.top+r}],a=this.paths[c].transformMatrix;for(var u=0;u<i.length;u++)o=i[u],a&&(o=e.util.transformPoint(o,a,!1)),h.push(o.x),l.push(o.y)}t.width=Math.max.apply(null,h),t.height=Math.max.apply(null,l)},drawObject:function(t){t.save(),t.translate(-this.width/2,-this.height/2);for(var e=0,i=this.paths.length;e<i;++e)this.paths[e].render(t,!0);t.restore()},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var t=0,e=this.paths.length;t<e;t++)if(this.paths[t].isCacheDirty(!0)){var i=this._getNonTransformedDimensions();return this._cacheContext.clearRect(-i.x/2,-i.y/2,i.x,i.y),!0}return!1},_set:function(t,e){if("fill"===t&&e&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(t,e);return this.callSuper("_set",t,e)},toObject:function(t){var e=this.paths.map(function(e){var i=e.includeDefaultValues;e.includeDefaultValues=e.group.includeDefaultValues;var o=e.toObject(t);return e.includeDefaultValues=i,o});return i(this.callSuper("toObject",["sourcePath"].concat(t)),{paths:e})},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.paths=this.sourcePath),e},toSVG:function(t){var e=this.getObjects(),i=this.getPointByOrigin("left","top"),o="translate("+i.x+" "+i.y+")",n=this._createBaseSVGMarkup();n.push("<g ",this.getSvgId(),'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),o,this.getSvgTransform(),'" ',">\n");for(var r=0,s=e.length;r<s;r++)n.push("\t",e[r].toSVG(t));return n.push("</g>\n"),t?t(n.join("")):n.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var t=this.getObjects()[0].get("fill")||"";return"string"==typeof t&&(t=t.toLowerCase(),this.getObjects().every(function(e){var i=e.get("fill")||"";return"string"==typeof i&&i.toLowerCase()===t}))},complexity:function(){return this.paths.reduce(function(t,e){return t+(e&&e.complexity?e.complexity():0)},0)},getObjects:function(){return this.paths}}),e.PathGroup.fromObject=function(t,i){"string"==typeof t.paths?e.loadSVGFromURL(t.paths,function(o){var n=t.paths;delete t.paths;var r=e.util.groupSVGElements(o,t,n);i(r)}):e.util.enlivenObjects(t.paths,function(o){delete t.paths,i(new e.PathGroup(o,t))})},e.PathGroup.async=!0)}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.util.array.min,n=e.util.array.max;if(!e.Group){var r={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;this.originalState={},e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),i?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",e)),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(t){for(var e=this.getCenterPoint(),i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],e,t)},_updateObjectCoords:function(t,e,i){if(t.__origHasControls=t.hasControls,t.hasControls=!1,!i){var o=t.getLeft(),n=t.getTop();t.set({originalLeft:o,originalTop:n,left:o-e.x,top:n-e.y}),t.setCoords(!0)}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,this},_setObjectActive:function(t){t.set("active",!0),t.group=this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.forEachObject(this._setObjectActive,this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group,t.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(t,e){var i=this._objects.length;if(this.delegatedProperties[t]||"canvas"===t)for(;i--;)this._objects[i].set(t,e);else for(;i--;)this._objects[i].setOnGroup(t,e);this.callSuper("_set",t,e)},toObject:function(t){var e=this.getObjects().map(function(e){var i=e.includeDefaultValues;e.includeDefaultValues=e.group.includeDefaultValues;var o=e.toObject(t);return e.includeDefaultValues=i,o});return i(this.callSuper("toObject",t),{objects:e})},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},drawObject:function(t){for(var e=0,i=this._objects.length;e<i;e++)this._renderObject(this._objects[e],t)},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var t=0,e=this._objects.length;t<e;t++)if(this._objects[t].isCacheDirty(!0)){var i=this._getNonTransformedDimensions();return this._cacheContext.clearRect(-i.x/2,-i.y/2,i.x,i.y),!0}return!1},_renderControls:function(t,e){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",t,e);for(var i=0,o=this._objects.length;i<o;i++)this._objects[i]._renderControls(t);t.restore()},_renderObject:function(t,e){if(t.visible){var i=t.hasRotatingPoint;t.hasRotatingPoint=!1,t.render(e),t.hasRotatingPoint=i}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var i=t.calcTransformMatrix(),o=e.util.qrDecompose(i),n=new e.Point(o.translateX,o.translateY);return t.flipX=!1,t.flipY=!1,t.set("scaleX",o.scaleX),t.set("scaleY",o.scaleY),t.skewX=o.skewX,t.skewY=o.skewY,t.angle=o.angle,t.setPositionByOrigin(n,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),t.hasControls=t.__origHasControls,delete t.__origHasControls,t.set("active",!1),delete t.group,this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords(!0)}),this},_calcBounds:function(t){for(var e,i,o,n=[],r=[],s=["tr","br","bl","tl"],a=0,h=this._objects.length,l=s.length;a<h;++a)for((e=this._objects[a]).setCoords(!0),o=0;o<l;o++)i=s[o],n.push(e.oCoords[i].x),r.push(e.oCoords[i].y);this.set(this._getBounds(n,r,t))},_getBounds:function(t,i,r){var s=new e.Point(o(t),o(i)),a=new e.Point(n(t),n(i)),h={width:a.x-s.x||0,height:a.y-s.y||0};return r||(h.left=s.x||0,h.top=s.y||0,"center"===this.originX&&(h.left+=h.width/2),"right"===this.originX&&(h.left+=h.width),"center"===this.originY&&(h.top+=h.height/2),"bottom"===this.originY&&(h.top+=h.height)),h},toSVG:function(t){var e=this._createBaseSVGMarkup();e.push("<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var i=0,o=this._objects.length;i<o;i++)e.push("\t",this._objects[i].toSVG(t));return e.push("</g>\n"),t?t(e.join("")):e.join("")},get:function(t){if(t in r){if(this[t])return this[t];for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e][t])return!0;return!1}return t in this.delegatedProperties?this._objects[0]&&this._objects[0].get(t):this[t]}}),e.Group.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(o){delete t.objects,i&&i(new e.Group(o,t,!0))})},e.Group.async=!0}}(exports),function(t){"use strict";var e=fabric.util.object.extend;if(t.fabric||(t.fabric={}),t.fabric.Image)fabric.warn("fabric.Image is already defined.");else{var i=fabric.Object.prototype.stateProperties.concat();i.push("alignX","alignY","meetOrSlice"),fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,minimumScaleTrigger:.5,stateProperties:i,objectCaching:!1,initialize:function(t,e,i){e||(e={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",e),this._initElement(t,e,i)},getElement:function(){return this._element},setElement:function(t,e,i){var o,n;return this._element=t,this._originalElement=t,this._initConfig(i),0===this.resizeFilters.length?o=e:(n=this,o=function(){n.applyFilters(e,n.resizeFilters,n._filteredEl||n._originalElement,!0)}),0!==this.filters.length?this.applyFilters(o):o&&o(this),this},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.width,height:t.height}},_stroke:function(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath()}},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,o=this.width,n=this.height;t.save(),this._setStrokeStyles(t),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+o,i,this.strokeDashArray),fabric.util.drawDashedLine(t,e+o,i,e+o,i+n,this.strokeDashArray),fabric.util.drawDashedLine(t,e+o,i+n,e,i+n,this.strokeDashArray),fabric.util.drawDashedLine(t,e,i+n,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){var i=[],o=[],n=1,r=1;this.filters.forEach(function(t){t&&("Resize"===t.type&&(n*=t.scaleX,r*=t.scaleY),i.push(t.toObject()))}),this.resizeFilters.forEach(function(t){t&&o.push(t.toObject())});var s=e(this.callSuper("toObject",["crossOrigin","alignX","alignY","meetOrSlice"].concat(t)),{src:this.getSrc(),filters:i,resizeFilters:o});return s.width/=n,s.height/=r,s},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=-this.width/2,o=-this.height/2,n="none";if(this.group&&"path-group"===this.group.type&&(i=this.left,o=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(n="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),e.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',"<image ",this.getSvgId(),'xlink:href="',this.getSvgSrc(!0),'" x="',i,'" y="',o,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',n,'"',"></image>\n"),this.stroke||this.strokeDashArray){var r=this.fill;this.fill=null,e.push("<rect ",'x="',i,'" y="',o,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=r}return e.push("</g>\n"),t?t(e.join("")):e.join("")},getSrc:function(t){var e=t?this._element:this._originalElement;return e?fabric.isLikelyNode?e._src:e.src:this.src||""},setSrc:function(t,e,i){fabric.util.loadImage(t,function(t){return this.setElement(t,e,i)},this,i&&i.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyFilters:function(t,e,i,o){if(e=e||this.filters,i=i||this._originalElement){var n,r,s=fabric.util.createImage(),a=this.canvas?this.canvas.getRetinaScaling():fabric.devicePixelRatio,h=this.minimumScaleTrigger/a,l=this;if(0===e.length)return this._element=i,t&&t(this),i;var c=fabric.util.createCanvasElement();return c.width=i.width,c.height=i.height,c.getContext("2d").drawImage(i,0,0,i.width,i.height),e.forEach(function(t){t&&(o?(n=l.scaleX<h?l.scaleX:1,r=l.scaleY<h?l.scaleY:1,n*a<1&&(n*=a),r*a<1&&(r*=a)):(n=t.scaleX,r=t.scaleY),t.applyTo(c,n,r),o||"Resize"!==t.type||(l.width*=t.scaleX,l.height*=t.scaleY))}),s.width=c.width,s.height=c.height,fabric.isLikelyNode?(s.src=c.toBuffer(void 0,fabric.Image.pngCompression),l._element=s,!o&&(l._filteredEl=s),t&&t(l)):(s.onload=function(){l._element=s,!o&&(l._filteredEl=s),t&&t(l),s.onload=c=null},s.src=c.toDataURL("image/png")),c}},_render:function(t,e){var i,o,n,r=this._findMargins();i=e?this.left:-this.width/2,o=e?this.top:-this.height/2,"slice"===this.meetOrSlice&&(t.beginPath(),t.rect(i,o,this.width,this.height),t.clip()),!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,n=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):n=this._element,n&&t.drawImage(n,i+r.marginX,o+r.marginY,r.width,r.height),this._stroke(t),this._renderStroke(t)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var t,e,i=this.width,o=this.height,n=0,r=0;return"none"===this.alignX&&"none"===this.alignY||(t=[this.width/this._element.width,this.height/this._element.height],e="meet"===this.meetOrSlice?Math.min.apply(null,t):Math.max.apply(null,t),i=this._element.width*e,o=this._element.height*e,"Mid"===this.alignX&&(n=(this.width-i)/2),"Max"===this.alignX&&(n=this.width-i),"Mid"===this.alignY&&(r=(this.height-o)/2),"Max"===this.alignY&&(r=this.height-o)),{width:i,height:o,marginX:n,marginY:r}},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width),this.set("height",t.height)},_initElement:function(t,e,i){this.setElement(fabric.util.getById(t),i,e),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t&&t.length?fabric.util.enlivenObjects(t,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()&&this.getElement().width||0,this.height="height"in t?t.height:this.getElement()&&this.getElement().height||0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(t,e){fabric.util.loadImage(t.src,function(i){fabric.Image.prototype._initFilters.call(t,t.filters,function(o){t.filters=o||[],fabric.Image.prototype._initFilters.call(t,t.resizeFilters,function(o){return t.resizeFilters=o||[],new fabric.Image(i,t,e)})})},null,t.crossOrigin)},fabric.Image.fromURL=function(t,e,i){fabric.util.loadImage(t,function(t){e&&e(new fabric.Image(t,i))},null,i&&i.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(t,i,o){var n,r=fabric.parseAttributes(t,fabric.Image.ATTRIBUTE_NAMES);r.preserveAspectRatio&&(n=fabric.util.parsePreserveAspectRatioAttribute(r.preserveAspectRatio),e(r,n)),fabric.Image.fromURL(r["xlink:href"],i,e(o?fabric.util.object.clone(o):{},r))},fabric.Image.async=!0,fabric.Image.pngCompression=1}}(exports),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.getAngle()%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(t){var e=function(){},i=(t=t||{}).onComplete||e,o=t.onChange||e,n=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){n.setAngle(t),o()},onComplete:function(){n.setCoords(),i()},onStart:function(){n.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.renderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.Brightness=n(o.BaseFilter,{type:"Brightness",initialize:function(t){t=t||{},this.brightness=t.brightness||0},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),o=i.data,n=this.brightness,r=0,s=o.length;r<s;r+=4)o[r]+=n,o[r+1]+=n,o[r+2]+=n;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}}),e.Image.filters.Brightness.fromObject=function(t){return new e.Image.filters.Brightness(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.Convolute=n(o.BaseFilter,{type:"Convolute",initialize:function(t){t=t||{},this.opaque=t.opaque,this.matrix=t.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(t){for(var e,i,o,n,r,s,a,h,l,c=this.matrix,u=t.getContext("2d"),p=u.getImageData(0,0,t.width,t.height),d=Math.round(Math.sqrt(c.length)),f=Math.floor(d/2),g=p.data,v=p.width,b=p.height,m=u.createImageData(v,b),y=m.data,_=this.opaque?1:0,w=0;w<b;w++)for(var C=0;C<v;C++){r=4*(w*v+C),e=0,i=0,o=0,n=0;for(var T=0;T<d;T++)for(var S=0;S<d;S++)s=C+S-f,(a=w+T-f)<0||a>b||s<0||s>v||(h=4*(a*v+s),l=c[T*d+S],e+=g[h]*l,i+=g[h+1]*l,o+=g[h+2]*l,n+=g[h+3]*l);y[r]=e,y[r+1]=i,y[r+2]=o,y[r+3]=n+_*(255-n)}u.putImageData(m,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=function(t){return new e.Image.filters.Convolute(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.GradientTransparency=n(o.BaseFilter,{type:"GradientTransparency",initialize:function(t){t=t||{},this.threshold=t.threshold||100},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),o=i.data,n=this.threshold,r=o.length,s=0,a=o.length;s<a;s+=4)o[s+3]=n+255*(r-s)/r;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}}),e.Image.filters.GradientTransparency.fromObject=function(t){return new e.Image.filters.GradientTransparency(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,o=e.util.createClass;i.Grayscale=o(i.BaseFilter,{type:"Grayscale",applyTo:function(t){for(var e,i=t.getContext("2d"),o=i.getImageData(0,0,t.width,t.height),n=o.data,r=o.width*o.height*4,s=0;s<r;)e=(n[s]+n[s+1]+n[s+2])/3,n[s]=e,n[s+1]=e,n[s+2]=e,s+=4;i.putImageData(o,0,0)}}),e.Image.filters.Grayscale.fromObject=function(){return new e.Image.filters.Grayscale}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,o=e.util.createClass;i.Invert=o(i.BaseFilter,{type:"Invert",applyTo:function(t){var e,i=t.getContext("2d"),o=i.getImageData(0,0,t.width,t.height),n=o.data,r=n.length;for(e=0;e<r;e+=4)n[e]=255-n[e],n[e+1]=255-n[e+1],n[e+2]=255-n[e+2];i.putImageData(o,0,0)}}),e.Image.filters.Invert.fromObject=function(){return new e.Image.filters.Invert}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.Mask=n(o.BaseFilter,{type:"Mask",initialize:function(t){t=t||{},this.mask=t.mask,this.channel=[0,1,2,3].indexOf(t.channel)>-1?t.channel:0},applyTo:function(t){if(this.mask){var i,o=t.getContext("2d"),n=o.getImageData(0,0,t.width,t.height),r=n.data,s=this.mask.getElement(),a=e.util.createCanvasElement(),h=this.channel,l=n.width*n.height*4;a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(s,0,0,t.width,t.height);var c=a.getContext("2d").getImageData(0,0,t.width,t.height).data;for(i=0;i<l;i+=4)r[i+3]=c[i+h];o.putImageData(n,0,0)}},toObject:function(){return i(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),e.Image.filters.Mask.fromObject=function(t,i){e.util.loadImage(t.mask.src,function(o){t.mask=new e.Image(o,t.mask),i&&i(new e.Image.filters.Mask(t))})},e.Image.filters.Mask.async=!0}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.Noise=n(o.BaseFilter,{type:"Noise",initialize:function(t){t=t||{},this.noise=t.noise||0},applyTo:function(t){for(var e,i=t.getContext("2d"),o=i.getImageData(0,0,t.width,t.height),n=o.data,r=this.noise,s=0,a=n.length;s<a;s+=4)e=(.5-Math.random())*r,n[s]+=e,n[s+1]+=e,n[s+2]+=e;i.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=function(t){return new e.Image.filters.Noise(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.Pixelate=n(o.BaseFilter,{type:"Pixelate",initialize:function(t){t=t||{},this.blocksize=t.blocksize||4},applyTo:function(t){var e,i,o,n,r,s,a,h=t.getContext("2d"),l=h.getImageData(0,0,t.width,t.height),c=l.data,u=l.height,p=l.width;for(i=0;i<u;i+=this.blocksize)for(o=0;o<p;o+=this.blocksize){n=c[e=4*i*p+4*o],r=c[e+1],s=c[e+2],a=c[e+3];for(var d=i,f=i+this.blocksize;d<f;d++)for(var g=o,v=o+this.blocksize;g<v;g++)c[e=4*d*p+4*g]=n,c[e+1]=r,c[e+2]=s,c[e+3]=a}h.putImageData(l,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}}),e.Image.filters.Pixelate.fromObject=function(t){return new e.Image.filters.Pixelate(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.RemoveWhite=n(o.BaseFilter,{type:"RemoveWhite",initialize:function(t){t=t||{},this.threshold=t.threshold||30,this.distance=t.distance||20},applyTo:function(t){for(var e,i,o,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),s=r.data,a=this.threshold,h=this.distance,l=255-a,c=Math.abs,u=0,p=s.length;u<p;u+=4)e=s[u],i=s[u+1],o=s[u+2],e>l&&i>l&&o>l&&c(e-i)<h&&c(e-o)<h&&c(i-o)<h&&(s[u+3]=0);n.putImageData(r,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),e.Image.filters.RemoveWhite.fromObject=function(t){return new e.Image.filters.RemoveWhite(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,o=e.util.createClass;i.Sepia=o(i.BaseFilter,{type:"Sepia",applyTo:function(t){var e,i,o=t.getContext("2d"),n=o.getImageData(0,0,t.width,t.height),r=n.data,s=r.length;for(e=0;e<s;e+=4)i=.3*r[e]+.59*r[e+1]+.11*r[e+2],r[e]=i+100,r[e+1]=i+50,r[e+2]=i+255;o.putImageData(n,0,0)}}),e.Image.filters.Sepia.fromObject=function(){return new e.Image.filters.Sepia}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,o=e.util.createClass;i.Sepia2=o(i.BaseFilter,{type:"Sepia2",applyTo:function(t){var e,i,o,n,r=t.getContext("2d"),s=r.getImageData(0,0,t.width,t.height),a=s.data,h=a.length;for(e=0;e<h;e+=4)i=a[e],o=a[e+1],n=a[e+2],a[e]=(.393*i+.769*o+.189*n)/1.351,a[e+1]=(.349*i+.686*o+.168*n)/1.203,a[e+2]=(.272*i+.534*o+.131*n)/2.14;r.putImageData(s,0,0)}}),e.Image.filters.Sepia2.fromObject=function(){return new e.Image.filters.Sepia2}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.Tint=n(o.BaseFilter,{type:"Tint",initialize:function(t){t=t||{},this.color=t.color||"#000000",this.opacity=void 0!==t.opacity?t.opacity:new e.Color(this.color).getAlpha()},applyTo:function(t){var i,o,n,r,s,a,h,l,c,u=t.getContext("2d"),p=u.getImageData(0,0,t.width,t.height),d=p.data,f=d.length;for(o=(c=new e.Color(this.color).getSource())[0]*this.opacity,n=c[1]*this.opacity,r=c[2]*this.opacity,l=1-this.opacity,i=0;i<f;i+=4)s=d[i],a=d[i+1],h=d[i+2],d[i]=o+s*l,d[i+1]=n+a*l,d[i+2]=r+h*l;u.putImageData(p,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),e.Image.filters.Tint.fromObject=function(t){return new e.Image.filters.Tint(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.Multiply=n(o.BaseFilter,{type:"Multiply",initialize:function(t){t=t||{},this.color=t.color||"#000000"},applyTo:function(t){var i,o,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),s=r.data,a=s.length;for(o=new e.Color(this.color).getSource(),i=0;i<a;i+=4)s[i]*=o[0]/255,s[i+1]*=o[1]/255,s[i+2]*=o[2]/255;n.putImageData(r,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color})}}),e.Image.filters.Multiply.fromObject=function(t){return new e.Image.filters.Multiply(t)}}(exports),function(t){"use strict";var e=t.fabric,i=e.Image.filters,o=e.util.createClass;i.Blend=o(i.BaseFilter,{type:"Blend",initialize:function(t){t=t||{},this.color=t.color||"#000",this.image=t.image||!1,this.mode=t.mode||"multiply",this.alpha=t.alpha||1},applyTo:function(t){var i,o,n,r,s,a,h,l,c,u,p=t.getContext("2d"),d=p.getImageData(0,0,t.width,t.height),f=d.data,g=!1;if(this.image){g=!0;var v=e.util.createCanvasElement();v.width=this.image.width,v.height=this.image.height;var b=new e.StaticCanvas(v);b.add(this.image),u=b.getContext("2d").getImageData(0,0,b.width,b.height).data}else i=(u=new e.Color(this.color).getSource())[0]*this.alpha,o=u[1]*this.alpha,n=u[2]*this.alpha;for(var m=0,y=f.length;m<y;m+=4)switch(r=f[m],s=f[m+1],a=f[m+2],g&&(i=u[m]*this.alpha,o=u[m+1]*this.alpha,n=u[m+2]*this.alpha),this.mode){case"multiply":f[m]=r*i/255,f[m+1]=s*o/255,f[m+2]=a*n/255;break;case"screen":f[m]=1-(1-r)*(1-i),f[m+1]=1-(1-s)*(1-o),f[m+2]=1-(1-a)*(1-n);break;case"add":f[m]=Math.min(255,r+i),f[m+1]=Math.min(255,s+o),f[m+2]=Math.min(255,a+n);break;case"diff":case"difference":f[m]=Math.abs(r-i),f[m+1]=Math.abs(s-o),f[m+2]=Math.abs(a-n);break;case"subtract":h=r-i,l=s-o,c=a-n,f[m]=h<0?0:h,f[m+1]=l<0?0:l,f[m+2]=c<0?0:c;break;case"darken":f[m]=Math.min(r,i),f[m+1]=Math.min(s,o),f[m+2]=Math.min(a,n);break;case"lighten":f[m]=Math.max(r,i),f[m+1]=Math.max(s,o),f[m+2]=Math.max(a,n)}p.putImageData(d,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.Blend.fromObject=function(t){return new e.Image.filters.Blend(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.pow,o=Math.floor,n=Math.sqrt,r=Math.abs,s=Math.max,a=Math.round,h=Math.sin,l=Math.ceil,c=e.Image.filters,u=e.util.createClass;c.Resize=u(c.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(t,e,i){if(1!==e||1!==i){this.rcpScaleX=1/e,this.rcpScaleY=1/i;var o,n=t.width,r=t.height,s=a(n*e),h=a(r*i);"sliceHack"===this.resizeType&&(o=this.sliceByTwo(t,n,r,s,h)),"hermite"===this.resizeType&&(o=this.hermiteFastResize(t,n,r,s,h)),"bilinear"===this.resizeType&&(o=this.bilinearFiltering(t,n,r,s,h)),"lanczos"===this.resizeType&&(o=this.lanczosResize(t,n,r,s,h)),t.width=s,t.height=h,t.getContext("2d").putImageData(o,0,0)}},sliceByTwo:function(t,i,n,r,a){var h,l=t.getContext("2d"),c=.5,u=.5,p=1,d=1,f=!1,g=!1,v=i,b=n,m=e.util.createCanvasElement(),y=m.getContext("2d");for(r=o(r),a=o(a),m.width=s(r,i),m.height=s(a,n),r>i&&(c=2,p=-1),a>n&&(u=2,d=-1),h=l.getImageData(0,0,i,n),t.width=s(r,i),t.height=s(a,n),l.putImageData(h,0,0);!f||!g;)i=v,n=b,r*p<o(v*c*p)?v=o(v*c):(v=r,f=!0),a*d<o(b*u*d)?b=o(b*u):(b=a,g=!0),h=l.getImageData(0,0,i,n),y.putImageData(h,0,0),l.clearRect(0,0,v,b),l.drawImage(m,0,0,i,n,0,0,v,b);return l.getImageData(0,0,r,a)},lanczosResize:function(t,e,s,a,c){var u=t.getContext("2d"),p=u.getImageData(0,0,e,s),d=u.getImageData(0,0,a,c),f=p.data,g=d.data,v=function(t){return function(e){if(e>t)return 0;if(e*=Math.PI,r(e)<1e-16)return 1;var i=e/t;return h(e)*h(i)/e/i}}(this.lanczosLobes),b=this.rcpScaleX,m=this.rcpScaleY,y=2/this.rcpScaleX,_=2/this.rcpScaleY,w=l(b*this.lanczosLobes/2),C=l(m*this.lanczosLobes/2),T={},S={},O={};return function t(h){var l,u,p,E,x,I,A,D,k,P,M;for(S.x=(h+.5)*b,O.x=o(S.x),l=0;l<c;l++){for(S.y=(l+.5)*m,O.y=o(S.y),x=0,I=0,A=0,D=0,k=0,u=O.x-w;u<=O.x+w;u++)if(!(u<0||u>=e)){P=o(1e3*r(u-S.x)),T[P]||(T[P]={});for(var B=O.y-C;B<=O.y+C;B++)B<0||B>=s||(M=o(1e3*r(B-S.y)),T[P][M]||(T[P][M]=v(n(i(P*y,2)+i(M*_,2))/1e3)),(p=T[P][M])>0&&(x+=p,I+=p*f[E=4*(B*e+u)],A+=p*f[E+1],D+=p*f[E+2],k+=p*f[E+3]))}g[E=4*(l*a+h)]=I/x,g[E+1]=A/x,g[E+2]=D/x,g[E+3]=k/x}return++h<a?t(h):d}(0)},bilinearFiltering:function(t,e,i,n,r){var s,a,h,l,c,u,p,d,f,g=0,v=this.rcpScaleX,b=this.rcpScaleY,m=t.getContext("2d"),y=4*(e-1),_=m.getImageData(0,0,e,i).data,w=m.getImageData(0,0,n,r),C=w.data;for(h=0;h<r;h++)for(l=0;l<n;l++)for(c=v*l-(s=o(v*l)),u=b*h-(a=o(b*h)),f=4*(a*e+s),p=0;p<4;p++)d=_[f+p]*(1-c)*(1-u)+_[f+4+p]*c*(1-u)+_[f+y+p]*u*(1-c)+_[f+y+4+p]*c*u,C[g++]=d;return w},hermiteFastResize:function(t,e,i,s,a){for(var h=this.rcpScaleX,c=this.rcpScaleY,u=l(h/2),p=l(c/2),d=t.getContext("2d"),f=d.getImageData(0,0,e,i).data,g=d.getImageData(0,0,s,a),v=g.data,b=0;b<a;b++)for(var m=0;m<s;m++){for(var y=4*(m+b*s),_=0,w=0,C=0,T=0,S=0,O=0,E=0,x=(b+.5)*c,I=o(b*c);I<(b+1)*c;I++)for(var A=r(x-(I+.5))/p,D=(m+.5)*h,k=A*A,P=o(m*h);P<(m+1)*h;P++){var M=r(D-(P+.5))/u,B=n(k+M*M);B>1&&B<-1||(_=2*B*B*B-3*B*B+1)>0&&(E+=_*f[(M=4*(P+I*e))+3],C+=_,f[M+3]<255&&(_=_*f[M+3]/250),T+=_*f[M],S+=_*f[M+1],O+=_*f[M+2],w+=_)}v[y]=T/w,v[y+1]=S/w,v[y+2]=O/w,v[y+3]=E/C}return g},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=function(t){return new e.Image.filters.Resize(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.ColorMatrix=n(o.BaseFilter,{type:"ColorMatrix",initialize:function(t){t||(t={}),this.matrix=t.matrix||[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},applyTo:function(t){var e,i,o,n,r,s=t.getContext("2d"),a=s.getImageData(0,0,t.width,t.height),h=a.data,l=h.length,c=this.matrix;for(e=0;e<l;e+=4)i=h[e],o=h[e+1],n=h[e+2],r=h[e+3],h[e]=i*c[0]+o*c[1]+n*c[2]+r*c[3]+c[4],h[e+1]=i*c[5]+o*c[6]+n*c[7]+r*c[8]+c[9],h[e+2]=i*c[10]+o*c[11]+n*c[12]+r*c[13]+c[14],h[e+3]=i*c[15]+o*c[16]+n*c[17]+r*c[18]+c[19];s.putImageData(a,0,0)},toObject:function(){return i(this.callSuper("toObject"),{type:this.type,matrix:this.matrix})}}),e.Image.filters.ColorMatrix.fromObject=function(t){return new e.Image.filters.ColorMatrix(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.Contrast=n(o.BaseFilter,{type:"Contrast",initialize:function(t){t=t||{},this.contrast=t.contrast||0},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),o=i.data,n=259*(this.contrast+255)/(255*(259-this.contrast)),r=0,s=o.length;r<s;r+=4)o[r]=n*(o[r]-128)+128,o[r+1]=n*(o[r+1]-128)+128,o[r+2]=n*(o[r+2]-128)+128;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{contrast:this.contrast})}}),e.Image.filters.Contrast.fromObject=function(t){return new e.Image.filters.Contrast(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.Image.filters,n=e.util.createClass;o.Saturate=n(o.BaseFilter,{type:"Saturate",initialize:function(t){t=t||{},this.saturate=t.saturate||0},applyTo:function(t){for(var e,i=t.getContext("2d"),o=i.getImageData(0,0,t.width,t.height),n=o.data,r=.01*-this.saturate,s=0,a=n.length;s<a;s+=4)e=Math.max(n[s],n[s+1],n[s+2]),n[s]+=e!==n[s]?(e-n[s])*r:0,n[s+1]+=e!==n[s+1]?(e-n[s+1])*r:0,n[s+2]+=e!==n[s+2]?(e-n[s+2])*r:0;i.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{saturate:this.saturate})}}),e.Image.filters.Saturate.fromObject=function(t){return new e.Image.filters.Saturate(t)}}(exports),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.clone,o=e.util.toFixed,n=e.Object.NUM_FRACTION_DIGITS;if(e.Text)e.warn("fabric.Text is already defined");else{var r=e.Object.prototype.stateProperties.concat();r.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing");var s=e.Object.prototype.cacheProperties.concat();s.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:r,cacheProperties:s,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,charSpacing:0,initialize:function(t,e){e=e||{},this.text=t,this.__skipDimension=!0,this.callSuper("initialize",e),this.__skipDimension=!1,this._initDimensions(),this.setupState({propertySet:"_dimensionAffectingProps"})},_initDimensions:function(t){this.__skipDimension||(t||(t=e.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this.width=this._getTextWidth(t)||this.cursorWidth||2,this.height=this._getTextHeight(t))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var t=this.callSuper("_getCacheCanvasDimensions");return t.width+=2*this.fontSize,t.height+=2*this.fontSize,t},_render:function(t){this._setTextStyles(t),this.group&&"path-group"===this.group.type&&t.translate(this.left,this.top),this._renderTextLinesBackground(t),this._renderText(t),this._renderTextDecoration(t)},_renderText:function(t){this._renderTextFill(t),this._renderTextStroke(t)},_setTextStyles:function(t){t.textBaseline="alphabetic",t.font=this._getFontDeclaration()},_getTextHeight:function(){return this._getHeightOfSingleLine()+(this._textLines.length-1)*this._getHeightOfLine()},_getTextWidth:function(t){for(var e=this._getLineWidth(t,0),i=1,o=this._textLines.length;i<o;i++){var n=this._getLineWidth(t,i);n>e&&(e=n)}return e},_renderChars:function(t,e,i,o,n){var r,s,a=t.slice(0,-4);if(this[a].toLive){var h=-this.width/2+this[a].offsetX||0,l=-this.height/2+this[a].offsetY||0;e.save(),e.translate(h,l),o-=h,n-=l}if(0!==this.charSpacing)for(var c=this._getWidthOfCharSpacing(),u=0,p=(i=i.split("")).length;u<p;u++)r=i[u],s=e.measureText(r).width+c,e[t](r,o,n),o+=s>0?s:0;else e[t](i,o,n);this[a].toLive&&e.restore()},_renderTextLine:function(t,e,i,o,n,r){n-=this.fontSize*this._fontSizeFraction;var s=this._getLineWidth(e,r);if("justify"!==this.textAlign||this.width<s)this._renderChars(t,e,i,o,n,r);else for(var a,h=i.split(/\s+/),l=0,c=this._getWidthOfWords(e,h.join(" "),r,0),u=this.width-c,p=h.length-1,d=p>0?u/p:0,f=0,g=0,v=h.length;g<v;g++){for(;" "===i[l]&&l<i.length;)l++;a=h[g],this._renderChars(t,e,a,o+f,n,r,l),f+=this._getWidthOfWords(e,a,r,l)+d,l+=a.length}},_getWidthOfWords:function(t,e){var i=t.measureText(e).width;return 0!==this.charSpacing&&(i+=e.split("").length*this._getWidthOfCharSpacing()),i>0?i:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return!0},_renderTextCommon:function(t,e){for(var i=0,o=this._getLeftOffset(),n=this._getTopOffset(),r=0,s=this._textLines.length;r<s;r++){var a=this._getHeightOfLine(t,r),h=a/this.lineHeight,l=this._getLineWidth(t,r),c=this._getLineLeftOffset(l);this._renderTextLine(e,t,this._textLines[r],o+c,n+i+h,r),i+=a}},_renderTextFill:function(t){!this.fill&&this.isEmptyStyles()||this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_getHeightOfLine:function(){return this._getHeightOfSingleLine()*this.lineHeight},_getHeightOfSingleLine:function(){return this.fontSize*this._fontSizeMult},_renderTextLinesBackground:function(t){if(this.textBackgroundColor){var e,i,o,n=0,r=t.fillStyle;t.fillStyle=this.textBackgroundColor;for(var s=0,a=this._textLines.length;s<a;s++)e=this._getHeightOfLine(t,s),(i=this._getLineWidth(t,s))>0&&(o=this._getLineLeftOffset(i),t.fillRect(this._getLeftOffset()+o,this._getTopOffset()+n,i,e/this.lineHeight)),n+=e;t.fillStyle=r,this._removeShadow(t)}},_getLineLeftOffset:function(t){return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[]},_shouldClearDimensionCache:function(){var t;return this._forceClearCache?(this._forceClearCache=!1,this.dirty=!0,!0):((t=this.hasStateChanged("_dimensionAffectingProps"))&&(this.saveState({propertySet:"_dimensionAffectingProps"}),this.dirty=!0),t)},_getLineWidth:function(t,e){if(this.__lineWidths[e])return-1===this.__lineWidths[e]?this.width:this.__lineWidths[e];var i,o=this._textLines[e];return i=""===o?0:this._measureLine(t,e),this.__lineWidths[e]=i,i&&"justify"===this.textAlign&&o.split(/\s+/).length>1&&(this.__lineWidths[e]=-1),i},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},_measureLine:function(t,e){var i,o=this._textLines[e],n=t.measureText(o).width,r=0;return 0!==this.charSpacing&&(r=(o.split("").length-1)*this._getWidthOfCharSpacing()),(i=n+r)>0?i:0},_renderTextDecoration:function(t){if(this.textDecoration){var e=this.height/2,i=this,o=[];this.textDecoration.indexOf("underline")>-1&&o.push(.85),this.textDecoration.indexOf("line-through")>-1&&o.push(.43),this.textDecoration.indexOf("overline")>-1&&o.push(-.12),o.length>0&&function(o){var n,r,s,a,h,l,c,u=0;for(n=0,r=i._textLines.length;n<r;n++){for(h=i._getLineWidth(t,n),l=i._getLineLeftOffset(h),c=i._getHeightOfLine(t,n),s=0,a=o.length;s<a;s++)t.fillRect(i._getLeftOffset()+l,u+(i._fontSizeMult-1+o[s])*i.fontSize-e,h,i.fontSize/15);u+=c}}(o)}},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(t,e){this.visible&&(this._shouldClearDimensionCache()&&(this._setTextStyles(t),this._initDimensions(t)),this.callSuper("render",t,e))},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(t){var e=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","textDecoration","textAlign","textBackgroundColor","charSpacing"].concat(t);return this.callSuper("toObject",e)},toSVG:function(t){this.ctx||(this.ctx=e.util.createCanvasElement().getContext("2d"));var i=this._createBaseSVGMarkup(),o=this._getSVGLeftTopOffsets(this.ctx),n=this._getSVGTextAndBg(o.textTop,o.textLeft);return this._wrapSVGTextAndBg(i,n),t?t(i.join("")):i.join("")},_getSVGLeftTopOffsets:function(t){var e=this._getHeightOfLine(t,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:e}},_wrapSVGTextAndBg:function(t,e){var i=this.getSvgFilter(),o=""===i?"":' style="'+i+'"';t.push("\t<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',o,">\n",e.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(!0),'" >\n',e.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(t,e){var i=[],o=[],n=0;this._setSVGBg(o);for(var r=0,s=this._textLines.length;r<s;r++)this.textBackgroundColor&&this._setSVGTextLineBg(o,r,e,t,n),this._setSVGTextLineText(r,i,n,e,t,o),n+=this._getHeightOfLine(this.ctx,r);return{textSpans:i,textBgRects:o}},_setSVGTextLineText:function(t,i,r,s,a){var h=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-a+r-this.height/2;"justify"!==this.textAlign?i.push('\t\t\t<tspan x="',o(s+this._getLineLeftOffset(this._getLineWidth(this.ctx,t)),n),'" ','y="',o(h,n),'" ',this._getFillAttributes(this.fill),">",e.util.string.escapeXml(this._textLines[t]),"</tspan>\n"):this._setSVGTextLineJustifed(t,i,h,s)},_setSVGTextLineJustifed:function(t,i,r,s){var a=e.util.createCanvasElement().getContext("2d");this._setTextStyles(a);var h,l,c=this._textLines[t].split(/\s+/),u=this._getWidthOfWords(a,c.join("")),p=this.width-u,d=c.length-1,f=d>0?p/d:0,g=this._getFillAttributes(this.fill);for(s+=this._getLineLeftOffset(this._getLineWidth(a,t)),t=0,l=c.length;t<l;t++)h=c[t],i.push('\t\t\t<tspan x="',o(s,n),'" ','y="',o(r,n),'" ',g,">",e.util.string.escapeXml(h),"</tspan>\n"),s+=this._getWidthOfWords(a,h)+f},_setSVGTextLineBg:function(t,e,i,r,s){t.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',o(i+this._getLineLeftOffset(this._getLineWidth(this.ctx,e)),n),'" y="',o(s-this.height/2,n),'" width="',o(this._getLineWidth(this.ctx,e),n),'" height="',o(this._getHeightOfLine(this.ctx,e)/this.lineHeight,n),'"></rect>\n')},_setSVGBg:function(t){this.backgroundColor&&t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',o(-this.width/2,n),'" y="',o(-this.height/2,n),'" width="',o(this.width,n),'" height="',o(this.height,n),'"></rect>\n')},_getFillAttributes:function(t){var i=t&&"string"==typeof t?new e.Color(t):"";return i&&i.getSource()&&1!==i.getAlpha()?'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_set:function(t,e){this.callSuper("_set",t,e),this._dimensionAffectingProps.indexOf(t)>-1&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(t,i){if(!t)return null;var o=e.parseAttributes(t,e.Text.ATTRIBUTE_NAMES);(i=e.util.object.extend(i?e.util.object.clone(i):{},o)).top=i.top||0,i.left=i.left||0,"dx"in o&&(i.left+=o.dx),"dy"in o&&(i.top+=o.dy),"fontSize"in i||(i.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE),i.originX||(i.originX="left");var n="";"textContent"in t?n=t.textContent:"firstChild"in t&&null!==t.firstChild&&"data"in t.firstChild&&null!==t.firstChild.data&&(n=t.firstChild.data),n=n.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var r=new e.Text(n,i),s=r.getHeight()/r.height,a=((r.height+r.strokeWidth)*r.lineHeight-r.height)*s,h=r.getHeight()+a,l=0;return"left"===r.originX&&(l=r.getWidth()/2),"right"===r.originX&&(l=-r.getWidth()/2),r.set({left:r.getLeft()+l,top:r.getTop()-h/2+r.fontSize*(.18+r._fontSizeFraction)/r.lineHeight}),r},e.Text.fromObject=function(t,o){var n=new e.Text(t.text,i(t));return o&&o(n),n},e.util.createAccessors(e.Text)}}(exports),function(){var t=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],initialize:function(t,e){this.styles=e&&e.styles||{},this.callSuper("initialize",t,e),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var t=this.styles;for(var e in t)for(var i in t[e])for(var o in t[e][i])return!1;return!0},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectionStyles:function(t,e){if(2===arguments.length){for(var i=[],o=t;o<e;o++)i.push(this.getSelectionStyles(o));return i}var n=this.get2DCursorLocation(t);return this._getStyleDeclaration(n.lineIndex,n.charIndex)||{}},setSelectionStyles:function(t){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,t);else for(var e=this.selectionStart;e<this.selectionEnd;e++)this._extendStyles(e,t);return this._forceClearCache=!0,this},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex,{}),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),e)},_initDimensions:function(t){t||this.clearContextTop(),this.callSuper("_initDimensions",t)},render:function(t,e){this.clearContextTop(),this.callSuper("render",t,e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(t){this.callSuper("_render",t),this.ctx=t},clearContextTop:function(){if(this.active&&this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop;t.save(),t.transform.apply(t,this.canvas.viewportTransform),this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this._clearTextArea(t),t.restore()}},renderCursorOrSelection:function(){if(this.active&&this.isEditing){var t,e,i=this.text.split("");this.canvas&&this.canvas.contextTop?((e=this.canvas.contextTop).save(),e.transform.apply(e,this.canvas.viewportTransform),this.transform(e),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this._clearTextArea(e)):(e=this.ctx).save(),this.selectionStart===this.selectionEnd?(t=this._getCursorBoundaries(i,"cursor"),this.renderCursor(t,e)):(t=this._getCursorBoundaries(i,"selection"),this.renderSelection(i,t,e)),e.restore()}},_clearTextArea:function(t){var e=this.width+4,i=this.height+4;t.clearRect(-e/2,-i/2,e,i)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,i=0;i<e;i++){if(t<=this._textLines[i].length)return{lineIndex:i,charIndex:t};t-=this._textLines[i].length+1}return{lineIndex:i-1,charIndex:this._textLines[i-1].length<t?this._textLines[i-1].length:t}},getCurrentCharStyle:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return{fontSize:i&&i.fontSize||this.fontSize,fill:i&&i.fill||this.fill,textBackgroundColor:i&&i.textBackgroundColor||this.textBackgroundColor,textDecoration:i&&i.textDecoration||this.textDecoration,fontFamily:i&&i.fontFamily||this.fontFamily,fontWeight:i&&i.fontWeight||this.fontWeight,fontStyle:i&&i.fontStyle||this.fontStyle,stroke:i&&i.stroke||this.stroke,strokeWidth:i&&i.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return i&&i.fontSize?i.fontSize:this.fontSize},getCurrentCharColor:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return i&&i.fill?i.fill:this.cursorColor},_getCursorBoundaries:function(t,e){var i=Math.round(this._getLeftOffset()),o=this._getTopOffset(),n=this._getCursorBoundariesOffsets(t,e);return{left:i,top:o,leftOffset:n.left+n.lineLeft,topOffset:n.top}},_getCursorBoundariesOffsets:function(t,e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;for(var i,o=0,n=0,r=0,s=0,a=0,h=0;h<this.selectionStart;h++)"\n"===t[h]?(a=0,s+=this._getHeightOfLine(this.ctx,n),n++,r=0):(a+=this._getWidthOfChar(this.ctx,t[h],n,r),r++),o=this._getLineLeftOffset(this._getLineWidth(this.ctx,n));return"cursor"===e&&(s+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,n)/this.lineHeight-this.getCurrentCharFontSize(n,r)*(1-this._fontSizeFraction)),0!==this.charSpacing&&r===this._textLines[n].length&&(a-=this._getWidthOfCharSpacing()),i={top:s,left:a>0?a:0,lineLeft:o},this.cursorOffsetCache=i,this.cursorOffsetCache},renderCursor:function(t,e){var i=this.get2DCursorLocation(),o=i.lineIndex,n=i.charIndex,r=this.getCurrentCharFontSize(o,n),s=0===o&&0===n?this._getLineLeftOffset(this._getLineWidth(e,o)):t.leftOffset,a=this.scaleX*this.canvas.getZoom(),h=this.cursorWidth/a;e.fillStyle=this.getCurrentCharColor(o,n),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+s-h/2,t.top+t.topOffset,h,r)},renderSelection:function(t,e,i){i.fillStyle=this.selectionColor;for(var o=this.get2DCursorLocation(this.selectionStart),n=this.get2DCursorLocation(this.selectionEnd),r=o.lineIndex,s=n.lineIndex,a=r;a<=s;a++){var h,l=this._getLineLeftOffset(this._getLineWidth(i,a))||0,c=this._getHeightOfLine(this.ctx,a),u=0,p=this._textLines[a];if(a===r){for(var d=0,f=p.length;d<f;d++)d>=o.charIndex&&(a!==s||d<n.charIndex)&&(u+=this._getWidthOfChar(i,p[d],a,d)),d<o.charIndex&&(l+=this._getWidthOfChar(i,p[d],a,d));d===p.length&&(u-=this._getWidthOfCharSpacing())}else if(a>r&&a<s)u+=this._getLineWidth(i,a)||5;else if(a===s){for(var g=0,v=n.charIndex;g<v;g++)u+=this._getWidthOfChar(i,p[g],a,g);n.charIndex===p.length&&(u-=this._getWidthOfCharSpacing())}h=c,(this.lineHeight<1||a===s&&this.lineHeight>1)&&(c/=this.lineHeight),i.fillRect(e.left+l,e.top+e.topOffset,u>0?u:0,c),e.topOffset+=h}},_renderChars:function(t,e,i,o,n,r,s){if(this.isEmptyStyles())return this._renderCharsFast(t,e,i,o,n);s=s||0;var a,h,l=this._getHeightOfLine(e,r),c="";e.save(),n-=l/this.lineHeight*this._fontSizeFraction;for(var u=s,p=i.length+s;u<=p;u++)a=a||this.getCurrentCharStyle(r,u),h=this.getCurrentCharStyle(r,u+1),(this._hasStyleChanged(a,h)||u===p)&&(this._renderChar(t,e,r,u-1,c,o,n,l),c="",a=h),c+=i[u-s];e.restore()},_renderCharsFast:function(t,e,i,o,n){"fillText"===t&&this.fill&&this.callSuper("_renderChars",t,e,i,o,n),"strokeText"===t&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",t,e,i,o,n)},_renderChar:function(t,e,i,o,n,r,s,a){var h,l,c,u,p,d,f,g,v,b=this._getStyleDeclaration(i,o);if(b?(l=this._getHeightOfChar(e,n,i,o),u=b.stroke,c=b.fill,d=b.textDecoration):l=this.fontSize,u=(u||this.stroke)&&"strokeText"===t,c=(c||this.fill)&&"fillText"===t,b&&e.save(),h=this._applyCharStylesGetWidth(e,n,i,o,b||null),d=d||this.textDecoration,b&&b.textBackgroundColor&&this._removeShadow(e),0!==this.charSpacing){g=this._getWidthOfCharSpacing(),h=0;for(var m,y=0,_=(f=n.split("")).length;y<_;y++)m=f[y],c&&e.fillText(m,r+h,s),u&&e.strokeText(m,r+h,s),h+=(v=e.measureText(m).width+g)>0?v:0}else c&&e.fillText(n,r,s),u&&e.strokeText(n,r,s);(d||""!==d)&&(p=this._fontSizeFraction*a/this.lineHeight,this._renderCharDecoration(e,d,r,s,p,h,l)),b&&e.restore(),e.translate(h,0)},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.fontSize!==e.fontSize||t.textBackgroundColor!==e.textBackgroundColor||t.textDecoration!==e.textDecoration||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth},_renderCharDecoration:function(t,e,i,o,n,r,s){if(e){var a,h,l=s/15,c={underline:o+s/10,"line-through":o-s*(this._fontSizeFraction+this._fontSizeMult-1)+l,overline:o-(this._fontSizeMult-this._fontSizeFraction)*s},u=["underline","line-through","overline"];for(a=0;a<u.length;a++)h=u[a],e.indexOf(h)>-1&&t.fillRect(i,c[h],r,l)}},_renderTextLine:function(t,e,i,o,n,r){this.isEmptyStyles()||(n+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",t,e,i,o,n,r)},_renderTextDecoration:function(t){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",t)},_renderTextLinesBackground:function(t){this.callSuper("_renderTextLinesBackground",t);var e,i,o,n,r,s,a=0,h=this._getLeftOffset(),l=this._getTopOffset();t.save();for(var c=0,u=this._textLines.length;c<u;c++)if(e=this._getHeightOfLine(t,c),""!==(n=this._textLines[c])&&this.styles&&this._getLineStyle(c)){i=this._getLineWidth(t,c),o=this._getLineLeftOffset(i);for(var p=0,d=n.length;p<d;p++)(s=this._getStyleDeclaration(c,p))&&s.textBackgroundColor&&(r=n[p],t.fillStyle=s.textBackgroundColor,t.fillRect(h+o+this._getWidthOfCharsAt(t,c,p),l+a,this._getWidthOfChar(t,r,c,p),e/this.lineHeight));a+=e}else a+=e;t.restore()},_getCacheProp:function(t,e){return t+e.fontSize+e.fontWeight+e.fontStyle},_getFontCache:function(t){return fabric.charWidthsCache[t]||(fabric.charWidthsCache[t]={}),fabric.charWidthsCache[t]},_applyCharStylesGetWidth:function(e,i,o,n,r){var s,a,h,l=r||this._getStyleDeclaration(o,n),c=t(l);if(this._applyFontStyles(c),h=this._getFontCache(c.fontFamily),a=this._getCacheProp(i,c),!l&&h[a]&&this.caching)return h[a];"string"==typeof c.shadow&&(c.shadow=new fabric.Shadow(c.shadow));var u=c.fill||this.fill;return e.fillStyle=u.toLive?u.toLive(e,this):u,c.stroke&&(e.strokeStyle=c.stroke&&c.stroke.toLive?c.stroke.toLive(e,this):c.stroke),e.lineWidth=c.strokeWidth||this.strokeWidth,e.font=this._getFontDeclaration.call(c),c.shadow&&(c.scaleX=this.scaleX,c.scaleY=this.scaleY,c.canvas=this.canvas,c.getObjectScaling=this.getObjectScaling,this._setShadow.call(c,e)),this.caching&&h[a]?h[a]:(s=e.measureText(i).width,this.caching&&(h[a]=s),s)},_applyFontStyles:function(t){t.fontFamily||(t.fontFamily=this.fontFamily),t.fontSize||(t.fontSize=this.fontSize),t.fontWeight||(t.fontWeight=this.fontWeight),t.fontStyle||(t.fontStyle=this.fontStyle)},_getStyleDeclaration:function(e,i,o){return o?this.styles[e]&&this.styles[e][i]?t(this.styles[e][i]):{}:this.styles[e]&&this.styles[e][i]?this.styles[e][i]:null},_setStyleDeclaration:function(t,e,i){this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return this.styles[t]},_setLineStyle:function(t,e){this.styles[t]=e},_deleteLineStyle:function(t){delete this.styles[t]},_getWidthOfChar:function(t,e,i,o){if(!this._isMeasuring&&"justify"===this.textAlign&&this._reSpacesAndTabs.test(e))return this._getWidthOfSpace(t,i);t.save();var n=this._applyCharStylesGetWidth(t,e,i,o);return 0!==this.charSpacing&&(n+=this._getWidthOfCharSpacing()),t.restore(),n>0?n:0},_getHeightOfChar:function(t,e,i){var o=this._getStyleDeclaration(e,i);return o&&o.fontSize?o.fontSize:this.fontSize},_getWidthOfCharsAt:function(t,e,i){var o,n,r=0;for(o=0;o<i;o++)n=this._textLines[e][o],r+=this._getWidthOfChar(t,n,e,o);return r},_measureLine:function(t,e){this._isMeasuring=!0;var i=this._getWidthOfCharsAt(t,e,this._textLines[e].length);return 0!==this.charSpacing&&(i-=this._getWidthOfCharSpacing()),this._isMeasuring=!1,i>0?i:0},_getWidthOfSpace:function(t,e){if(this.__widthOfSpace[e])return this.__widthOfSpace[e];var i=this._textLines[e],o=this._getWidthOfWords(t,i,e,0),n=this.width-o,r=i.length-i.replace(this._reSpacesAndTabs,"").length,s=Math.max(n/r,t.measureText(" ").width);return this.__widthOfSpace[e]=s,s},_getWidthOfWords:function(t,e,i,o){for(var n=0,r=0;r<e.length;r++){var s=e[r];s.match(/\s/)||(n+=this._getWidthOfChar(t,s,i,r+o))}return n},_getHeightOfLine:function(t,e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var i=this._textLines[e],o=this._getHeightOfChar(t,e,0),n=1,r=i.length;n<r;n++){var s=this._getHeightOfChar(t,e,n);s>o&&(o=s)}return this.__lineHeights[e]=o*this.lineHeight*this._fontSizeMult,this.__lineHeights[e]},_getTextHeight:function(t){for(var e,i=0,o=0,n=this._textLines.length;o<n;o++)e=this._getHeightOfLine(t,o),i+=o===n-1?e/this.lineHeight:e;return i},toObject:function(e){return fabric.util.object.extend(this.callSuper("toObject",e),{styles:t(this.styles,!0)})}}),fabric.IText.fromObject=function(e,i){var o=new fabric.IText(e.text,t(e));return i&&i(o),o}}(),function(){var t=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},initSelectedHandler:function(){this.on("selected",function(){var t=this;setTimeout(function(){t.selected=!0},100)})},initAddedHandler:function(){var t=this;this.on("added",function(){var e=t.canvas;e&&(e._hasITextHandlers||(e._hasITextHandlers=!0,t._initCanvasHandlers(e)),e._iTextInstances=e._iTextInstances||[],e._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){var e=t.canvas;e&&(e._iTextInstances=e._iTextInstances||[],fabric.util.removeFromArray(e._iTextInstances,t),0===e._iTextInstances.length&&(e._hasITextHandlers=!1,t._removeCanvasHandlers(e)))})},_initCanvasHandlers:function(t){t._canvasITextSelectionClearedHanlder=function(){fabric.IText.prototype.exitEditingOnOthers(t)}.bind(this),t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.__isMousedown=!1})}.bind(this),t.on("selection:cleared",t._canvasITextSelectionClearedHanlder),t.on("object:selected",t._canvasITextSelectionClearedHanlder),t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("selection:cleared",t._canvasITextSelectionClearedHanlder),t.off("object:selected",t._canvasITextSelectionClearedHanlder),t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,i,o){var n;return n={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",e,{duration:i,onComplete:function(){n.isAborted||t[o]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return n.isAborted}}),n},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var e=this,i=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){e._tick()},i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this._fireSelectionChanged(),this._updateTextarea()},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i--;for(;/\S/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i++;for(;/\S/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},getNumNewLinesInSelectedText:function(){for(var t=this.getSelectedText(),e=0,i=0,o=t.length;i<o;i++)"\n"===t[i]&&e++;return e},searchWordBoundary:function(t,e){for(var i=this._reSpace.test(this.text.charAt(t))?t-1:t,o=this.text.charAt(i),n=/[ \n\.,;!\?\-]/;!n.test(o)&&i>0&&i<this.text.length;)i+=e,o=this.text.charAt(i);return n.test(o)&&"\n"!==o&&(i+=1===e?0:1),i},selectWord:function(t){t=t||this.selectionStart;var e=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var e=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea()},enterEditing:function(t){if(!this.isEditing&&this.editable)return this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.renderAll(),this):this},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.selected=!1,t.isEditing&&t.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(this.__isMousedown&&this.isEditing){var e=this.getSelectionStartFromPointer(t.e),i=this.selectionStart,o=this.selectionEnd;e!==this.__selectionStartOnMouseDown&&(e>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=e):(this.selectionStart=e,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===o||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea&&!this.inCompositionMode&&(this.cursorOffsetCache={},this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top,this.hiddenTextarea.style.fontSize=t.fontSize}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.text.split(""),e=this._getCursorBoundaries(t,"cursor"),i=this.get2DCursorLocation(),o=i.lineIndex,n=i.charIndex,r=this.getCurrentCharFontSize(o,n),s=0===o&&0===n?this._getLineLeftOffset(this._getLineWidth(this.ctx,o)):e.leftOffset,a=this.calcTransformMatrix(),h={x:e.left+s,y:e.top+e.topOffset+r},l=this.canvas.upperCanvasEl,c=l.width-r,u=l.height-r;return h=fabric.util.transformPoint(h,a),(h=fabric.util.transformPoint(h,this.canvas.viewportTransform)).x<0&&(h.x=0),h.x>c&&(h.x=c),h.y<0&&(h.y=0),h.y>u&&(h.y=u),h.x+=this.canvas._offset.left,h.y+=this.canvas._offset.top,{left:h.x+"px",top:h.y+"px",fontSize:r}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var t=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},_removeCharsFromTo:function(t,e){for(;e!==t;)this._removeSingleCharAndStyle(t+1),e--;this.selectionStart=t,this.selectionEnd=t},_removeSingleCharAndStyle:function(t){var e="\n"===this.text[t-1],i=e?t:t-1;this.removeStyleObject(e,i),this.text=this.text.slice(0,t-1)+this.text.slice(t),this._textLines=this._splitTextIntoLines()},insertChars:function(t,e){var i;if(this.selectionEnd-this.selectionStart>1&&this._removeCharsFromTo(this.selectionStart,this.selectionEnd),e||!this.isEmptyStyles())for(var o=0,n=t.length;o<n;o++)e&&(i=fabric.util.object.clone(fabric.copiedTextStyle[o],!0)),this.insertChar(t[o],o<n-1,i);else this.insertChar(t,!1)},insertChar:function(t,e,i){var o="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+t+this.text.slice(this.selectionEnd),this._textLines=this._splitTextIntoLines(),this.insertStyleObjects(t,o,i),this.selectionStart+=t.length,this.selectionEnd=this.selectionStart,e||(this._updateTextarea(),this.setCoords(),this._fireSelectionChanged(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}),this.canvas&&this.canvas.renderAll())},insertNewlineStyleObject:function(e,i,o){this.shiftLineStyles(e,1),this.styles[e+1]||(this.styles[e+1]={});var n={},r={};if(this.styles[e]&&this.styles[e][i-1]&&(n=this.styles[e][i-1]),o)r[0]=t(n),this.styles[e+1]=r;else{for(var s in this.styles[e])parseInt(s,10)>=i&&(r[parseInt(s,10)-i]=this.styles[e][s],delete this.styles[e][s]);this.styles[e+1]=r}this._forceClearCache=!0},insertCharStyleObject:function(e,i,o){var n=this.styles[e],r=t(n);for(var s in 0!==i||o||(i=1),r){var a=parseInt(s,10);a>=i&&(n[a+1]=r[a],r[a-1]||delete n[a])}this.styles[e][i]=o||t(n[i-1]),this._forceClearCache=!0},insertStyleObjects:function(t,e,i){var o=this.get2DCursorLocation(),n=o.lineIndex,r=o.charIndex;this._getLineStyle(n)||this._setLineStyle(n,{}),"\n"===t?this.insertNewlineStyleObject(n,r,e):this.insertCharStyleObject(n,r,i)},shiftLineStyles:function(e,i){var o=t(this.styles);for(var n in this.styles){var r=parseInt(n,10);r>e&&(this.styles[r+i]=o[r],o[r-i]||delete this.styles[r])}},removeStyleObject:function(t,e){var i=this.get2DCursorLocation(e),o=i.lineIndex,n=i.charIndex;this._removeStyleObject(t,i,o,n)},_getTextOnPreviousLine:function(t){return this._textLines[t-1]},_removeStyleObject:function(e,i,o,n){if(e){var r=this._getTextOnPreviousLine(i.lineIndex),s=r?r.length:0;for(n in this.styles[o-1]||(this.styles[o-1]={}),this.styles[o])this.styles[o-1][parseInt(n,10)+s]=this.styles[o][n];this.shiftLineStyles(i.lineIndex,-1)}else{var a=this.styles[o];a&&delete a[n];var h=t(a);for(var l in h){var c=parseInt(l,10);c>=n&&0!==c&&(a[c-1]=h[c],delete a[c])}}},insertNewline:function(){this.insertChars("\n")},setSelectionStartEndWithShift:function(t,e,i){i<=t?(e===t?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):i>t&&i<e?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(e===t?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=e),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t.e);this.isTripleClick(e)?(this.fire("tripleclick",t),this._stopEvent(t.e)):this.isDoubleClick(e)&&(this.fire("dblclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y&&this.__lastIsEditing},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))}),this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})},initMousedownHandler:function(){this.on("mousedown",function(t){if(this.editable){var e=this.canvas.getPointer(t.e);this.__mousedownX=e.x,this.__mousedownY=e.y,this.__isMousedown=!0,this.selected&&this.setCursorByClick(t.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())}})},_isObjectMoved:function(t){var e=this.canvas.getPointer(t);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(t){this.__isMousedown=!1,this.editable&&!this._isObjectMoved(t.e)&&(this.__lastSelected&&!this.__corner&&(this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)})},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t),i=this.selectionStart,o=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(i,o,e):(this.selectionStart=e,this.selectionEnd=e),this._fireSelectionChanged(),this._updateTextarea()},getSelectionStartFromPointer:function(t){for(var e,i=this.getLocalPointer(t),o=0,n=0,r=0,s=0,a=0,h=this._textLines.length;a<h;a++){e=this._textLines[a],r+=this._getHeightOfLine(this.ctx,a)*this.scaleY;var l=this._getLineWidth(this.ctx,a);n=this._getLineLeftOffset(l)*this.scaleX;for(var c=0,u=e.length;c<u;c++){if(o=n,n+=this._getWidthOfChar(this.ctx,e[c],a,this.flipX?u-c:c)*this.scaleX,!(r<=i.y||n<=i.x))return this._getNewSelectionStartFromOffset(i,o,n,s+a,u);s++}if(i.y<r)return this._getNewSelectionStartFromOffset(i,o,n,s+a-1,u)}return this.text.length},_getNewSelectionStartFromOffset:function(t,e,i,o,n){var r=t.x-e,s=o+(i-t.x>r?0:1);return this.flipX&&(s=n-s),s>this.text.length&&(s=this.text.length),s}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off");var t=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+t.top+"; left: "+t.left+"; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMapUp:{67:"copy",88:"cut"},_ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing){if(t.keyCode in this._keysMap)this[this._keysMap[t.keyCode]](t);else{if(!(t.keyCode in this._ctrlKeysMapDown&&(t.ctrlKey||t.metaKey)))return;this[this._ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.renderAll()}},onKeyUp:function(t){this.isEditing&&!this._copyDone?t.keyCode in this._ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this._ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()):this._copyDone=!1},onInput:function(t){if(this.isEditing&&!this.inCompositionMode){var e,i,o,n=this.selectionStart||0,r=this.selectionEnd||0,s=this.text.length,a=this.hiddenTextarea.value.length;a>s?(o="left"===this._selectionDirection?r:n,e=a-s,i=this.hiddenTextarea.value.slice(o,o+e)):(e=a-s+r-n,i=this.hiddenTextarea.value.slice(n,n+e)),this.insertChars(i),t.stopPropagation()}},onCompositionStart:function(){this.inCompositionMode=!0,this.prevCompositionLength=0,this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){var e=t.data;this.selectionStart=this.compositionStart,this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd,this.insertChars(e,!1),this.prevCompositionLength=e.length},forwardDelete:function(t){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(t)}this.removeChars(t)},copy:function(t){if(this.selectionStart!==this.selectionEnd){var e=this.getSelectedText(),i=this._getClipboardData(t);i&&i.setData("text",e),fabric.copiedText=e,fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd),t.stopImmediatePropagation(),t.preventDefault(),this._copyDone=!0}},paste:function(t){var e=null,i=this._getClipboardData(t),o=!0;i?(e=i.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===e||(o=!1)):e=fabric.copiedText,e&&this.insertChars(e,o),t.stopImmediatePropagation(),t.preventDefault()},cut:function(t){this.selectionStart!==this.selectionEnd&&(this.copy(t),this.removeChars(t))},_getClipboardData:function(t){return t&&t.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(t,e){for(var i,o=this._textLines[t].slice(0,e),n=this._getLineWidth(this.ctx,t),r=this._getLineLeftOffset(n),s=0,a=o.length;s<a;s++)i=o[s],r+=this._getWidthOfChar(this.ctx,i,t,s);return r},getDownCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),o=this.get2DCursorLocation(i),n=o.lineIndex;if(n===this._textLines.length-1||t.metaKey||34===t.keyCode)return this.text.length-i;var r=o.charIndex,s=this._getWidthBeforeCursor(n,r),a=this._getIndexOnLine(n+1,s);return this._textLines[n].slice(r).length+a+2},_getSelectionForOffset:function(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),o=this.get2DCursorLocation(i),n=o.lineIndex;if(0===n||t.metaKey||33===t.keyCode)return-i;var r=o.charIndex,s=this._getWidthBeforeCursor(n,r),a=this._getIndexOnLine(n-1,s),h=this._textLines[n].slice(0,r);return-this._textLines[n-1].length+a-h.length},_getIndexOnLine:function(t,e){for(var i,o=this._getLineWidth(this.ctx,t),n=this._textLines[t],r=this._getLineLeftOffset(o),s=0,a=0,h=n.length;a<h;a++){var l=n[a],c=this._getWidthOfChar(this.ctx,l,t,a);if((r+=c)>e){i=!0;var u=r-c,p=r,d=Math.abs(u-e);s=Math.abs(p-e)<d?a:a-1;break}}return i||(s=n.length-1),s},moveCursorDown:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,e){var i=this["get"+t+"CursorOffset"](e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(t){var e="left"===this._selectionDirection?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t},moveCursorWithoutShift:function(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t},moveCursorLeft:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)},_move:function(t,e,i){var o;if(t.altKey)o=this["findWordBoundary"+i](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===i?-1:1,!0;o=this["findLineBoundary"+i](this[e])}if(void 0!==typeof o&&this[e]!==o)return this[e]=o,!0},_moveLeft:function(t,e){return this._move(t,e,"Left")},_moveRight:function(t,e){return this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(t){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(t,"selectionStart")):void 0},moveCursorRight:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,e){var i="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?i+="Shift":i+="outShift",this[i](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this.text.length?(this._selectionDirection="right",this._moveRight(t,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(t){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(t){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(t):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(t){if(0!==this.selectionStart)if(t.metaKey){var e=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)}else if(t.altKey){var i=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(i,this.selectionStart),this.setSelectionStart(i)}else this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)}}),function(){var t=fabric.util.toFixed,e=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(t,e,i,o,n,r){this._getLineStyle(t)?this._setSVGTextLineChars(t,e,i,o,r):fabric.Text.prototype._setSVGTextLineText.call(this,t,e,i,o,n)},_setSVGTextLineChars:function(t,e,i,o,n){for(var r=this._textLines[t],s=0,a=this._getLineLeftOffset(this._getLineWidth(this.ctx,t))-this.width/2,h=this._getSVGLineTopOffset(t),l=this._getHeightOfLine(this.ctx,t),c=0,u=r.length;c<u;c++){var p=this._getStyleDeclaration(t,c)||{};e.push(this._createTextCharSpan(r[c],p,a,h.lineTop+h.offset,s));var d=this._getWidthOfChar(this.ctx,r[c],t,c);p.textBackgroundColor&&n.push(this._createTextCharBg(p,a,h.lineTop,l,d,s)),s+=d}},_getSVGLineTopOffset:function(t){for(var e,i=0,o=0;o<t;o++)i+=this._getHeightOfLine(this.ctx,o);return e=this._getHeightOfLine(this.ctx,o),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(i,o,n,r,s,a){return['\t\t<rect fill="',i.textBackgroundColor,'" x="',t(o+a,e),'" y="',t(n-this.height/2,e),'" width="',t(s,e),'" height="',t(r/this.lineHeight,e),'"></rect>\n'].join("")},_createTextCharSpan:function(i,o,n,r,s){var a=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},o));return['\t\t\t<tspan x="',t(n+s,e),'" y="',t(r-this.height/2,e),'" ',o.fontFamily?'font-family="'+o.fontFamily.replace(/"/g,"'")+'" ':"",o.fontSize?'font-size="'+o.fontSize+'" ':"",o.fontStyle?'font-style="'+o.fontStyle+'" ':"",o.fontWeight?'font-weight="'+o.fontWeight+'" ':"",o.textDecoration?'text-decoration="'+o.textDecoration+'" ':"",'style="',a,'">',fabric.util.string.escapeXml(i),"</tspan>\n"].join("")}})}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.clone;e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingY:!0,lockScalingFlip:!0,noScaleCache:!1,initialize:function(t,i){this.callSuper("initialize",t,i),this.setControlsVisibility(e.Textbox.getTextboxControlVisibility()),this.ctx=this.objectCaching?this._cacheContext:e.util.createCanvasElement().getContext("2d"),this._dimensionAffectingProps.push("width")},_initDimensions:function(t){this.__skipDimension||(t||(t=e.util.createCanvasElement().getContext("2d"),this._setTextStyles(t),this.clearContextTop()),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(t),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(t))},_generateStyleMap:function(){for(var t=0,e=0,i=0,o={},n=0;n<this._textLines.length;n++)"\n"===this.text[i]&&n>0?(e=0,i++,t++):" "===this.text[i]&&n>0&&(e++,i++),o[n]={line:t,offset:e},i+=this._textLines[n].length,e+=this._textLines[n].length;return o},_getStyleDeclaration:function(t,e,i){if(this._styleMap){var o=this._styleMap[t];if(!o)return i?{}:null;t=o.line,e=o.offset+e}return this.callSuper("_getStyleDeclaration",t,e,i)},_setStyleDeclaration:function(t,e,i){var o=this._styleMap[t];t=o.line,e=o.offset+e,this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){var i=this._styleMap[t];t=i.line,e=i.offset+e,delete this.styles[t][e]},_getLineStyle:function(t){var e=this._styleMap[t];return this.styles[e.line]},_setLineStyle:function(t,e){var i=this._styleMap[t];this.styles[i.line]=e},_deleteLineStyle:function(t){var e=this._styleMap[t];delete this.styles[e.line]},_wrapText:function(t,e){var i,o=e.split(this._reNewline),n=[];for(i=0;i<o.length;i++)n=n.concat(this._wrapLine(t,o[i],i));return n},_measureText:function(t,e,i,o){var n=0;o=o||0;for(var r=0,s=e.length;r<s;r++)n+=this._getWidthOfChar(t,e[r],i,r+o);return n},_wrapLine:function(t,e,i){for(var o=0,n=[],r="",s=e.split(" "),a="",h=0,l=0,c=0,u=0,p=!0,d=this._getWidthOfCharSpacing(),f=0;f<s.length;f++)a=s[f],l=this._measureText(t,a,i,h),h+=a.length,(o+=c+l-d)>=this.width&&!p?(n.push(r),r="",o=l,p=!0):o+=d,p||(r+=" "),r+=a,c=this._measureText(t," ",i,h),h++,p=!1,l>u&&(u=l);return f&&n.push(r),u>this.dynamicMinWidth&&(this.dynamicMinWidth=u-d),n},_splitTextIntoLines:function(t){t=t||this.ctx;var e=this.textAlign;this._styleMap=null,t.save(),this._setTextStyles(t),this.textAlign="left";var i=this._wrapText(t,this.text);return this.textAlign=e,t.restore(),this._textLines=i,this._styleMap=this._generateStyleMap(),i},setOnGroup:function(t,e){"scaleX"===t&&(this.set("scaleX",Math.abs(1/e)),this.set("width",this.get("width")*e/(void 0===this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=e)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,i=0,o=0;o<e;o++){var n=this._textLines[o].length;if(t<=i+n)return{lineIndex:o,charIndex:t-i};i+=n,"\n"!==this.text[i]&&" "!==this.text[i]||i++}return{lineIndex:e-1,charIndex:this._textLines[e-1].length}},_getCursorBoundariesOffsets:function(t,e){for(var i=0,o=0,n=this.get2DCursorLocation(),r=this._textLines[n.lineIndex].split(""),s=this._getLineLeftOffset(this._getLineWidth(this.ctx,n.lineIndex)),a=0;a<n.charIndex;a++)o+=this._getWidthOfChar(this.ctx,r[a],n.lineIndex,a);for(a=0;a<n.lineIndex;a++)i+=this._getHeightOfLine(this.ctx,a);return"cursor"===e&&(i+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,n.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(n.lineIndex,n.charIndex)*(1-this._fontSizeFraction)),{top:i,left:o,lineLeft:s}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(t){return this.callSuper("toObject",["minWidth"].concat(t))}}),e.Textbox.fromObject=function(t,o){var n=new e.Textbox(t.text,i(t));return o&&o(n),n},e.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}}}(exports),function(){var t=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(e,i,o,n,r,s,a){var h=i.target;if(!(h instanceof fabric.Textbox))return t.call(fabric.Canvas.prototype,e,i,o,n,r,s,a);var l=h.width*(e.x/i.scaleX/(h.width+h.strokeWidth));return l>=h.getMinWidth()?(h.set("width",l),!0):void 0},fabric.Group.prototype._refreshControlsVisibility=function(){if(void 0!==fabric.Textbox)for(var t=this._objects.length;t--;)if(this._objects[t]instanceof fabric.Textbox)return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility())};var e=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var t in this._styleMap)this._textLines[t]||delete this.styles[this._styleMap[t].line]},insertCharStyleObject:function(t,e,i){var o=this._styleMap[t];t=o.line,e=o.offset+e,fabric.IText.prototype.insertCharStyleObject.apply(this,[t,e,i])},insertNewlineStyleObject:function(t,e,i){var o=this._styleMap[t];t=o.line,e=o.offset+e,fabric.IText.prototype.insertNewlineStyleObject.apply(this,[t,e,i])},shiftLineStyles:function(t,i){var o=e(this.styles),n=this._styleMap[t];for(var r in t=n.line,this.styles){var s=parseInt(r,10);s>t&&(this.styles[s+i]=o[s],o[s-i]||delete this.styles[s])}},_getTextOnPreviousLine:function(t){for(var e=this._textLines[t-1];this._styleMap[t-2]&&this._styleMap[t-2].line===this._styleMap[t-1].line;)e=this._textLines[t-2]+e,t--;return e},removeStyleObject:function(t,e){var i=this.get2DCursorLocation(e),o=this._styleMap[i.lineIndex],n=o.line,r=o.offset+i.charIndex;this._removeStyleObject(t,i,n,r)}})}(),function(){var t=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(e,i,o,n,r){n=t.call(this,e,i,o,n,r);for(var s=0,a=0,h=0;h<this._textLines.length&&!((s+=this._textLines[h].length)+a>=n);h++)"\n"!==this.text[s+a]&&" "!==this.text[s+a]||a++;return n-h+a}}(),function(){if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=__webpack_require__(43).DOMParser,URL=__webpack_require__(9),HTTP=__webpack_require__(21),HTTPS=__webpack_require__(25),Canvas=__webpack_require__(10),Image=__webpack_require__(10).Image;fabric.util.loadImage=function(t,e,i){function o(o){o?(n.src=new Buffer(o,"binary"),n._src=t,e&&e.call(i,n)):(n=null,e&&e.call(i,null,!0))}var n=new Image;t&&(t instanceof Buffer||0===t.indexOf("data"))?(n.src=n._src=t,e&&e.call(i,n)):t&&0!==t.indexOf("http")?requestFs(t,o):t?request(t,"binary",o):e&&e.call(i,t)},fabric.loadSVGFromURL=function(t,e,i){0!==(t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim()).indexOf("http")?requestFs(t,function(t){fabric.loadSVGFromString(t.toString(),e,i)}):request(t,"",function(t){fabric.loadSVGFromString(t,e,i)})},fabric.loadSVGFromString=function(t,e,i){var o=(new DOMParser).parseFromString(t);fabric.parseSVGDocument(o.documentElement,function(t,i){e&&e(t,i)},i)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.createCanvasForNode=function(t,e,i,o){o=o||i;var n=fabric.document.createElement("canvas"),r=new Canvas(t||600,e||600,o),s=new Canvas(t||600,e||600,o);n.style={},n.width=r.width,n.height=r.height,(i=i||{}).nodeCanvas=r,i.nodeCacheCanvas=s;var a=new(fabric.Canvas||fabric.StaticCanvas)(n,i);return a.nodeCanvas=r,a.nodeCacheCanvas=s,a.contextContainer=r.getContext("2d"),a.contextCache=s.getContext("2d"),a.Font=Canvas.Font,a};var originaInitStatic=fabric.StaticCanvas.prototype._initStatic;fabric.StaticCanvas.prototype._initStatic=function(t,e){t=t||fabric.document.createElement("canvas"),this.nodeCanvas=new Canvas(t.width,t.height),this.nodeCacheCanvas=new Canvas(t.width,t.height),originaInitStatic.call(this,t,e),this.contextContainer=this.nodeCanvas.getContext("2d"),this.contextCache=this.nodeCacheCanvas.getContext("2d"),this.Font=Canvas.Font},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(t){return this.nodeCanvas.createJPEGStream(t)},fabric.StaticCanvas.prototype._initRetinaScaling=function(){if(this._isRetinaScaling())return this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.nodeCanvas.width=this.width*fabric.devicePixelRatio,this.nodeCanvas.height=this.height*fabric.devicePixelRatio,this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio),this},fabric.Canvas&&(fabric.Canvas.prototype._initRetinaScaling=fabric.StaticCanvas.prototype._initRetinaScaling);var origSetBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension;fabric.StaticCanvas.prototype._setBackstoreDimension=function(t,e){return origSetBackstoreDimension.call(this,t,e),this.nodeCanvas[t]=e,this},fabric.Canvas&&(fabric.Canvas.prototype._setBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension)}function request(t,e,i){var o=URL.parse(t);o.port||(o.port=0===o.protocol.indexOf("https:")?443:80);var n=(0===o.protocol.indexOf("https:")?HTTPS:HTTP).request({hostname:o.hostname,port:o.port,path:o.path,method:"GET"},function(t){var o="";e&&t.setEncoding(e),t.on("end",function(){i(o)}),t.on("data",function(e){200===t.statusCode&&(o+=e)})});n.on("error",function(t){t.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+o.hostname+":"+o.port):fabric.log(t.message),i(null)}),n.end()}function requestFs(t,e){__webpack_require__(24).readFile(t,function(t,i){if(t)throw fabric.log(t),t;e(i)})}}()}).call(this,__webpack_require__(5).Buffer,__webpack_require__(3))},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e){var i,o,n=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(t){i=r}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(t){o=s}}();var h,l=[],c=!1,u=-1;function p(){c&&h&&(c=!1,h.length?l=h.concat(l):u=-1,l.length&&d())}function d(){if(!c){var t=a(p);c=!0;for(var e=l.length;e;){for(h=l,l=[];++u<e;)h&&h[u].run();u=-1,e=l.length}h=null,c=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function g(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new f(t,e)),1!==l.length||c||a(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e,i){"use strict";var o=i(8),n=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};t.exports=u;var r=i(6);r.inherits=i(2);var s=i(17),a=i(13);r.inherits(u,s);for(var h=n(a.prototype),l=0;l<h.length;l++){var c=h[l];u.prototype[c]||(u.prototype[c]=a.prototype[c])}function u(t){if(!(this instanceof u))return new u(t);s.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",p)}function p(){this.allowHalfOpen||this._writableState.ended||o.nextTick(d,this)}function d(t){t.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),u.prototype._destroy=function(t,e){this.push(null),this.end(),o.nextTick(e,t)}},function(t,e,i){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var o=i(46),n=i(45),r=i(22);function s(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=h.prototype:(null===t&&(t=new h(e)),t.length=e),t}function h(t,e,i){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return u(this,t)}return l(this,t,e,i)}function l(t,e,i,o){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,o){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(o||0))throw new RangeError("'length' is out of bounds");e=void 0===i&&void 0===o?new Uint8Array(e):void 0===o?new Uint8Array(e,i):new Uint8Array(e,i,o);h.TYPED_ARRAY_SUPPORT?(t=e).__proto__=h.prototype:t=p(t,e);return t}(t,e,i,o):"string"==typeof e?function(t,e,i){"string"==typeof i&&""!==i||(i="utf8");if(!h.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var o=0|f(e,i),n=(t=a(t,o)).write(e,i);n!==o&&(t=t.slice(0,n));return t}(t,e,i):function(t,e){if(h.isBuffer(e)){var i=0|d(e.length);return 0===(t=a(t,i)).length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?a(t,0):p(t,e);if("Buffer"===e.type&&r(e.data))return p(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function u(t,e){if(c(e),t=a(t,e<0?0:0|d(e)),!h.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function p(t,e){var i=e.length<0?0:0|d(e.length);t=a(t,i);for(var o=0;o<i;o+=1)t[o]=255&e[o];return t}function d(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function f(t,e){if(h.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var o=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return $(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return F(t).length;default:if(o)return $(t).length;e=(""+e).toLowerCase(),o=!0}}function g(t,e,i){var o=t[e];t[e]=t[i],t[i]=o}function v(t,e,i,o,n){if(0===t.length)return-1;if("string"==typeof i?(o=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=n?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(n)return-1;i=t.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof e&&(e=h.from(e,o)),h.isBuffer(e))return 0===e.length?-1:b(t,e,i,o,n);if("number"==typeof e)return e&=255,h.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):b(t,[e],i,o,n);throw new TypeError("val must be string, number or Buffer")}function b(t,e,i,o,n){var r,s=1,a=t.length,h=e.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(t.length<2||e.length<2)return-1;s=2,a/=2,h/=2,i/=2}function l(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(n){var c=-1;for(r=i;r<a;r++)if(l(t,r)===l(e,-1===c?0:r-c)){if(-1===c&&(c=r),r-c+1===h)return c*s}else-1!==c&&(r-=r-c),c=-1}else for(i+h>a&&(i=a-h),r=i;r>=0;r--){for(var u=!0,p=0;p<h;p++)if(l(t,r+p)!==l(e,p)){u=!1;break}if(u)return r}return-1}function m(t,e,i,o){i=Number(i)||0;var n=t.length-i;o?(o=Number(o))>n&&(o=n):o=n;var r=e.length;if(r%2!=0)throw new TypeError("Invalid hex string");o>r/2&&(o=r/2);for(var s=0;s<o;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[i+s]=a}return s}function y(t,e,i,o){return V($(e,t.length-i),t,i,o)}function _(t,e,i,o){return V(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,o)}function w(t,e,i,o){return _(t,e,i,o)}function C(t,e,i,o){return V(F(e),t,i,o)}function T(t,e,i,o){return V(function(t,e){for(var i,o,n,r=[],s=0;s<t.length&&!((e-=2)<0);++s)i=t.charCodeAt(s),o=i>>8,n=i%256,r.push(n),r.push(o);return r}(e,t.length-i),t,i,o)}function S(t,e,i){return 0===e&&i===t.length?o.fromByteArray(t):o.fromByteArray(t.slice(e,i))}function O(t,e,i){i=Math.min(t.length,i);for(var o=[],n=e;n<i;){var r,s,a,h,l=t[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u<=i)switch(u){case 1:l<128&&(c=l);break;case 2:128==(192&(r=t[n+1]))&&(h=(31&l)<<6|63&r)>127&&(c=h);break;case 3:r=t[n+1],s=t[n+2],128==(192&r)&&128==(192&s)&&(h=(15&l)<<12|(63&r)<<6|63&s)>2047&&(h<55296||h>57343)&&(c=h);break;case 4:r=t[n+1],s=t[n+2],a=t[n+3],128==(192&r)&&128==(192&s)&&128==(192&a)&&(h=(15&l)<<18|(63&r)<<12|(63&s)<<6|63&a)>65535&&h<1114112&&(c=h)}null===c?(c=65533,u=1):c>65535&&(c-=65536,o.push(c>>>10&1023|55296),c=56320|1023&c),o.push(c),n+=u}return function(t){var e=t.length;if(e<=E)return String.fromCharCode.apply(String,t);var i="",o=0;for(;o<e;)i+=String.fromCharCode.apply(String,t.slice(o,o+=E));return i}(o)}e.Buffer=h,e.SlowBuffer=function(t){+t!=t&&(t=0);return h.alloc(+t)},e.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),h.poolSize=8192,h._augment=function(t){return t.__proto__=h.prototype,t},h.from=function(t,e,i){return l(null,t,e,i)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(t,e,i){return function(t,e,i,o){return c(e),e<=0?a(t,e):void 0!==i?"string"==typeof o?a(t,e).fill(i,o):a(t,e).fill(i):a(t,e)}(null,t,e,i)},h.allocUnsafe=function(t){return u(null,t)},h.allocUnsafeSlow=function(t){return u(null,t)},h.isBuffer=function(t){return!(null==t||!t._isBuffer)},h.compare=function(t,e){if(!h.isBuffer(t)||!h.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,o=e.length,n=0,r=Math.min(i,o);n<r;++n)if(t[n]!==e[n]){i=t[n],o=e[n];break}return i<o?-1:o<i?1:0},h.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(t,e){if(!r(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return h.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var o=h.allocUnsafe(e),n=0;for(i=0;i<t.length;++i){var s=t[i];if(!h.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(o,n),n+=s.length}return o},h.byteLength=f,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},h.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},h.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},h.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?O(this,0,t):function(t,e,i){var o=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return A(this,e,i);case"utf8":case"utf-8":return O(this,e,i);case"ascii":return x(this,e,i);case"latin1":case"binary":return I(this,e,i);case"base64":return S(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,e,i);default:if(o)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),o=!0}}.apply(this,arguments)},h.prototype.equals=function(t){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===h.compare(this,t)},h.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},h.prototype.compare=function(t,e,i,o,n){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===o&&(o=0),void 0===n&&(n=this.length),e<0||i>t.length||o<0||n>this.length)throw new RangeError("out of range index");if(o>=n&&e>=i)return 0;if(o>=n)return-1;if(e>=i)return 1;if(e>>>=0,i>>>=0,o>>>=0,n>>>=0,this===t)return 0;for(var r=n-o,s=i-e,a=Math.min(r,s),l=this.slice(o,n),c=t.slice(e,i),u=0;u<a;++u)if(l[u]!==c[u]){r=l[u],s=c[u];break}return r<s?-1:s<r?1:0},h.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},h.prototype.indexOf=function(t,e,i){return v(this,t,e,i,!0)},h.prototype.lastIndexOf=function(t,e,i){return v(this,t,e,i,!1)},h.prototype.write=function(t,e,i,o){if(void 0===e)o="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)o=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===o&&(o="utf8")):(o=i,i=void 0)}var n=this.length-e;if((void 0===i||i>n)&&(i=n),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var r=!1;;)switch(o){case"hex":return m(this,t,e,i);case"utf8":case"utf-8":return y(this,t,e,i);case"ascii":return _(this,t,e,i);case"latin1":case"binary":return w(this,t,e,i);case"base64":return C(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,e,i);default:if(r)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),r=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var E=4096;function x(t,e,i){var o="";i=Math.min(t.length,i);for(var n=e;n<i;++n)o+=String.fromCharCode(127&t[n]);return o}function I(t,e,i){var o="";i=Math.min(t.length,i);for(var n=e;n<i;++n)o+=String.fromCharCode(t[n]);return o}function A(t,e,i){var o=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>o)&&(i=o);for(var n="",r=e;r<i;++r)n+=z(t[r]);return n}function D(t,e,i){for(var o=t.slice(e,i),n="",r=0;r<o.length;r+=2)n+=String.fromCharCode(o[r]+256*o[r+1]);return n}function k(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function P(t,e,i,o,n,r){if(!h.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<r)throw new RangeError('"value" argument is out of bounds');if(i+o>t.length)throw new RangeError("Index out of range")}function M(t,e,i,o){e<0&&(e=65535+e+1);for(var n=0,r=Math.min(t.length-i,2);n<r;++n)t[i+n]=(e&255<<8*(o?n:1-n))>>>8*(o?n:1-n)}function B(t,e,i,o){e<0&&(e=4294967295+e+1);for(var n=0,r=Math.min(t.length-i,4);n<r;++n)t[i+n]=e>>>8*(o?n:3-n)&255}function j(t,e,i,o,n,r){if(i+o>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function R(t,e,i,o,r){return r||j(t,0,i,4),n.write(t,e,i,o,23,4),i+4}function L(t,e,i,o,r){return r||j(t,0,i,8),n.write(t,e,i,o,52,8),i+8}h.prototype.slice=function(t,e){var i,o=this.length;if(t=~~t,e=void 0===e?o:~~e,t<0?(t+=o)<0&&(t=0):t>o&&(t=o),e<0?(e+=o)<0&&(e=0):e>o&&(e=o),e<t&&(e=t),h.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=h.prototype;else{var n=e-t;i=new h(n,void 0);for(var r=0;r<n;++r)i[r]=this[r+t]}return i},h.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||k(t,e,this.length);for(var o=this[t],n=1,r=0;++r<e&&(n*=256);)o+=this[t+r]*n;return o},h.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||k(t,e,this.length);for(var o=this[t+--e],n=1;e>0&&(n*=256);)o+=this[t+--e]*n;return o},h.prototype.readUInt8=function(t,e){return e||k(t,1,this.length),this[t]},h.prototype.readUInt16LE=function(t,e){return e||k(t,2,this.length),this[t]|this[t+1]<<8},h.prototype.readUInt16BE=function(t,e){return e||k(t,2,this.length),this[t]<<8|this[t+1]},h.prototype.readUInt32LE=function(t,e){return e||k(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},h.prototype.readUInt32BE=function(t,e){return e||k(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},h.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||k(t,e,this.length);for(var o=this[t],n=1,r=0;++r<e&&(n*=256);)o+=this[t+r]*n;return o>=(n*=128)&&(o-=Math.pow(2,8*e)),o},h.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||k(t,e,this.length);for(var o=e,n=1,r=this[t+--o];o>0&&(n*=256);)r+=this[t+--o]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*e)),r},h.prototype.readInt8=function(t,e){return e||k(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},h.prototype.readInt16LE=function(t,e){e||k(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},h.prototype.readInt16BE=function(t,e){e||k(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},h.prototype.readInt32LE=function(t,e){return e||k(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},h.prototype.readInt32BE=function(t,e){return e||k(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},h.prototype.readFloatLE=function(t,e){return e||k(t,4,this.length),n.read(this,t,!0,23,4)},h.prototype.readFloatBE=function(t,e){return e||k(t,4,this.length),n.read(this,t,!1,23,4)},h.prototype.readDoubleLE=function(t,e){return e||k(t,8,this.length),n.read(this,t,!0,52,8)},h.prototype.readDoubleBE=function(t,e){return e||k(t,8,this.length),n.read(this,t,!1,52,8)},h.prototype.writeUIntLE=function(t,e,i,o){(t=+t,e|=0,i|=0,o)||P(this,t,e,i,Math.pow(2,8*i)-1,0);var n=1,r=0;for(this[e]=255&t;++r<i&&(n*=256);)this[e+r]=t/n&255;return e+i},h.prototype.writeUIntBE=function(t,e,i,o){(t=+t,e|=0,i|=0,o)||P(this,t,e,i,Math.pow(2,8*i)-1,0);var n=i-1,r=1;for(this[e+n]=255&t;--n>=0&&(r*=256);)this[e+n]=t/r&255;return e+i},h.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||P(this,t,e,1,255,0),h.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},h.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||P(this,t,e,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},h.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||P(this,t,e,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},h.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||P(this,t,e,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):B(this,t,e,!0),e+4},h.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||P(this,t,e,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):B(this,t,e,!1),e+4},h.prototype.writeIntLE=function(t,e,i,o){if(t=+t,e|=0,!o){var n=Math.pow(2,8*i-1);P(this,t,e,i,n-1,-n)}var r=0,s=1,a=0;for(this[e]=255&t;++r<i&&(s*=256);)t<0&&0===a&&0!==this[e+r-1]&&(a=1),this[e+r]=(t/s>>0)-a&255;return e+i},h.prototype.writeIntBE=function(t,e,i,o){if(t=+t,e|=0,!o){var n=Math.pow(2,8*i-1);P(this,t,e,i,n-1,-n)}var r=i-1,s=1,a=0;for(this[e+r]=255&t;--r>=0&&(s*=256);)t<0&&0===a&&0!==this[e+r+1]&&(a=1),this[e+r]=(t/s>>0)-a&255;return e+i},h.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||P(this,t,e,1,127,-128),h.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},h.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||P(this,t,e,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):M(this,t,e,!0),e+2},h.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||P(this,t,e,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):M(this,t,e,!1),e+2},h.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||P(this,t,e,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):B(this,t,e,!0),e+4},h.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||P(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):B(this,t,e,!1),e+4},h.prototype.writeFloatLE=function(t,e,i){return R(this,t,e,!0,i)},h.prototype.writeFloatBE=function(t,e,i){return R(this,t,e,!1,i)},h.prototype.writeDoubleLE=function(t,e,i){return L(this,t,e,!0,i)},h.prototype.writeDoubleBE=function(t,e,i){return L(this,t,e,!1,i)},h.prototype.copy=function(t,e,i,o){if(i||(i=0),o||0===o||(o=this.length),e>=t.length&&(e=t.length),e||(e=0),o>0&&o<i&&(o=i),o===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),t.length-e<o-i&&(o=t.length-e+i);var n,r=o-i;if(this===t&&i<e&&e<o)for(n=r-1;n>=0;--n)t[n+e]=this[n+i];else if(r<1e3||!h.TYPED_ARRAY_SUPPORT)for(n=0;n<r;++n)t[n+e]=this[n+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+r),e);return r},h.prototype.fill=function(t,e,i,o){if("string"==typeof t){if("string"==typeof e?(o=e,e=0,i=this.length):"string"==typeof i&&(o=i,i=this.length),1===t.length){var n=t.charCodeAt(0);n<256&&(t=n)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!h.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var r;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(r=e;r<i;++r)this[r]=t;else{var s=h.isBuffer(t)?t:$(new h(t,o).toString()),a=s.length;for(r=0;r<i-e;++r)this[r+e]=s[r%a]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function z(t){return t<16?"0"+t.toString(16):t.toString(16)}function $(t,e){var i;e=e||1/0;for(var o=t.length,n=null,r=[],s=0;s<o;++s){if((i=t.charCodeAt(s))>55295&&i<57344){if(!n){if(i>56319){(e-=3)>-1&&r.push(239,191,189);continue}if(s+1===o){(e-=3)>-1&&r.push(239,191,189);continue}n=i;continue}if(i<56320){(e-=3)>-1&&r.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(e-=3)>-1&&r.push(239,191,189);if(n=null,i<128){if((e-=1)<0)break;r.push(i)}else if(i<2048){if((e-=2)<0)break;r.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;r.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;r.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return r}function F(t){return o.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(N,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function V(t,e,i,o){for(var n=0;n<o&&!(n+i>=e.length||n>=t.length);++n)e[n+i]=t[n];return n}}).call(this,i(0))},function(t,e,i){(function(t){function i(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===i(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===i(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===i(t)},e.isError=function(t){return"[object Error]"===i(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(this,i(5).Buffer)},function(t,e,i){var o=i(5),n=o.Buffer;function r(t,e){for(var i in t)e[i]=t[i]}function s(t,e,i){return n(t,e,i)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=o:(r(o,e),e.Buffer=s),r(n,s),s.from=function(t,e,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return n(t,e,i)},s.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var o=n(t);return void 0!==e?"string"==typeof i?o.fill(e,i):o.fill(e):o.fill(0),o},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return o.SlowBuffer(t)}},function(t,e,i){"use strict";(function(e){!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,i,o,n){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var r,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,i)});case 3:return e.nextTick(function(){t.call(null,i,o)});case 4:return e.nextTick(function(){t.call(null,i,o,n)});default:for(r=new Array(a-1),s=0;s<r.length;)r[s++]=arguments[s];return e.nextTick(function(){t.apply(null,r)})}}}:t.exports=e}).call(this,i(3))},function(t,e,i){"use strict";var o=i(42),n=i(40);function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=y,e.resolve=function(t,e){return y(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?y(t,!1,!0).resolveObject(e):e},e.format=function(t){n.isString(t)&&(t=y(t));return t instanceof r?t.format():r.prototype.format.call(t)},e.Url=r;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,h=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(l),u=["%","/","?",";","#"].concat(c),p=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=i(39);function y(t,e,i){if(t&&n.isObject(t)&&t instanceof r)return t;var o=new r;return o.parse(t,e,i),o}r.prototype.parse=function(t,e,i){if(!n.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),a=-1!==r&&r<t.indexOf("#")?"?":"#",l=t.split(a);l[0]=l[0].replace(/\\/g,"/");var y=t=l.join(a);if(y=y.trim(),!i&&1===t.split("#").length){var _=h.exec(y);if(_)return this.path=y,this.href=y,this.pathname=_[1],_[2]?(this.search=_[2],this.query=e?m.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var w=s.exec(y);if(w){var C=(w=w[0]).toLowerCase();this.protocol=C,y=y.substr(w.length)}if(i||w||y.match(/^\/\/[^@\/]+@[^@\/]+/)){var T="//"===y.substr(0,2);!T||w&&v[w]||(y=y.substr(2),this.slashes=!0)}if(!v[w]&&(T||w&&!b[w])){for(var S,O,E=-1,x=0;x<p.length;x++){-1!==(I=y.indexOf(p[x]))&&(-1===E||I<E)&&(E=I)}-1!==(O=-1===E?y.lastIndexOf("@"):y.lastIndexOf("@",E))&&(S=y.slice(0,O),y=y.slice(O+1),this.auth=decodeURIComponent(S)),E=-1;for(x=0;x<u.length;x++){var I;-1!==(I=y.indexOf(u[x]))&&(-1===E||I<E)&&(E=I)}-1===E&&(E=y.length),this.host=y.slice(0,E),y=y.slice(E),this.parseHost(),this.hostname=this.hostname||"";var A="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var D=this.hostname.split(/\./),k=(x=0,D.length);x<k;x++){var P=D[x];if(P&&!P.match(d)){for(var M="",B=0,j=P.length;B<j;B++)P.charCodeAt(B)>127?M+="x":M+=P[B];if(!M.match(d)){var R=D.slice(0,x),L=D.slice(x+1),N=P.match(f);N&&(R.push(N[1]),L.unshift(N[2])),L.length&&(y="/"+L.join(".")+y),this.hostname=R.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),A||(this.hostname=o.toASCII(this.hostname));var z=this.port?":"+this.port:"",$=this.hostname||"";this.host=$+z,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!g[C])for(x=0,k=c.length;x<k;x++){var F=c[x];if(-1!==y.indexOf(F)){var V=encodeURIComponent(F);V===F&&(V=escape(F)),y=y.split(F).join(V)}}var H=y.indexOf("#");-1!==H&&(this.hash=y.substr(H),y=y.slice(0,H));var W=y.indexOf("?");if(-1!==W?(this.search=y.substr(W),this.query=y.substr(W+1),e&&(this.query=m.parse(this.query)),y=y.slice(0,W)):e&&(this.search="",this.query={}),y&&(this.pathname=y),b[C]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){z=this.pathname||"";var U=this.search||"";this.path=z+U}return this.href=this.format(),this},r.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",o=this.hash||"",r=!1,s="";this.host?r=t+this.host:this.hostname&&(r=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&n.isObject(this.query)&&Object.keys(this.query).length&&(s=m.stringify(this.query));var a=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||b[e])&&!1!==r?(r="//"+(r||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):r||(r=""),o&&"#"!==o.charAt(0)&&(o="#"+o),a&&"?"!==a.charAt(0)&&(a="?"+a),e+r+(i=i.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(a=a.replace("#","%23"))+o},r.prototype.resolve=function(t){return this.resolveObject(y(t,!1,!0)).format()},r.prototype.resolveObject=function(t){if(n.isString(t)){var e=new r;e.parse(t,!1,!0),t=e}for(var i=new r,o=Object.keys(this),s=0;s<o.length;s++){var a=o[s];i[a]=this[a]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var h=Object.keys(t),l=0;l<h.length;l++){var c=h[l];"protocol"!==c&&(i[c]=t[c])}return b[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!b[t.protocol]){for(var u=Object.keys(t),p=0;p<u.length;p++){var d=u[p];i[d]=t[d]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||v[t.protocol])i.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),i.pathname=f.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var g=i.pathname||"",m=i.search||"";i.path=g+m}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var y=i.pathname&&"/"===i.pathname.charAt(0),_=t.host||t.pathname&&"/"===t.pathname.charAt(0),w=_||y||i.host&&t.pathname,C=w,T=i.pathname&&i.pathname.split("/")||[],S=(f=t.pathname&&t.pathname.split("/")||[],i.protocol&&!b[i.protocol]);if(S&&(i.hostname="",i.port=null,i.host&&(""===T[0]?T[0]=i.host:T.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),w=w&&(""===f[0]||""===T[0])),_)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,T=f;else if(f.length)T||(T=[]),T.pop(),T=T.concat(f),i.search=t.search,i.query=t.query;else if(!n.isNullOrUndefined(t.search)){if(S)i.hostname=i.host=T.shift(),(A=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=A.shift(),i.host=i.hostname=A.shift());return i.search=t.search,i.query=t.query,n.isNull(i.pathname)&&n.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!T.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var O=T.slice(-1)[0],E=(i.host||t.host||T.length>1)&&("."===O||".."===O)||""===O,x=0,I=T.length;I>=0;I--)"."===(O=T[I])?T.splice(I,1):".."===O?(T.splice(I,1),x++):x&&(T.splice(I,1),x--);if(!w&&!C)for(;x--;x)T.unshift("..");!w||""===T[0]||T[0]&&"/"===T[0].charAt(0)||T.unshift(""),E&&"/"!==T.join("/").substr(-1)&&T.push("");var A,D=""===T[0]||T[0]&&"/"===T[0].charAt(0);S&&(i.hostname=i.host=D?"":T.length?T.shift():"",(A=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=A.shift(),i.host=i.hostname=A.shift()));return(w=w||i.host&&T.length)&&!D&&T.unshift(""),T.length?i.pathname=T.join("/"):(i.pathname=null,i.path=null),n.isNull(i.pathname)&&n.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},r.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},function(t,e){},function(t,e,i){"use strict";t.exports=r;var o=i(4),n=i(6);function r(t){if(!(this instanceof r))return new r(t);o.call(this,t),this._transformState={afterTransform:function(t,e){var i=this._transformState;i.transforming=!1;var o=i.writecb;if(!o)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,i.writecb=null,null!=e&&this.push(e),o(t);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",s)}function s(){var t=this;"function"==typeof this._flush?this._flush(function(e,i){a(t,e,i)}):a(this,null,null)}function a(t,e,i){if(e)return t.emit("error",e);if(null!=i&&t.push(i),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}n.inherits=i(2),n.inherits(r,o),r.prototype.push=function(t,e){return this._transformState.needTransform=!1,o.prototype.push.call(this,t,e)},r.prototype._transform=function(t,e,i){throw new Error("_transform() is not implemented")},r.prototype._write=function(t,e,i){var o=this._transformState;if(o.writecb=i,o.writechunk=t,o.writeencoding=e,!o.transforming){var n=this._readableState;(o.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},r.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},r.prototype._destroy=function(t,e){var i=this;o.prototype._destroy.call(this,t,function(t){e(t),i.emit("close")})}},function(t,e,i){"use strict";var o=i(7).Buffer,n=o.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(o.isEncoding===n||!n(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=h,this.end=l,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=c,this.end=u,e=3;break;default:return this.write=p,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=o.allocUnsafe(e)}function s(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function a(t){var e=this.lastTotal-this.lastNeed,i=function(t,e,i){if(128!=(192&e[0]))return t.lastNeed=0,"";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,""}}(this,t);return void 0!==i?i:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function h(t,e){if((t.length-e)%2==0){var i=t.toString("utf16le",e);if(i){var o=i.charCodeAt(i.length-1);if(o>=55296&&o<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function l(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,i)}return e}function c(t,e){var i=(t.length-e)%3;return 0===i?t.toString("base64",e):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-i))}function u(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function p(t){return t.toString(this.encoding)}function d(t){return t&&t.length?this.write(t):""}e.StringDecoder=r,r.prototype.write=function(t){if(0===t.length)return"";var e,i;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<t.length?e?e+this.text(t,i):this.text(t,i):e||""},r.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e},r.prototype.text=function(t,e){var i=function(t,e,i){var o=e.length-1;if(o<i)return 0;var n=s(e[o]);if(n>=0)return n>0&&(t.lastNeed=n-1),n;if(--o<i||-2===n)return 0;if((n=s(e[o]))>=0)return n>0&&(t.lastNeed=n-2),n;if(--o<i||-2===n)return 0;if((n=s(e[o]))>=0)return n>0&&(2===n?n=0:t.lastNeed=n-3),n;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=i;var o=t.length-(i-this.lastNeed);return t.copy(this.lastChar,0,o),t.toString("utf8",e,o)},r.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,i){"use strict";(function(e,o,n){var r=i(8);function s(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,i){var o=t.entry;t.entry=null;for(;o;){var n=o.callback;e.pendingcb--,n(i),o=o.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=m;var a,h=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?o:r.nextTick;m.WritableState=b;var l=i(6);l.inherits=i(2);var c={deprecate:i(30)},u=i(15),p=i(7).Buffer,d=n.Uint8Array||function(){};var f,g=i(14);function v(){}function b(t,e){a=a||i(4),t=t||{};var o=e instanceof a;this.objectMode=!!t.objectMode,o&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,l=t.writableHighWaterMark,c=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:o&&(l||0===l)?l:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===t.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var i=t._writableState,o=i.sync,n=i.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(i),e)!function(t,e,i,o,n){--e.pendingcb,i?(r.nextTick(n,o),r.nextTick(S,t,e),t._writableState.errorEmitted=!0,t.emit("error",o)):(n(o),t._writableState.errorEmitted=!0,t.emit("error",o),S(t,e))}(t,i,o,e,n);else{var s=C(i);s||i.corked||i.bufferProcessing||!i.bufferedRequest||w(t,i),o?h(_,t,i,s,n):_(t,i,s,n)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function m(t){if(a=a||i(4),!(f.call(m,this)||this instanceof a))return new m(t);this._writableState=new b(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),u.call(this)}function y(t,e,i,o,n,r,s){e.writelen=o,e.writecb=s,e.writing=!0,e.sync=!0,i?t._writev(n,e.onwrite):t._write(n,r,e.onwrite),e.sync=!1}function _(t,e,i,o){i||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,o(),S(t,e)}function w(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var o=e.bufferedRequestCount,n=new Array(o),r=e.corkedRequestsFree;r.entry=i;for(var a=0,h=!0;i;)n[a]=i,i.isBuf||(h=!1),i=i.next,a+=1;n.allBuffers=h,y(t,e,!0,e.length,n,"",r.finish),e.pendingcb++,e.lastBufferedRequest=null,r.next?(e.corkedRequestsFree=r.next,r.next=null):e.corkedRequestsFree=new s(e),e.bufferedRequestCount=0}else{for(;i;){var l=i.chunk,c=i.encoding,u=i.callback;if(y(t,e,!1,e.objectMode?1:l.length,l,c,u),i=i.next,e.bufferedRequestCount--,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequest=i,e.bufferProcessing=!1}function C(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function T(t,e){t._final(function(i){e.pendingcb--,i&&t.emit("error",i),e.prefinished=!0,t.emit("prefinish"),S(t,e)})}function S(t,e){var i=C(e);return i&&(!function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,r.nextTick(T,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),i}l.inherits(m,u),b.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(b.prototype,"buffer",{get:c.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(m,Symbol.hasInstance,{value:function(t){return!!f.call(this,t)||this===m&&(t&&t._writableState instanceof b)}})):f=function(t){return t instanceof this},m.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},m.prototype.write=function(t,e,i){var o=this._writableState,n=!1,s=!o.objectMode&&function(t){return p.isBuffer(t)||t instanceof d}(t);return s&&!p.isBuffer(t)&&(t=function(t){return p.from(t)}(t)),"function"==typeof e&&(i=e,e=null),s?e="buffer":e||(e=o.defaultEncoding),"function"!=typeof i&&(i=v),o.ended?function(t,e){var i=new Error("write after end");t.emit("error",i),r.nextTick(e,i)}(this,i):(s||function(t,e,i,o){var n=!0,s=!1;return null===i?s=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||e.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(t.emit("error",s),r.nextTick(o,s),n=!1),n}(this,o,t,i))&&(o.pendingcb++,n=function(t,e,i,o,n,r){if(!i){var s=function(t,e,i){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=p.from(e,i));return e}(e,o,n);o!==s&&(i=!0,n="buffer",o=s)}var a=e.objectMode?1:o.length;e.length+=a;var h=e.length<e.highWaterMark;h||(e.needDrain=!0);if(e.writing||e.corked){var l=e.lastBufferedRequest;e.lastBufferedRequest={chunk:o,encoding:n,isBuf:i,callback:r,next:null},l?l.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else y(t,e,!1,a,o,n,r);return h}(this,o,s,t,e,i)),n},m.prototype.cork=function(){this._writableState.corked++},m.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||w(this,t))},m.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(m.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),m.prototype._write=function(t,e,i){i(new Error("_write() is not implemented"))},m.prototype._writev=null,m.prototype.end=function(t,e,i){var o=this._writableState;"function"==typeof t?(i=t,t=null,e=null):"function"==typeof e&&(i=e,e=null),null!==t&&void 0!==t&&this.write(t,e),o.corked&&(o.corked=1,this.uncork()),o.ending||o.finished||function(t,e,i){e.ending=!0,S(t,e),i&&(e.finished?r.nextTick(i):t.once("finish",i));e.ended=!0,t.writable=!1}(this,o,i)},Object.defineProperty(m.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),m.prototype.destroy=g.destroy,m.prototype._undestroy=g.undestroy,m.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,i(3),i(32).setImmediate,i(0))},function(t,e,i){"use strict";var o=i(8);function n(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var i=this,r=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return r||s?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||o.nextTick(n,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(o.nextTick(n,i,t),i._writableState&&(i._writableState.errorEmitted=!0)):e&&e(t)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,i){t.exports=i(16).EventEmitter},function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(t){return"function"==typeof t}function n(t){return"object"==typeof t&&null!==t}function r(t){return void 0===t}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!function(t){return"number"==typeof t}(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,s,a,h,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(r(i=this._events[t]))return!1;if(o(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(n(i))for(a=Array.prototype.slice.call(arguments,1),s=(l=i.slice()).length,h=0;h<s;h++)l[h].apply(this,a);return!0},i.prototype.addListener=function(t,e){var s;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?n(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,n(this._events[t])&&!this._events[t].warned&&(s=r(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){if(!o(e))throw TypeError("listener must be a function");var i=!1;function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}return n.listener=e,this.on(t,n),this},i.prototype.removeListener=function(t,e){var i,r,s,a;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=(i=this._events[t]).length,r=-1,i===e||o(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(n(i)){for(a=s;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){r=a;break}if(r<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(o(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,i){"use strict";(function(e,o){var n=i(8);t.exports=y;var r,s=i(22);y.ReadableState=m;i(16).EventEmitter;var a=function(t,e){return t.listeners(e).length},h=i(15),l=i(7).Buffer,c=e.Uint8Array||function(){};var u=i(6);u.inherits=i(2);var p=i(35),d=void 0;d=p&&p.debuglog?p.debuglog("stream"):function(){};var f,g=i(34),v=i(14);u.inherits(y,h);var b=["error","close","destroy","pause","resume"];function m(t,e){r=r||i(4),t=t||{};var o=e instanceof r;this.objectMode=!!t.objectMode,o&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,s=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:o&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(f||(f=i(12).StringDecoder),this.decoder=new f(t.encoding),this.encoding=t.encoding)}function y(t){if(r=r||i(4),!(this instanceof y))return new y(t);this._readableState=new m(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),h.call(this)}function _(t,e,i,o,n){var r,s=t._readableState;null===e?(s.reading=!1,function(t,e){if(e.ended)return;if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,S(t)}(t,s)):(n||(r=function(t,e){var i;(function(t){return l.isBuffer(t)||t instanceof c})(e)||"string"==typeof e||void 0===e||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk"));return i}(s,e)),r?t.emit("error",r):s.objectMode||e&&e.length>0?("string"==typeof e||s.objectMode||Object.getPrototypeOf(e)===l.prototype||(e=function(t){return l.from(t)}(e)),o?s.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):w(t,s,e,!0):s.ended?t.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!i?(e=s.decoder.write(e),s.objectMode||0!==e.length?w(t,s,e,!1):E(t,s)):w(t,s,e,!1))):o||(s.reading=!1));return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(s)}function w(t,e,i,o){e.flowing&&0===e.length&&!e.sync?(t.emit("data",i),t.read(0)):(e.length+=e.objectMode?1:i.length,o?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&S(t)),E(t,e)}Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),y.prototype.destroy=v.destroy,y.prototype._undestroy=v.undestroy,y.prototype._destroy=function(t,e){this.push(null),e(t)},y.prototype.push=function(t,e){var i,o=this._readableState;return o.objectMode?i=!0:"string"==typeof t&&((e=e||o.defaultEncoding)!==o.encoding&&(t=l.from(t,e),e=""),i=!0),_(this,t,e,!1,i)},y.prototype.unshift=function(t){return _(this,t,null,!0,!1)},y.prototype.isPaused=function(){return!1===this._readableState.flowing},y.prototype.setEncoding=function(t){return f||(f=i(12).StringDecoder),this._readableState.decoder=new f(t),this._readableState.encoding=t,this};var C=8388608;function T(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=C?t=C:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function S(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(d("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?n.nextTick(O,t):O(t))}function O(t){d("emit readable"),t.emit("readable"),D(t)}function E(t,e){e.readingMore||(e.readingMore=!0,n.nextTick(x,t,e))}function x(t,e){for(var i=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(d("maybeReadMore read 0"),t.read(0),i!==e.length);)i=e.length;e.readingMore=!1}function I(t){d("readable nexttick read 0"),t.read(0)}function A(t,e){e.reading||(d("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),D(t),e.flowing&&!e.reading&&t.read(0)}function D(t){var e=t._readableState;for(d("flow",e.flowing);e.flowing&&null!==t.read(););}function k(t,e){return 0===e.length?null:(e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):i=function(t,e,i){var o;t<e.head.data.length?(o=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):o=t===e.head.data.length?e.shift():i?function(t,e){var i=e.head,o=1,n=i.data;t-=n.length;for(;i=i.next;){var r=i.data,s=t>r.length?r.length:t;if(s===r.length?n+=r:n+=r.slice(0,t),0===(t-=s)){s===r.length?(++o,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=r.slice(s));break}++o}return e.length-=o,n}(t,e):function(t,e){var i=l.allocUnsafe(t),o=e.head,n=1;o.data.copy(i),t-=o.data.length;for(;o=o.next;){var r=o.data,s=t>r.length?r.length:t;if(r.copy(i,i.length-t,0,s),0===(t-=s)){s===r.length?(++n,o.next?e.head=o.next:e.head=e.tail=null):(e.head=o,o.data=r.slice(s));break}++n}return e.length-=n,i}(t,e);return o}(t,e.buffer,e.decoder),i);var i}function P(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,n.nextTick(M,e,t))}function M(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function B(t,e){for(var i=0,o=t.length;i<o;i++)if(t[i]===e)return i;return-1}y.prototype.read=function(t){d("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return d("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?P(this):S(this),null;if(0===(t=T(t,e))&&e.ended)return 0===e.length&&P(this),null;var o,n=e.needReadable;return d("need readable",n),(0===e.length||e.length-t<e.highWaterMark)&&d("length less than watermark",n=!0),e.ended||e.reading?d("reading or ended",n=!1):n&&(d("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=T(i,e))),null===(o=t>0?k(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&P(this)),null!==o&&this.emit("data",o),o},y.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},y.prototype.pipe=function(t,e){var i=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t)}r.pipesCount+=1,d("pipe count=%d opts=%j",r.pipesCount,e);var h=(!e||!1!==e.end)&&t!==o.stdout&&t!==o.stderr?c:y;function l(e,o){d("onunpipe"),e===i&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,d("cleanup"),t.removeListener("close",b),t.removeListener("finish",m),t.removeListener("drain",u),t.removeListener("error",v),t.removeListener("unpipe",l),i.removeListener("end",c),i.removeListener("end",y),i.removeListener("data",g),p=!0,!r.awaitDrain||t._writableState&&!t._writableState.needDrain||u())}function c(){d("onend"),t.end()}r.endEmitted?n.nextTick(h):i.once("end",h),t.on("unpipe",l);var u=function(t){return function(){var e=t._readableState;d("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,"data")&&(e.flowing=!0,D(t))}}(i);t.on("drain",u);var p=!1;var f=!1;function g(e){d("ondata"),f=!1,!1!==t.write(e)||f||((1===r.pipesCount&&r.pipes===t||r.pipesCount>1&&-1!==B(r.pipes,t))&&!p&&(d("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,f=!0),i.pause())}function v(e){d("onerror",e),y(),t.removeListener("error",v),0===a(t,"error")&&t.emit("error",e)}function b(){t.removeListener("finish",m),y()}function m(){d("onfinish"),t.removeListener("close",b),y()}function y(){d("unpipe"),i.unpipe(t)}return i.on("data",g),function(t,e,i){if("function"==typeof t.prependListener)return t.prependListener(e,i);t._events&&t._events[e]?s(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i)}(t,"error",v),t.once("close",b),t.once("finish",m),t.emit("pipe",i),r.flowing||(d("pipe resume"),i.resume()),t},y.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i),this);if(!t){var o=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var r=0;r<n;r++)o[r].emit("unpipe",this,i);return this}var s=B(e.pipes,t);return-1===s?this:(e.pipes.splice(s,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i),this)},y.prototype.on=function(t,e){var i=h.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var o=this._readableState;o.endEmitted||o.readableListening||(o.readableListening=o.needReadable=!0,o.emittedReadable=!1,o.reading?o.length&&S(this):n.nextTick(I,this))}return i},y.prototype.addListener=y.prototype.on,y.prototype.resume=function(){var t=this._readableState;return t.flowing||(d("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,n.nextTick(A,t,e))}(this,t)),this},y.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},y.prototype.wrap=function(t){var e=this,i=this._readableState,o=!1;for(var n in t.on("end",function(){if(d("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on("data",function(n){(d("wrapped data"),i.decoder&&(n=i.decoder.write(n)),!i.objectMode||null!==n&&void 0!==n)&&((i.objectMode||n&&n.length)&&(e.push(n)||(o=!0,t.pause())))}),t)void 0===this[n]&&"function"==typeof t[n]&&(this[n]=function(e){return function(){return t[e].apply(t,arguments)}}(n));for(var r=0;r<b.length;r++)t.on(b[r],this.emit.bind(this,b[r]));return this._read=function(e){d("wrapped _read",e),o&&(o=!1,t.resume())},this},Object.defineProperty(y.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),y._fromList=k}).call(this,i(0),i(3))},function(t,e,i){(e=t.exports=i(17)).Stream=e,e.Readable=e,e.Writable=i(13),e.Duplex=i(4),e.Transform=i(11),e.PassThrough=i(29)},function(t,e,i){(function(t,o,n){var r=i(20),s=i(2),a=i(18),h=e.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},l=e.IncomingMessage=function(e,i,s,h){var l=this;if(a.Readable.call(l),l._mode=s,l.headers={},l.rawHeaders=[],l.trailers={},l.rawTrailers=[],l.on("end",function(){t.nextTick(function(){l.emit("close")})}),"fetch"===s){if(l._fetchResponse=i,l.url=i.url,l.statusCode=i.status,l.statusMessage=i.statusText,i.headers.forEach(function(t,e){l.headers[e.toLowerCase()]=t,l.rawHeaders.push(e,t)}),r.writableStream){var c=new WritableStream({write:function(t){return new Promise(function(e,i){l._destroyed?i():l.push(new o(t))?e():l._resumeFetch=e})},close:function(){n.clearTimeout(h),l._destroyed||l.push(null)},abort:function(t){l._destroyed||l.emit("error",t)}});try{return void i.body.pipeTo(c).catch(function(t){n.clearTimeout(h),l._destroyed||l.emit("error",t)})}catch(t){}}var u=i.body.getReader();!function t(){u.read().then(function(e){if(!l._destroyed){if(e.done)return n.clearTimeout(h),void l.push(null);l.push(new o(e.value)),t()}}).catch(function(t){n.clearTimeout(h),l._destroyed||l.emit("error",t)})}()}else{if(l._xhr=e,l._pos=0,l.url=e.responseURL,l.statusCode=e.status,l.statusMessage=e.statusText,e.getAllResponseHeaders().split(/\r?\n/).forEach(function(t){var e=t.match(/^([^:]+):\s*(.*)/);if(e){var i=e[1].toLowerCase();"set-cookie"===i?(void 0===l.headers[i]&&(l.headers[i]=[]),l.headers[i].push(e[2])):void 0!==l.headers[i]?l.headers[i]+=", "+e[2]:l.headers[i]=e[2],l.rawHeaders.push(e[1],e[2])}}),l._charset="x-user-defined",!r.overrideMimeType){var p=l.rawHeaders["mime-type"];if(p){var d=p.match(/;\s*charset=([^;])(;|$)/);d&&(l._charset=d[1].toLowerCase())}l._charset||(l._charset="utf-8")}}};s(l,a.Readable),l.prototype._read=function(){var t=this._resumeFetch;t&&(this._resumeFetch=null,t())},l.prototype._onXHRProgress=function(){var t=this,e=t._xhr,i=null;switch(t._mode){case"text:vbarray":if(e.readyState!==h.DONE)break;try{i=new n.VBArray(e.responseBody).toArray()}catch(t){}if(null!==i){t.push(new o(i));break}case"text":try{i=e.responseText}catch(e){t._mode="text:vbarray";break}if(i.length>t._pos){var r=i.substr(t._pos);if("x-user-defined"===t._charset){for(var s=new o(r.length),a=0;a<r.length;a++)s[a]=255&r.charCodeAt(a);t.push(s)}else t.push(r,t._charset);t._pos=i.length}break;case"arraybuffer":if(e.readyState!==h.DONE||!e.response)break;i=e.response,t.push(new o(new Uint8Array(i)));break;case"moz-chunked-arraybuffer":if(i=e.response,e.readyState!==h.LOADING||!i)break;t.push(new o(new Uint8Array(i)));break;case"ms-stream":if(i=e.response,e.readyState!==h.LOADING)break;var l=new n.MSStreamReader;l.onprogress=function(){l.result.byteLength>t._pos&&(t.push(new o(new Uint8Array(l.result.slice(t._pos)))),t._pos=l.result.byteLength)},l.onload=function(){t.push(null)},l.readAsArrayBuffer(i)}t._xhr.readyState===h.DONE&&"ms-stream"!==t._mode&&t.push(null)}}).call(this,i(3),i(5).Buffer,i(0))},function(t,e,i){(function(t){e.fetch=a(t.fetch)&&a(t.ReadableStream),e.writableStream=a(t.WritableStream),e.abortController=a(t.AbortController),e.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),e.blobConstructor=!0}catch(t){}var i;function o(){if(void 0!==i)return i;if(t.XMLHttpRequest){i=new t.XMLHttpRequest;try{i.open("GET",t.XDomainRequest?"/":"https://example.com")}catch(t){i=null}}else i=null;return i}function n(t){var e=o();if(!e)return!1;try{return e.responseType=t,e.responseType===t}catch(t){}return!1}var r=void 0!==t.ArrayBuffer,s=r&&a(t.ArrayBuffer.prototype.slice);function a(t){return"function"==typeof t}e.arraybuffer=e.fetch||r&&n("arraybuffer"),e.msstream=!e.fetch&&s&&n("ms-stream"),e.mozchunkedarraybuffer=!e.fetch&&r&&n("moz-chunked-arraybuffer"),e.overrideMimeType=e.fetch||!!o()&&a(o().overrideMimeType),e.vbArray=a(t.VBArray),i=null}).call(this,i(0))},function(t,e,i){(function(t){var o=i(36),n=i(19),r=i(27),s=i(26),a=i(9),h=e;h.request=function(e,i){e="string"==typeof e?a.parse(e):r(e);var n=-1===t.location.protocol.search(/^https?:$/)?"http:":"",s=e.protocol||n,h=e.hostname||e.host,l=e.port,c=e.path||"/";h&&-1!==h.indexOf(":")&&(h="["+h+"]"),e.url=(h?s+"//"+h:"")+(l?":"+l:"")+c,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{};var u=new o(e);return i&&u.on("response",i),u},h.get=function(t,e){var i=h.request(t,e);return i.end(),i},h.ClientRequest=o,h.IncomingMessage=n.IncomingMessage,h.Agent=function(){},h.Agent.defaultMaxSockets=4,h.globalAgent=new h.Agent,h.STATUS_CODES=s,h.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,i(0))},function(t,e){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},function(t,e,i){"use strict";i.r(e);var o=i(1);window.DrawerJs={plugins:{},util:{},utilPlugins:{},brushes:{}};var n=DrawerJs,r={"Add Drawer":"Add Drawer","Insert Drawer":"Insert Drawer",Insert:"Insert","Free drawing mode":"Free drawing mode",SimpleWhiteEraser:"SimpleWhiteEraser",Eraser:"Eraser","Delete this canvas":"Delete this canvas","Are you sure want to delete this canvas?":"Are you sure want to delete this canvas?","Size (px)":"Size (px)",Position:"Position",Inline:"Inline",Left:"Left",Center:"Center",Right:"Right",Floating:"Floating","Canvas properties":"Canvas properties",Background:"Background",transparent:"transparent",Cancel:"Cancel",Save:"Save","Enter fullscreen mode":"Enter fullscreen mode","Exit fullscreen mode":"Exit fullscreen mode","Bring forward":"Bring forward","Send backwards":"Send backwards","Bring to front":"Bring to front","Send to back":"Send to back",Duplicate:"Duplicate",Remove:"Remove","Size:":"Size:","Fill:":"Fill:",Transparent:"Transparent","Border:":"Border:",None:"None","Draw an arrow":"Draw an arrow","Draw a two-sided arrow":"Draw a two-sided arrow","Lines and arrows":"Lines and arrows","Draw a circle":"Draw a circle","Draw a line":"Draw a line","Draw a rectangle":"Draw a rectangle","Draw a triangle":"Draw a triangle","Draw a Polygon":"Draw a Polygon","Stop drawing a polygon":"Stop drawing a polygon (esc)","Click to start a new line":"Click to start a new line","Draw a text":"Draw a text","Click to place a text":"Click to place a text","Font:":"Font:","Move canvas":"Move canvas","Click to start drawing a ":"Click to start drawing a "};var s=new class{init(t){return this._map=t,this}urlFor(t){return this._map[t]||t}},a=function(t,e,i,o){if(this.drawerInstance=t,!t)throw new Error("ToolbarPlaceholder: drawerInstance is not provided!");this._setupOptions(e,i,o),this._setupElement(),this._attachEventHandlers(),this._attachDrawerEventHandlers()};a.prototype.TOP_POSITION="top",a.prototype.BOTTOM_POSITION="bottom",a.prototype.LEFT_POSITION="left",a.prototype.RIGHT_POSITION="right",a.prototype.OVER_CANVAS_POSITION="canvas",a.prototype.POPUP_POSITION="popup",a.prototype.POSITION_TYPE_OUTSIDE="outside",a.prototype.POSITION_TYPE_INSIDE="inside",a.prototype.POSITION_TYPE_CUSTOM="custom",a.prototype.CUSTOM_POSITION="custom",a.prototype.HORIZONTAL_ORIENTATION="horizontal",a.prototype.VERTICAL_ORIENTATION="vertical",a.prototype.STATE_HIDDEN="hidden",a.prototype.STATE_OVERLAY="overlay",a.prototype.STATE_DISABLED="disabled",a.prototype._html_default='<ul class="noselect toolbar-placeholder" contenteditable=false><li class="toolbar-placeholder-overlay"></li></ul>',a.prototype._html_popup='<div class="noselect toolbar-placeholder hidden" contenteditable=false><div class="close-btn"><span class="fa fa-close"></span></div><div class="overlay"></div></div>',a.prototype._setupOptions=function(t,e,i){if(t===this.POPUP_POSITION){var o=this.drawerInstance.$popupWrapper,n=o&&o.find(".popup-content");n&&n.length&&(t=this.CUSTOM_POSITION,this.$customAnchor=n)}this.position=t,this.positionType=e,this.customAnchorSelector=i},a.prototype._attachEventHandlers=function(){},a.prototype._attachDrawerEventHandlers=function(){var t=this;this.drawerInstance.on(this.drawerInstance.EVENT_EDIT_STOP,function(){t.$element.remove()});this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_CHANGE_STATE,function(e,i){var o=$.extend(!0,{},i||{});t.changeState(o)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_CLEAR_STATE,function(e,i){var o=i&&i.excludeElements,n=t.$element.find(o).length,r=t.$element.closest(o).length,s=t.position===t.POSITION_TYPE_CUSTOM;n||r||s||(t.turnOffOverlay(),t.turnOffDisabled(),t._showPlaceholder())}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_HIDDEN_OFF,function(e,i){var o=$.extend(!0,{},i||{});o.state="hidden",o.turnOn=!1,t.changeState(o)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_HIDDEN_ON,function(e,i){var o=$.extend(!0,{},i||{});o.state="hidden",o.turnOn=!0,t.changeState(o)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_OVERLAY_ON,function(e,i){var o=$.extend(!0,{},i||{});o.state="overlay",o.turnOn=!0,t.changeState(o)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_OVERLAY_OFF,function(e,i){var o=$.extend(!0,{},i||{});o.state="overlay",o.turnOn=!1,t.changeState(o)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_DISABLED_ON,function(e,i){var o=$.extend(!0,{},i||{});o.state="disabled",o.turnOn=!0,t.changeState(o)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_DISABLED_OFF,function(e,i){var o=$.extend(!0,{},i||{});o.state="disabled",o.turnOn=!1,t.changeState(o)})},a.prototype._setPosition=function(t,e,i){if(t=t||this.position,e=e||this.positionType,i=i||this.customAnchorSelector,this.position=t,t==this.CUSTOM_POSITION){this.customAnchorSelector=i;var o=$(window.document).find(this.$customAnchor),n=$(window.document).find(i),r=o.length?o:!!n.length&&n;r?(this.orientation=this.HORIZONTAL_ORIENTATION,this.$customAnchor=r,this.$customAnchor.append(this.$element)):(this.drawerInstance.error("ToolbarPlaceholder : no anchor element found for custom toolbar by selector '"+i+"'"),this.position=this.TOP_POSITION)}else{switch(t){case this.TOP_POSITION:this.$element.addClass("toolbar-placeholder-top"),this.orientation=this.HORIZONTAL_ORIENTATION;break;case this.BOTTOM_POSITION:this.$element.addClass("toolbar-placeholder-bottom"),this.orientation=this.HORIZONTAL_ORIENTATION;break;case this.LEFT_POSITION:this.$element.addClass("toolbar-placeholder-left"),this.orientation=this.VERTICAL_ORIENTATION;break;case this.RIGHT_POSITION:this.$element.addClass("toolbar-placeholder-right"),this.orientation=this.VERTICAL_ORIENTATION;break;case this.OVER_CANVAS_POSITION:this.$element.addClass("toolbar-placeholder-overcanvas"),this.orientation=this.HORIZONTAL_ORIENTATION;break;default:this.position=this.TOP_POSITION,this.$element.addClass("toolbar-placeholder-top"),this.orientation=this.HORIZONTAL_ORIENTATION}e&&e===this.POSITION_TYPE_INSIDE&&this.$element.addClass("toolbar-placeholder-inside"),this.$element.attr("data-position",t),this.drawerInstance.$toolbarsWrapper.append(this.$element)}},a.prototype._setupElement=function(){var t=this._getHtmlOfElement();this.$element=$(t),this.$overlay=this.$element.find(".toolbar-placeholder-overlay"),this._setPosition()},a.prototype._getHtmlOfElement=function(){var t;return t=this._html_default,this.position===this.POPUP_POSITION&&(t=this._html_popup),t},a.prototype.changeState=function(t){var e=this,i=function(t){var i,o,n;return(t&&t.length?t:$()).each(function(t,r){var s=$(r);n||(i=e.$element.find(s).length,o=e.$element.closest(s).length,n=i||o)}),n}(t&&t.excludeElements.length?t.excludeElements:$()),o=e.position===e.POSITION_TYPE_CUSTOM;if(!(i||o))switch(t.state){case this.STATE_OVERLAY:this.toggleOverlay(t.turnOn);break;case this.STATE_HIDDEN:t.turnOn?this._hidePlaceholder():this._showPlaceholder();break;case this.STATE_DISABLED:t.turnOn?this.turnOnDisabled():this.turnOffDisabled()}},a.prototype._hidePlaceholder=function(){this.$element.addClass("hidden")},a.prototype._showPlaceholder=function(){this.$element.removeClass("hidden")},a.prototype.toggleOverlay=function(t){t?this.turnOnOverlay():this.turnOffOverlay()},a.prototype.turnOnDisabled=function(){this.$element.addClass("placeholder-disabled")},a.prototype.turnOffDisabled=function(){this.$element.removeClass("placeholder-disabled")},a.prototype.turnOnOverlay=function(){this.$element.addClass("placeholder-overlayed")},a.prototype.turnOffOverlay=function(){this.$element.removeClass("placeholder-overlayed")},a.prototype.addToolbar=function(t){var e=t.$toolbar;this.$element.append(e),t.position=this.position,e.removeClass("toolbar-horizontal").removeClass("toolbar-vertical"),this.orientation==this.HORIZONTAL_ORIENTATION?e.addClass("toolbar-horizontal"):e.addClass("toolbar-vertical")};var h=a,l=function(t,e,i){!function(t,e,i,o){var n=function(t,i){return this.$element=e(t),this._setupOptions(i),this._processOptions(),this._setupTooltip(),this._attachEventHandlers(),{instance:this,$trigger:this.$element,adjustPosition:this.adjustPosition.bind(this),destroy:this.destroy.bind(this),hideTooltip:this.hideTooltip.bind(this),showTooltip:this.showTooltip.bind(this)}};n.prototype._defaultOptions={defaultClass:"editable-canvas-tooltip",defaultPositionX:"center",defaultPositionY:"bottom",additionalClass:"",text:"",position:"",style:"",styleObj:{},$tooltipWrapper:"",tooltipWrapperSelector:void 0},n.prototype.enabled=!0,n.prototype._defaultWrapper="body",n.prototype._eventsNamespace=".drawerTooltip",n.prototype._firstShow=!0,n.prototype._setupOptions=function(t){var i=this._collectOptionsFromElement();return this.options=e.extend(!0,{},this._defaultOptions||{},i||{},t||{}),this._initialOptions=e.extend(!0,{},t),this._initialOptionsFromElement=e.extend(!0,{},i),this.options},n.prototype._checkElement=function(t){var i,o;return"string"==typeof t&&(o=e(t)),t instanceof e&&(o=t),o&&o.length&&(i=o.eq(0)),i},n.prototype._processOptions=function(){var t=this._checkElement(this.options.$tooltipWrapper),e=this._checkElement(this.options.tooltipWrapperSelector),i=this._checkElement(this._defaultWrapper);this.$tooltipWrapper=t||e||i},n.prototype._setupTooltip=function(){var t=this._generateTemplate(),i=e(t);this.options.styleObj&&i.css(this.options.styleObj),this.$element.addClass("tooltip-trigger"),this.$element.data("DrawerTooltip",this),this.$tooltipWrapper.append(i),this.$tooltip=i},n.prototype._generateTemplate=function(){var t=this.options.text||"";return'<span class="'+this.options.defaultClass+" "+this.options.additionalClass+'"style="'+(this.options.style||"")+'">'+t+"</span>"},n.prototype._attachEventHandlers=function(){var t=this,i=this.$element;this._detachEventHandlers(),i.on("mouseenter"+this._eventsNamespace,function(o){var n=e(o.currentTarget),r=e("body"),s=r.hasClass("drawer-moving"),a=r.hasClass("drawer-resizing"),h=i.hasClass("disabled");s||a||h||t.showTooltip(n)}),i.on("mouseout"+this._eventsNamespace,function(){t.hideTooltip()})},n.prototype._detachEventHandlers=function(){this.$element.off("mouseenter"+this._eventsNamespace),this.$element.off("mouseout"+this._eventsNamespace)},n.prototype._parsePositionString=function(t){var e={},i=-1!==(t=t||this.options.position||"").indexOf("right")||-1!==t.indexOf("left"),o=i&&(-1!==t.indexOf("right")?"right":"left"),n=-1!==t.indexOf("top")||-1!==t.indexOf("bottom"),r=n&&(-1!==t.indexOf("top")?"top":"bottom");return o=o||(n?"center":this.options.defaultPositionX),r=r||(i?"center":this.options.defaultPositionY),e.positionX=o,e.positionY=r,e},n.prototype._resetTooltip=function(t){},n.prototype.adjustPosition=function(t,e){if(this.enabled){e=e||this.$element;var o=this._parsePositionString(t),n=this.$tooltip,r=0,s=0,a=i.getScrollTopFromElement(e),h=e.get(0).getBoundingClientRect(),l=n.get(0).getBoundingClientRect();switch(o.positionX){case"right":s=a.left+h.left+h.width+8;break;case"left":s=a.left+h.left-l.width-8;break;default:s=a.left+h.left+(h.width-l.width)/2}switch(o.positionY){case"top":r=a.top+h.top-l.height-8;break;case"bottom":r=a.top+h.top+h.height+8;break;default:r=a.top+h.top+(h.height-l.height)/2}n.attr("positionX",o.positionX),n.attr("positionY",o.positionY),n.css({top:r+"px",left:s+"px"})}},n.prototype._collectOptionsFromElement=function(t){var e={items:[]},i=(t=t||this.$element).text(),o=t.attr("tooltip-text"),n=t.attr("tooltip-style")||"",r=t.attr("tooltip-position")||"";return e.text=o||i,e.style=n,e.position=r,e},n.prototype.destroy=function(){this._detachEventHandlers(),this.$tooltip.remove(),this.$element.data("DrawerTooltip",void 0),this.$element.removeClass("tooltip-trigger"),this.enabled=!1},n.prototype.showTooltip=function(t){this.enabled&&(this.$element.trigger("showTooltip"),this._firstShow=!1,this.$tooltip.is(":visible")||this.$tooltip.addClass("tooltip-transparent"),this.adjustPosition(void 0,t),this.$tooltip.removeClass("tooltip-transparent"),this.$tooltip.addClass("active"),this.isVisible=!0)},n.prototype.hideTooltip=function(){this.enabled&&this.isVisible&&(this.$tooltip.removeClass("active"),this.isVisible=!1)},e.fn.DrawerTooltip=function(t){var i=[];return e(this).each(function(o,r){var s=new n(r,t);e(r).data("DrawerTooltip",s),i.push(s)}),i},e.fn.getDrawerTooltip=function(){var t=[];return e(this).each(function(i,o){var n=e(o).data("DrawerTooltip");n&&t.push(n)}),t.length>1?t:t[0]},o.Tooltip=n}(0,e,i.util,i.utilPlugins),function(t,e,i,o){var n=function(t,e){return this.drawerInstance=t,this._setupOptions(e),this._processOptions(),this._createHelperElements(),this._attachDrawerEventHandlers(),this._attachEventHandlers(),{instance:this,createTooltip:this.createTooltip.bind(this)}};n.prototype._defaultOptions={tooltipCss:{}},n.prototype._tooltipInstances=[],n.prototype._setupOptions=function(t){var i={styleObj:this.drawerInstance.options.tooltipCss};return this.options=e.extend(!0,{},this._defaultOptions||{},i,t||{}),this._initialOptions=e.extend(!0,{},t),this.options},n.prototype._processOptions=function(){},n.prototype.createTooltip=function(t,i){t=t||[];var n,r=this,s=[],a=e.extend(!0,{},this.options,i||{});return t.each(function(t,e){n=new o.Tooltip(e,a),r._tooltipInstances.push(n),s.push(n)}),s},n.prototype.removeAllTooltips=function(){this._tooltipInstances.forEach(function(t){t.destroy()}),this._tooltipInstances=[]},n.prototype.hideAllTooltips=function(){this._tooltipInstances.forEach(function(t){t.hideTooltip()})},n.prototype._removeHelperElements=function(){this.drawerInstance.$tooltipContainer&&this.drawerInstance.$tooltipContainer.length&&this.drawerInstance.$tooltipContainer.remove()},n.prototype._createHelperElements=function(){this._removeHelperElements();var t=this.drawerInstance.id,i=e('<div class="tooltip-container" data-drawer-instance="'+t+'"></div>');e("body").append(i),this.options.$tooltipWrapper=i,this.drawerInstance.$tooltipContainer=i},n.prototype._attachDrawerEventHandlers=function(){var t=this;this.drawerInstance.on(this.drawerInstance.EVENT_CREATE_TOOLTIP,function(e,i,o){return t.createTooltip(i,o)}),this.drawerInstance.on(this.drawerInstance.EVENT_HIDE_TOOLTIPS,function(){t.hideAllTooltips()}),this.drawerInstance.on(this.drawerInstance.EVENT_DESTROY_TOOLTIPS,function(){t.removeAllTooltips()}),this.drawerInstance.on("destroy",function(){t.removeAllTooltips()})},n.prototype._attachEventHandlers=function(){e("body").off("showTooltip").on("showTooltip",".tooltip-trigger",function(t){var i=e(t.currentTarget),o=i.data("DrawerTooltip");if(o._firstShow){var n;switch(i.closest(".toolbar-placeholder").attr("data-position")){case h.prototype.TOP_POSITION:n=h.prototype.BOTTOM_POSITION;break;case h.prototype.BOTTOM_POSITION:n=h.prototype.TOP_POSITION;break;case h.prototype.LEFT_POSITION:n=h.prototype.RIGHT_POSITION;break;case h.prototype.RIGHT_POSITION:n=h.prototype.LEFT_POSITION}n&&(o.options.position=n)}})},o.TooltipManager=n}(0,e,i.util,i.utilPlugins),function(t,e,i,o){var n=".ToolbarComboBox",r=function(t,i){return this.$element=e(t),this._setupOptions(i),this._setupCombobox(),this._attachEventHandlers(),this._attachDrawerEventHandlers(),{instance:this,updateSelectedValues:this.updateSelectedValues.bind(this),hideDropdown:this.hideDropdown.bind(this),showDropdown:this.hideDropdown.bind(this)}};r.prototype._defaultOptions={wrapper:"toolbar-combobox-wrapper",editable:!1,addNewOptions:!1,buttonMode:!1,items:[]},r.prototype._setupOptions=function(t){var i=this._collectOptionsFromElement();return this.options=e.extend(!0,{},this._defaultOptions||{},i||{},t||{}),this._initialOptions=e.extend(!0,{},t),this._initialOptionsFromElement=e.extend(!0,{},i),this.options},r.prototype._setupCombobox=function(){var t=this._generateTemplate(),i=e(t);i.insertAfter(this.$element),this.$element.addClass("hidden"),this.$combobox=i,this.$options=this.$combobox.find("ul"),this.$dropdown=this.$combobox.find(".dropdown-box"),this.$input=this.$combobox.find("input"),this.$closestToolbarItem=this.$element.closest(".toolbar-item-wrapper")},r.prototype._generateTemplate=function(){var t=this,e="";return this.options.items.forEach(function(i){var o,n="object"==typeof i,r=n?i.value:i,s=n&&i.text||r,a=n&&i.style||"";o=t._generateNewOptionItem(s,r,!1,!0,a),e+=o}),this.wrapperClasses=this.options.wrapper+(this.options.buttonMode?" button-mode ":"")+(this.options.editable?" edit-mode ":""),'<div class="'+this.wrapperClasses+' collapsed" tabindex="-1"><div class="selected"><span></span><a class="ui-button"><i class="fa fa-angle-down"></i></a></div><div class="dropdown-box">'+(this.options.editable?'<div class="inputbox"><input type="text"/></div>':"")+'<ul class="option-list">'+e+"</ul></div></div>"},r.prototype._generateNewOptionItem=function(t,i,o,n,r){t=t||"";var s=e('<li style="'+(r=r||"")+'"data-val="'+i+'"class="option-item"><div class="option-item-text">'+t+"</div></li>");return o&&(this.$combobox.find(".selected").attr("data-val",i).find("span").text(t),s.addClass("selected")),n?s.get(0).outerHTML:s},r.prototype._setupDropDownSize=function(){this.$combobox.width()&&(this.sizesUpdated=!0)},r.prototype._attachDrawerEventHandlers=function(){var t=this,o=this.$element.closest(".toolbar-item-wrapper");o&&o.length&&(i.bindClick(e("body"),"_optionTool_toggleDropdown",function(i){var n=e(i.target),r=n.closest(".toolbar-item-wrapper"),s=n.is("canvas");o.get(0)!==r.get(0)&&!s&&(o.find(".toolbar-dropdown-block").addClass("collapsed"),t.hideDropdown())}),i.bindClick(o.find(".toolbar-item-icon"),"_optionTool_toggleDDropdown",function(e){var n,r=o.find(".toolbar-dropdown-block").hasClass("collapsed");if(r){var s=t.options&&t.options.drawer&&t.options.drawer.toolbars&&t.options.drawer.toolbars.toolOptionsToolbar,a=s&&s.options,h=a&&"popup"!==a.position,l=a&&"outside"===a.positionType,c=a&&"scrollable"===a.compactType;if(n=h&&l&&c){var u=t.$combobox.clone(!0);o.closest(".toolbar-placeholder").append(u),u.addClass("combobox-cloned"),t.$clonedCombobox=u;var p=i.getScrollOffset(t.options.drawer.$canvasEditContainer),d=i.getScrollOffset(t.$element.parent()),f=t.options.drawer.$canvasEditContainer.get(0).getBoundingClientRect(),g=t.$element.parent().get(0).getBoundingClientRect().left-f.left-(d.left-p.left)-t.$clonedCombobox.width()/2;t.$clonedCombobox.css({left:g})}}n||o.find(".toolbar-dropdown-block").toggleClass("collapsed",!r)}))},r.prototype._attachEventHandlers=function(){var t=this;if(this.options.editable){var i,o=this.$input;o.off("focus"+n).on("focus"+n,function(e){t.$combobox.addClass("focus"),i=!0}),o.off("blur"+n).on("blur"+n,function(e){i=!1,t.$combobox.trigger("blur")}),o.off("keypress"+n).on("keypress"+n,function(i){if("13"==i.keyCode){var n=o.val();o.val("");var r=e("<option>").val(n).text(n).attr("data-is-input",1);if(t.$element.append(r),t.options.addNewOptions){var s=t._generateNewOptionItem(n,n,!0);t.$options.append(s)}t.changeActiveOption(n)}})}this.$element.off("valueChanged"+n).on("valueChanged"+n,function(e,i){var o,n=t.$element.val(),r=i?i.value:void 0,s=i?r:n;i&&(o=i.classString),t.updateSelectedValues(s,o)}),this.$element.off("change"+n).on("change"+n,function(e){if(!t.addNewOptions){var i=t.$element,o=i.attr("prev-value");-1===t.options.valuesArr.indexOf(o)&&i.find('option[data-val="'+o+'"]').remove()}}),this.$combobox.off("mouseleave"+n).on("mouseleave"+n,function(e){t.$element.closest(".toolbar-item-wrapper").find(".toolbar-dropdown-block").addClass("collapsed"),t.hideDropdown()}),this.$combobox.off("click.ToolbarComboBox_optionSelect").on("click.ToolbarComboBox_optionSelect",".option-item",this._onOptionSelect.bind(this)),this.$combobox.off("click.ToolbarComboBox_toggleDropdown").on("click.ToolbarComboBox_toggleDropdown",".selected",function(){t.toggleDropdown()}),this.$combobox.off("blur"+n).on("blur"+n,function(e){e.preventDefault(),setTimeout(function(){i||t.hideDropdown()},100),t.$combobox.removeClass("focus")})},r.prototype._collectOptionsFromElement=function(){var t={},i=this.$element.attr("data-editable")&&"true"===this.$element.attr("data-editable");return t.items=[],t.valuesArr=[],this.$element.find("option").each(function(i,o){var n=e(o),r=n.val(),s={value:r,text:n.text(),style:n.attr("style")||""};t.valuesArr.push(r),t.items.push(s)}),t.editable=i,t},r.prototype._onOptionSelect=function(t){var i=e(t.currentTarget),o=i.hasClass("selected")?"":i.attr("data-val"),n=i.text();this.hideDropdown(),this.changeActiveOption(o,n),t.stopPropagation(),t.preventDefault()},r.prototype.changeActiveOption=function(t,e){var i=this.$element.val();this.$element.attr("prev-value",i),this.$element.val(t),this.updateSelectedValues(t),this.$element.trigger("toolbarOptionChange")},r.prototype.updateSelectedValues=function(t,e,i){t=t||"";var o=this.$combobox.find(".option-item"),n=o.filter('[data-val="'+t+'"]'),r=n&&n.length?n.text():t,s=this.$combobox.hasClass("collapsed")?" collapsed":"",a=this.wrapperClasses+" "+(e||"")+s;this.$combobox.attr("class",a),this.$combobox.find(".selected span").text(r),o.removeClass("selected"),n?(n.addClass("selected"),this.$input.val("")):this.$input.val(t)},r.prototype.showDropdown=function(){this.dropdownIsVisible=!0,this.sizesUpdated||this._setupDropDownSize(),this.$combobox.find(".ui-button .fa").addClass("fa-angle-down").removeClass("fa-angle-up"),this.$combobox.removeClass("collapsed")},r.prototype.hideDropdown=function(){this.dropdownIsVisible=!1,this.$combobox.addClass("collapsed"),this.$combobox.find(".ui-button .fa").removeClass("fa-angle-down").addClass("fa-angle-up"),this.$clonedCombobox&&this.$clonedCombobox.remove()},r.prototype.toggleDropdown=function(t){var e=void 0!==t?t:!this.dropdownIsVisible;this.dropdownIsVisible=e,e?this.showDropdown():this.hideDropdown()},e.fn.ToolbarComboBox=function(t){var i=[];return e(this).each(function(o,n){var s=new r(n,t);e(n).data("comboBox",s),i.push(s)}),i},e.fn.getComboBox=function(){var t=[];return e(this).each(function(i,o){var n=e(o).data("comboBox");n&&t.push(n)}),t.length>1?t:t[0]},o.ToolbarComboBox=r}(0,e,i.util,i.utilPlugins)},c=function(t,e){if(!t)throw new Error("DrawerToolbar c-tor : drawerInstance is not set!");this.drawerInstance=t,this.buttonsGroups={},this._setupOptions(e),this._setupElement(),this._attachEventHandlers(),this._attachDrawerEventHandlers(),this._initCompactType()};c.prototype.MULTILINE="multiline",c.prototype.SCROLLABLE="scrollable",c.prototype.POPUP="popup",c.prototype.POSITION_TYPE_OUTSIDE="outside",c.prototype.POSITION_TYPE_INSIDE="inside",c.prototype.position="top",c.prototype.buttonsGroups={},c.prototype.buttons=[],c.prototype._defaultOptions={compactType:c.prototype.MULTILINE,positionType:c.prototype.POSITION_TYPE_OUTSIDE,buttonWidth:32,buttonHeight:35},c.prototype._defaultButtonConfig={additionalClass:"",iconClass:"",tooltipText:"",buttonOrder:10,isSubMenu:!1,group:{name:"",tooltip:""},clickHandler:function(){}},c.prototype._setupOptions=function(t){this.options=$.extend(!0,{},this._defaultOptions||{},t||{})},c.prototype._setupElement=function(){var t=this._generateTemplate(),e=$(t);this.$toolbar=e,this.$toolbarContentHolder=this.$toolbar.find(".toolbar-content-wrapper")},c.prototype._generateTemplate=function(){return'<ul class="'+("editable-canvas-toolbar "+(this.options.toolbarClass||"")+(this.options.hidden?" hidden ":""))+'" contenteditable="false"><ul class="toolbar-content-wrapper"></ul></ul>'},c.prototype._attachEventHandlers=function(){},c.prototype._attachDrawerEventHandlers=function(){var t=this;this.drawerInstance.on(this.drawerInstance.EVENT_DO_ACTIVATE_TOOL,function(){t.hideActiveSubmenu()})},c.prototype._initCompactType=function(){switch(!0){case this.options.compactType===c.prototype.SCROLLABLE:this._initCompactType_scrollable();break;case this.options.compactType===c.prototype.MULTILINE:this._initCompactType_multiline();break;case this.options.compactType===c.prototype.POPUP:this._initCompactType_popup();break;default:this._initCompactType_multiline()}},c.prototype._initCompactType_scrollable=function(){this.isScrollable=!0,this.scrollModeActive=!1,this.currentScrollOffset=0,this.$toolbar.addClass("toolbar-scrollable"),this._addScrollButtons(),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_START_RESIZE,this._onCanvasResizeStart.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_RESIZING,this._onCanvasResizing.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_STOP_RESIZE,this._onCanvasResizeFinish.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_EDIT_START,this.checkScroll.bind(this)),this.$toolbar.on("mousedown.toolbar touchstart.toolbar",this.onTouchStart.bind(this))},c.prototype._initCompactType_multiline=function(){this.$toolbar.addClass("toolbar-multiline")},c.prototype._initCompactType_popup=function(){this._initCompactType_multiline()},c.prototype.remove=function(){this.$toolbar.remove(),this.buttonsGroups={},this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOLBAR_DESTROYED,[this])},c.prototype.addControl=function(t,e){e=void 0!==e?e:this._defaultButtonConfig.buttonOrder;var i=this._getOrderString(e),o=t.attr("style");t.attr("style",(o||"")+";"+i),this.$toolbarContentHolder.append(t)},c.prototype.addButton=function(t){t=this._validateButtonConfig(t);var e=this.createButton(t);return this.buttons.push(e),this.$toolbarContentHolder.append(e),this.checkScroll(),e},c.prototype.addButtonToGroup=function(t){t=this._validateButtonConfig(t);var e=this.buttonsGroups[t.group.name];!(e&&e.length)&&(this._createAndAppendGroup(t.group,t.iconClass,t.buttonOrder),e=this.buttonsGroups[t.group.name]),t.isSubMenu=!0;var i=this.createButton(t);return e.$submenuWrapper.buttons.push(i),e.find(".group-items-container").append(i),i},c.prototype._validateButtonConfig=function(t){t=t||{};var e=$.extend(!0,{},this._defaultButtonConfig),i=$.extend(!0,{},e,t);return i.buttonOrder="number"==typeof i.buttonOrder?i.buttonOrder:e.buttonOrder,i.isSubMenu=void 0!==i.isSubMenu?i.isSubMenu:e.isSubMenu,i.clickHandler="function"==typeof i.clickHandler?i.clickHandler:e.clickHandler,i},c.prototype._getOrderString=function(t){return"-webkit-order:"+t+";-ms-flex-order:"+t+";order:"+t+";"},c.prototype.createButton=function(t){var e,i='style="'+this._getOrderString(t.buttonOrder)+'"',o=t.isSubMenu?" submenu-child ":" ",n='<li class="'+("toolbar-button "+t.additionalClass+o)+'"data-tooltip-class="'+t.additionalClass+'"'+i+'><a href="#" class="toolbar-button-icon '+o+'"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height,font-size:($v / 2.5)" tabindex="-1"><i class="fa '+t.iconClass+" "+o+'"></i></a></li>';e=$(n);var r={additionalClass:t.additionalClass,text:t.tooltipText,position:"bottom"};e.tooltip=this.drawerInstance.trigger(this.drawerInstance.EVENT_CREATE_TOOLTIP,[e.find("a"),r]);var s=e.find("a");return s.on("click",function(t){t.preventDefault(),t.stopPropagation()}),DrawerJs.util.bindClick(s,"editable-canvas-toolbar-button",t.clickHandler),e},c.prototype.removeButton=function(t){t?(DrawerJs.util.unbindClick(t.find("a"),"editable-canvas-toolbar-button"),t.remove()):console.warn("DrawerToolbar.removeButton() : no $button is provided!")},c.prototype._createAndAppendGroup=function(t,e,i){var o='style="'+this._getOrderString(i)+'"',n=$('<li class="toolbar-button btn-group group-'+t.name+'"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="width,height"'+o+'><a href="#" class="toolbar-button-icon"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height,font-size:($v / 2.5)" tabindex="-1"><i class="fa '+e+'"></i></a><div class="submenu-wrapper"><ul class="group-items-container submenu-child toolbar-dropdown-block"></ul></div></li>');n.$submenuWrapper=n.find(".submenu-wrapper"),n.$submenuWrapper.buttons=[],this.$toolbarContentHolder.append(n),this.buttonsGroups[t.name]=n,n.find("a").on("click",function(t){t.preventDefault()}),n.on("click",this.onGroupButtonClick.bind(this,n));var r={additionalClass:t.name,text:t.tooltip,position:"bottom"};this.drawerInstance.trigger(this.drawerInstance.EVENT_CREATE_TOOLTIP,[n.children("a"),r])},c.prototype.setActiveButton=function(t){this.$toolbar.find(".toolbar-button."+t).find(".toolbar-button-icon").addClass("active")},c.prototype.clearActiveButton=function(){this.$toolbar.find(".toolbar-button .toolbar-button-icon.active").removeClass("active")},c.prototype.onGroupButtonClick=function(t,e){this.activeSubmenu=t.$submenuWrapper.clone(!0);var i=$(e.currentTarget);if(this.isHorizontal()){var o=parseInt(this.$toolbar.css("padding-left")),n=i.position().left-this.currentScrollOffset+o;this.activeSubmenu.css("left",n+"px")}else{var r=parseInt(this.$toolbar.css("padding-top")),s=i.position().top-this.currentScrollOffset+r;this.activeSubmenu.css("top",s+"px")}this.$toolbar.parent().append(this.activeSubmenu);var a=0;switch(this.position){case"custom":case"top":a=this.$toolbar[0].offsetTop+this.$toolbar.height(),this.activeSubmenu.css("top",a+"px");break;case"left":a=this.$toolbar[0].offsetLeft+this.$toolbar.width(),this.activeSubmenu.css("left",a+"px");break;case"right":a=this.$toolbar[0].offsetLeft-this.$toolbar.width(),this.activeSubmenu.css("left",a+"px");break;case"bottom":a=this.$toolbar[0].offsetTop-this.activeSubmenu.height(),this.activeSubmenu.css("top",a+"px")}$("body").on("mousedown.submenu",this.onSubmenuMouseDown.bind(this))},c.prototype.onSubmenuMouseDown=function(t){this.activeSubmenu&&(t.target==this.activeSubmenu||$(t.target).hasClass("submenu-child")||this.hideActiveSubmenu())},c.prototype.hideActiveSubmenu=function(){this.activeSubmenu&&(this.drawerInstance.trigger(this.drawerInstance.EVENT_HIDE_TOOLTIPS),this.activeSubmenu.remove(),this.activeSubmenu=null,$("body").off("mousedown.submenu"))},c.prototype._setGroupButtonActive=function(t,e){var i=this.buttonsGroups[t],o=this.$toolbar.find("."+e);i.attr("class",o.attr("class")),i.addClass("btn-group");var n=i.children("a");n.addClass("active"),n.html(o.children("a").html())},c.prototype._addScrollButtons=function(){var t=function(t){return'<li class="toolbar-button '+t+'"><a href="#" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height,font-size:($v / 2.5)" tabindex="-1"><i class="fa"></i></a></li>'};this.$scrollToBeginBtn=$(t("scroll-to-begin-btn")),this.$scrollToEndBtn=$(t("scroll-to-end-btn"));var e=this.$scrollToBeginBtn.find("a"),i=this.$scrollToEndBtn.find("a");e.on("click",function(t){t.preventDefault()}),i.on("click",function(t){t.preventDefault()}),DrawerJs.util.bindClick(e,"scroll-to-begin-btn",this.onScrollToBegin.bind(this)),DrawerJs.util.bindClick(i,"scroll-to-end-btn",this.onScrollToEnd.bind(this)),this.$toolbar.append(this.$scrollToBeginBtn),this.$toolbar.append(this.$scrollToEndBtn)},c.prototype.onTouchStart=function(t){if(this.scrollModeActive){this.mouseDown=!0;var e="touchstart"==t.type?t.originalEvent.touches[0]:t,i=this.isHorizontal()?e.pageX:e.pageY;this.touchStartCoord=i+this.currentScrollOffset,console.log("TOUCH START",this.touchStartCoord,t),$("body").on("mouseup.toolbar touchend.toolbar",this.onTouchEnd.bind(this)),this.$toolbar.on("mousemove.toolbar touchmove.toolbar",this.onTouchMove.bind(this))}},c.prototype.onTouchEnd=function(t){console.log("TOUCH END",t),this.mouseDown=!1,$("body").off("mousemove.toolbar touchmove.toolbar"),$("body").off("mouseup.toolbar touchend.toolbar")},c.prototype.onTouchMove=function(t){if(this.mouseDown){var e=t.target,i=$(e),o=i.is("input"),n=i.is(".color-indicator");if(!o&&!n){t.preventDefault();var r="touchmove"===t.type?t.originalEvent.touches[0]:t,s=this.isHorizontal()?r.pageX:r.pageY,a=this.touchStartCoord-s;console.log("TOUCH MOVE",s,a),this.scrollTo(a)}}},c.prototype._onCanvasResizeStart=function(){this.checkScroll()},c.prototype._onCanvasResizing=function(){this.checkScroll()},c.prototype._onCanvasResizeFinish=function(){this.checkScroll()},c.prototype.checkScroll=function(){var t=this.$toolbarContentHolder.get(0);(this.isHorizontal()?t.scrollWidth:t.scrollHeight)>(this.isHorizontal()?this.$toolbar.width():this.$toolbar.height())?(this.scrollModeActive=!0,this.$toolbar.addClass("show-scroll")):(this.scrollModeActive=!1,this.$toolbar.removeClass("show-scroll"),this.scrollTo(0))},c.prototype._getCurrOffsetProps=function(){var t,e={},i=this.isHorizontal(),o=this.currentScrollOffset,n=this.$toolbar.find(".toolbar-content-wrapper"),r=n.get(0).getBoundingClientRect();return n.children().each(function(n,s){var a=$(s),h=s.getBoundingClientRect(),l=i?h.left-r.left:h.top-r.top,c=Math.abs(l-o);a.is(":visible")&&(void 0===t||t>c)&&(t=c,e.relativeOffset=l-o,e.$element=a,e.sizes=h)}),e},c.prototype._getOffsetStep_Custom=function(t){var e,i,o,n,r=0,s=this.isHorizontal(),a=(s?this.$toolbar.width():this.$toolbar.height())-2*(s?this.options.buttonWidth:this.options.buttonHeight),h=this._getCurrOffsetProps(),l=h.$element,c=!0;r=h.relativeOffset;var u=l.get(0).getBoundingClientRect();for(e=l;c;){if((i=t?e.prev():e.next()).length&&Math.abs(r)<a)i.is(":visible")&&(o=i.get(0).getBoundingClientRect(),(n=s?o.left-u.left:o.top-u.top)>0?n+=3:n-=3,r+=n,c=!1);else c=!1;e=i}return r},c.prototype._getOffsetStep_Buttons=function(){var t=this.isHorizontal()?this.$toolbar.width():this.$toolbar.height(),e=this.isHorizontal()?this.options.buttonWidth:this.options.buttonHeight,i=Math.ceil(t/e);return Math.max(i-1,1)*e},c.prototype.onScrollToBegin=function(){var t;t=this.customScrollMode?this._getOffsetStep_Custom(!0):-this._getOffsetStep_Buttons(),this.scrollToolbarBy(t)},c.prototype.onScrollToEnd=function(){var t;t=this.customScrollMode?this._getOffsetStep_Custom():this._getOffsetStep_Buttons(),this.scrollToolbarBy(t)},c.prototype.scrollToolbarBy=function(t){var e=this.currentScrollOffset+parseInt(t),i=this.$toolbar.get(0),o=this.isHorizontal(),n=(o?this.$toolbar.width():this.$toolbar.height(),(o?i.scrollWidth:i.scrollHeight)-(o?this.options.buttonWidth:this.options.buttonHeight));e=Math.min(e,n),e=Math.max(e,0),this.scrollTo(e)},c.prototype.toggleToolbarVisibility=function(t,e){var i=!this.$toolbar.hasClass("hidden");(e?this.visibilityState:i)?this.showToolbar(t):this.hideToolbar(t)},c.prototype.hideToolbar=function(t){t&&(this.visibilityState=!this.$toolbar.hasClass("hidden")),this.invisible=!0,this.$toolbar.addClass("hidden")},c.prototype.showToolbar=function(t){t&&(this.visibilityState=!this.$toolbar.hasClass("hidden")),this.invisible=!1,this.$toolbar.removeClass("hidden")},c.prototype.scrollTo=function(t){this.currentScrollOffset=parseInt(t),this.isHorizontal()?this.$toolbarContentHolder.css("left","-"+this.currentScrollOffset+"px"):this.$toolbarContentHolder.css("top","-"+this.currentScrollOffset+"px")},c.prototype.getToolbarOrientation=function(){return this.$toolbar.hasClass("toolbar-vertical")?"vertical":"horizontal"},c.prototype.isHorizontal=function(){return"horizontal"===this.getToolbarOrientation()},c.prototype.height=function(){return this.$toolbar.height()},c.prototype.width=function(){return this.$toolbar.width()};var u=c,p=function(t,e){e.toolbarClass="tool-options-toolbar",u.call(this,t,e),t.trigger(t.EVENT_OPTIONS_TOOLBAR_CREATED,[this])};(p.prototype=Object.create(u.prototype)).constructor=u,p.prototype.customScrollMode=!0;var d=p,f=function(t,e){e.toolbarClass="drawing-tools-toolbar",this.eventNameSpace=".toolbar-drawingTools",u.call(this,t,e),this._setDrawerHandlers(),t.trigger(t.EVENT_TOOLS_TOOLBAR_CREATED,[this])};(f.prototype=Object.create(u.prototype)).constructor=u,f.prototype._setDrawerHandlers=function(){var t=this.drawerInstance,e=this.eventNameSpace;t.off(t.EVENT_DO_ACTIVATE_TOOL+e),t.on(t.EVENT_DO_ACTIVATE_TOOL+e,function(e,i){t.lastUsedPluginName=i.name}),t.off(t.EVENT_DO_DEACTIVATE_TOOL+e),t.on(t.EVENT_DO_DEACTIVATE_TOOL+e,function(e,i){t.lastUsedPluginName==i.name&&(t.lastUsedPluginName=null)}),t.off(t.AFTER_CREATE_TOOLBARS+e),t.on(t.AFTER_CREATE_TOOLBARS+e,function(){t.activateDefaultPlugin()})};var g=f,v=function(t,e){(e=e||{}).toolbarClass="tool-cropimage hidden",u.call(this,t,e),this._createDefaultButtons(),t.trigger(t.EVENT_IMAGECROP_TOOLBAR_CREATED,[this])};(v.prototype=Object.create(u.prototype)).constructor=u,v.prototype._createDefaultButtons=function(){};var b=v,m=function(t,e){(e=e||{}).toolbarClass="tool-minimized-toolbar",u.call(this,t,e),t.trigger(t.EVENT_MINIMIZED_TOOLBAR_CREATED,[this])};(m.prototype=Object.create(u.prototype)).constructor=u;var y=m,_=function(t,e){(e=e||{}).toolbarClass="tool-overcanvas-toolbar",u.call(this,t,e),t.trigger(t.EVENT_FLOATING_TOOLBAR_CREATED,[this])};(_.prototype=Object.create(u.prototype)).constructor=u;var w=_,C=function(t,e){(e=e||{}).toolbarClass="tool-settings-toolbar",u.call(this,t,e),this._createDefaultButtons(),t.trigger(t.EVENT_CONFIG_TOOLBAR_CREATED,[this])};(C.prototype=Object.create(u.prototype)).constructor=u,C.prototype._createDefaultButtons=function(){};var T=C,S=function(t){if(this.drawerInstance=t,!t)throw new Error("DrawerToolbarManager : drawer must be provided!");this.toolbars={},this.toolbarPlaceholders={},this.TooltipManager=new DrawerJs.utilPlugins.TooltipManager(this.drawerInstance)};S.prototype.addToolbar=function(t,e){var i=(e=e||{}).position==h.prototype.CUSTOM_POSITION,o=i?e.customAnchorSelector:e.position,n=o===h.prototype.POPUP_POSITION||o===h.prototype.OVER_CANVAS_POSITION?h.prototype.POSITION_TYPE_CUSTOM:e.positionType||h.prototype.POSITION_TYPE_OUTSIDE,r=this.toolbarPlaceholders[n]&&this.toolbarPlaceholders[n][o],s=this.toolbarPlaceholders[o],a=r||s;if(a)a.addToolbar(t);else if(!i){var l=n+" "+o+" "+e.customAnchorSelector+"'";this.drawerInstance.error("DrawerToolbarManager.addToolbar() : no placeholder exists with name '"+l)}},S.prototype.createAllToolbars=function(){var t=this;this.drawerInstance.trigger(this.drawerInstance.BEFORE_CREATE_TOOLBARS,[this]),this._createHelperElements(),this._createToolbarsPlaceholders();var e,i,o,n=this.drawerInstance.options.toolbars,r=this.drawerInstance.$canvasEditContainer.hasClass("fullscreen"),s=n.overCanvas;if(r){var a={positionType:h.prototype.POSITION_TYPE_INSIDE};e=$.extend(!0,{},n.toolOptions,n.toolOptions.fullscreenMode||{},a),i=$.extend(!0,{},n.drawingTools,n.drawingTools.fullscreenMode||{},a),o=$.extend(!0,{},n.settings,n.settings.fullscreenMode||{},a)}else e=n.toolOptions,i=n.drawingTools,o=n.settings;this.toolOptionsToolbar=new d(this.drawerInstance,e);var l={position:e.position,positionType:e.positionType,customAnchorSelector:e.customAnchorSelector};e.compactType===u.prototype.POPUP&&(l.position=h.prototype.POPUP_POSITION,l.positionType=h.prototype.POSITION_TYPE_CUSTOM),this.addToolbar(this.toolOptionsToolbar,l),this.drawingToolsToolbar=new g(this.drawerInstance,i);var c={position:i.position,positionType:i.positionType,customAnchorSelector:i.customAnchorSelector};this.addToolbar(this.drawingToolsToolbar,c),this.settingsToolbar=new T(this.drawerInstance,o);var p={position:o.position,positionType:o.positionType,customAnchorSelector:o.customAnchorSelector};this.addToolbar(this.settingsToolbar,p),this.overCanvasToolbar=new w(this.drawerInstance,s);var f={position:h.prototype.OVER_CANVAS_POSITION,positionType:h.prototype.POSITION_TYPE_CUSTOM};this.addToolbar(this.overCanvasToolbar,f),this.cropImageToolbar=new b(this.drawerInstance,s);var v={position:h.prototype.TOP_POSITION,positionType:h.prototype.POSITION_TYPE_INSIDE};this.addToolbar(this.cropImageToolbar,v),this.minimizedToolbar=new y(this.drawerInstance);var m={position:h.prototype.TOP_POSITION,positionType:h.prototype.POSITION_TYPE_INSIDE};this.addToolbar(this.minimizedToolbar,m),this.setToolbarButtonsSize(),this.drawerInstance.on(this.drawerInstance.EVENT_EDIT_STOP,function(){t.destroyAllToolbars()}),this.drawerInstance.trigger(this.drawerInstance.AFTER_CREATE_TOOLBARS,[this])},S.prototype._createToolbarsPlaceholders=function(){this.toolbarPlaceholders.outside={},this.toolbarPlaceholders.inside={},this.toolbarPlaceholders.custom={},this.toolbarPlaceholders.outside.top=new h(this.drawerInstance,h.prototype.TOP_POSITION,h.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.outside.left=new h(this.drawerInstance,h.prototype.LEFT_POSITION,h.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.outside.right=new h(this.drawerInstance,h.prototype.RIGHT_POSITION,h.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.outside.bottom=new h(this.drawerInstance,h.prototype.BOTTOM_POSITION,h.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.inside.top=new h(this.drawerInstance,h.prototype.TOP_POSITION,h.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.inside.left=new h(this.drawerInstance,h.prototype.LEFT_POSITION,h.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.inside.right=new h(this.drawerInstance,h.prototype.RIGHT_POSITION,h.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.inside.bottom=new h(this.drawerInstance,h.prototype.BOTTOM_POSITION,h.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.custom.canvas=new h(this.drawerInstance,h.prototype.OVER_CANVAS_POSITION,h.prototype.POSITION_TYPE_CUSTOM),this.toolbarPlaceholders.custom.popup=new h(this.drawerInstance,h.prototype.POPUP_POSITION,h.prototype.POSITION_TYPE_CUSTOM),this.toolbarPlaceholders.custom.minimized=new h(this.drawerInstance,h.prototype.TOP_POSITION,h.prototype.POSITION_TYPE_INSIDE);for(var t=["drawingTools","toolOptions","settings"],e=0;e<t.length;e++){var i=this.drawerInstance.options.toolbars[t[e]];if(i&&i.position==h.prototype.CUSTOM_POSITION&&i.customAnchorSelector){var o=i.customAnchorSelector;this.toolbarPlaceholders[o]=new h(this.drawerInstance,h.prototype.CUSTOM_POSITION,null,o)}}},S.prototype._removeHelperElements=function(){this.drawerInstance.$toolbarsWrapper&&this.drawerInstance.$toolbarsWrapper.length&&this.drawerInstance.$toolbarsWrapper.remove();var t=this.drawerInstance.$canvasEditContainer.find(".toolbars-wrapper");t&&t.length&&t.remove(),this.drawerInstance.$toolbarsWrapper=void 0},S.prototype._createHelperElements=function(){this._removeHelperElements();var t=$('<div class="toolbars-wrapper"></div>');this.drawerInstance.$canvasEditContainer.append(t),this.drawerInstance.$toolbarsWrapper=t},S.prototype.destroyAllToolbars=function(){this.settingsToolbar.remove(),this.drawingToolsToolbar.remove(),this.toolOptionsToolbar.remove()},S.prototype.resetAllToolbars=function(){this.destroyAllToolbars(),this.createAllToolbars()},S.prototype._adjustElementsSize=function(t,e){for(var i=$("[data-editable-canvas-sizeable="+t+"]"),o=0;o<i.length;o++){var n=i[o],r=$(n).attr("data-editable-canvas-cssrules");if(r)for(var s=r.split(","),a=0;a<s.length;a++){var h=s[a],l=e;"-"==h[0]&&(h=h.substr(1),l="-"+e);var c=h.match(/:\((.+)\)/);if(c){h=h.replace(c[0],"");var u=c[1];u=u.replace("$v",l),l=new Function("return "+u)()}$(n).css(h,l+"px")}}},S.prototype.setToolbarButtonsSize=function(t){t?this.touchDevice?this.drawerInstance.options.toolbarSizeTouch=t:this.drawerInstance.options.toolbarSize=t:t=this.touchDevice?this.drawerInstance.options.toolbarSizeTouch:this.drawerInstance.options.toolbarSize,this._adjustElementsSize("toolbar-button",t)};var O=S,E=function(t,e){t.prototype.getCanvasData=function(){var t=null;if(this.fCanvas)t=this.fCanvas.toJSON();else if(this.options.contentConfig.loadCanvasData)t=this.options.contentConfig.loadCanvasData(this.id);else if(this.$canvasDataContainer){var e=this.$canvasDataContainer.text();e&&(t=JSON.parse(e)[this.id])}else{var i=this.$imageElement.attr("data-canvas-serialized");i&&(t=JSON.parse(i))}return t},t.prototype.getImageData=function(){if(this.fCanvas)this.imageData=this.fCanvas.toDataURL();else if(this.options.contentConfig.loadImageData)this.imageData=this.options.contentConfig.loadImageData(this.id),'"'==this.imageData[0]&&'"'==this.imageData[this.imageData.length-1]&&(this.imageData=this.imageData.substr(1,this.imageData.length-2));else if(this.$imagesContainer){var t=this.$imagesContainer.text();if(t){var e=JSON.parse(t);this.imageData=e[this.id]}}return this.imageData},t.prototype.loadCanvas=function(t){var e=this;t?this.fCanvas.loadFromJSON(t,function(){var t=e.fCanvas.getObjects();for(var i in t)e._updateObjectsControls(t[i]);e.mode=e.MODE_ACTIVE,e.trigger(e.EVENT_LOADED_FROM_JSON),e.fCanvas.renderAll(),e.onCanvasLoaded()}):(e.mode=this.MODE_ACTIVE,e.onCanvasLoaded())},t.prototype.onCanvasLoaded=function(){var t=this;this.fCanvas.on("object:added",function(e){t._updateObjectsControls(e.target),t.trigger(t.EVENT_OBJECT_ADDED,e),t.onCanvasModified()}),this.fCanvas.on("object:moving",function(e){t.trigger(t.EVENT_OBJECT_MOVING,e)}),this.fCanvas.on("object:modified",function(){t.onCanvasModified()}),this.fCanvas.on("before:render",function(e){t.trigger(t.EVENT_BEFORE_RENDER,e)}),this.fCanvas.on("after:render",function(e){t.trigger(t.EVENT_AFTER_RENDER,e)}),this.fCanvas.on("canvas:zoom:lower:set",function(e){t.trigger(t.EVENT_ZOOM_SET,e)}),this.fCanvas.on("canvas:zoom:lower:restore",function(e){t.trigger(t.EVENT_ZOOM_RESTORE,e)}),this.fCanvas.on("canvas:zoom:upper:set",function(e){t.trigger(t.EVENT_ZOOM_UPPER_SET,e)}),this.fCanvas.on("canvas:zoom:upper:restore",function(e){t.trigger(t.EVENT_ZOOM_UPPER_RESTORE,e)}),this.fCanvas.on("pencil:move:before",function(e){t.trigger(t.EVENT_ZOOM_UPPER_SET,e)}),this.fCanvas.on("pencil:move:after",function(e){t.trigger(t.EVENT_ZOOM_UPPER_RESTORE,e)}),this.fCanvas.on("object:removed",function(){t.onCanvasModified()}),this.fCanvas.on("object:selected",function(e){t.trigger(t.EVENT_OBJECT_SELECTED,e)}),this.fCanvas.on("selection:cleared",function(e){t.trigger(t.EVENT_SELECTION_CLEARED,e)}),this.fCanvas.on("text:selection:changed",function(e){t.trigger(t.EVENT_TEXT_SELECTION_CHANGED,e)}),this.fCanvas.on("text:editing:entered",function(e){t.trigger(t.EVENT_TEXT_EDITING_ENTERED,e)}),this.fCanvas.on("text:editing:exited",function(e){t.trigger(t.EVENT_TEXT_EDITING_EXITED,e)}),this.setColor(),this.toolbars.createAllToolbars(),$(this.fCanvas.upperCanvasEl).attr("data-id",1),this.setSize(this.width,this.height),this.$canvasEditContainer.on("contextmenu",function(e){return t.trigger(t.EVENT_CONTEXTMENU,[e]),!1}),e.bindLongPress(this.$canvasEditContainer,"canvasEdit",function(e){t.trigger(t.EVENT_CONTEXTMENU,[e])}),this.trigger(this.EVENT_EDIT_START),this.$canvasEditContainer.on("keydown",".canvas-container",function(e){t.trigger(t.EVENT_KEYDOWN,e);var i=8==e.which,o=46==e.which;if(i||o){t.fCanvas.renderOnAddRemove=!1;var n=t.fCanvas.getActiveObject();n&&(n.remove(),e.preventDefault(),e.stopPropagation());var r=t.fCanvas.getActiveGroup();return r&&(r.getObjects().map(function(t){t.remove()}),t.fCanvas.discardActiveGroup(),e.preventDefault(),e.stopPropagation()),t.fCanvas.renderAll(),t.fCanvas.renderOnAddRemove=!0,!1}}),this.trigger(this.EVENT_CANVAS_READY)},t.prototype.getSerializedCanvas=function(){var t=this.fCanvas.toJSON();return JSON.stringify(t,null,2)},t.prototype.beforeSync=function(){this.options.contentConfig&&!this.options.contentConfig.saveInHtml&&this.$imageElement.attr("src",""),this.fCanvas&&(this.beforeSyncActiveObject=this.fCanvas.getActiveObject(),this.beforeSyncActiveGroup=this.fCanvas.getActiveGroup(),this.fCanvas.deactivateAll())},t.prototype.afterSync=function(){this.beforeSyncActiveObject&&(this.fCanvas.setActiveObject(this.beforeSyncActiveObject),delete this.beforeSyncActiveObject),this.beforeSyncActiveGroup&&(this.fCanvas.setActiveGroup(this.beforeSyncActiveGroup),delete this.beforeSyncActiveGroup),this.options.contentConfig&&!this.options.contentConfig.saveInHtml&&this.$imageElement.attr("src",this.getImageData())},t.prototype.syncCanvasData=function(t){if(this.fCanvas){var e=this.getSerializedCanvas();if(this.$canvasDataContainer){var i=this.$canvasDataContainer.text(),o={};i.length>0&&(o=JSON.parse(i)),t?delete o[this.id]:this.fCanvas&&(o[this.id]=e),this.$canvasDataContainer.text(JSON.stringify(o,null,2)),this.log("sync","sync with data container done.")}this.options.contentConfig.saveCanvasData&&this.options.contentConfig.saveCanvasData(this.id,e),this.options.contentConfig.saveInHtml&&this.$imageElement.attr("data-canvas-serialized",e)}},t.prototype.syncImageData=function(t){var e=this.getImageData();if(this.$imagesContainer){var i=this.$imagesContainer.text(),o={};i.length>0&&(o=JSON.parse(i)),t?delete o[this.id]:o[this.id]=e,this.$imagesContainer.text(JSON.stringify(o,null,2)),this.log("sync","sync with images container done.")}this.options.contentConfig.saveImageData&&this.options.contentConfig.saveImageData(this.id,e)}},x=function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.ErasableMixin=function(t){this.eraserPaths=[],t&&(this.eraserPaths=this._createEraserPaths(t.eraserPaths))},e.ErasableMixin.prototype.initialize=function(t){this.eraserPaths=[],t&&(this.eraserPaths=e.ErasableMixin.prototype._createEraserPaths.call(this,t.eraserPaths))},e.ErasableMixin.prototype._createEraserPaths=function(t){var i=[];return t&&t.map(function(t){e.EraserPath.fromObject(t,function(t){i.push(t)})}),i},e.ErasableMixin.prototype.render=function(t,e){var i=DrawerJs.util.getTemporaryCanvas(this.canvas),o=i.getContext("2d"),n=this.canvas.width,r=this.canvas.height;o.clearRect(0,0,n,r),e(o);for(var s=0;s<this.eraserPaths.length;s++)this.eraserPaths[s].globalCompositeOperation="destination-out",this.eraserPaths[s].render(o);t.drawImage(i,0,0)},e.ErasableMixin.prototype.addEraserPath=function(t,i){var o=this;t.clone(function(t){t.set("stroke","blue"),t.selectable=!1,t.evented=!1;var n=o.getCenterPoint(),r=t.getCenterPoint();t.polygonOffsetX=r.x-n.x,t.polygonOffsetY=r.y-n.y;var s=o.angle;t.set({angle:s});for(var a=0;a<t.path.length;a++)e.ErasableMixin.prototype._rotatePathPoints(t.path[a],n,-s);e.ErasableMixin.prototype._updatePathPosition.call(o,t),o.eraserPaths.push(t),i&&i(this)})},e.ErasableMixin.prototype._updateEPathsOnSet=function(t,i){if(this.eraserPaths){this.getCenterPoint();for(var o=0;o<this.eraserPaths.length;o++){var n=this.eraserPaths[o];if(n instanceof e.EraserPath){var r=n.scaleX,s=n.scaleY;"scaleX"==t&&(r*=i/this.scaleX,n.set("scaleX",r)),"scaleY"==t&&(s*=i/this.scaleY,n.set("scaleY",s)),"angle"==t&&n.set("angle",this.angle),e.ErasableMixin.prototype._updatePathPosition.call(this,n)}}}},e.ErasableMixin.prototype._updatePathPosition=function(t){var i=this.getCenterPoint(),o=t.scaleX,n=t.scaleY,r=i.x+t.polygonOffsetX*o,s=i.y+t.polygonOffsetY*n,a=e.util.rotatePoint(new e.Point(r,s),i,e.util.degreesToRadians(t.angle));t.set("left",a.x),t.set("top",a.y)},e.ErasableMixin.prototype._rotatePathPoints=function(t,i,o){for(var n,r,s=e.util.degreesToRadians(o),a=t.length,h=0;h<a;h++)"number"==typeof t[h]&&(n=new e.Point(t[h],t[h+1]),r=e.util.rotatePoint(n,i,s),t[h]=r.x,t[h+1]=r.y,h++);return t},e.ErasableMixin.prototype.toObject=function(){return{eraserPaths:this.eraserPaths.map(function(t){return t.toObject()})}},e.ErasableMixin.prototype.fromObject=function(t){return this.eraserPaths=e.ErasableMixin.prototype._createEraserPaths(t.eraserPaths),this},e.makeObjectErasable=function(t){var o=new e.ErasableMixin;t.prototype.isErasable=!0;var n=t.prototype.initialize;t.prototype.initialize=function(){n.apply(this,arguments),o.initialize.apply(this,arguments)},t.prototype.addEraserPath=function(t){o.addEraserPath.call(this,t)};var r=t.prototype.render;t.prototype.render=function(t){o.render.call(this,t,r.bind(this))};var s=t.prototype._set;t.prototype._set=function(t,e){o._updateEPathsOnSet.call(this,t,e),s.call(this,t,e)};var a=t.fromObject;t.fromObject=function(t,e){if(!this.async){var i=a.call(this,t);return o.fromObject.call(i,t)}a.call(this,t,function(i){var n=o.fromObject.call(i,t);e&&e(n)})};var h=t.prototype.toObject;t.prototype.toObject=function(){var t=h.call(this);return i(t,o.toObject.call(this)),t}}},I=function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.PText=e.util.createClass(e.IText,{type:"PText",_defaultOptions:{editIconMode:!0},objectOptionsList:["color","border","opacity","TextLineHeight","TextAlign"],initialize:function(t,e){this.callSuper("initialize",t,e),this.options=$.extend(!0,this._defaultOptions||{},e||{});var i=DrawerJs.util.getDrawerFolderUrl()+"assets/pencil-square-o.32.png";this.options.editIconMode&&(this.startEditControl=new ObjectFloatingControl(this,i,this._iconClickHandler.bind(this),this.options))},onInput:function(t){if(this.isEditing&&!this.inCompositionMode){var e,i,o,n=this.selectionStart||0,r=this.selectionEnd||0,s=this.text.length,a=this.hiddenTextarea.value.length;a>s?(o="left"===this._selectionDirection?r:n,e=a-s,i=this.hiddenTextarea.value.slice(o,o+e)):(e=a-s+r-n,i=this.hiddenTextarea.value.slice(n,n+e));var h=this.selectionStart===this.selectionEnd&&this.canvas.copiedTextStyle;this.insertChars(i,h),t.stopPropagation()}},renderCursorOrSelection:function(t){this.canvas.fire("canvas:zoom:upper:set"),this.callSuper("renderCursorOrSelection",t),this.canvas.fire("canvas:zoom:upper:restore")},initMouseupHandler:function(){this.on("mouseup",function(t){this.options.editIconMode?this.onMouseUpHandler(t):this.onMouseUpSuperHandler(t)})},onMouseUpHandler:function(t){this.__isMousedown=!1,!this.editable||this._isObjectMoved&&this._isObjectMoved(t.e)||(this.selected=!0)},onMouseUpSuperHandler:function(t){this.__isMousedown=!1,!this.editable||this._isObjectMoved&&this._isObjectMoved(t.e)||(this.__lastSelected&&!this.__corner&&(this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)},_iconClickHandler:function(t){this.canvas.setActiveObject(this),this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()},getObjStyles:function(t){return{fontSize:(t=t||this).fontSize,fill:t.fill,textBackgroundColor:t.textBackgroundColor,textDecoration:t.textDecoration,fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontStyle:t.fontStyle,lineHeight:t.lineHeight,stroke:t.stroke,strokeWidth:t.strokeWidth}},render:function(t){this.callSuper("render",t)},toObject:function(t){return i(this.callSuper("toObject",t))}}),e.PText.fromObject=function(t){return new e.PText(t.text,t)}},A=function(t){x(t.global),function(t){var e=t.fabric||(t.fabric={});e.util.object.extend;e.ErasableObject=e.util.createClass(e.Object,{type:"erasableObject",initialize:function(t){t=t||{},this.callSuper("initialize",t)}}),e.ErasableObject.fromObject=function(t){return new e.ErasableObject(t)},e.makeObjectErasable(e.ErasableObject)}(t.global),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.util.array.min,n=e.util.array.max;e.util.toFixed;e.SegmentablePolygon=e.util.createClass(e.ErasableObject,{type:"segmentablePolygon",points:null,minX:0,minY:0,objectOptionsList:["color","border","opacity"],initialize:function(t,e){this.points=t,void 0===t&&console.error("Points should be array."),e=e||{},this.callSuper("initialize",e),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX)},_calcDimensions:function(){for(var t=null,e=null,i=null,r=null,s=0;s<this.points.length;s++){var a=o(this.points[s],"x");(null===t||a<t)&&(t=a);var h=o(this.points[s],"y");(null===e||h<e)&&(e=h);var l=n(this.points[s],"x");(null===i||l>i)&&(i=l);var c=n(this.points[s],"y");(null===r||c>r)&&(r=c)}this.width=i-t||1,this.height=r-e||1,this.minX=t,this.minY=e},_fixPoints:function(){this._calcDimensions(),this.minX==this.width/2*-1&&this.minY==this.height/2*-1||this.points.forEach(function(t){t.forEach(function(t){t.x-=this.minX+this.width/2,t.y-=this.minY+this.height/2},this)},this)},_applyPointOffset:function(){this.points.forEach(function(t){t.forEach(function(t){t.x-=this.minX+this.width/2,t.y-=this.minY+this.height/2},this)},this)},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat(),type:this.type})},render:function(t,e){2==this.points[0].length&&(this.oldStroke=this.stroke,this.oldStrokeDashArray=this.strokeDashArray,this.oldStrokeWidth=this.strokeWidth,this.stroke=this.fill,this.strokeWidth=3,this.strokeDashArray=[]),this.callSuper("render",t,e),2==this.points[0].length&&(this.stroke=this.oldStroke,this.strokeDashArray=this.oldStrokeDashArray,this.strokeWidth=this.oldStrokeWidth)},_render:function(t){this.commonRender(t),this._renderFill(t),(this.stroke||this.strokeDashArray)&&(t.closePath(),this._renderStroke(t))},commonRender:function(t){var e;t.beginPath(),this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null);var i=this.points[0];1==i.length&&t.arc(i[0].x,i[0].y,2,0,2*Math.PI,!1),t.moveTo(i[0].x,i[0].y);for(var o=0,n=i.length;o<n;o++)e=i[o],t.lineTo(e.x,e.y);if(t.closePath(),this.points.length>1)for(var r=1;r<this.points.length;r++){var s=this.points[r];t.moveTo(s[0].x,s[0].y);for(var a=0;a<s.length;a++)t.lineTo(s[a].x,s[a].y)}},complexity:function(){for(var t=0,e=0;e<this.points.length;e++)t+=this.points[e].length;return t}}),e.SegmentablePolygon.fromObject=function(t){return new e.SegmentablePolygon(t.points,t,!0)}}(t.global),I(t.global),function(t){var e=t.fabric||(t.fabric={});e.util.object.extend;e.ErasableText=e.util.createClass(e.PText,{type:"ErasableText",isErasable:!0,initialize:function(t,e){this.callSuper("initialize",t,e)}}),e.ErasableText.fromObject=function(t){return new e.ErasableText(t.text,t)},e.makeObjectErasable(e.ErasableText)}(t.global),function(t){var e=t.fabric||(t.fabric={});e.util.object.extend;e.Arrow=e.util.createClass(e.Line,{type:"arrow",objectCaching:!1,objectOptionsList:["border","opacity","lineWidth","strokeWidth"],initialize:function(t,e){this.callSuper("initialize",t,e),e&&this.set("oneSided",e.oneSided)},_render:function(t,e){this.width<20&&this.height<20||this.scaleX<.3&&this.scaleY<.3?this.set("padding",20):this.set("padding",10),this.canvas.calcOffset(),this.callSuper("_render",t,e);var i=this.callSuper("calcLinePoints"),o=this._calcArrowAngle(i.x1,i.y1,i.x2,i.y2);this.oneSided||this._drawArrow(t,{x:i.x1,y:i.y1},o+90),this._drawArrow(t,{x:i.x2,y:i.y2},o-90)},_drawArrow:function(t,e,i){var o=.5;this.get("strokeWidth")>1&&(o*=this.get("strokeWidth")/2);var n={x:e.x,y:e.y+10*o},r={x:e.x-10*o,y:e.y-20*o},s={x:e.x,y:e.y-10*o},a={x:e.x+10*o,y:e.y-20*o};t.save(),t.translate(e.x,e.y),t.rotate(i*Math.PI/180),t.translate(-1*e.x,-1*e.y),t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(r.x,r.y),t.lineTo(s.x,s.y),t.lineTo(a.x,a.y),t.fillStyle=this.stroke,t.fill(),t.restore()},_calcArrowAngle:function(t,e,i,o){var n,r;return r=o-e,180*(0==(n=i-t)?0===r?0:r>0?Math.PI/2:3*Math.PI/2:0===r?n>0?0:Math.PI:n<0?Math.atan(r/n)+Math.PI:r<0?Math.atan(r/n)+2*Math.PI:Math.atan(r/n))/Math.PI},toObject:function(t){return t||(t=[]),t.push("oneSided","padding"),e.util.object.extend(this.callSuper("toObject",t),this.calcLinePoints())}}),e.Arrow.fromObject=function(t){var i=[t.x1,t.y1,t.x2,t.y2];return new e.Arrow(i,t)}}(t.global),function(t){t.runClippingOperation=function(t){var s=t.firstShape,a=t.secondShape,h=n(s.width,s.currentWidth,s.height,s.currentHeight,s.center,s.angleInRadians,s.points),l=i(a.center,a.points),c=e(t.cmd,h,o(l));if(a.centersQueue)for(var u=0;u<a.centersQueue.length;u++)l=i(a.centersQueue[u],a.points),c=e(t.cmd,c,o(l));var p=null;return(c=ClipperLib.JS.Lighten(c,.1)).length>0&&(p=r(s.currentWidth,s.width,s.currentHeight,s.height,s.center,-1*s.angleInRadians,c)),p};var e=function(t,e,i){var o=new ClipperLib.Paths,n=new ClipperLib.Clipper;return n.AddPaths(e,ClipperLib.PolyType.ptSubject,!0),n.AddPaths(i,ClipperLib.PolyType.ptClip,!0),n.Execute(t,o),o},i=function(t,e){for(var i=[],o=0;o<e.length;o++){for(var n=[],r=0;r<e[o].length;r++)n.push({x:t.x+e[o][r].x,y:t.y+e[o][r].y});i.push(n)}return i},o=function(t){for(var e=[],i=0;i<t.length;i++){for(var o=[],n=0;n<t[i].length;n++)o.push({X:t[i][n].x,Y:t[i][n].y});e.push(o)}return e},n=function(t,e,i,o,n,r,s){for(var a=[],h=Math.sin(r),l=Math.cos(r),c=0;c<s.length;c++){for(var u=[],p=0;p<s[c].length;p++){var d=100*s[c][p].x/t*e/100,f=100*s[c][p].y/i*o/100;d=n.x+d,f=n.y+f;var g=(d-=n.x)*l-(f-=n.y)*h,v=d*h+f*l;d=g+=n.x,f=v+=n.y,u.push({X:d,Y:f})}a.push(u)}return a},r=function(t,e,i,o,n,r,s){for(var a=[],h=Math.sin(r),l=Math.cos(r),c=0;c<s.length;c++){for(var u=[],p=0;p<s[c].length;p++){var d=s[c][p].X,f=s[c][p].Y,g=(d-=n.x)*l-(f-=n.y)*h,v=d*h+f*l;d=g+=n.x,f=v+=n.y,d=100*(d-=n.x)/t*e/100,f=100*(f-=n.y)/i*o/100,u.push({x:d,y:f})}a.push(u)}return a}}(t.clipping),function(t){var e=t.fabric||(t.fabric={});e.ErasableArrow=e.util.createClass(e.Arrow,{type:"ErasableArrow",originX:"center",originY:"center",initialize:function(t,e){e=e||{},this.callSuper("initialize",t,e)},toObject:function(t){return this.callSuper("toObject",t)},_render:function(t){this.callSuper("_render",t)}}),e.ErasableArrow.fromObject=function(t){var i=[t.x1,t.y1,t.x2,t.y2];return new e.ErasableArrow(i,t)},e.makeObjectErasable(e.ErasableArrow)}(t.global),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.ErasableImage=e.util.createClass(e.Image,{type:"ErasableImage",async:!0,objectOptionsList:["opacity","border"],initialize:function(t,e){e=e||{},this.width=e.width||10,this.height=e.height||10,this.callSuper("initialize",t,e)},_render:function(t){this.callSuper("_render",t)},_set:function(t,e){this.callSuper("_set",t,e)},toObject:function(t){return i(this.callSuper("toObject",t),{width:this.width,height:this.height})}}),e.ErasableImage.fromObject=function(t,i){e.util.loadImage(t.src,function(o){var n=new e.ErasableImage(o,t);i&&i(n)})},e.ErasableImage.async=!0,e.makeObjectErasable(e.ErasableImage)}(t.global),function(t){var e=t.fabric||(t.fabric={});e.ErasableLine=e.util.createClass(e.Line,{type:"ErasableLine",originX:"center",originY:"center",objectOptionsList:["border","opacity","lineWidth","strokeWidth"],initialize:function(t,e){e=e||{},this.callSuper("initialize",t,e)},toObject:function(t){return this.callSuper("toObject",t)},_render:function(t){this.callSuper("_render",t)}}),e.ErasableLine.fromObject=function(t){var i=[t.x1,t.y1,t.x2,t.y2];return new e.ErasableLine(i,t)},e.makeObjectErasable(e.ErasableLine)}(t.global),function(t){var e=t.fabric||(t.fabric={});e.util.object.extend;e.ErasablePath=e.util.createClass(e.Path,{type:"ErasablePath",objectCaching:!1,evented:!1,selectable:!1,initialize:function(t,e){e=e||{},this.callSuper("initialize",t,e)},_render:function(t){this.callSuper("_render",t)},toObject:function(t){return this.callSuper("toObject",t)}}),e.ErasablePath.fromObject=function(t){return new e.ErasablePath(t.path,t)},e.ErasablePath.async=!1,e.makeObjectErasable(e.ErasablePath)}(t.global),function(t){var e=t.fabric||(t.fabric={});e.ErasablePencilBrush=e.util.createClass(e.PencilBrush,{type:"ErasablePencilBrush",objectOptionsList:["color","opacity","brush"],onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render(),this.canvas.renderAll()},_render:function(){this.canvas.fire("pencil:move:before"),this.callSuper("_render"),this.canvas.fire("pencil:move:after")},initialize:function(t,e){e=e||{},this.options=e,this.callSuper("initialize",t)},createPath:function(t){var i=new e.ErasablePath(t,{fill:null,stroke:this.color,opacity:this.opacity,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,i.setShadow(this.shadow)),i}})}(t.global),function(t,e){var i=t.fabric||(t.fabric={}),o=(i.util.object.extend,function(t,o,n,r){if(!(t&&t instanceof i.Object))throw new Error("[ObjectFloatingControl()]  invalid param : obj");if(this.obj=t,!o||!e.isString(o))throw new Error("[ObjectFloatingControl()]  invalid param : iconPath");if(this.iconPath=o,!(n&&n instanceof Function))throw new Error("[ObjectFloatingControl()]  invalid param : callback");this.callback=n,this.options=$.extend(!0,{},this._defaultOptions||{},r||{}),this.enabled=this.options.enabled,i.Image.fromURL(o,this._onIconReady.bind(this)),this.obj.on("added",this._onAdded.bind(this)),this.obj.on("removed",this._onRemoved.bind(this))});o.prototype.SMALL_ICON="small",o.prototype.MEDIUM_ICON="medium",o.prototype.LARGE_ICON="large",o.prototype.LEFT_TOP="left-top",o.prototype.LEFT_BOTTOM="left-bottom",o.prototype.RIGHT_TOP="right-top",o.prototype.RIGHT_BOTTOM="right-bottom",o.prototype._defaultOptions={defaulIconSize:32,symbolicIconSizes:{small:16,medium:32,large:48},enabled:!0},o.prototype.remove=function(){this._onRemoved()},o.prototype.enable=function(){this.enabled=!0},o.prototype.disable=function(){this.enabled=!1},o.prototype._onAdded=function(t){this.canvas=this.obj.canvas,this._iconClickHandlerBinded=this._iconClickHandler.bind(this),this.canvas.on("mouse:up",this._iconClickHandlerBinded),this.canvas.on("touchend",this._iconClickHandlerBinded),this._bindedAfterRender=this._onAfterRender.bind(this),this.canvas.on("after:render",this._bindedAfterRender)},o.prototype._onRemoved=function(t){this.canvas.off("mouse:up",this._iconClickHandlerBinded),this.canvas.off("touchend",this._iconClickHandlerBinded),this.canvas.off("after:render",this._bindedAfterRender)},o.prototype._onIconReady=function(t){var e=this.options.iconSize||this.options.defaulIconSize,i=this.options.editIconSize,o=("string"==typeof i&&this.options.symbolicIconSizes[i]||i||this.options.defaulIconSize)/e;this.icon=t,this.iconSize=e,this.iconScale=o,this.icon.offsetFromLeft=.66*this.options.defaulIconSize,this.icon.offsetFromTop=.66*-this.iconSize,this.icon.set({scaleX:o,scaleY:o,originX:"center",originY:"center",opacity:1})},o.prototype._iconClickHandler=function(t){if(this.enabled&&this.canvas&&this.icon){var e,i,o=this.canvas.getPointer(t.e);if(o)e=o.x,i=o.y;else if(void 0===t.e.offsetX){var n=drawer.left(),r=drawer.top();e=t.e.pageX-n,i=t.e.pageY-r,console.log("x : ",t.e.pageX,"-",n,"=",e),console.log("y : ",t.e.pageY,"-",r,"=",i)}else e=t.e.offsetX,i=t.e.offsetY;this._coordInsideIcon(e,i)&&this.callback(t,this)}},o.prototype._coordInsideIcon=function(t,e){var i=this.icon.width*this.icon.scaleX/2,o=this._calcIconCoords(),n=t>o.x-i&&t<o.x+i,r=e>o.y-i&&e<o.y+i;return n&&r},o.prototype._onAfterRender=function(t){this.canvas.fire("canvas:zoom:lower:set"),this._drawIcon(),this.canvas.fire("canvas:zoom:lower:restore")},o.prototype._drawIcon=function(){if(this.enabled&&this.icon&&this.obj.active){var t=this._calcIconCoords();this.icon.left=t.x,this.icon.top=t.y,this.icon.render(this.canvas.getContext())}},o.prototype._calcIconCoords=function(){var t=this.obj.getPointByOrigin("left","top"),e=this.icon.offsetFromLeft*this.obj.scaleX,o=this.icon.offsetFromTop,n=i.util.degreesToRadians(this.obj.angle),r=e*Math.cos(n)-o*Math.sin(n),s=e*Math.sin(n)+o*Math.cos(n);return{x:t.x+r,y:t.y+s}},t.ObjectFloatingControl=o}(t.global,t.util),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,o=e.util.array.min,n=e.util.array.max,r=e.util.toFixed;e.SegmentableLine=e.util.createClass(e.Object,{type:"SegmentableLine",objectOptionsList:["border","opacity","lineWidth","strokeWidth"],points:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.points=t,this.callSuper("initialize",e),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX)},_calcDimensions:function(){this.points;for(var t=null,e=null,i=null,r=null,s=0;s<this.points.length;s++){var a=o(this.points[s],"x");(null===t||a<t)&&(t=a);var h=o(this.points[s],"y");(null===e||h<e)&&(e=h);var l=n(this.points[s],"x");(null===i||l>i)&&(i=l);var c=n(this.points[s],"y");(null===r||c>r)&&(r=c)}this.width=i-t||1,this.height=r-e||1,this.minX=t,this.minY=e},_applyPointOffset:function(){this.points.forEach(function(t){t.forEach(function(t){t.x-=this.minX+this.width/2,t.y-=this.minY+this.height/2},this)},this)},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat(),type:this.type})},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),o=0,n=this.points.length;o<n;o++)e.push(r(this.points[o].x,2),",",r(this.points[o].y,2)," ");return i.push("<",this.type," ",'points="',e.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),t?t(i.join("")):i.join("")},_render:function(t){this.commonRender(t),this._renderFill(t),(this.stroke||this.strokeDashArray)&&this._renderStroke(t)},commonRender:function(t){var e;t.beginPath(),this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null);var i=this.points[0];t.moveTo(i[0].x,i[0].y);for(var o=0,n=i.length;o<n;o++)e=i[o],t.lineTo(e.x,e.y);if(this.points.length>1)for(var r=1;r<this.points.length;r++){var s=this.points[r];t.moveTo(s[0].x,s[0].y);for(var a=0;a<s.length;a++)t.lineTo(s[a].x,s[a].y)}},complexity:function(){return this.points.length}}),e.SegmentableLine.fromObject=function(t){return new e.SegmentableLine(t.points,t,!0)}}(t.global),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.util.array.min,e.util.array.max,e.util.toFixed;e.PCircle=e.util.createClass(e.SegmentablePolygon,{radius:0,type:"PCircle",initialize:function(t){t=t||{},this.radius=t.radius||0;var e=this.makeCircle(this.radius);this.width=2*this.radius,this.height=2*this.radius,this.callSuper("initialize",e,t)},makeCircle:function(t){for(var e=[],i=0;i<360;i++){var o=i*Math.PI/180,n=0+t*Math.cos(o),r=0+t*Math.sin(o);e.push({x:n,y:r})}return[e]},_render:function(t){this.callSuper("_render",t)},_set:function(t,e){"radius"===t&&(this.points=this.makeCircle(e),this.width=2*e,this.height=2*e,this.callSuper("_set","points",this.points)),this.callSuper("_set",t,e)},isPointInside:function(t,e){var i=this.getCenterPoint();return Math.sqrt((t-i.x)*(t-i.x)+(e-i.y)*(e-i.y))<this.radius},getPerimeterPoints:function(t,e,i){var o=0,n=360;return"number"==typeof t&&"number"==typeof e&&!i&&(t||e)&&(n=0!==t&&0!==e?90:180,e<0?(o=180,t>0&&(o=270)):t<0&&(o=90)),this.getSectorPoints(o,n)},getSectorPoints:function(t,i){for(var o=[],n=Math.round(15*Math.random()/2),r=t+i+15-n,s=t-n;s<=r;s+=15){var a={},h=e.util.degreesToRadians(s%360),l=this.radius*Math.cos(h),c=this.radius*Math.sin(h);a.x=this.left+Math.round(l),a.y=this.top+Math.round(c),o.push(a)}return o},toObject:function(t){return i(this.callSuper("toObject",t),{radius:this.radius})}}),e.PCircle.fromObject=function(t){return new e.PCircle(t,!0)},e.PCircle.async=!1}(t.global),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.util.array.min,e.util.array.max,e.util.toFixed;e.PRect=e.util.createClass(e.SegmentablePolygon,{type:"PRect",initialize:function(t){t=t||{},this.width=t.width||10,this.height=t.height||10;var e=this.makeRect(this.width,this.height);this.callSuper("initialize",e,t)},makeRect:function(t,e){var i=t/2,o=e/2;return[[{x:-1*i,y:-1*o},{x:i,y:-1*o},{x:i,y:o},{x:-1*i,y:o}]]},_render:function(t){this.callSuper("_render",t)},_set:function(t,e){var i=!1;"width"===t&&(this.width=e,i=!0),"height"===t&&(this.height=e,i=!0),i&&(this.points=this.makeRect(this.width,this.height),this.callSuper("_set","points",this.points)),this.callSuper("_set",t,e)},toObject:function(t){return i(this.callSuper("toObject",t),{width:this.width,height:this.height})}}),e.PRect.fromObject=function(t){return new e.PRect(t,!0)},e.PRect.async=!1}(t.global),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.util.array.min,e.util.array.max,e.util.toFixed;e.PTriangle=e.util.createClass(e.SegmentablePolygon,{type:"PTriangle",initialize:function(t){t=t||{},this.width=t.width||10,this.height=t.height||10;var e=this.makeTriangle(this.width,this.height);this.callSuper("initialize",e,t)},makeTriangle:function(t,e){var i=t/2,o=e/2;return[[{x:-1*i,y:o},{x:0,y:-1*o},{x:i,y:o}]]},_render:function(t){this.callSuper("_render",t)},_set:function(t,e){var i=!1;"width"===t&&(this.width=e,i=!0),"height"===t&&(this.height=e,i=!0),i&&(this.points=this.makeTriangle(this.width,this.height),this.callSuper("_set","points",this.points)),this.callSuper("_set",t,e)},toObject:function(t){return i(this.callSuper("toObject",t),{width:this.width,height:this.height})}}),e.PTriangle.fromObject=function(t){return new e.PTriangle(t,!0)},e.PTriangle.async=!1}(t.global)},D=function(t,e,i){var o=function(t){e.call(this,t),this.name="ArrowOneSide",this.toolOptionsList=["border","opacity","lineWidth","strokeWidth"],this.btnClass="btn-arrow-one-side",this.faClass="fa-long-arrow-right",this.tooltip=t.t("Draw an arrow"),this.group={name:"lines",tooltip:t.t("Lines and arrows")},this._setupOptions({}),$.extend(!0,this.options.lineAngleTooltip,t.options.lineAngleTooltip||{}),this.options.lineAngleTooltip.fontFamily+=", "+this._defaultOptions.lineAngleTooltip.fontFamily};(o.prototype=Object.create(e.prototype)).constructor=o,o.prototype.checkOnlyWidth=!0,o.prototype._defaultOptions={lineAngleTooltip:{enabled:!1,fontSize:11,fontFamily:"Arial, sans serif",color:"black"}},o.prototype.createShape=function(t,e){var i=new fabric.ErasableArrow([t,e,t+1,e+1],{oneSided:!0});return i.set("strokeWidth",this.drawerInstance.lineStrokeWidth||1),i.set("stroke",this.drawerInstance.activeColor),i.set("opacity",this.drawerInstance.activeOpacity),i.set("oneSided",!0),this.createAngleTooltip(i),i},o.prototype.updateShape=function(t,e,i){t.set("y2",i),t.set("x2",e),this.updateAngleTooltip(t)},o.prototype.finishShape=function(t,e){this.removeAngleTooltip()},o.prototype.createAngleTooltip=function(t){this.options.lineAngleTooltip.enabled&&(this.angleTooltip=new fabric.IText("Text"),this.angleTooltip.set("fontFamily",this.options.lineAngleTooltip.fontFamily),this.angleTooltip.set("fontSize",this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("left",t.x1-10),this.angleTooltip.set("top",t.y1-10),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color),this.angleTooltip.set("text",""),this.drawerInstance.fCanvas.add(this.angleTooltip),this.updateAngleTooltip(t))},o.prototype.updateAngleTooltip=function(t){if(this.options.lineAngleTooltip.enabled){var e=Math.atan((t.y2-t.y1)/(t.x2-t.x1)),i=Math.abs(fabric.util.radiansToDegrees(e));this.angleTooltip.setText(i.toFixed().toString());var o=this.options.lineAngleTooltip.fontSize,n=-this.options.lineAngleTooltip.fontSize;t.x2<t.x1&&(o=-(this.options.lineAngleTooltip.fontSize+10)),t.y2>t.y1&&(n=2),this.angleTooltip.set("left",t.x1+o),this.angleTooltip.set("top",t.y1+n),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color)}},o.prototype.removeAngleTooltip=function(){this.options.lineAngleTooltip.enabled&&this.angleTooltip&&(this.angleTooltip.remove(),delete this.tooltip)},i.ArrowOneSide=o},k=function(t,e,i){var o=function(t){e.call(this,t),this.name="ArrowTwoSide",this.toolOptionsList=["border","opacity","lineWidth","strokeWidth"],this.btnClass="btn-arrow-two-side",this.faClass="fa-arrows-h",this.tooltip=t.t("Draw a two-sided arrow"),this.group={name:"lines",tooltip:t.t("Lines and arrows")},this._setupOptions({}),$.extend(!0,this.options.lineAngleTooltip,t.options.lineAngleTooltip||{}),this.options.lineAngleTooltip.fontFamily+=", "+this._defaultOptions.lineAngleTooltip.fontFamily};(o.prototype=Object.create(e.prototype)).constructor=o,o.prototype.checkOnlyWidth=!0,o.prototype._defaultOptions={lineAngleTooltip:{enabled:!1,fontSize:11,fontFamily:"Arial, sans serif",color:"black"}},o.prototype.createShape=function(t,e){var i=new fabric.ErasableArrow([t,e,t+1,e+1],{oneSided:!1});return i.set("strokeWidth",this.drawerInstance.lineStrokeWidth||1),i.set("stroke",this.drawerInstance.activeColor),i.set("opacity",this.drawerInstance.activeOpacity),i.set("oneSided",!1),this.createAngleTooltip(i),i},o.prototype.updateShape=function(t,e,i){t.set("y2",i),t.set("x2",e),this.updateAngleTooltip(t)},o.prototype.finishShape=function(t,e){this.removeAngleTooltip()},o.prototype.createAngleTooltip=function(t){this.options.lineAngleTooltip.enabled&&(this.angleTooltip=new fabric.IText("Text"),this.angleTooltip.set("fontFamily",this.options.lineAngleTooltip.fontFamily),this.angleTooltip.set("fontSize",this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("left",t.x1-this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("top",t.y1-this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color),this.angleTooltip.set("text",""),this.drawerInstance.fCanvas.add(this.angleTooltip),this.updateAngleTooltip(t))},o.prototype.updateAngleTooltip=function(t){if(this.options.lineAngleTooltip.enabled){var e=Math.atan((t.y2-t.y1)/(t.x2-t.x1)),i=Math.abs(fabric.util.radiansToDegrees(e));this.angleTooltip.setText(i.toFixed().toString());var o=this.options.lineAngleTooltip.fontSize,n=-this.options.lineAngleTooltip.fontSize;t.x2<t.x1&&(o=-(this.options.lineAngleTooltip.fontSize+10)),t.y2>t.y1&&(n=2),this.angleTooltip.set("left",t.x1+o),this.angleTooltip.set("top",t.y1+n),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color)}},o.prototype.removeAngleTooltip=function(){this.options.lineAngleTooltip.enabled&&this.angleTooltip&&(this.angleTooltip.remove(),delete this.tooltip)},i.ArrowTwoSide=o},P=function(t,e){!function(t,e){var i=function(t,e){if(!t)throw new Error("BaseTool CTOR : drawerInstance is not set!");this._setupOptions(e),this.drawerInstance=t,this.drawer=t,this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLS_TOOLBAR_CREATED,this._bindedOnToolbarCreated)};i.prototype.name="",i.prototype.type=null,i.prototype.active=!1,i.prototype.btnClass="btn",i.prototype.faClass="",i.prototype.tooltip="",i.prototype.toolbar=null,i.prototype.$toolButton=null,i.prototype.drawerInstance=null,i.prototype._onDeactivateAllTools=function(){if(this.active){var t=".tool-"+this.name;this.drawerInstance.trigger(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL+t,[this])}},i.prototype._setupOptions=function(e,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=t.extend(!0,{},this._defaultOptions||{},r||{},e||{});return o||(this.options=s),s},i.prototype._onToolbarCreated=function(t,e){this.toolbar=e,this.createButton(e),this._setHandlers(),this.onToolbarCreated&&this.onToolbarCreated(t,e)},i.prototype.onToolbarDestroyed=function(t,e){this.toolbar==e&&this.removeTool()},i.prototype.removeTool=function(t){this.$toolButton&&this.toolbar.removeButton(this.$toolButton),t&&(this._unsetHandlers(),this.drawerInstance.off(this.drawerInstance.EVENT_TOOLS_TOOLBAR_CREATED,this._bindedOnToolbarCreated))},i.prototype._setHandlers=function(){var t=".tool-"+this.name;this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_DESTROYED+t,this.onToolbarDestroyed.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_DO_DEACTIVATE_ALL_TOOLS+t,this._onDeactivateAllTools.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL+t,this._onDeactivateTool.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this))},i.prototype._unsetHandlers=function(){var t=".tool-"+this.name;this.drawerInstance.off(this.drawerInstance.EVENT_TOOLBAR_DESTROYED+t),this.drawerInstance.off(this.drawerInstance.EVENT_DO_DEACTIVATE_ALL_TOOLS+t),this.drawerInstance.off(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL+t),this.drawerInstance.off(this.drawerInstance.EVENT_DO_ACTIVATE_TOOL+t)},i.prototype._onDeactivateTool=function(t,e){if(!e||!e.name)throw new Error("BaseTool.onDeactivateTool() : no tool name is provided!");this.active&&e.name==this.name&&this._deactivateTool()},i.prototype._onActivateTool=function(t,e){if(!e||!e.name)throw new Error("BaseTool._onActivateTool() : no tool name is provided!");e.name!==this.name||this.active||(this.drawerInstance.trigger(this.drawerInstance.EVENT_DO_DEACTIVATE_ALL_TOOLS,{beforeActivateTool:!0}),this._activateTool())},i.prototype.createButton=function(t){var e={buttonOrder:this.options.buttonOrder,additionalClass:this.btnClass,iconClass:this.faClass,tooltipText:this.tooltip,clickHandler:this.onButtonClick.bind(this)};this.group?(e.group=this.group,this.$toolButton=t.addButtonToGroup(e)):this.$toolButton=t.addButton(e)},i.prototype.onButtonClick=function(){var t=this.active?this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL:this.drawerInstance.EVENT_DO_ACTIVATE_TOOL;this.drawerInstance.trigger(t,[this])},i.prototype._activateTool=function(){this.drawerInstance.log("TOOL","["+this.name+"] .activateTool() [BaseTool]"),this.drawerInstance.fCanvas.discardActiveObject(),this.drawerInstance.fCanvas.renderAll(),this.active=!0,this.drawerInstance.activeDrawingTool=this,this.highlightButton(),this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_ACTIVATED,[this])},i.prototype._deactivateTool=function(){this.drawerInstance.log("TOOL","["+this.name+"] : deactivateTool [BaseTool]"),this.active=!1,this.drawerInstance.activeDrawingTool===this&&(this.drawerInstance.activeDrawingTool=null),this.highlightButtonOff(),this.drawerInstance.fCanvas.renderAll(),this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_DEACTIVATED,[this])},i.prototype.highlightButton=function(){this.group?this.toolbar._setGroupButtonActive(this.group.name,this.btnClass):this.toolbar.setActiveButton(this.btnClass)},i.prototype.highlightButtonOff=function(){this.toolbar.clearActiveButton()},e.BaseTool=i}(t,e.plugins),function(t,e){var i=function(t,e){if(!t)throw new Error("BaseToolOptions CTOR : drawer is not set!");this.drawer=t,this._setupOptions(e),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),t.on(t.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedOnToolbarCreated),t.on(t.EVENT_TOOLBAR_DESTROYED,this._onToolbarDestroyed.bind(this)),t.on(t.EVENT_DO_DEACTIVATE_ALL_TOOLS,this._onDeactivateTool.bind(this)),t.on(t.EVENT_DO_DEACTIVATE_TOOL,this._onDeactivateTool.bind(this)),t.on(t.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),t.on(t.EVENT_TOOL_DEACTIVATED,this._onDeactivateTool.bind(this)),t.on(t.EVENT_TOOL_ACTIVATED,this._onActivateTool.bind(this)),t.on(t.EVENT_OBJECT_SELECTED,this._onObjectSelected.bind(this)),t.on(t.EVENT_SELECTION_CLEARED,this._onSelectionCleared.bind(this)),t.on(t.EVENT_TEXT_EDITING_ENTERED,this._onTextEditingEntered.bind(this)),t.on(t.EVENT_TEXT_EDITING_EXITED,this._onTextEditingExited.bind(this))};i.prototype.active=!1,i.prototype.drawer=null,i.prototype.toolbar=null,i.prototype.name="",i.prototype.type=null,i.prototype.optionName="",i.prototype.btnClass="btn",i.prototype.faClass="",i.prototype.showOnEditMode=!1,i.prototype.hideOnEditMode=!0,i.prototype.data={},i.prototype._setupOptions=function(e,i,o){e=e||{};var n=this._collectDefaultOptions(i),r=t.extend(!0,{},this._defaultOptions||{},n||{},e);return r=this._onOptionsSetup(this._defaultOptions,e,n,r)||r,o||(this.options=r),r},i.prototype._onOptionsSetup=function(t,e,i,o){return o},i.prototype._collectDefaultOptions=function(t){t=t||this.name||this.optionName;var e=this.drawerInstance||this.drawer;return e&&e.getPluginConfig(t)},i.prototype._onToolbarCreated=function(t,e){if(this.toolbar=e,this.createControls&&this.createControls(e),this.useCombobox&&this.$toolControl){var i={drawer:this.drawer,editable:!this.onlyPredefined,buttonMode:this.buttonMode},o=this.$toolControl.find("select");o.ToolbarComboBox(i),this.comboBox=o.getComboBox()}},i.prototype._onToolbarDestroyed=function(t,e){this.toolbar==e&&this.removeTool()},i.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},i.prototype._onTextEditingEntered=function(t,e){var i=(e=e&&e.target)&&e.isEditing;this.hideOnEditMode||!this.showOnEditMode&&!i?this.hideControls():this.showControls(!0,e)},i.prototype._onTextEditingExited=function(t,e){var i=e&&e.target&&e.target.isEditing;this.hideOnEditMode&&!i?this.showControls():this.hideControls()},i.prototype._onDeactivateTool=function(t,e){this.active=!1,this.options&&this.options.alwaysVisible?this.showControls():this.hideControls()},i.prototype._onActivateTool=function(t,e){this.updateOnTool(e)},i.prototype.updateOnTool=function(t){var e=t.toolOptionsList&&-1!==t.toolOptionsList.indexOf(this.optionName),i=!this.showOnEditMode||t.isEditing;e&&i?(this.active=!0,this.showControls(),this.onActivateTool&&this.onActivateTool(t)):(this.active=!1,this.hideControls(t.forceOptionsHide))},i.prototype._onObjectSelected=function(t,e){var i=e.target,o=i.objectOptionsList&&-1!==i.objectOptionsList.indexOf(this.optionName),n=!this.showOnEditMode||i.isEditing;o&&n?(this.showControls(),this.updateControlsFromObject(i)):this.hideControls()},i.prototype.onSelectionCleared=function(){},i.prototype._onSelectionCleared=function(){this.drawer.activeDrawingTool?this.updateOnTool(this.drawer.activeDrawingTool):this.hideControls(),this.onSelectionCleared()},i.prototype.collectDataFromObject=function(t){return{}},i.prototype.updateControls=function(t){},i.prototype.updateControlsFromObject=function(t){this.collectDataFromObject(t),this.updateControls(this.data)},i.prototype.showControls=function(t,e){},i.prototype.hideControls=function(t){},e.BaseToolOptions=i}(t,e.plugins),function(t,e,i,o){var n=function(t){i.call(this,t),this.drawer=t,this._setEventHandlers(),this._setGlobalClickHandler()};(n.prototype=Object.create(i.prototype)).constructor=i,n.prototype.buttonIconClass="",n.prototype.showOnEditMode=!0,n.prototype.hideOnEditMode=!1,n.prototype.focusTextOnChange=!1,n.prototype.onlyPredefined=!1,n.prototype.stylesToObject=!1,n.prototype.useCombobox=!0,n.prototype.buttonMode=!0,n.prototype.predefined={},n.prototype.valueType={},n.prototype.minValue=void 0,n.prototype.maxValue=void 0,n.prototype._setEventHandlers=function(){this.drawer.on(this.drawer.EVENT_TEXT_STYLES_CHANGED,this._onStylesChanged.bind(this)),this.drawer.on(this.drawer.EVENT_TEXT_GET_STYLES,this._onGetStyles.bind(this)),this._onObjectAdded&&this.drawer.on(this.drawer.EVENT_OBJECT_ADDED,this._onObjectAdded.bind(this))},n.prototype._onStylesChanged=function(t,e,i,o){this.updateControls(e,i,o)},n.prototype._onGetStyles=function(e,i,o){(o=o||{}).defaultValues=t.extend(!0,{},o.defaultValues||{},this.options.defaultValues||{})},n.prototype.updateControls=function(e,i,o){e=e||this._lastData||{},i=i||{},o=o||[];var n=this,r=this.$toolControl;r&&r.find(".controls-value-item").each(function(s,a){var h=t(a),l=h.is("input, select, textarea"),c=h.data("name"),u=n._defaultOptions.defaultValues[c],p=i[c],d=-1!==o.indexOf(c),f=void 0===e[c],g=void 0!==e[c]?e[c]:p||u;d&&(g=""),l&&h.val(g),n._updateClasses(f,f&&g===p,d),r.toggleClass("option-value-invalid",!!f),r.toggleClass("option-value-multiple",!!d),r.toggleClass("option-value-inherited",!(!f||g!==p));var v=(f&&g===p?" option-value-inherited ":"")+(f?" option-value-invalid ":"")+(d?" option-value-multiple ":"");h.data("comboBox")?h.data("comboBox").updateSelectedValues(g,v):h.trigger("valueChanged",[{value:g,valueName:c,inherited:f||g===p,multipleValues:d,classString:v}]),n.updateSingleControl(c,g)})},n.prototype._updateClasses=function(t,e,i){this.$toolControl.toggleClass("option-value-invalid",!!t),this.$toolControl.toggleClass("option-value-multiple",!!e),this.$toolControl.toggleClass("option-value-inherited",!!i)},n.prototype.updateSingleControl=function(t,e){},n.prototype.setStyles=function(t){t=t||this._lastData||this.getStylesFromControls();var e=this.drawer.fCanvas.getActiveObject();if(e){if(e.selectionEnd===e.selectionStart)this.drawer.setTemporaryStyles(t);else if(this.drawer.setTemporaryStyles(),this.stylesToObject)for(var i in t)e[i]=t[i];else e.setSelectionStyles(t);this._lastData=t,this.focusTextOnChange&&(this.comboBox&&this.comboBox.hideDropdown(),e.hiddenTextarea&&e.hiddenTextarea.focus()),e.canvas.renderAll()}},n.prototype.normalizeValue=function(t,e,i){var o,n=i?void 0:this.options.defaultSize;return o=this.validateValue(t,e)?t:n,this.minValue&&void 0!==this.minValue[e]&&(o=o<this.minValue[e]?this.minValue[e]:o),this.maxValue&&void 0!==this.maxValue[e]&&(o=o>this.maxValue[e]?this.maxValue[e]:o),o},n.prototype._attachEvents=function(){this.$toolControl&&this.$toolControl.on("input change toolbarOptionChange",this.onInputChange.bind(this))},n.prototype.generateControlHtml=function(){var t="";return this.controlTemplate&&(t="function"==typeof this.controlTemplate?this.controlTemplate():this.controlTemplate),t},n.prototype.createControls=function(e,i){this.changeCallback=i;var o=this.generateControlHtml();return this.$toolControl=t(o),e.addControl(this.$toolControl,this.options.buttonOrder),this.setupControl(e,this.$toolControl,i),this._attachEvents(),this.$toolControl},n.prototype.setupControl=function(t,e,i){},n.prototype._collectDefaultOptions=function(e){var i=this.drawer.getPluginConfig("Text");return{predefined:t.extend(!0,{},i.predefined||{}),defaultValues:t.extend(!0,{},i.defaultValues||{})}},n.prototype._onOptionsSetup=function(t,e,i,o){var n,r,s,a;for(n in e=e||{},t=t||{},i=i||{},o.predefined)r=t.predefined&&t.predefined[n],s=i.predefined&&i.predefined[n],a=e.predefined&&e.predefined[n],o.predefined[n]=void 0!==a&&!1!==a?a:void 0!==s&&!1!==s?s:void 0!==r&&!1!==r?r:[];return o},n.prototype.onInputChange=function(t){var e;(e=this.getStylesFromChangeEvent(t))||this.getStylesFromControls(),this.setStyles(e),this._updateClasses()},n.prototype.getStylesFromChangeEvent=function(t){},n.prototype.getStylesFromControls=function(){var e=this,i={},o=this.$toolControl;return o&&o.find("input, select, textarea").each(function(o,n){var r=t(n),s=r.data("name"),a=r.val(),h=e.normalizeValue(a,s);void 0!==s&&void 0!==a&&(i[s]=h)}),this._lastData=i,i},n.prototype.validateValue=function(t,e,i){var o,n=this.onlyPredefined&&this.predefined&&this.predefined[e],r=n&&-1!==this.predefined[e].indexOf(t);switch(this.valueType[e]){case"number":o="number"==typeof(t=parseFloat(t))&&isFinite(t);break;case"string":o="string"==typeof t;break;case"color":var s="string"==typeof t,a=t instanceof fabric.Color;o=i?a:s;break;default:o=void 0!==t}return o=n?o&&r:o},n.prototype.hideControls=function(){this.$toolControl&&this.$toolControl.addClass("hidden")},n.prototype.showControls=function(t,e){if(t){var i=(e=e||this.drawer.fCanvas.getActiveObject()).getSelectionStyles(),o=e.getObjStyles();this.updateControls(i,o)}this.$toolControl&&this.$toolControl.removeClass("hidden")},n.prototype.remove=function(){this.$toolControl&&this.$toolControl.remove()},n.prototype._setGlobalClickHandler=function(){var e=this;t("html").off("click.textOptionTool").on("click.textOptionTool",function(t){e.hideControls()})},e.BaseTextOptionTool=n}(t,e.plugins,e.plugins.BaseToolOptions,e.util),function(t,e,i,o){var n=function(t){if(!t)throw new Error("BaseShape CTOR : drawerInstance is not set!");i.call(this,t),this.drawer=t,this.type="shape",this.objectBaseType="shape",this.toolOptionsList=["color","border","opacity"],this.drawingInProgress=!1,this.onlyOneItem=!0,this.MOUSEMOVE=this.getEventId(["mousemove","touchmove"]),this.MOUSEDOWN=this.getEventId(["mousedown","touchstart"]),this.MOUSEUP=this.getEventId(["mouseup","touchend"])};(n.prototype=Object.create(i.prototype)).constructor=n,n.prototype.minShapeSize=4,n.prototype.minShapeSizeForTouch=15,n.CENTERING_MODE={NORMAL:"normal",FROM_CENTER:"from_center"},n.prototype._setupOptions=function(e,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=t.extend(!0,{},this._defaultOptions||{},r||{},e||{});return o||(this.options=s),s},n.prototype.getEventId=function(t){var e=this;if(t instanceof String&&(t=[t]),t instanceof Array)return t.map(function(t){return t+".drawerTool"+e.btnClass}).join(" ")},n.prototype._activateTool=function(){if(!this.active){i.prototype._activateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : _activateTool() [BaseShape]"),this.drawerInstance.touchDevice||this.showHelpTooltip();var t=this.drawerInstance.fCanvas;t.disableSelection(),t.renderAll(),t.defaultCursor="crosshair",this.setUpHandlers?this.setUpHandlers():this._setUpHandlers()}},n.prototype._setUpHandlers=function(){var e=this,i=this.drawerInstance.fCanvas;t(i.upperCanvasEl).on(e.MOUSEDOWN,function(o){if(e.drawerInstance.log("baseShape","mousedown"),t(i.upperCanvasEl).off(e.MOUSEDOWN),e.drawerInstance.touchDevice||e.removeHelpTooltip(),i.getActiveObject())return!0;if(e.drawingInProgress)return e.finishItemDraw(),!0;e.drawingInProgress=!0,e.drawerInstance.drawingInProgress=!0;var n=e.drawer.fCanvas.getPointer(o,!0);if(!e.createShape)throw new Error("createShape method does not exist",e);e.shape=e.createShape(n.x,n.y),e.drawerInstance.trigger(e.drawerInstance.EVENT_ZOOM_SET),i.add(e.shape),e.drawerInstance.trigger(e.drawerInstance.EVENT_ZOOM_RESTORE),t(document).on(e.MOUSEMOVE,function(t){var o=e.drawer.fCanvas.getPointer(t);if(!e.updateShape)throw new Error("updateShape method does not exist",e);e.updateShape(e.shape,o.x,o.y),i.renderAll()}),t(document).on(e.MOUSEUP,function(){e.drawerInstance.log("baseShape","mouseup");var t=e.drawer.touchDevice?e.minShapeSizeForTouch:e.minShapeSize,i=e.shape.width<t,o=!e.checkOnlyWidth&&e.shape.height<t;if(e.checkOnlyWidthOrHeight?i&&o:i||o)return e.shape.remove(),e.shape=null,e._deactivateTool(),void e._activateTool();e.finishItemDraw(),e.onlyOneItem&&e.drawerInstance.trigger(e.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,e)})})},n.prototype.finishItemDraw=function(){var e=this,i=e.drawerInstance.fCanvas;if(i.defaultCursor="default",this.drawerInstance.touchDevice||e.removeHelpTooltip(),i.deactivateAll(),i.calcOffset(),e.drawingInProgress=!1,o.setTimeout(function(){e.drawerInstance.drawingInProgress=!1}),t(document).off(e.MOUSEMOVE),t(document).off(e.MOUSEUP),this.finishShape&&this.finishShape(this.shape),e.shape){e.shape.width<0&&(e.shape.set("width",-1*e.shape.width),e.shape.set("left",e.shape.left-e.shape.width),e.shape.set("flipX",!0)),e.shape.height<0&&(e.shape.set("height",-1*e.shape.height),e.shape.set("top",e.shape.top-e.shape.height),e.shape.set("flipY",!0));var n=e.shape.clone();e.shape.remove(),e.shape=null,i.deactivateAll(),i.add(n),i.restoreSelection(),i.renderAll(),i.calcOffset(),i.renderAll()}},n.prototype._deactivateTool=function(){this.active&&(i.prototype._deactivateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : _deactivateTool() [BaseShape]"),this.finishItemDraw(),t(this.drawerInstance.fCanvas.upperCanvasEl).off(this.MOUSEDOWN),this.drawerInstance.fCanvas.restoreSelection())},n.prototype.showHelpTooltip=function(){var e=this,i=e.drawerInstance.fCanvas,o="";o=this.helpTooltipText?this.helpTooltipText:e.drawerInstance.t("Click to start drawing a ")+'<i class="fa '+e.faClass+'"></i>',e.cursorTooltip=t('<div class="drawer-tool-mouse-tooltip '+this.btnClass+'">'+o+"</div>"),t("body").append(e.cursorTooltip),t(i.upperCanvasEl).on("mousemove.drawer-tool-mouse-toolip",function(t){e.cursorTooltip.css("left",t.pageX),e.cursorTooltip.css("top",t.pageY)}),t(i.upperCanvasEl).on("mouseleave",function(){e.cursorTooltip.css("opacity",0)}),t(i.upperCanvasEl).on("mouseenter",function(){e.cursorTooltip.css("opacity",1)})},n.prototype.removeHelpTooltip=function(){this.cursorTooltip&&(t("body").off("mousemove.drawer-tool-mouse-toolip"),this.cursorTooltip.fadeOut(),this.cursorTooltip.remove())},e.BaseShape=n}(t,e.plugins,e.plugins.BaseTool,e.util),function(t,e,i,o){var n=o.mouseUp("BaseBrushTimer"),r=o.mouseDown("BaseBrushTimer"),s=function(t){i.call(this,t),this.type="brush",this.brushConstructor=fabric.ErasablePencilBrush};(s.prototype=Object.create(i.prototype)).constructor=s,s.prototype.doNotZoomOnActivate=!0,s.prototype.createButton=function(t){var e=this,i={buttonOrder:this.options.buttonOrder,additionalClass:this.btnClass,iconClass:this.faClass,tooltipText:this.tooltip,clickHandler:function(){var t=e.active?e.drawerInstance.EVENT_DO_DEACTIVATE_TOOL:e.drawerInstance.EVENT_DO_ACTIVATE_TOOL;e.drawerInstance.trigger(t,[e])}};this.$toolButton=t.addButton(i)},s.prototype._activateTool=function(){i.prototype._activateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : activateTool [BaseBrush]");var t=this.drawerInstance.fCanvas;t.freeDrawingCursor="url(/redactor.plugin.drawer/dist/cursor-fa-eraser.cur), default",t.isDrawingMode=!0,this.brush||(this.createBrush?this.brush=this.createBrush():this.brush=new fabric.ErasablePencilBrush(this.drawerInstance.fCanvas)),this.previousBrush=this.drawerInstance.getBrush(),this.drawerInstance.setBrush(this.brush),this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_ACTIVATED,[this]),this.afterActivateTool(),this._attachTimerEvents()},s.prototype._attachTimerEvents=function(){var e=this.drawerInstance.fCanvas.upperCanvasEl,i=t(e);this._removeTimerEvents(),i.on(r,this._onMouseDownTimer.bind(this)),t(window.document).on(n,this._onMouseUpTimer.bind(this))},s.prototype._onMouseDownTimer=function(){this.drawerInstance.isBrushDrawing=!0},s.prototype._onMouseUpTimer=function(){var t=this;o.setTimeout(function(){t.drawerInstance.isBrushDrawing=!1},0)},s.prototype._removeTimerEvents=function(){var e=this.drawerInstance.fCanvas.upperCanvasEl;t(e).off(r),t(window.document).off(n)},s.prototype._deactivateTool=function(){i.prototype._deactivateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : deactivateTool [BaseBrush]"),this.drawerInstance.fCanvas.isDrawingMode=!1,t(this.drawerInstance.fCanvas.upperCanvasEl).off("mousedown.BaseBrush touchstart.BaseBrush"),t(this.drawerInstance.fCanvas.upperCanvasEl).off("mouseup.BaseBrush touchend.BaseBrush"),this._removeTimerEvents(),this.drawerInstance.setBrush(this.previousBrush),this.brush=null,this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_DEACTIVATED,[this]),this.afterDeactivateTool()},s.prototype.afterActivateTool=function(){throw new Error(this.name+" should implement afterActivateTool() method.")},s.prototype.afterDeactivateTool=function(){throw new Error(this.name+" should implement afterDeactivateTool() method.")},e.BaseBrush=s}(t,e.plugins,e.plugins.BaseTool,e.util),function(t,e,i){function o(t){var e=!1;if(t){var i=void 0!==t.naturalWidth&&0!==t.naturalWidth,o=void 0!==t.naturalHeight&&0!==t.naturalHeight;e=i&&o}return e}function n(t){var e="background: url("+t+") !important;background-repeat: no-repeat !important;background-position: center !important;background-size: contain !important;";i.addStyleToStyleSheet(".editable-canvas-not-edited",e,"#canvasInactiveImage",!0)}e.prototype.setInactiveDrawerImage=function(t){if(t){var e="string"==typeof t&&t.length,r=t instanceof Image,s=e||r,a=e?t:t.src;s&&(r&&t.complete&&o(t)?n(a):i.loadImage(a,null,null,!0).then(function(t){o(t)&&n(t.src)}))}}}(0,e.DrawerApi,e.util),function(t,e,i,o,n){var r=n.mouseUp("Eraser"),s=n.mouseDown("Eraser"),a=n.mouseMove("Eraser"),h=function(t,e){i.call(this,t),this.name="Eraser",this.btnClass="btn-eraser",this.faClass="fa-eraser",this.tooltip=t.t("Eraser"),this.separatePathOnShapes=!0,this._defaultOptions={cursorUrl:"none",brushSize:3,useCoordsQueue:!1},this._setupOptions(e),this.toolOptionsList=["brushSize"],this.forceOptionsHide=!0,this.previousColor=null,this.previousBrushSize=null,this.savedBrushSize=this.options.brushSize,this.erasingNow=!1,this.brush=null};(h.prototype=Object.create(i.prototype)).constructor=h,h.prototype.afterActivateTool=function(){var e=this.drawerInstance,i=e.fCanvas;this._previousCursor=e.fCanvas.freeDrawingCursor,e.fCanvas.freeDrawingCursor=this.options.cursorUrl,this.brush=this._createBrush(),e.setBrush(this.brush),e.on(e.EVENT_BRUSH_SIZE_CHANGED,this._updateCursorShapeSize.bind(this)),t(i.upperCanvasEl).on(a,this._onMouseMove.bind(this)),t(i.upperCanvasEl).on(s,this._onMouseDown.bind(this)),t(i.upperCanvasEl).on(r,this._onMouseUp.bind(this)),this._createEraserCursorShape(),t(i.upperCanvasEl).on("mouseenter.EraserCursor",this._showEraserCursorShape.bind(this)),t(i.upperCanvasEl).on("mouseleave.EraserCursor",this._hideEraserCursorShape.bind(this)),i.on("path:created",this._onEraserPathCreated.bind(this))},h.prototype.afterDeactivateTool=function(){var e=this.drawerInstance.fCanvas;this.erasingNow=!1,e.off("path:created"),e.freeDrawingCursor=this._previousCursor,this._removeEraserCursorShape(),t(e.upperCanvasEl).off(a),t(e.upperCanvasEl).off(r),t(e.upperCanvasEl).off(s),t(e.upperCanvasEl).off("mouseenter.EraserCursor"),t(e.upperCanvasEl).off("mouseleave.EraserCursor")},h.prototype._createBrush=function(){var t=new e.EraserBrush(this.drawerInstance.fCanvas);return t.color="#fff",t.opacity=this.drawerInstance.activeOpacity,t.width=this.options.brushSize,t},h.prototype._createEraserCursorShape=function(){var t=this.drawerInstance.getBrushSize()/2;this.eraserCursorShape=new fabric.PCircle({radius:t}),this.drawerInstance.fCanvas.add(this.eraserCursorShape),this.eraserCursorShape.isEraserBrush=!0,this.eraserCursorShape.set("fill","transparent"),this.eraserCursorShape.set("stroke","black"),this.eraserCursorShape.set("strokeWidth",1),this.eraserCursorShape.set("originX","center"),this.eraserCursorShape.set("originY","center"),this._updateCursorShapeSize()},h.prototype._removeEraserCursorShape=function(){this.eraserCursorShape&&(this.eraserCursorShape.remove(),delete this.eraserCursorShape)},h.prototype._showEraserCursorShape=function(){this.eraserCursorShape.set("visible",!0),this.drawerInstance.fCanvas.renderAll()},h.prototype._hideEraserCursorShape=function(){this.eraserCursorShape.set("visible",!1),this.drawerInstance.fCanvas.renderAll()},h.prototype._updateCursorShapeSize=function(){if(this.eraserCursorShape){var t=this.drawerInstance.getBrushSize()/2,e=2*Math.PI*t/20;this.eraserCursorShape.set("radius",t),this.eraserCursorShape.set("strokeDashArray",[e,e])}},h.prototype._onEraserPathCreated=function(t){var e=this.drawerInstance.fCanvas;t.path.set("eraserPath",!0),t.path.set("visible",!0);for(var i=0;i<this.affectedShapes.length;i++){var o=this.affectedShapes[i];delete o.eraserAffected,o.addEraserPath(t.path)}e.renderAll()},h.prototype._affectShapesUnderCoords=function(t,e){var i=this.drawerInstance.fCanvas.getObjects();this.eraserCursorShape._lastCenterPosition={x:t,y:e};for(var o=0;o<i.length;o++){var n=i[o];!n.isErasable||n.eraserAffected||n.isEraserBrush||this._checkObjectIntersection(n,t,e)&&(n.eraserAffected=!0,this.affectedShapes.push(n))}},h.prototype._checkObjectIntersection=function(t,e,i){var o,n,r=this.eraserCursorShape;if(r.intersectsWithObject(t)&&!(o=!t.canvas.isTargetTransparent(t,e,i))){var s=r._lastCenterPosition?e-r._lastCenterPosition.x:void 0,a=r._lastCenterPosition?i-r._lastCenterPosition.y:void 0;r.getPerimeterPoints(s,a).forEach(function(e,i){n||(n=!t.canvas.isTargetTransparent(t,e.x,e.y))})}return o||n},h.prototype._onMouseDown=function(t){var e=3===t.which,i=2===t.which;e||i||(this.affectedShapes=[],this.erasingNow=!0)},h.prototype._onMouseUp=function(){this.erasingNow=!1,this.drawerInstance.fCanvas.renderAll()},h.prototype._onMouseMove=function(t){var e=this.drawer.fCanvas.getPointer(t),i=e.x,o=e.y;this.eraserCursorShape&&(this.eraserCursorShape.set("left",e.x),this.eraserCursorShape.set("top",e.y),this.eraserCursorShape.setCoords(),this.drawerInstance.fCanvas.renderAll()),this.erasingNow&&this.separatePathOnShapes&&this._affectShapesUnderCoords(i,o)},o.Eraser=h}(t,e.brushes,e.plugins.BaseBrush,e.plugins,e.util),function(t){t.EraserBrush=fabric.util.createClass(fabric.PencilBrush,{initialize:function(t){this.callSuper("initialize",t)},_render:function(){this.canvas.fire("pencil:move:before"),this.callSuper("_render"),this.canvas.fire("pencil:move:after")},createPath:function(t){var e=new fabric.EraserPath(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e}})}(e.brushes),e.global,fabric.EraserPath=fabric.util.createClass(fabric.Path,{type:"EraserPath",objectCaching:!1,evented:!1,selectable:!1,initialize:function(t,e){e=e||{},this.polygonOffsetX=e.polygonOffsetX||null,this.polygonOffsetY=e.polygonOffsetY||null,this.callSuper("initialize",t,e)},toString:function(){return"#<fabric.EraserPath ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){var e=fabric.util.object.extend(this.callSuper("toObject",t),{path:this.path.map(function(t){return t.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(e.sourcePath=this.sourcePath),this.transformMatrix&&(e.transformMatrix=this.transformMatrix),this.polygonOffsetX&&this.polygonOffsetY&&(e.polygonOffsetX=this.polygonOffsetX,e.polygonOffsetY=this.polygonOffsetY),e}}),fabric.EraserPath.fromObject=function(t,e){"string"==typeof t.path?fabric.loadSVGFromURL(t.path,function(i){var o=i[0],n=t.path;delete t.path,fabric.util.object.extend(o,t),o.setSourcePath(n),e(o)}):e(new fabric.EraserPath(t.path,t))},fabric.EraserPath.async=!0,function(t,e,i,o){var n=function(t,i){if(e.call(this,t),this.name="SimpleWhiteEraser",this.btnClass="btn-simple-eraser",this.faClass="fa-eraser",this.tooltip=t.t("SimpleWhiteEraser"),this._defaultOptions={brushSize:3,cursorUrl:"eraser"},this._setupOptions(i),"eraser"==this.options.cursorUrl){var n=o.getDrawerFolderUrl();n&&(this.options.cursorUrl="url("+n+"assets/cursor-fa-eraser.cur), default")}this.previousColor=null,this.previousBrushSize=null,this.savedBrushSize=this.options.brushSize};(n.prototype=Object.create(e.prototype)).constructor=n,n.prototype.afterActivateTool=function(){this.previousColor=this.drawerInstance.fCanvas.freeDrawingBrush.color,this.drawerInstance.fCanvas.freeDrawingBrush.color="#fff",this.drawerInstance.fCanvas.freeDrawingBrush.fill="#fff",this.drawerInstance.fCanvas.freeDrawingBrush.opacity=this.drawerInstance.activeOpacity,this._previousCursor=this.drawerInstance.fCanvas.freeDrawingCursor,this.drawerInstance.fCanvas.freeDrawingCursor=this.options.cursorUrl,this.previousBrushSize=this.drawerInstance.freeDrawingBrushSize,this.drawerInstance.setFreeDrawingBrushSize(this.savedBrushSize)},n.prototype.afterDeactivateTool=function(){this.drawerInstance.fCanvas.freeDrawingCursor=this._previousCursor,this.drawerInstance.fCanvas.freeDrawingBrush.color=this.previousColor,this.drawerInstance.fCanvas.freeDrawingBrush.fill=this.previousColor,this.savedBrushSize=this.drawerInstance.freeDrawingBrushSize,this.drawerInstance.setFreeDrawingBrushSize(this.previousBrushSize)},i.SimpleWhiteEraser=n}(0,e.plugins.BaseBrush,e.plugins,e.util),function(t,e,i,o){var n=function(t,i){if(e.call(this,t),this.name="Pencil",this.toolOptionsList=["color","opacity","brushSize"],this.btnClass="btn-pencil",this.faClass="fa-pencil",this.tooltip=t.t("Free drawing mode"),this._defaultOptions={cursorUrl:"pencil",brushSize:2},this._setupOptions(i),"pencil"==this.options.cursorUrl){var n=o.getDrawerFolderUrl();n&&(this.options.cursorUrl="url("+n+"assets/cursor-fa-pencil.cur), default")}};(n.prototype=Object.create(e.prototype)).constructor=n,n.prototype.createBrush=function(){var t=new fabric.ErasablePencilBrush(this.drawerInstance.fCanvas);return t.color=this.drawerInstance.activeColor,t.opacity=this.drawerInstance.activeOpacity,t.width=this.options.brushSize,t},n.prototype.afterActivateTool=function(){var t=this.drawerInstance.fCanvas;this._previousCursor=t.freeDrawingCursor,t.freeDrawingCursor=this.options.cursorUrl},n.prototype.afterDeactivateTool=function(){this.drawerInstance.fCanvas.freeDrawingCursor=this._previousCursor},i.Pencil=n}(0,e.plugins.BaseBrush,e.plugins,e.util),function(t,e){var i=function(t,e){var i=this;t.redactorInstance?(this.drawerInstance=t,this.drawer=t,this.name="DrawerPluginCanvasProperties",this.LOGTAG=i.name,this._setupOptions(e),i.drawerInstance.on(i.drawerInstance.EVENT_CONFIG_TOOLBAR_CREATED,function(e,o){var n=i.drawerInstance.redactorInstance,r='<section id="redactor-drawer-properties"><label class="drawer-properties-size-label">'+t.t("Size (px)")+'</label><input class="drawer-properties-width" type="number" value="'+t.width+'" /><span class="size-separator">x</span><input class="drawer-properties-height" type="number" value="'+t.height+'"/><label class="drawer-properties-align-label">'+t.t("Position")+'</label><select class="drawer-properties-align"><option value="inline">'+t.t("Inline")+'</option><option value="left">'+t.t("Left")+'</option><option value="center">'+t.t("Center")+'</option><option value="right">'+t.t("Right")+'</option><option value="floating">'+t.t("Floating")+'</option></select><span class="group-transparency"><label class="drawer-properties-background">'+t.t("Background")+'</label><input type="checkbox" id="background-transparency" class="background-transparency"/><label for="background-transparency" class="background-transparency">'+t.t("transparent")+"</label></span></section>";n.modal.addTemplate("drawer-properties",r);var s={buttonOrder:9,additionalClass:"btn-canvas-properties",iconClass:"fa-cog",tooltipText:t.t("Canvas properties"),clickHandler:function(){return i.openPopup(),!1}};o.addButton(s)})):console.error("'CanvasProperties' plugin can work only in redactor mode!")};i.prototype._setupOptions=function(e,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=t.extend(!0,{},this._defaultOptions||{},r||{},e||{});return o||(this.options=s),s},i.prototype.openPopup=function(){var e=this,i=e.drawerInstance.redactorInstance,o=e.drawerInstance;e.drawerInstance.$imageElement,i.modal.load("drawer-properties",o.t("Canvas properties"),260),i.modal.createCancelButton(),t(".redactor-modal-close-btn").html(o.t("Cancel"));var n=i.modal.createActionButton(o.t("Save")),r=t("#redactor-drawer-properties"),s=o.getAlign();r.find("select").val(s),r.find(".drawer-properties-width").val(o.width),r.find(".drawer-properties-height").val(o.height),e.currentAlign=s,e.currentHeight=o.height,e.currentWidth=o.width,e.$backgroundTransparencyInput=r.find("input.background-transparency"),e.$backgroundTransparencyInput.attr("checked",o.options.transparentBackground),r.find(".background-transparency").click(function(){var t=e.$backgroundTransparencyInput.attr("checked");e.$backgroundTransparencyInput.attr("checked",!t)}),n.on("click",function(){e.saveProperties()});var a=r.find(".drawer-properties-align");function h(){"floating"==r.find(".drawer-properties-align").val()?r.find(".group-transparency").show():r.find(".group-transparency").hide()}h(),a.change(function(){h()}),i.modal.show(),t(document.body).css("overflow",i.modal.bodyOveflow)},i.prototype.saveProperties=function(){var e=this.drawerInstance.redactorInstance,i=this.drawerInstance,o=this.drawerInstance.getPluginInstance("Fullscreen"),n=t("#redactor-drawer-properties"),r=n.find("input.drawer-properties-width").val(),s=n.find("input.drawer-properties-height").val(),a=n.find("select.drawer-properties-align option:selected").val();this.currentWidth==r&&this.currentHeight==s||(o&&o.isInFullscreenMode()&&o.exitFullscreen(),i.setSize(r,s)),i.options.align=a,this.currentAlign!=a&&(o&&o.isInFullscreenMode()&&o.exitFullscreen(),i.setAlign(a));var h=this.$backgroundTransparencyInput.attr("checked");i.options.transparentBackground=!!h,e.modal.close(),i.onCanvasModified(),i.trigger(i.EVENT_OPTIONS_CHANGED)},e.CanvasProperties=i}(t,e.plugins),function(t,e){var i=function(t,e){this.drawer=t,this.name="CloseButton",this._setupOptions(e),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),t.on(t.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),t.on(t.EVENT_MINIMIZED_TOOLBAR_CREATED,this._bindedOnToolbarCreated)};i.prototype._defaultOptions={buttonOrder:1},i.prototype._setupOptions=function(e,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=t.extend(!0,{},this._defaultOptions||{},r||{},e||{});return o||(this.options=s),s},i.prototype._onToolbarCreated=function(t,e){this.toolbar=e,this.createControls&&this.createControls(e)},i.prototype.createControls=function(t){this._createAndAddButton(t)},i.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},i.prototype._createAndAddButton=function(t){var e={buttonOrder:this.options.buttonOrder,additionalClass:"btn-delete-canvas",iconClass:"fa-times",tooltipText:this.drawer.t("Delete this canvas"),clickHandler:this._onCloseButtonClick.bind(this)};t.addButton(e)},i.prototype._onCloseButtonClick=function(){var t=this.drawer.t("Are you sure want to delete this canvas?");confirm(t)&&this.drawer.destroy()},e.CloseButton=i}(t,e.plugins,e.util),function(t,e,i){var o,n=i.mouseDown("drawerJsCrop"),r=i.mouseUp("drawerJsCrop"),s=i.mouseMove("drawerJsCrop"),a=function(){},h=["Webkit","Moz","ms"],l=document.createElement("div").style;function c(t){if(t in l)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=h.length;i--;)if((t=h[i]+e)in l)return t}o=c("transform"),c("transformOrigin"),c("userSelect");var u=function(e,i,o){return this.name="ImageCropPlugin",this.drawer=e,this.$element=i,this._resetData(),this.options=t.extend(!0,{},this._defaultOptions,o||{}),this._init(),this};u.prototype._defaultOptions={boundary:{},enableExif:!1,minSize:10,enableOrientation:!1,update:a,controlsCss:{},controlsTouchCss:{}},u.prototype.globals={translate:"translate3d"},u.prototype._bind=function(e,o){var n=o&&"function"==typeof o;return this.data="string"==typeof e?{url:e}:t.extend(!0,{},e||{}),this._resetData(),this.successCallback=n?o:this.successCallback||a,this.data&&this.data.newImage&&(this.originalImage=this.data.url,this.prevImages=[]),this.currentImage=this.data.url,this.elements.$fullsizePreview.attr("src",this.data.url),i.loadImage(this.data.url,this.elements.$img.get(0),this.data).then(this.startCropping.bind(this))},u.prototype._getCanvas=function(t){var e=t.points,i=parseInt(e[0],10),o=parseInt(e[1],10),n=parseInt(e[2],10),r=parseInt(e[3],10),s=n-i,a=r-o,h=document.createElement("canvas"),l=h.getContext("2d"),c=s,u=a,p=0,d=0,f=c,g=u,v=t.outputWidth&&t.outputHeight,b=1;return!b&&v&&(f=t.outputWidth,g=t.outputHeight,b=f/c),h.width=f,h.height=g,t.backgroundColor&&(l.fillStyle=t.backgroundColor,l.fillRect(0,0,c,u)),i<0&&(p=Math.abs(i),i=0),o<0&&(d=Math.abs(o),o=0),n>this.originalWidth&&(c=s=this.originalWidth-i),r>this.originalHeight&&(u=a=this.originalHeight-o),1!==b&&(p*=b,d*=b,c*=b,u*=b),l.drawImage(this.elements.$fullsizePreview.get(0),i,o,s,a,p,d,c,u),h},u.prototype._getHtmlResult=function(e){var i=e.points,o=t('<div class="croppie-result">'),n=t("<img>"),r=i[2]-i[0],s=i[3]-i[1];return o.append(n),n.css({left:-1*i[0]+"px",top:-1*i[1]+"px"}),img.src=e.url,o.css({width:r+"px",height:s+"px"}),o},u.prototype._getBase64Result=function(t){return this._getCanvas(t).toDataURL(t.format,t.quality)},u.prototype._getBlobResult=function(t){var e=this;return new Promise(function(i,o){e._getCanvas(t).toBlob(function(t){i(t)},t.format,t.quality)})},u.prototype._get=function(){var t=this.elements.$img.get(0),e=this.elements.$viewport.get(0),i=t.getBoundingClientRect(),o=e.getBoundingClientRect(),n=o.left-i.left,r=o.top-i.top,s=n+o.width,a=r+o.height,h=parseInt(100*this._currentZoom)/100||1;return n=Math.max(0,n/h),r=Math.max(0,r/h),s=Math.max(0,s/h),a=Math.max(0,a/h),{points:[parseFloat(n).toFixed(4),parseFloat(r).toFixed(4),parseFloat(s).toFixed(4),parseFloat(a).toFixed(4)],zoom:h}};var p={type:"canvas",format:"png",quality:1},d=["jpeg","webp","png"];u.prototype._result=function(e){var i=this,o=this._get(),n=t.extend(!0,{},p,e||{}),r="string"==typeof e?e:n.type||"base64",s=n.format,a=n.quality,h=n.backgroundColor;return this.elements.$viewport.get(0).getBoundingClientRect(),d.indexOf(s)>-1&&(o.format="image/"+s,o.quality=a),o.url=this.data.url,o.backgroundColor=h,new Promise(function(t,e){switch(r.toLowerCase()){case"rawcanvas":t(i._getCanvas(o));break;case"canvas":case"base64":t(i._getBase64Result(o));break;case"blob":i._getBlobResult(o).then(t);break;default:t(i._getHtmlResult(o))}})},u.prototype.getExifOrientation=function(t,e){window.EXIF||e(0),EXIF.getData(t,function(){var t=EXIF.getTag(this,"Orientation");e(t)})},u.prototype.drawCanvas=function(t,e,i){var o=e.width,n=e.height,r=t.getContext("2d");switch(t.width=e.width,t.height=e.height,r.save(),i){case 2:r.translate(o,0),r.scale(-1,1);break;case 3:r.translate(o,n),r.rotate(180*Math.PI/180);break;case 4:r.translate(0,n),r.scale(1,-1);break;case 5:t.width=n,t.height=o,r.rotate(90*Math.PI/180),r.scale(1,-1);break;case 6:t.width=n,t.height=o,r.rotate(90*Math.PI/180),r.translate(0,-n);break;case 7:t.width=n,t.height=o,r.rotate(-90*Math.PI/180),r.translate(-o,n),r.scale(1,-1);break;case 8:t.width=n,t.height=o,r.translate(0,o),r.rotate(-90*Math.PI/180)}r.drawImage(e,0,0,o,n),r.restore()},u.prototype._transferImageToCanvas=function(t){t=this.options.enableOrientation&&t;var e=this.elements.$canvas.get(0),i=this.elements.$img.get(0),o=e.get(0).getContext("2d"),n=this.options.enableExif&&window.EXIF;o.clearRect(0,0,e.width,e.height),e.width=i.width,e.height=i.height,n?this.getExifOrientation(i,function(o){this.drawCanvas(e,i,parseInt(o,10)),t&&this.drawCanvas(e,i,t)}):t&&this.drawCanvas(e,i,t)},u.prototype._onCropSuccess=function(t){this.success(t)},u.prototype.success=function(t){this.successCallback&&this.successCallback(t)},u.prototype._resetData=function(){this.weight=0,this.originalWidth=null,this.originalHeight=null,this.actualWidth=null,this.actualHeight=null,this.croppedWidth=null,this.croppedHeight=null,this.croppedLeft=null,this.croppedTop=null},u.prototype._destroy=function(){},u.prototype._updateViewportSizes=function(){var t=this.elements.$img.get(0).getBoundingClientRect(),e=this.elements.$img.parent().get(0).getBoundingClientRect(),i=t&&e&&t.left-e.left,o=t&&e&&t.top-e.top,n=t&&t.width||this.originalWidth,r=t&&t.height||this.originalHeight;this.actualWidth=n,this.actualHeight=r,this.offsetLeft=i,this.offsetTop=o,this._currentZoom=parseInt(this.actualWidth/this.originalWidth*100)/100},u.prototype._refreshViewportPosition=function(t){this._updateViewportSizes();var e={width:this.croppedWidth?this.croppedWidth:this.actualWidth,height:this.croppedHeight?this.croppedHeight:this.actualHeight,"max-width":this.actualWidth,"max-height":this.actualHeight,left:this.croppedLeft?this.croppedLeft:this.offsetLeft||0,top:this.croppedTop?this.croppedTop:this.offsetTop||0};t?this.elements.$viewport.attr("style",t):this.elements.$viewport.css(e)},u.prototype.undoCrop=function(){var t=this.prevImages.pop();t&&this._bind(t)},u.prototype._setupCropElements=function(){var e,o=i.getDrawerFolderUrl()+"assets/",n='style="background: url('+o+'border.gif);"';e='<div class="imager-crop-container"><div class="crop-corner crop-top-left"></div><div class="crop-corner crop-top-right"></div><div class="crop-corner crop-bottom-right"></div><div class="crop-corner crop-bottom-left"></div><div class="crop-border crop-border-top" '+n+'></div><div class="crop-border crop-border-right" '+n+'></div><div class="crop-border crop-border-bottom" '+n+'></div><div class="crop-border crop-border-left" '+n+"></div></div>",this.elements=this.elements||{},this.elements.$viewport=t(e),this.elements.$img=t('<img class="cr-image">'),this.elements.$fullsizePreview=t('<img class="cr-image-fullsize">'),this.elements.$overlay=t('<div class="cr-overlay">'),this.elements.$preview=this.elements.$img,this.$element.append(this.elements.$fullsizePreview),this.$element.append(this.elements.$preview),this.$element.append(this.elements.$overlay),this.$element.append(this.elements.$viewport)},u.prototype._init=function(){this._setupCropElements()},u.prototype._save=function(){this.prevImages.push({viewportStyleAttr:this.elements.$viewport.attr("style"),points:this._get(),url:this.currentImage})},u.prototype.applyCrop=function(t){var e=this;e._result().then(function(i){t?(e._save(),e._bind(i)):e._onCropSuccess(i)})},u.prototype.startCropping=function(e){var o=this;e.style.opacity=1,o.enableRendering=!1,o.renderCropped=!1;var a=t("body");o.originalWidth=e.naturalWidth,o.originalHeight=e.naturalHeight,o.makePreview(),o._refreshViewportPosition(o.data&&o.data.viewportStyleAttr),o.viewportStyleAttr=!1;var h=o.elements.$viewport.find(".crop-corner");o.drawer.touchDevice?h.css(o.options.controlsTouchCss):h.css(o.options.controlsCss),h.on(n,function(e){var n=this.getBoundingClientRect().width/2;o.drawer.croppingNow=!0;var h=i.getEventPosition(e),l=o.elements.$viewport.get(0).getBoundingClientRect(),c=o.elements.$viewport.parent().get(0).getBoundingClientRect(),u=l.left-c.left,p=l.top-c.top,d=l.width,f=l.height,g=t(this).hasClass("crop-top-left"),v=t(this).hasClass("crop-top-right"),b=t(this).hasClass("crop-bottom-left"),m=t(this).hasClass("crop-bottom-right");a.on(s,function(t){var e=i.getEventPosition(t),r=e.left-h.left,s=e.top-h.top;return g&&(o.croppedLeft=u+r,o.croppedTop=p+s,o.croppedWidth=d-r,o.croppedHeight=f-s),v&&(o.croppedLeft=u,o.croppedTop=p+s,o.croppedWidth=d- -1*r,o.croppedHeight=f-s),m&&(o.croppedLeft=u,o.croppedTop=p,o.croppedWidth=d- -1*r,o.croppedHeight=f+s),b&&(o.croppedLeft=u+r,o.croppedTop=p,o.croppedWidth=d-r,o.croppedHeight=f+s),o.croppedLeft<o.offsetLeft&&(o.croppedLeft=o.offsetLeft),o.croppedLeft+n>o.offsetLeft+o.actualWidth&&(o.croppedLeft=o.offsetLeft+o.actualWidth-o.options.minSize,o.croppedWidth=o.options.minSize),o.croppedTop<o.offsetTop&&(o.croppedTop=o.offsetTop),o.croppedTop+n>o.offsetTop+o.actualHeight&&(o.croppedTop=o.offsetTop+o.actualHeight-o.options.minSize,o.croppedHeight=o.options.minSize),o.croppedLeft+o.croppedWidth>o.actualWidth+o.offsetLeft&&(o.croppedWidth=o.actualWidth-o.croppedLeft+o.offsetLeft),o.croppedTop+o.croppedHeight>o.actualHeight+o.offsetTop&&(o.croppedHeight=o.actualHeight-o.croppedTop+o.offsetTop),o.elements.$viewport.css({left:o.croppedLeft,top:o.croppedTop,width:o.croppedWidth,height:o.croppedHeight}),t.preventDefault(),t.stopPropagation(),!1}),a.on(r,function(){i.setTimeout(function(){o.drawer.croppingNow=!1},50),a.off(s),a.off(r)})})},u.prototype.makePreview=function(e,i){this.$preview=t('<div class="imager-crop-preview-container"><canvas class="imager-crop-preview"></canvas></div>').css("position","absolute").css("top","50px").css({width:e,height:i,position:"absolute",right:"50px",top:"50px"}),this.previewCanvas=this.$preview.find("canvas.imager-crop-preview")[0],this.previewCanvas.__previewCanvas=!0,this.previewCanvas.width=1.5*e,this.previewCanvas.height=1.5*i,t(this.previewCanvas).css({height:"400px"}),this.$element.append(this.$preview)},u.prototype.reset=function(){this.croppedLeft=null,this.croppedTop=null,this.croppedWidth=null,this.croppedHeight=null,this.sizeBeforeCrop=null};var f={translate3d:{suffix:", 0px"},translate:{suffix:""}},g=function(t,e,i){this.x=parseFloat(t),this.y=parseFloat(e),this.scale=parseFloat(i)};g.parse=function(t){if(t){var e=t&&t instanceof jQuery&&t.length,i=t instanceof Node,n=e?t.get(0):i&&t,r=n&&n.style;return r?g.parse(r[o]):t.indexOf("matrix")>-1||t.indexOf("none")>-1?g.fromMatrix(t):g.fromString(t)}},g.fromMatrix=function(t){var e=t.substring(7).split(",");e.length&&"none"!==t||(e=[1,0,0,1,0,0]);var i=parseInt(e[4],10),o=parseInt(e[5],10),n=parseFloat(e[0]);return new g(i,o,n)},g.fromString=function(t){var e=t.split(") "),i=e[0].substring(u.prototype.globals.translate.length+1).split(","),o=e.length>1?e[1].substring(6):1,n=i.length>1?i[0]:0,r=i.length>1?i[1]:0;return new g(n,r,o)},g.prototype.toString=function(){var t=f[u.prototype.globals.translate].suffix||"";return u.prototype.globals.translate+"("+this.x+"px, "+this.y+"px"+t+") scale("+this.scale+")"};e.ImageCropPlugin=u}(t,e.plugins,e.util),function(t,e,i){var o=function(t,e){this.name="ImageCrop",this.drawer=t,this._setupOptions(e),this.drawer.on(this.drawer.BEFORE_CREATE_TOOLBARS,this._init.bind(this)),this.drawer.on(this.drawer.EVENT_IMAGECROP_TOOLBAR_CREATED,this._onToolbarCreated.bind(this)),this.drawer.on(this.drawer.EVENT_IMAGE_CROP,this._onImageCropTrigger.bind(this))};o.prototype._defaultOptions={toolbarState:"hidden"},o.prototype._defaultCropOptions={},o.prototype._init=function(){if(this.enabled=this.drawer.options.enableImageCrop&&e.ImageCropPlugin,this.enabled){var t=this._setupCropOptions();this._removeElements(),this._createElements(),this.cropper=new e.ImageCropPlugin(this.drawer,this.$cropperContainer,t)}},o.prototype._setupOptions=function(e,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=t.extend(!0,{},this._defaultOptions||{},r||{},e||{});return o||(this.options=s),s},o.prototype._onToolbarCreated=function(t,e){this.cropContainerSizesUpdated=!1,this.$toolbar=e.$toolbar,this._resizeCropWrapper(),this._createToolbarButtons(e)},o.prototype._createToolbarButtons=function(t){var e,i,o,n,r={buttonOrder:this.options.buttonOrder,additionalClass:"btn-another-crop",iconClass:"fa-scissors",tooltipText:this.drawer.t("Crop image"),clickHandler:this._onAnotherCropButtonClick.bind(this)},s={buttonOrder:this.options.buttonOrder,additionalClass:"btn-apply-crop",iconClass:"fa-check",tooltipText:this.drawer.t("Apply current image"),clickHandler:this._onApplyCropButtonClick.bind(this)},a={buttonOrder:this.options.buttonOrder,additionalClass:"btn-undo-crop",iconClass:"fa-undo",tooltipText:this.drawer.t("Undo crop"),clickHandler:this._onUndoCropButtonClick.bind(this)},h=(this.options.buttonOrder,this.drawer.t("Use origin image"),this._onUseOriginButtonClick.bind(this),{buttonOrder:this.options.buttonOrder,additionalClass:"btn-cancel-crop",iconClass:"fa-ban",tooltipText:this.drawer.t("Cancel"),clickHandler:this._onCancelCropButtonClick.bind(this)});e=t.addButton(r),i=t.addButton(s),o=t.addButton(a),n=t.addButton(h),this.$anotherCropButton=e,this.$applyButton=i,this.$undoCropButton=o,this.$useOriginButton=void 0,this.$cancelButton=n},o.prototype._onAnotherCropButtonClick=function(){this.cropper.applyCrop(!0),this.$undoCropButton.removeClass("disabled")},o.prototype._onApplyCropButtonClick=function(){this.cropper.applyCrop()},o.prototype._onUndoCropButtonClick=function(){var t=this.cropper;t.prevImages&&t.prevImages.length&&(t.undoCrop(!0),t.prevImages.length||this.$undoCropButton.addClass("disabled"))},o.prototype._onUseOriginButtonClick=function(){var t=this.cropper;t.success(t.originalImage)},o.prototype._onCancelCropButtonClick=function(){this.cropper.success()},o.prototype._resizeCropWrapper=function(){var t=this.drawer.toolbars.cropImageToolbar,e=t&&t.$toolbar&&t.$toolbar.height(),i=this.cropper&&this.cropper.$element;i&&i.css("top",e||0),e&&e>0&&(this.cropContainerSizesUpdated=!0)},o.prototype._getCropCallback=function(t){var e=this;return function(i){t&&"function"==typeof t&&t(i),e.hideCropper(),e.hideCropToolbar(),e.cropper.reset()}},o.prototype._onImageCropTrigger=function(t,e){if(this.enabled){var i=e&&e.url;if(e.newImage=!0,i){var o=this._getCropCallback(e.callback);this.showCropToolbar(),this.showCropper(),this.cropper._bind(e,o)}}},o.prototype._setupCropOptions=function(e){var i={};t.extend(!0,i,this._defaultCropOptions,e||{}),this.cropOptions=i},o.prototype._createElements=function(){var e=t('<div class="image-crop-wrapper hidden"></div>');this.drawer.$canvasEditContainer.append(e),this.drawer.$cropperContainer=e,this.$cropperContainer=e},o.prototype._removeElements=function(){this.$cropperContainer&&(this.$cropperContainer.remove(),delete this.$cropperContainer),this.drawer.$cropperContainer&&delete this.drawer.$cropperContainer,this.cropper&&(this.cropper._destroy(),delete this.cropper)},o.prototype.showCropToolbar=function(){this.$undoCropButton.addClass("disabled"),this.drawer.trigger(this.drawer.EVENT_RESIZER_HIDE),this.drawer.trigger(this.drawer.EVENT_TOOLBAR_CHANGE_STATE,[{excludeElements:this.$toolbar,state:this.options.toolbarState,turnOn:!0}]),this.drawer.trigger(this.drawer.EVENT_OVERCANVAS_BUTTON_HIDE,[!0]),this.drawer.toolbars.cropImageToolbar.showToolbar(),this.cropContainerSizesUpdated||this._resizeCropWrapper()},o.prototype.hideCropToolbar=function(){this.drawer.toolbars.cropImageToolbar.hideToolbar(),this.drawer.trigger(this.drawer.EVENT_RESIZER_SHOW),this.drawer.trigger(this.drawer.EVENT_TOOLBAR_CLEAR_STATE),this.drawer.trigger(this.drawer.EVENT_OVERCANVAS_BUTTON_SHOW)},o.prototype.showCropper=function(){this.$cropperContainer&&this.$cropperContainer.length&&this.$cropperContainer.removeClass("hidden")},o.prototype.hideCropper=function(){this.$cropperContainer&&this.$cropperContainer.length&&this.$cropperContainer.addClass("hidden")},e.ImageCrop=o}(t,e.plugins,e.util),function(t,e,i){var o=i.mouseDown("MovableFloatingMode"),n=i.mouseMove("MovableFloatingMode"),r=i.mouseUp("MovableFloatingMode"),s=function(t,e){this.drawer=t,this._setupOptions(e),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),t.on(t.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),t.on(t.EVENT_MINIMIZED_TOOLBAR_CREATED,this._bindedOnToolbarCreated),t.options.align&&"floating"!==t.options.align&&console.warn("MovableFloatingMode plugin: options.align is set and it is not 'floating', so canvas will not move. Please use MovableFloatingMode plugin with 'floating' align"),t.options.align||(t.options.align="floating"),this.drawer.on(this.drawer.EVENT_CANVAS_READY,this.onOptionsChanged.bind(this)),this.drawer.on(this.drawer.EVENT_OPTIONS_CHANGED,this.onOptionsChanged.bind(this))};s.prototype._setupOptions=function(e,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=t.extend(!0,{},this._defaultOptions||{},r||{},e||{});return o||(this.options=s),s},s.prototype._onToolbarCreated=function(t,e){this.toolbar=e,this.createControls(e)},s.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&(this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),this.drawer.off(this.drawer.EVENT_MINIMIZED_TOOLBAR_CREATED,this._bindedOnToolbarCreated))},s.prototype.createControls=function(t){this.makeMoveButton(t)},s.prototype.makeMoveButton=function(t){var e={buttonOrder:this.options.buttonOrder,additionalClass:"btn-move",iconClass:"fa-arrows",tooltipText:this.drawer.t("Move canvas")},i=t.addButton(e);this.$moveButton=i,this.$moveButton.on(o,this.buttonOnMouseDown.bind(this))},s.prototype.buttonOnMouseDown=function(e){e.type.indexOf("touch")>-1&&(e=e.originalEvent),t(".tooltip-btn-move").css("display","none"),this.startLeft=0|this.drawer.$imageElement.css("left").replace("px",""),this.startTop=0|this.drawer.$imageElement.css("top").replace("px",""),this.mouseStartLeft=e.pageX,this.mouseStartTop=e.pageY;var i=t("body"),o=t(window.document);return i.addClass("drawer-moving"),o.on(n,this.buttonOnMouseMove.bind(this)),o.on(r,this.buttonOnMouseUp.bind(this)),!1},s.prototype.buttonOnMouseMove=function(t){var e=this,o=i.getEventPosition(t);return i.requestAnimationFrame(function(){e.moveDrawer(o.left,o.top)}),t.preventDefault(),t.stopPropagation(),!1},s.prototype.buttonOnMouseUp=function(e){t(".tooltip-btn-move").css("display","block");var i=t("body"),o=t(window.document);return i.removeClass("drawer-moving"),o.off(n),o.off(r),!1},s.prototype.moveDrawer=function(t,e){var i=t-this.mouseStartLeft,o=e-this.mouseStartTop,n=this.startLeft+i,r=this.startTop+o;n=n<0?0:n,r=r<0?0:r;var s=this.drawer;s.$imageElement.css({left:n,top:r}),s.updateAligmentCss(),s.adjustEditContainer(!1,!0)},s.prototype.onOptionsChanged=function(){var t;try{t=this.drawer.getPluginInstance("Fullscreen")}catch(t){}t&&t.isInFullscreenMode()||"floating"!=this.drawer.options.align?this.hideMoveButton():this.showMoveButton()},s.prototype.showMoveButton=function(){this.$moveButton?this.$moveButton.show():console.warn("MovableFloatingMode.removeMoveButton() : no button 'Move' present")},s.prototype.hideMoveButton=function(){this.$moveButton?this.$moveButton.hide():console.warn("MovableFloatingMode.removeMoveButton() : no button 'Move' present")},e.MovableFloatingMode=s}(t,e.plugins,e.util),function(t,e,i,o){var n=function(t,e){this.name="MinimizeButton",this.drawer=t,this._setupOptions(e),t.on(t.EVENT_CONFIG_TOOLBAR_CREATED,this._onConfigToolbarCreated.bind(this)),t.on(t.EVENT_MINIMIZED_TOOLBAR_CREATED,this._onMinimizedToolbarCreated.bind(this))};n.prototype._setupOptions=function(e,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=t.extend(!0,{},this._defaultOptions||{},r||{},e||{});return o||(this.options=s),s},n.prototype._onConfigToolbarCreated=function(t,e){this._createAndAddButton_minimize(e)},n.prototype._onMinimizedToolbarCreated=function(e,i){var o=this.drawer.options.captionText,n=t('<li class="canvas-caption">'+o+"</li>");i.$toolbar.find(".toolbar-content-wrapper").prepend(n),this._createAndAddButton_restore(i)},n.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},n.prototype.minimizeCanvas=function(){var t=this.drawer.$canvasEditContainer,e=t.hasClass("animated");t.removeClass("animated"),t.addClass("minimized"),i.setTimeout(function(){t.toggleClass("animated",!!e)},0)},n.prototype.restoreCanvas=function(){var t=this.drawer.$canvasEditContainer,e=t.hasClass("animated");t.removeClass("animated"),t.removeClass("minimized"),i.setTimeout(function(){t.toggleClass("animated",!!e)},0)},n.prototype._createAndAddButton_restore=function(t){var e={buttonOrder:this.options.buttonOrder,additionalClass:"btn-restore-canvas",iconClass:"fa-expand",tooltipText:this.drawer.t("Restore canvas"),clickHandler:this._onRestoreSizeButtonClick.bind(this)},i=t.addButton(e);this.$restoreButton=i},n.prototype._createAndAddButton_minimize=function(t){var e={buttonOrder:this.options.buttonOrder,additionalClass:"btn-minimize-canvas",iconClass:"fa-compress",tooltipText:this.drawer.t("Minimize canvas"),clickHandler:this._onMinimizeButtonClick.bind(this)},i=t.addButton(e);this.$minimizeButton=i},n.prototype._onMinimizeButtonClick=function(){this.minimizeCanvas()},n.prototype._onRestoreSizeButtonClick=function(){this.restoreCanvas()},o.prototype.minimizeCanvas=function(){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("MinimizeButton").minimizeCanvas()},o.prototype.restoreCanvas=function(){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("MinimizeButton").restoreCanvas()},e.MinimizeButton=n}(t,e.plugins,e.util,e.DrawerApi),function(t,e,i){var o=function(t){this.drawerInstance=t,this.LOGTAG=this.name,this._attachDrawerEvents()};o.prototype.drawerInstance=null,o.prototype.namespace="OvercanvasPopup",o.prototype.name="DrawerPluginOvercanvasPopup",o.prototype.popupClass="popup-wrapper",o.prototype.defaultPosition="bottom",o.prototype.positions=["bottom","left","right","top"],o.prototype.toolbarBehavior="overlay",o.prototype._attachDrawerEvents=function(){this.drawerInstance.on(this.drawerInstance.BEFORE_CREATE_TOOLBARS,this._onBeforeCreateToolbars.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_OVERCANVAS_POPUP_SHOW,this.showPopup.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_OVERCANVAS_POPUP_HIDE,this.hidePopup.bind(this))},o.prototype._onBeforeCreateToolbars=function(){this._createHelperElements(),this._attachHelperEvents()},o.prototype._attachHelperEvents=function(){var e=this.$popup.find(".popup-close-btn"),o=this.$popup.find(".popup-overlay"),n=t("body");i.bindClick(e,this.namespace,this._triggerPopupHide.bind(this)),i.bindClick(o,this.namespace,this._triggerPopupHide.bind(this)),i.bindClick(n,this.namespace,this._onBodyClick.bind(this))},o.prototype._triggerPopupHide=function(){this.drawerInstance.trigger(this.drawerInstance.EVENT_OVERCANVAS_POPUP_HIDE)},o.prototype._triggerPopupShow=function(){this.drawerInstance.trigger(this.drawerInstance.EVENT_OVERCANVAS_POPUP_SHOW)},o.prototype._onBodyClick=function(t){if(this.popupIsVisible){var e=this.$button&&this.$button.length&&(t.target===this.$button.get(0)||this.$button.find(t.target).length),i=t.target===this.$popup.get(0)||this.$popup.find(t.target).length;e||i||this.drawerInstance.trigger(this.drawerInstance.EVENT_OVERCANVAS_POPUP_HIDE)}},o.prototype._createHelperElements=function(){this._removeHelperElements();var e='<div class="'+this.popupClass+' hidden"><div class="popup-content-wrapper"><div class="popup-arrow"></div><div class="popup-content"></div></div><div class="popup-overlay"></div><div class="popup-close-btn"><div class="fa fa-close"></div></div></div>',i=t(e);this.drawerInstance.$canvasEditContainer.append(i),this.drawerInstance.$popupWrapper=i,this.$popup=i,this.$arrow=i.find(".popup-arrow"),this.$popupContentWrapper=i.find(".popup-content-wrapper")},o.prototype._removeHelperElements=function(){this.drawerInstance.$popupWrapper&&this.drawerInstance.$popupWrapper.length&&this.drawerInstance.$popupWrapper.remove();var t=this.drawerInstance.$canvasEditContainer.find("."+this.popupClass);t&&t.length&&t.remove(),this.drawerInstance.$popupWrapper=void 0,this.$popup=void 0},o.prototype._getAvailableSpace=function(t){var e;if(t&&t.length){var i=this.drawerInstance.$canvasEditContainer.get(0).getBoundingClientRect(),o=t.get(0).getBoundingClientRect(),n=this.$popupContentWrapper.get(0).getBoundingClientRect(),r=o.left-i.left,s=o.top-i.top;(e={}).top=s,e.left=r,e.right=i.width-r-o.width,e.bottom=i.height-s-o.height,e.centerX=r+o.width/2,e.centerY=s+o.height/2,e.popup={arrowSize:10,top:n.height,bottom:n.height,left:n.width,right:n.width},e.popupSizes=n,e.canvasSizes=i,e.triggerSizes=o}return this.sizes=e,e},o.prototype._movePopup=function(t){var e,i,o,n,r=this.sizes,s={},a=r.popupSizes.width/2,h=r.popupSizes.height/2;switch(t){case"left":i=r.left-r.popupSizes.width-r.popup.arrowSize,o=r.centerY-r.popupSizes.height/2;break;case"right":i=r.canvasSizes.width-r.right+r.popup.arrowSize,o=r.centerY-r.popupSizes.height/2;break;case"top":e=!0,i=r.centerX-r.popupSizes.width/2,o=r.top-r.popupSizes.height-r.popup.arrowSize;break;case"bottom":e=!0,i=r.centerX-r.popupSizes.width/2,o=r.canvasSizes.height-r.bottom+r.popup.arrowSize}e?(s.top=o,(n=i+r.popupSizes.width-r.canvasSizes.width)>0?(a+=n,s.right=0):(i<0&&(a+=i,i=0),s.left=i)):(s.left=i,(n=o+r.popupSizes.height-r.canvasSizes.height)>0?(h+=n,s.bottom=0):(o<0&&(h+=o,o=0),s.top=o)),this.$popupContentWrapper.attr("data-position",t),this.$popupContentWrapper.removeAttr("style"),this.$popupContentWrapper.css(s),this._moveArrow(a,h)},o.prototype._moveArrow=function(t,e){this.$arrow.css({left:t,top:e})},o.prototype._adjustPosition=function(t){var e,i=this._getAvailableSpace(t);this.positions.forEach(function(t,o){var n=i[t]&&i.popup[t];if(!e&&n){var r=i.popup[t]+i.popup.arrowSize,s=i[t]-r>0;e=s&&t}}),e&&this._movePopup(e)},o.prototype.showPopup=function(e,i){this.popupIsVisible=!0,this.$popup.removeClass("hidden"),this._adjustPosition(i),this.$popupContentWrapper.removeClass("popup-transparent"),this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOLBAR_CHANGE_STATE,[{excludeElements:t().add(this.$popup).add(i),turnOn:!0,state:this.toolbarBehavior}])},o.prototype.hidePopup=function(){this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOLBAR_CLEAR_STATE),this.popupIsVisible=!1,this.$popup.addClass("hidden"),this.$popupContentWrapper.addClass("popup-transparent")},e.OvercanvasPopup=o}(t,e.plugins,e.util),function(t,e,i){var o=i.mouseUp("OpenPopupButton"),n=i.mouseDown("OpenPopupButton"),r=i.mouseMove("OpenPopupButton"),s=function(t,e){this.drawer=t,this._setupOptions(e),t.on(t.EVENT_OPTIONS_TOOLBAR_CREATED,this._onToolbarCreated.bind(this)),t.on(t.EVENT_FLOATING_TOOLBAR_CREATED,this._init.bind(this))};s.prototype._setupOptions=function(e,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=t.extend(!0,{},this._defaultOptions||{},r||{},e||{});return o||(this.options=s),s},s.prototype._init=function(t,e){this.needToInitButton&&(this.createControls(e),this.drawer.off(this.drawer.EVENT_OBJECT_SELECTED,this._onObjectSelected.bind(this)),this.drawer.on(this.drawer.EVENT_OBJECT_SELECTED,this._onObjectSelected.bind(this)),this.drawer.off(this.drawer.EVENT_SELECTION_CLEARED,this._onSelectionCleared.bind(this)),this.drawer.on(this.drawer.EVENT_SELECTION_CLEARED,this._onSelectionCleared.bind(this)),this.drawer.off(this.drawer.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),this.drawer.on(this.drawer.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),this.drawer.off(this.drawer.EVENT_DO_DEACTIVATE_TOOL,this._onDeactivateTool.bind(this)),this.drawer.on(this.drawer.EVENT_DO_DEACTIVATE_TOOL,this._onDeactivateTool.bind(this)),this.drawer.off(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS,this._onDeactivateAllTools.bind(this)),this.drawer.on(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS,this._onDeactivateAllTools.bind(this)),this.drawer.off(this.drawer.EVENT_CANVAS_START_RESIZE,this.hideButton.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_START_RESIZE,this.hideButton.bind(this)),this.drawer.off(this.drawer.EVENT_CANVAS_STOP_RESIZE,this.refreshPosition.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_STOP_RESIZE,this.refreshPosition.bind(this)),this.drawer.off(this.drawer.EVENT_OVERCANVAS_BUTTON_HIDE,this.hideButton.bind(this)),this.drawer.on(this.drawer.EVENT_OVERCANVAS_BUTTON_HIDE,this.hideButton.bind(this)),this.drawer.off(this.drawer.EVENT_OVERCANVAS_BUTTON_SHOW,this.showButton.bind(this)),this.drawer.on(this.drawer.EVENT_OVERCANVAS_BUTTON_SHOW,this.showButton.bind(this)),this.drawer.off(this.drawer.EVENT_IMAGE_CROP,this.hideButton.bind(this)),this.drawer.on(this.drawer.EVENT_IMAGE_CROP,this.hideButton.bind(this)))},s.prototype._onToolbarCreated=function(t,e){this.toolbar=e;var i=e.options.compactType===e.POPUP,o=e.options.hidden,n=i&&!o;this.needToInitButton=n},s.prototype._onObjectSelected=function(t){this.showButton()},s.prototype._onActivateTool=function(t){this.showButton()},s.prototype._onDeactivateTool=function(t){this.hideButton()},s.prototype._onDeactivateAllTools=function(t,e){(!e||!e.beforeActivateTool)&&this.hideButton()},s.prototype._onSelectionCleared=function(t,e){!this.drawer.activeDrawingTool&&this.hideButton()},s.prototype.createControls=function(t){this._createAndAddButton(t),this._setInitialPosition(),this.showButton()},s.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_FLOATING_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},s.prototype._setInitialPosition=function(){var e=0,i=0,o=this.drawer.toolbars.toolbarPlaceholders.inside,n=o&&o.top&&o.top.$element,r=o&&o.left&&o.left.$element;n&&n.length&&n.find("ul.editable-canvas-toolbar:visible").each(function(e,o){var n=t(o);i+=n.height()}),r&&r.length&&r.find("ul.editable-canvas-toolbar:visible").each(function(i,o){var n=t(o);e+=n.width()}),this.positionInitialized=!0,this.moveButton(e,i)},s.prototype.moveButton=function(t,e){this.positionLimit||this.refreshPositionLimits(),t=t>this.positionLimit.left?this.positionLimit.left:t,e=e>this.positionLimit.top?this.positionLimit.top:e,t=t<0?0:t,e=e<0?0:e,this.latestState={left:t||0,top:e||0},this.$button[0].style.left=t+"px",this.$button[0].style.top=e+"px"},s.prototype.refreshPosition=function(){var t=this.latestState&&this.latestState.left||0,e=this.latestState&&this.latestState.top||0;this.showButton(),this.refreshPositionLimits(),this.moveButton(t,e)},s.prototype._createAndAddButton=function(e){var i,s=t("body"),a={buttonOrder:this.options.buttonOrder,additionalClass:"btn-popup-canvas hidden",iconClass:"fa-cogs",tooltipText:this.drawer.t("Open options tools")};i=e.addButton(a),this.$button=i;var h=this.latestState&&this.latestState.left||0,l=this.latestState&&this.latestState.top||0;this.moveButton(h,l),s.off(r).on(r,this._onMouseMove.bind(this)),i.off(n).on(n,this._onMouseDown.bind(this)),s.off(o).on(o,this._onMouseUp.bind(this))},s.prototype._onMouseDown=function(t){var e=this;this.moveNow=!0,this.triggerClick=!0,this.clickPosition=i.getEventPosition(t),this.refreshSizes(),this.refreshPositionLimits(),i.setTimeout(function(){e.triggerClick=!1},200)},s.prototype._onMouseUp=function(t){this.moveNow=!1,this.dragNow=!1,this.clickPosition={};var e=t.target===this.$button.get(0)||this.$button.find(t.target).length;this.$button.removeClass("dragging"),e&&this.triggerClick&&this.drawer.trigger(this.drawer.EVENT_OVERCANVAS_POPUP_SHOW,[this.$button])},s.prototype._onMouseMove=function(t){if(this.moveNow){var e=i.getEventPosition(t),o=this.clickPosition&&this.clickPosition.left===e.left,n=this.clickPosition&&this.clickPosition.top===e.top;if(!o||!n){this.dragNow||(this.$button.addClass("dragging"),this.dragNow=!0),this.latestSizes=this.latestSizes||this.refreshSizes();var r=i.getEventPosition(t),s=this.latestSizes,a=s.canvas,h=r.left-a.left-s.button.width/2-s.scroll.left,l=r.top-a.top-s.button.height/2-s.scroll.top;this.triggerClick=!1,this.moveButton(h,l),t.preventDefault(),t.stopPropagation()}}},s.prototype.refreshSizes=function(){var t={},e=this.drawer.fCanvas.upperCanvasEl.getBoundingClientRect(),o=this.$button[0].getBoundingClientRect();return t.canvas=e,t.button=o,t.scroll=i.getScrollTopFromElement(this.$button),this.latestSizes=t,t},s.prototype.refreshPositionLimits=function(){var t=this.$button.get(0).getBoundingClientRect();this.positionLimit={left:this.drawer.width-t.width-2,top:this.drawer.height-t.height-2}},s.prototype.showButton=function(){this.$button.removeClass("hidden")},s.prototype.hideButton=function(t,e){var i=this.drawer.options.toolbars.popupButtonAlwaysVisible;!e&&i||this.$button.addClass("hidden")},e.OpenPopupButton=s}(t,e.plugins,e.util),function(t,e,i){var o=function(t){this.drawerInstance=t,this.name="DrawerPluginResize",this.LOGTAG=this.name,this.MOUSEDOWN=i.mouseDown("drawerPluginResize"),this.MOUSEUP=i.mouseUp("drawerPluginResize"),this.MOUSEMOVE=i.mouseMove("drawerPluginResize"),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),t.on(this.drawerInstance.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),t.on(this.drawerInstance.EVENT_RESIZER_HIDE,this.resizerHide.bind(this)),t.on(this.drawerInstance.EVENT_RESIZER_SHOW,this.resizerShow.bind(this))};o.prototype._onToolbarCreated=function(){this.createControls()},o.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawerInstance.off(this.drawerInstance.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},o.prototype.createControls=function(){this.deleteControls(),this.appendResizeControl()},o.prototype.deleteControls=function(){this.$canvasResizer&&this.$canvasResizer.length&&this.$canvasResizer.remove()},o.prototype.appendResizeControl=function(){var e=this,o=t(window.document),n=(t("body"),o),r=e.drawerInstance.$canvasEditContainer;this.$canvasResizer=t('<span class="redactor-drawer-resizer"><span class="resizer-box"></span></span>'),this.drawerInstance.touchDevice&&this.$canvasResizer.find(".resizer-box").addClass("touch"),r.append(this.$canvasResizer),this.$canvasResizer.find(".resizer-box").on(this.MOUSEDOWN,function(o){var r=i.getEventPosition(o);e.drawerInstance.log(e.LOGTAG,"resize start"),e.resizeOriginalWidth=e.drawerInstance.width,e.resizeOriginalHeight=e.drawerInstance.height,e.resizeStartX=r.left,e.resizeStartY=r.top;var s=t("body");s.addClass("drawer-resizing"),e.drawerInstance.trigger(e.drawerInstance.EVENT_CANVAS_START_RESIZE),e.drawerInstance.resizingNow=!0,n.on(e.MOUSEMOVE,function(t){t.stopPropagation(),t.preventDefault();var o=i.getEventPosition(t),n=e.resizeStartX-o.left,r=e.resizeStartY-o.top;return i.requestAnimationFrame(function(){e.drawerInstance.setSize(e.resizeOriginalWidth-n,e.resizeOriginalHeight-r),e.drawerInstance.trigger(e.drawerInstance.EVENT_CANVAS_RESIZING)}),!1}),n.on(e.MOUSEUP,function(t){s.removeClass("drawer-resizing"),n.off(e.MOUSEMOVE),n.off(e.MOUSEUP),e.drawerInstance.log(e.LOGTAG,"resize finished by mouseup"),e.resizeFinished()})})},o.prototype.resizerHide=function(){this.$canvasResizer&&this.$canvasResizer.length&&this.$canvasResizer.addClass("hidden")},o.prototype.resizerShow=function(){this.$canvasResizer&&this.$canvasResizer.length&&this.$canvasResizer.removeClass("hidden")},o.prototype.resizeFinished=function(){this.drawerInstance.onCanvasModified(),this.drawerInstance.resizingNow=!1,console.log("[resize]","EVENT_CANVAS_STOP_RESIZE"),this.drawerInstance.trigger(this.drawerInstance.EVENT_CANVAS_STOP_RESIZE)},e.Resize=o}(t,e.plugins,e.util),function(t){t.prototype.contextMenuShow=function(){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("ShapeContextMenu").showContextMenu()},t.prototype.contextMenuHide=function(){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("ShapeContextMenu").hideContextMenu()},t.prototype.contextMenuSetPosition=function(t,e,i){this.drawer.api.checkIsActive();var o=this.drawer.getPluginInstance("ShapeContextMenu");if(i){var n=o._calcCoordsToFitViewport(t,e);t=n.left,e=n.top}o.setMenuPosition(t,e)}}(e.DrawerApi),function(t,e,i){var o=i.mouseDown("ShapeContextMenu"),n=function(e,i){this.drawerInstance=e,this.options=t.extend(!0,{},this._defaultOptions||{},i||{}),this.left=this.top=0,this._bindedOnContextMenu=this._onContextMenu.bind(this),this._bindedSetHandlers=this._setHandlers.bind(this),e.on(e.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedSetHandlers),e.on(e.EVENT_EDIT_STOP,this._onEditStop.bind(this)),e.on(e.EVENT_OBJECT_MOVING,this._onObjectMoved.bind(this))};n.prototype.eventsNamespace="shapeContextMenu",n.prototype._defaultOptions={position:{touch:"shapeRightBottom",mouse:"cursor"}},n.prototype._setHandlers=function(){if(this.options.customMenuRenderer)this.drawerInstance.on(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace,this.options.customMenuRenderer);else{this.drawerInstance.on(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace,this._bindedOnContextMenu);var e=this;i.bindClick(t("body"),"shapeContextMenu",function(){e.hideContextMenu()})}this.drawerInstance.$canvasEditContainer.off(o).on(o,this._onMouseDown.bind(this))},n.prototype._unsetHandlers=function(e){this.options.customMenuRenderer?this.drawerInstance.off(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace):(i.unbindClick(t("body"),"shapeContextMenu"),this.drawerInstance.off(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace),e&&this.drawerInstance.off(this.drawerInstance.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedSetHandlers))},n.prototype.removeTool=function(t){this._unsetHandlers(t)},n.prototype._onObjectMoved=function(){this.objectWasMoved=!0},n.prototype._onEditStop=function(){this._unsetHandlers()},n.prototype._onMouseDown=function(){this.objectWasMoved=!1},n.prototype._onContextMenu=function(t,e){var i=this.drawerInstance.drawingInProgress,o=this.drawerInstance.isBrushDrawing,n=this.objectWasMoved;i||o||n||(e.type.indexOf("touch")>-1&&(e=e.originalEvent),this.handleContextMenuEvent(e))},n.prototype.handleContextMenuEvent=function(e){var i=t(e.target).hasClass("upper-canvas")&&this.drawerInstance.fCanvas.findTarget(e),o=i&&i.isMoving,n=i&&i.__corner;i&&!o&&!n&&(this.drawerInstance.fCanvas.setActiveObject(i),this.showContextMenu(i,e))},n.prototype.showContextMenu=function(e,o){this.hideContextMenu();var n=this.eventsNamespace;this.$contextMenu=t('<ul class="editable-canvas-shape-context-menu"></ul>');var r=t("<li><a>"+this.drawerInstance.t("Bring forward")+"</a></li>");i.bindClick(r.find("a"),n,this._bringObjectForward.bind(this,e)),this.$contextMenu.append(r);var s=t("<li><a>"+this.drawerInstance.t("Send backwards")+"</a></li>");i.bindClick(s.find("a"),n,this._sendObjectBackwards.bind(this,e)),this.$contextMenu.append(s);var a=t("<li><a>"+this.drawerInstance.t("Bring to front")+"</a></li>");i.bindClick(a.find("a"),n,this._bringObjectToFront.bind(this,e)),this.$contextMenu.append(a);var h=t("<li><a>"+this.drawerInstance.t("Send to back")+"</a></li>");i.bindClick(h.find("a"),n,this._sendObjectToBack.bind(this,e)),this.$contextMenu.append(h);var l=t("<li><a>"+this.drawerInstance.t("Duplicate")+"</a></li>");i.bindClick(l.find("a"),n,this._duplicateObject.bind(this,e)),this.$contextMenu.append(l);var c=t("<li><a>"+this.drawerInstance.t("Remove")+"</a></li>");i.bindClick(c.find("a"),n,this._removeObject.bind(this,e)),this.$contextMenu.append(c);var u=20;u=this.drawerInstance.touchDevice?this.drawerInstance.options.toolbarSizeTouch:this.drawerInstance.options.toolbarSize,u/=3,this.$contextMenu.find("li > a").each(function(e,i){t(i).css({"padding-top":u+"px","padding-bottom":u+"px"})}),this.drawerInstance.$canvasEditContainer.append(this.$contextMenu),this._positionMenu(e,i.getEventPosition(o))},n.prototype.hideContextMenu=function(){this.$contextMenu&&this.$contextMenu.remove()},n.prototype.setMenuPosition=function(t,e){this.left=Number(t),this.top=Number(e),this.$contextMenu.css("left",t+"px"),this.$contextMenu.css("top",e+"px")},n.prototype.getMenuPosition=function(){return{left:this.left,top:this.top}},n.prototype._positionMenu=function(e,i){var o=t(this.drawerInstance.fCanvas.upperCanvasEl).offset(),n=0,r=0,s=this.drawerInstance.touchDevice?"touch":"mouse",a=this.options.position[s];"shapeRightBottom"==a?(n=e.left+e.width,r=e.top+e.height):"cursor"==a&&(n=i.left-o.left+10,r=i.top-o.top+10);var h={};n=(h=this.options.customFitViewportMethod?this.options.customFitViewportMethod(n,r):this._calcCoordsToFitViewport(n,r)).left,r=h.top,this.setMenuPosition(n,r)},n.prototype._calcCoordsToFitViewport=function(t,e){t=Number(t),e=Number(e);var i=this.$contextMenu.height(),o=this.drawerInstance.fCanvas.height;e+i>o&&(e=o-i-10);var n=this.$contextMenu.width(),r=this.drawerInstance.fCanvas.width;return t+n>r&&(t=r-n-10),{left:t,top:e}},n.prototype._bringObjectForward=function(t){return this.drawerInstance.api.bringObjectForward(t),this.hideContextMenu(),!1},n.prototype._sendObjectBackwards=function(t){return this.drawerInstance.api.sendObjectBackwards(t),this.hideContextMenu(),!1},n.prototype._bringObjectToFront=function(t){return this.drawerInstance.api.bringObjectToFront(t),this.hideContextMenu(),!1},n.prototype._sendObjectToBack=function(t){return this.drawerInstance.api.sendObjectToBack(t),this.hideContextMenu(),!1},n.prototype._removeObject=function(t){return this.drawerInstance.api.removeObject(t),this.hideContextMenu(),!1},n.prototype._duplicateObject=function(t){return this.drawerInstance.api.duplicateObject(t),this.hideContextMenu(),!1},e.ShapeContextMenu=n}(t,e.plugins,e.util),function(t,e,i){var o=i.mouseUp("ToggleVisibilityButton"),n=i.mouseDown("ToggleVisibilityButton"),r=i.mouseMove("ToggleVisibilityButton"),s=function(t,e){this.drawer=t,this._setupOptions(e),this.drawer.on(this.drawer.EVENT_FLOATING_TOOLBAR_CREATED,this._onToolbarCreated.bind(this))};s.prototype._setupOptions=function(e,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=t.extend(!0,{},this._defaultOptions||{},r||{},e||{});return o||(this.options=s),s},s.prototype._onOverCanvasMode=function(){this.showNextItem(),this.positionInitialized||this._setInitialPosition()},s.prototype._onToolbarCreated=function(t,e){this.toolbar=e,this.checkConfigForButton()&&(this.createControls(e),this._onOverCanvasMode())},s.prototype._checkToolbarForButton=function(t){var e=!1;if(t){var i=t.options.toggleVisibilityButton,o="popup"===t.options.compactType;e=i&&!o}return e},s.prototype.checkConfigForButton=function(){var t=this.drawer.toolbars.drawingToolsToolbar,e=this.drawer.toolbars.toolOptionsToolbar,i=this.drawer.toolbars.settingsToolbar,o=this._checkToolbarForButton(t),n=this._checkToolbarForButton(e),r=this._checkToolbarForButton(i),s=o||n||r,a=[];return o&&a.push(t),n&&a.push(e),r&&a.push(i),this.toolbarsForToggle=a,s},s.prototype.createControls=function(t){this._createAndAddButton(t),this.showButton()},s.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_FLOATING_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},s.prototype.moveButton=function(t,e){this.positionLimit||this.refreshPositionLimits(),t=t>this.positionLimit.left?this.positionLimit.left:t,e=e>this.positionLimit.top?this.positionLimit.top:e,t=t<0?0:t,e=e<0?0:e,this.latestState={left:t||0,top:e||0},this.$button.css({left:t+"px",top:e+"px"})},s.prototype._setInitialPosition=function(){var t=0,e=0,i=this.drawer.toolbars.toolbarPlaceholders.inside,o=i&&i.top&&i.top.$element,n=i&&i.left&&i.left.$element;o&&o.length&&(e+=o.height()),n&&n.length&&(t+=n.width()),this.positionInitialized=!0,this.moveButton(t,e)},s.prototype._createAndAddButton=function(e){var i,s=t("body"),a={buttonOrder:this.options.buttonOrder,additionalClass:"btn-toggle-canvas hidden",iconClass:"fa-eye",tooltipText:this.drawer.t("Toggle toolbar vision")};i=e.addButton(a),this.$button=i;var h=this.latestState&&this.latestState.left||0,l=this.latestState&&this.latestState.top||0;this.moveButton(h,l),s.off(r).on(r,this._onMouseMove.bind(this)),i.off(n).on(n,this._onMouseDown.bind(this)),s.off(o).on(o,this._onMouseUp.bind(this))},s.prototype._onMouseDown=function(t){var e=this;this.moveNow=!0,this.triggerClick=!0,this.refreshSizes(),this.refreshPositionLimits(),i.setTimeout(function(){e.triggerClick=!1},200)},s.prototype._onMouseUp=function(t){var e=this,o=t.target===this.$button.get(0)||this.$button.find(t.target).length;this.moveNow=!1,this.dragNow=!1,this.$button.removeClass("dragging"),o&&this.triggerClick&&!this.touchRightNow&&(this.triggerClick=!1,this.touchRightNow=!0,i.setTimeout(function(){e.touchRightNow=!1},400),this.showNextItem())},s.prototype._onMouseMove=function(t){if(this.moveNow){this.dragNow||(this.$button.addClass("dragging"),this.dragNow=!0),this.latestSizes||this.refreshSizes();var e=i.getEventPosition(t),o=this.latestSizes,n=o.canvas,r=e.left-n.left-o.button.width/2-o.scroll.left,s=e.top-n.top-o.button.height/2-o.scroll.top;this.triggerClick=!1,this.moveButton(r,s),t.preventDefault(),t.stopPropagation()}},s.prototype.refreshSizes=function(){var t={},e=this.drawer.fCanvas.upperCanvasEl.getBoundingClientRect(),o=this.$button[0].getBoundingClientRect();return t.canvas=e,t.button=o,t.scroll=i.getScrollTopFromElement(this.$button),this.latestSizes=t,t},s.prototype.refreshPositionLimits=function(){var t=this.$button.get(0).getBoundingClientRect();this.positionLimit={left:this.drawer.width-t.width-2,top:this.drawer.height-t.height-2}},s.prototype.showButton=function(){this.$button.removeClass("hidden")},s.prototype.hideButton=function(){this.$button.addClass("hidden")},s.prototype.showNextItem=function(){var t,e,i=this,o=this.toolbarsForToggle[0];this.toolbarsForToggle.forEach(function(o,n){if(!o.invisible){var r=n+1;t=!0,e=i.toolbarsForToggle[r]}o.hideToolbar()}),t?e&&e.showToolbar():o.showToolbar()},e.ToggleVisibilityButton=s}(t,e.plugins,e.util),function(t,e,i){var o=t.fabric||(t.fabric={}),n=function(t,e){return this.drawer=t,this.i=0,this.position=new o.Point(0,0),this.zoom=1,this};n.prototype.setViewport=function(t,e,i,o){return this._adjustPosition(t,e,i,o),this._render(),this.getData()},n.prototype.getData=function(){var t={},e=this.getZoomCenter();return t.zoom=this.zoom,t.position={x:this.position.x,y:this.position.y},t.zoomCenterX=e.x,t.zoomCenterY=e.y,t},n.prototype.getZoomCenter=function(){var t={},e=this.drawer.width,i=this.drawer.height,o=e/this.zoom,n=i/this.zoom,r=o/2-this.position.x,s=n/2-this.position.y;return t.x=r,t.y=s,t},n.prototype._validatePosition=function(t,e,i){e=e||0,i=i||0;var o=this.drawer.width,n=this.drawer.height,r=o-o/t,s=n-n/t;return e<-r&&(e=-r),i<-s&&(i=-s),e>0&&(e=0),i>0&&(i=0),{x:e,y:i}},n.prototype.setToCenterOfCanvas=function(t){t=t||this.zoom;var e=this.drawer.width/2,i=this.drawer.height/2;this._adjustPosition(t,e,i,!0),this._render()},n.prototype._render=function(){this.drawer.fCanvas.renderAll()},n.prototype.setPosition=function(t,e,i){t=t||this.zoom;var o=this._validatePosition(t,e,i);this.position.x=o.x,this.position.y=o.y,this.zoom=t},n.prototype._adjustPosition=function(t,e,i,o){this.position.x=this.position.x||0,this.position.y=this.position.y||0;var n,r,s=this.drawer.width,a=this.drawer.height,h=t/this.zoom,l=s/this.zoom,c=a/this.zoom,u=s/t,p=a/t;if(o)n=u/2-e,r=p/2-i;else if(void 0!==e&&void 0!==i){var d=(e-s/2)/this.zoom,f=(i-s/2)/this.zoom;n=this.position.x-d-(l-u)/2,r=this.position.y-f-(c-p)/2}else n=s/2-h*(s/2-this.position.x),r=a/2-h*(a/2-this.position.y);return this.setPosition(t,n,r),this.position},i.ZoomViewport=n}(e.global,0,e.plugins),function(t,e,i,o,n){var r=t.fabric||(t.fabric={}),s=n.mouseDown("Zoom"),a=n.mouseMove("Zoom"),h=n.mouseUp("Zoom"),l=n.checkBrowser("webkit")?"-webkit-":"",c=function(t,e){this.drawer=t,this._setupOptions(e),this._init()};c.prototype._defaultOptions={enabled:!0,enableWhenNoActiveTool:!0,enableButton:!0,showZoomTooltip:!0,enableMove:!0,useWheelEvents:!0,moveCanvasOnWheel:!0,moveCanvasOnWheelStep:0,zoomStep:1.05,defaultZoom:1,maxZoom:32,minZoom:1,buttonOrder:11},c.prototype._init=function(){this.viewport=new i.ZoomViewport(this.drawer),this.enabled=this.options.enabled,this.zoomIsOn=!0,this.currentZoom=1,this._updateProto(),this.enabled&&(this._attachDrawerEvents(),this._updateDrawerValues())},c.prototype._setupOptions=function(t,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=e.extend(!0,{},this._defaultOptions||{},r||{},t||{});return o||(this.options=s),s},c.prototype._updateProto=function(){this.drawer.on(this.drawer.EVENT_CANVAS_READY,this._updateCanvasProto.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_READY,this._updateObjectProto.bind(this))},c.prototype._attachDrawerEvents=function(){this.drawer.on(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._onToolbarCreated.bind(this)),this.drawer.on(this.drawer.EVENT_RESTORE_DEFAULT_ZOOM,this.restoreDefaultZoom.bind(this)),this.drawer.on(this.drawer.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),this.drawer.on(this.drawer.EVENT_DO_DEACTIVATE_TOOL,this._ctxUpperRestore.bind(this)),this.drawer.on(this.drawer.EVENT_BEFORE_RENDER,this._ctxSet.bind(this)),this.drawer.on(this.drawer.EVENT_AFTER_RENDER,this._ctxRestore.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_SET,this._ctxSet.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UNSET,this._ctxUnset.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_RESTORE,this._ctxRestore.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UPPER_SET,this._ctxUpperSet.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UPPER_UNSET,this._ctxUpperUnset.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UPPER_RESTORE,this._ctxUpperRestore.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_START_RESIZE,this._ctxSet.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_STOP_RESIZE,this._ctxRestore.bind(this)),this.drawer.on(this.drawer.EVENT_SELECTION_CLEARED,this._refreshButton.bind(this)),this.drawer.on(this.drawer.EVENT_OBJECT_SELECTED,this._refreshButton.bind(this)),this.drawer.on(this.drawer.EVENT_TOOL_ACTIVATED,this._refreshButton.bind(this)),this.drawer.on(this.drawer.EVENT_TOOL_DEACTIVATED,this._refreshButton.bind(this))},c.prototype._refreshButton=function(t){this._refreshMoveButtonState()},c.prototype._ctxUpperSet=function(t){var e=this.drawer.fCanvas.contextTop;e.save(),e.scale(this.viewport.zoom,this.viewport.zoom),e.translate(this.viewport.position.x,this.viewport.position.y)},c.prototype._ctxUpperUnset=function(t){var e=this.drawer.fCanvas.contextTop;e.save(),e.scale(1/this.viewport.zoom,1/this.viewport.zoom),e.translate(-this.viewport.position.x,-this.viewport.position.y)},c.prototype._ctxUpperRestore=function(t){this.drawer.fCanvas.contextTop.restore()},c.prototype._ctxSet=function(t){var e=this.drawer.fCanvas.contextContainer;e.save(),e.scale(this.viewport.zoom,this.viewport.zoom),e.translate(this.viewport.position.x,this.viewport.position.y)},c.prototype._ctxUnset=function(t){var e=this.drawer.fCanvas.contextContainer;e.save(),e.scale(1/this.viewport.zoom,1/this.viewport.zoom),e.translate(-this.viewport.position.x,-this.viewport.position.y)},c.prototype._ctxRestore=function(t){this.drawer.fCanvas.contextContainer.restore()},c.prototype._onActivateTool=function(t,e){e.doNotZoomOnActivate||this._ctxUpperSet()},c.prototype._onDeactivateTool=function(t,e){e.doNotZoomOnActivate||this._ctxUpperRestore()},c.prototype._onToolbarCreated=function(t,e){this.toolbar=e,this.createControls(e),this._createHelperElements(),this._attachEvents()},c.prototype._removeHelperElements=function(){this.$zoomTooltip&&this.$zoomTooltip.length&&(this.$zoomTooltip.remove(),delete this.$zoomTooltip)},c.prototype._createHelperElements=function(){this._removeHelperElements();var t=e('<div class="zoom-tooltip transparent-tooltip"></div>'),i=this.drawer.$canvasEditContainer;this.$zoomTooltip=t,i.append(t)},c.prototype._attachEvents=function(){var t=this;if(this.options.showZoomTooltip){var e=n.debounce(function(){t.$zoomTooltip.addClass("transparent-tooltip")},1e3);this.drawer.on(this.drawer.EVENT_ZOOM_CHANGE,function(i,o){var n=parseInt(100*o.zoom,10)+"%";t.$zoomTooltip.text(n),t.$zoomTooltip.removeClass("transparent-tooltip"),e()})}this.options.enableButton&&this.drawer.on(this.drawer.EVENT_ZOOM_CHANGE,function(e,i){(1===i.prevValues.zoom&&1!==i.zoom||1===i.zoom&&1!==i.prevValues.zoom)&&t._refreshMoveButtonState()})},c.prototype.createControls=function(t){this._createAndAddButton(t),this._attachWheelEvents(),this._attachMoveEvents(),this._attachTouchEvents()},c.prototype._createAndAddButton=function(t){var e,i,o,n={buttonOrder:this.options.buttonOrder,additionalClass:"btn-zoom-in",iconClass:"fa-search-plus",tooltipText:this.drawer.t("Zoom in"),clickHandler:this._onZoomIn.bind(this)},r={buttonOrder:this.options.buttonOrder,additionalClass:"btn-zoom-out",iconClass:"fa-search-minus",tooltipText:this.drawer.t("Zoom out"),clickHandler:this._onZoomOut.bind(this)},s={buttonOrder:this.options.buttonOrder,additionalClass:"btn-zoom-move",iconClass:"fa-search",tooltipText:this.drawer.t("Move canvas"),clickHandler:this._onMoveButtonClick.bind(this)};e=t.addButton(n),i=t.addButton(r),this.options.enableMove&&this.options.enableButton&&(o=t.addButton(s)),this.toolbar=t,this.$zoomInButton=e,this.$zoomOutButton=i,this.$moveCanvasButton=o},c.prototype._onMoveButtonClick=function(t){this.$moveCanvasButton.hasClass("disabled")||(this.moveButtonIsActive=!this.moveButtonIsActive,this._refreshMoveButtonState(!0))},c.prototype._getZoomPopertiesFromEvent=function(t,e,i){var o,n,r={},s=this.currentZoom*(i?this.options.zoomStep:1/this.options.zoomStep);if(e){var a=this.drawer.getRelativeEventPosition(t,!0),h=a.left/s-this.viewport.position.x,l=a.top/s-this.viewport.position.y,c=h-this.zoomCenterX,u=l-this.zoomCenterY;o=this.zoomCenterX+c*this.options.moveCanvasOnWheelStep,n=this.zoomCenterY+u*this.options.moveCanvasOnWheelStep}else o=this.zoomCenterX,n=this.zoomCenterY;return r.zoom=s,r.zoomCenterX=o,r.zoomCenterY=n,r},c.prototype._onZoomIn=function(t,e){if(this.zoomIsOn){var i=this._getZoomPopertiesFromEvent(t,e,!0);this.setZoom(i.zoom,i.zoomCenterX,i.zoomCenterY,!0)}},c.prototype._onZoomOut=function(t,e){if(this.zoomIsOn){var i=this._getZoomPopertiesFromEvent(t,e,!1);this.setZoom(i.zoom,i.zoomCenterX,i.zoomCenterY,!0)}},c.prototype._attachWheelEvents=function(){if(this.options.useWheelEvents){this.wheelEventsAttached=!0;var t=this.drawer.$canvasEditContainer.find(".canvas-container").get(0);n.addWheelListener(t,this._onWheelEvent.bind(this),!0)}},c.prototype._attachMoveEvents=function(){if(this.options.enableMove){var t=e(window.document);this.drawer.$canvasEditContainer.find(".canvas-container").off(s).on(s,this._moveOnMouseDown.bind(this)),t.off(a).on(a,this._moveOnMouseMove.bind(this)),t.off(h).on(h,this._moveOnMouseUp.bind(this))}},c.prototype._moveOnMouseDown=function(t){var i=this.drawer.fCanvas.getActiveObject(),o=this.drawer.activeDrawingTool,n=this.moveButtonIsActive,r=this.options.enableButton&&n,s=this.options.enableWhenNoActiveTool&&(!this.options.enableButton||r);if(1!==this.currentZoom&&!i&&!o&&(r||s)){var a=this.drawer.getRelativeEventPosition(t);this.drawer.movingNow=!0,this.isMoving=!0,this.moveStartPoint=a,this.moveLastPoint=a;var h=e("body");return this.drawer.fCanvas.defaultCursor=l+"grabbing",this.drawer.fCanvas.setCursor(l+"grabbing"),h.addClass("drawer-dragging drawer-zoom-moving"),t.preventDefault(),t.stopPropagation(),!1}},c.prototype._refreshMoveButtonState=function(t){if(this.savedDefaultCursor=this.savedDefaultCursor||this.drawer.fCanvas.defaultCursor,this.options.enableButton)if(1===this.currentZoom)this.$moveCanvasButton.addClass("disabled"),this.drawer.fCanvas.defaultCursor=this.savedDefaultCursor,this.drawer.fCanvas.setCursor(this.savedDefaultCursor);else{if(!t){var i=this._checkMovePermission(!t);this.moveButtonIsActive=i}this.$moveCanvasButton.removeClass("disabled"),this.moveButtonIsActive?(this._prepareDrawerForZoom(),this.drawer.fCanvas.defaultCursor=l+"grab",this.drawer.fCanvas.setCursor(l+"grab"),e("body").addClass("drawer-zoom-move-available"),this.toolbar.setActiveButton("btn-zoom-move")):(this.drawer.fCanvas.defaultCursor=this.savedDefaultCursor,this.drawer.fCanvas.setCursor(this.savedDefaultCursor),e("body").removeClass("drawer-zoom-move-available"),this.toolbar.clearActiveButton())}else this.drawer.fCanvas.defaultCursor=l+"grab",this.drawer.fCanvas.setCursor(l+"grab"),e("body").addClass("drawer-zoom-move-available")},c.prototype._prepareDrawerForZoom=function(){this.drawer.trigger(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.drawer.fCanvas._clearSelection(),this.drawer.fCanvas.renderAll()},c.prototype._checkMovePermission=function(t){var e=this.drawer.fCanvas.getActiveObject(),i=this.drawer.activeDrawingTool,o=t&&this.moveButtonIsActive;return!e&&!i&&(this.options.enableWhenNoActiveTool||o)},c.prototype._moveOnMouseMove=function(t){if(this.isMoving&&1!==this.currentZoom){var e=this,i=this.drawer.getRelativeEventPosition(t),o=this.moveLastPoint,r=o.left-i.left,s=o.top-i.top,a=this.zoomCenterX+r,h=this.zoomCenterY+s;return this.moveLastPoint=i,n.requestAnimationFrame(function(){e.setZoom(e.currentZoom,a,h,!0)}),t.preventDefault(),t.stopPropagation(),!1}},c.prototype._moveOnMouseUp=function(t){if(this.isMoving){var i=e("body"),o=this;return n.setTimeout(function(){o.drawer.movingNow=!1},0),this.isMoving=!1,this.drawer.fCanvas.defaultCursor=l+"grab",this.drawer.fCanvas.setCursor(l+"grab"),i.removeClass("drawer-dragging drawer-zoom-moving"),t.preventDefault(),t.stopPropagation(),!1}},c.prototype._attachTouchEvents=function(){var t,e,i=this,o=this.drawer.$canvasEditContainer;function r(t,e){return Math.sqrt(Math.pow(t.left-e.left,2)+Math.pow(t.top-e.top,2))}o.off("touchstart.drawerZoom").on("touchstart.drawerZoom",function(o){var n=o.touches?o.touches:o.originalEvent.touches;if(i.zoomIsOn&&n&&n.length>1){var s=getEventPosition(o,0),a=getEventPosition(o,1);s.left&&s.top||(s=getEventPosition(window.event,0),a=getEventPosition(window.event,1)),t=r(s,a),e=t,i._prepareDrawerForZoom()}}),o.off("touchmove.drawerZoom").on("touchmove.drawerZoom",function(t){var s=t.touches?t.touches:t.originalEvent.touches;if(i.zoomIsOn&&s&&s.length>1){var a=n.getEventPosition(t,0),h=n.getEventPosition(t,1);a.left&&a.top||(a=n.getEventPosition(window.event,0),h=n.getEventPosition(window.event,1));var l=r(a,h),c=e<l,u=i.currentZoom*(c?i.options.zoomStep:1/i.options.zoomStep),p=n.getScrollOffset(o),d=o.get(0).getBoundingClientRect(),f=a.left-(a.left-h.left)/2,g=a.top-(a.top-h.top)/2,v=f-d.left-p.left,b=g-d.top-p.top;i.setZoom(u,v,b,!0),e=l,t.stopPropagation(),t.preventDefault()}})},c.prototype._onWheelEvent=function(t){if(this.zoomIsOn){var e=t.deltaY||t.detail||t.wheelDelta;this._prepareDrawerForZoom(),e>0?this._onZoomOut(t,!0):this._onZoomIn(t,!0),t.stopPropagation(),t.preventDefault()}},c.prototype._updateDrawerValues=function(t){t=t||{};var e=this.drawer.width,i=this.drawer.height,o=this.viewport.getZoomCenter();this.zoomCenterX=void 0!==this.zoomCenterX?this.zoomCenterX:o.x,this.zoomCenterY=void 0!==this.zoomCenterY?this.zoomCenterY:o.y;var n=void 0!==t.zoomCenterX?t.zoomCenterX:this.zoomCenterX,r=void 0!==t.zoomCenterY?t.zoomCenterY:this.zoomCenterY,s=t.zoom;"number"==typeof s&&isFinite(s)||"number"==typeof(s=this.currentZoom)&&isFinite(s)||(s=this.options.defaultZoom),n>e&&(n=e),r>i&&(r=e),n<0&&(n=0),r<0&&(r=0),"number"==typeof this.options.minZoom&&(s=Math.max(s,this.options.minZoom)),"number"==typeof this.options.maxZoom&&(s=Math.min(s,this.options.maxZoom)),this.drawer.currentZoom=this.currentZoom=s,this.drawer.zoomCenterX=this.zoomCenterX=n,this.drawer.zoomCenterY=this.zoomCenterY=r},c.prototype.setZoom=function(t,e,i,o){var n,r,s="number"==typeof t&&isFinite(t),a=void 0!==o?o:!this.options.moveCanvasOnWheel;s?(n={zoom:this.currentZoom,zoomCenterX:this.zoomCenterX,zoomCenterY:this.zoomCenterY},this._updateDrawerValues({zoom:t,zoomCenterX:e,zoomCenterY:i}),(r=this.viewport.setViewport(this.currentZoom,this.zoomCenterX,this.zoomCenterY,a)).prevValues=n,this._updateDrawerValues(r),this.drawer.trigger(this.drawer.EVENT_ZOOM_CHANGE,[r])):console.info("invalid zoom value")},c.prototype._updateObjectProto=function(){var t=this,e=(r.Object.prototype._drawControl,r.Object.prototype.drawControls,r.Object.prototype.getPointByOrigin),i=r.Object.prototype._setCornerCoords;r.Object.prototype._setCornerCoords=function(){var e,o=t.viewport,n=o?o.zoom:1;return this.cornerSize=this.cornerSize/n,e=i.apply(this,arguments),this.cornerSize=this.cornerSize*n,e},r.Object.prototype.getPointByOrigin=function(){var i,o=t.viewport,n=o?o.zoom:1;return this.cornerSize=this.cornerSize/n,i=e.apply(this,arguments),this.cornerSize=this.cornerSize*n,i}},c.prototype._updateCanvasProto=function(){var t=this,e=this.drawer.fCanvas,i=e.getPointer,o=e._drawSelection;e.getPointer=function(e,o,r){var s=i.apply(this,arguments);if(!isFinite(s.x)||!isFinite(s.y)){var a=t.drawer.$canvasEditContainer.get(0).getBoundingClientRect(),h=n.getEventPosition(window.event),l=n.getScrollOffset(t.drawer.$canvasEditContainer);s={x:h.left-l.left-a.left,y:h.top-l.top-a.top}}var c=t.viewport.position.x,u=t.viewport.position.y,p=parseInt(s.x/t.viewport.zoom-c,10),d=parseInt(s.y/t.viewport.zoom-u,10);return s.oldX=s.x,s.oldY=s.y,s.newX=p,s.newY=d,s.x=p,s.y=d,s},e._drawSelection=function(){var t;return(t=this.contextTop).save(),t.scale(this.viewport.zoom,this.viewport.zoom),t.translate(this.viewport.position.x,this.viewport.position.y),o.apply(this,arguments),t.restore(),t}},c.prototype.restoreDefaultZoom=function(){var t,e=this.options.defaultZoom,i=this.viewport.getZoomCenter();this.setZoom(e,i.x,i.y,!0),this.viewport.setToCenterOfCanvas(1),t=this.viewport.getData(),this._updateDrawerValues(t)},o.prototype.setZoom=function(t,e,i){var o=this.drawer.getPluginInstance("Zoom");o&&o.setZoom(t,e,i,!0)},o.prototype.restoreDefaultZoom=function(){var t=this.drawer.getPluginInstance("Zoom");t&&t.restoreDefaultZoom()},i.Zoom=c}(e.global,t,e.plugins,e.DrawerApi,e.util),function(t,e,i){var o=function(t){i.call(this,t),this.name="BrushSize",this.optionName="brushSize",this.$sizeControl=null,t.on(t.EVENT_BRUSH_SIZE_CHANGED,this.updateValue.bind(this)),t.on(t.EVENT_BRUSH_CHANGED,this.updateValue.bind(this))};(o.prototype=Object.create(i.prototype)).constructor=i,o.prototype.createControls=function(t){this.createSizeControl(t)},o.prototype.removeTool=function(t){this.$sizeControl.remove(),t&&this.drawer.off(this.drawer.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},o.prototype.createSizeControl=function(e){var i=this;i.$sizeControl=t('<li style="display:none" class="editable-canvas-brushsize toolbar-item-range"><div class="toolbar-item-description"><span class="toolbar-label">'+this.drawer.t("Size:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-brushsize-indicator">0px</span></div><input class="editable-canvas-brushsize-input" type="range" name="drawer-size" min="1"value="0" /></li>'),e.addControl(i.$sizeControl,this.options.buttonOrder),t(i.$sizeControl).on("change",function(){var e=t(i.$sizeControl).find("input").val();t(i.$sizeControl).find(".editable-canvas-brushsize-indicator").text(e+"px"),i.drawer.setBrushSize(e)})},o.prototype.showControls=function(){this.updateValue(),this.$sizeControl.show()},o.prototype.hideControls=function(){this.$sizeControl.hide()},o.prototype.updateValue=function(){var t=this.drawer.getBrushSize();this.$sizeControl.find("input").val(t),this.$sizeControl.find(".editable-canvas-brushsize-indicator").text(t+"px")},e.BrushSize=o}(t,e.plugins,e.plugins.BaseToolOptions),function(t,e,i,o){var n=function(t,e){i.call(this,t),this._setupOptions(e)};(n.prototype=Object.create(i.prototype)).constructor=i,n.prototype.name="LineWidth",n.prototype.optionName="lineWidth",n.prototype.useCombobox=!1,n.prototype.preventHightlight=!1,n.prototype.buttonMode=!1,n.prototype.buttonIconClass="fa-arrows-h",n.prototype._defaultOptions={digitsAfterDecimalPoint:0},n.prototype.onSelectionCleared=function(t){this.data=!1},n.prototype.createControls=function(t){this.createControl(t),this._attachEvents()},n.prototype._generateHtml=function(){return'<li class="toolbar-item-wrapper toolbar-item-range editable-canvas-line-width hidden'+(this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":"")+'"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-line-width-label">'+this.drawer.t("Line width:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-line-width-indicator"></span></div><input class="editable-canvas-line-width-input controls-value-item" name="drawer-line-width"data-name="lineWidth"type="range"min="1"max="1000"></li>'},n.prototype.createControl=function(e){var i=this._generateHtml();return this.$toolControl=t(i),this.$valueIndicator=this.$toolControl.find(".editable-canvas-line-width-indicator"),e.addControl(this.$toolControl,this.options.buttonOrder),this.$toolControl},n.prototype._attachEvents=function(){this.$toolControl&&this.$toolControl.on("input change toolbarOptionChange",this.onInputChange.bind(this))},n.prototype.validateValue=function(t){var e;if("number"==typeof(t=parseInt(t,10))&&isFinite(t)&&t){var i=Math.pow(10,this.options.digitsAfterDecimalPoint);e=parseInt(t*i,10)/i}return e},n.prototype.setLineWidth=function(t){var e=this.drawer.fCanvas,i=e.getActiveObject();if(i){this.data||this.collectDataFromObject(i);var o=parseInt(t/this.data.initialWidth*100,10)/100;i.x1=this.data.x1*o*i.scaleX,i.x2=this.data.x2*o*i.scaleX,i.y1=this.data.y1*o*i.scaleY,i.y2=this.data.y2*o*i.scaleY,i.set("x1",i.x1),i.set("x2",i.x2),i.set("y1",i.y1),i.set("y2",i.y2),i.set("top",this.data.top),i.set("left",this.data.left),e.renderAll()}},n.prototype.onInputChange=function(){var e=t(this.$toolControl).find("input").val(),i=this.validateValue(e);this.$valueIndicator.text(i+"px"),this.setLineWidth(i)},n.prototype.collectDataFromObject=function(t){var e={},i=Math.pow(10,this.options.digitsAfterDecimalPoint),o=function(t,e){var o=Math.pow(t,2)+Math.pow(e,2),n=Math.sqrt(o);return parseInt(n*i)/i},n=t.x2-t.x1,r=t.y2-t.y1,s=n*t.scaleX,a=r*t.scaleY,h=n,l=r,c=Math.atan(r/n),u=Math.abs(fabric.util.radiansToDegrees(c));return e.lineWidth=o(s,a),e.initialWidth=o(h,l),e.angleRad=c,e.angleDeg=u,e.top=t.top,e.left=t.left,e.x1=t.x1,e.x2=t.x2,e.y1=t.y1,e.y2=t.y2,this.data=e,e},n.prototype.updateControls=function(t){var e=(t=t||this.data).lineWidth,i=this.validateValue(e);this.$toolControl.find("input").val(i),this.$valueIndicator.text(i+"px")},n.prototype.showControls=function(){this.$toolControl.removeClass("hidden")},n.prototype.hideControls=function(t){this.$toolControl.addClass("hidden")},e.LineWidth=n}(t,e.plugins,e.plugins.BaseToolOptions,e.util),function(t,e,i,o){var n=function(t,e){i.call(this,t),this._setupOptions(e)};(n.prototype=Object.create(i.prototype)).constructor=i,n.prototype.optionName="opacity",n.prototype._defaultOptions={defaultValue:1,alwaysVisible:!0},n.prototype.createControls=function(t){this.createControl(t,this.setOpacity.bind(this))},n.prototype.createControl=function(e,i){return this.toolbar=e,this.opacityChangeCallback=i,this.$opacityControl=t('<li class="editable-canvas-opacity-option toolbar-item-range"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-opacity-option-label">'+this.drawer.t("Opacity :")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-opacity-option-indicator">100%</span></div><input class="editable-canvas-opacity-option-input" type="range" name="drawer-size" min="0" max="100"value="100" /></li>'),this.$opacityIndicator=this.$opacityControl.find(".editable-canvas-opacity-option-indicator"),e.addControl(this.$opacityControl,this.options.buttonOrder),this.$opacityControl.on("change",this._onOpacityChange.bind(this)),this.$opacityControl},n.prototype.setOpacity=function(t){var e=this.drawer.fCanvas,i=e.getActiveObject();this.drawer.setOpacity(t),i&&(i.setOpacity(t),e.renderAll())},n.prototype._onOpacityChange=function(){var e=t(this.$opacityControl).find("input"),i=parseInt(e.val(),10),o="number"==typeof i&&isFinite(i)?i:this.options.defaultOpacity,n=parseInt(o,10)+"%";this._opacity=o/100,this.$opacityIndicator.text(n),this.opacityChangeCallback&&this.opacityChangeCallback(this._opacity)},n.prototype.collectDataFromObject=function(t){var e={};return e.opacity=t.get("opacity"),this.data=e,e},n.prototype.updateControls=function(t){var e=(t=t||this.data).opacity,i="number"==typeof e&&isFinite(e)?e:this.options.defaultOpacity,o=parseInt(100*i,10)+"%";this.drawer.activeOpacity=i,this.$opacityControl.find("input").val(100*i),this.$opacityControl.find(".editable-canvas-opacity-option-indicator").text(o)},n.prototype.showControls=function(){this.$opacityControl.removeClass("hidden")},n.prototype.hideControls=function(t){var e=this.drawer.options.toolbars.popupButtonAlwaysVisible||this.options.alwaysVisible;!t&&e||this.$opacityControl.addClass("hidden")},e.OpacityOption=n}(t,e.plugins,e.plugins.BaseToolOptions,e.util),function(t,e,i,o){var n=function(t,e){i.call(this,t),this._setupOptions(e)};(n.prototype=Object.create(i.prototype)).constructor=i,n.prototype.name="StrokeWidth",n.prototype.optionName="strokeWidth",n.prototype.useCombobox=!1,n.prototype.preventHightlight=!1,n.prototype.buttonMode=!1,n.prototype.buttonIconClass="fa-arrows-h",n.prototype._defaultOptions={digitsAfterDecimalPoint:0},n.prototype.onSelectionCleared=function(t){this.data=!1},n.prototype.createControls=function(t){this.createControl(t),this._attachEvents()},n.prototype._generateHtml=function(){return'<li class="toolbar-item-wrapper toolbar-item-range editable-canvas-stroke-width hidden'+(this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":"")+'"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-stroke-width-label">'+this.drawer.t("Stroke width:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-stroke-width-indicator"></span></div><input class="editable-canvas-stroke-width-input controls-value-item" name="drawer-stroke-width"data-name="strokeWidth"type="range"min="1"max="50"></li>'},n.prototype.createControl=function(e){var i=this._generateHtml();return this.$toolControl=t(i),this.$valueIndicator=this.$toolControl.find(".editable-canvas-stroke-width-indicator"),e.addControl(this.$toolControl,this.options.buttonOrder),this.$toolControl},n.prototype._attachEvents=function(){this.$toolControl&&this.$toolControl.on("input change toolbarOptionChange",this.onInputChange.bind(this))},n.prototype.validateValue=function(t){var e;if("number"==typeof(t=parseInt(t,10))&&isFinite(t)&&t){var i=Math.pow(10,this.options.digitsAfterDecimalPoint);e=parseInt(t*i,10)/i}return e},n.prototype.setStrokeWidth=function(t){t=parseInt(t,10);var e=this.drawer.fCanvas,i=e.getActiveObject();this.drawer.lineStrokeWidth=t,i&&(this.data||this.collectDataFromObject(i),i.set("left",this.data.left),i.set("top",this.data.top),i.set("strokeWidth",parseInt(t,10)),e.renderAll())},n.prototype.onInputChange=function(){var e=t(this.$toolControl).find("input").val(),i=this.validateValue(e);this.$valueIndicator.text(i+"px"),this.setStrokeWidth(i)},n.prototype.collectDataFromObject=function(t){var e={},i=(Math.pow(10,this.options.digitsAfterDecimalPoint),t.strokeWidth);return e.strokeWidth=i,e.top=t.top,e.left=t.left,this.data=e,e},n.prototype.updateControls=function(t){var e=(t=t||this.data).strokeWidth,i=this.validateValue(e);this.drawer.lineStrokeWidth=i,this.$toolControl.find("input").val(i),this.$valueIndicator.text(i+"px")},n.prototype.showControls=function(){this.$toolControl.removeClass("hidden")},n.prototype.hideControls=function(t){this.$toolControl.addClass("hidden")},e.StrokeWidth=n}(t,e.plugins,e.plugins.BaseToolOptions,e.util),function(t,e,i,o){var n=function(t,e){o.call(this,t),this._setupOptions(e)};(n.prototype=Object.create(o.prototype)).constructor=o,n.prototype.name="TextAlign",n.prototype.optionName="TextAlign",n.prototype.useCombobox=!0,n.prototype.buttonMode=!0,n.prototype.focusTextOnChange=!0,n.prototype.preventHightlight=!0,n.prototype.showOnEditMode=!1,n.prototype.hideOnEditMode=!0,n.prototype.stylesToObject=!0,n.prototype.onlyPredefined=!0,n.prototype.buttonIconClass="fa-align-left",n.prototype.valueType={textAlign:"string"},n.prototype._defaultOptions={defaultValues:{textAlign:"left"},predefined:{textAlign:["left","center","right","justify"]},valueMap:{left:{value:"left",classString:"fa fa-align-left"},center:{value:"center",classString:"fa fa-align-center"},right:{value:"right",classString:"fa fa-align-right"},justify:{value:"justify",classString:"fa fa-align-justify"}}},n.prototype.controlTemplate=function(){var t,e;return t=this.options.predefined.textAlign.map(function(t,e){return'<option value="'+t+'">'+t+"</option>"}).join(""),e='<select class="editable-canvas-text-textalign-input controls-value-item" name="drawer-size"data-name="textAlign"value="'+this.options.defaultValues.textAlign+'">'+t+"</select>",'<li class="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-textalign hidden'+(this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":"")+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font size:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+e+"</div></li>"},e.TextAlign=n}(0,e.plugins,e.util,e.plugins.BaseTextOptionTool),function(t,e,i,o){var n=function(t,i){o.call(this,t),this._setupOptions(i),this.colorControl=new e.ColorpickerControl(this.drawer,this.options)};(n.prototype=Object.create(o.prototype)).constructor=o,n.prototype.name="TextBackgroundColor",n.prototype.optionName="TextBackgroundColor",n.prototype.focusTextOnChange=!0,n.prototype.useCombobox=!1,n.prototype.buttonMode=!1,n.prototype._defaultOptions={colorText:"Text background:",defaultValues:{textBackgroundColor:""}},n.prototype.onlyPredefined=!0,n.prototype.valueType={textBackgroundColor:"color"},n.prototype.updateSingleControl=function(t,e){"textBackgroundColor"===t&&this.colorControl.setColor(e)},n.prototype.getStylesFromControls=function(){},n.prototype.getStylesFromChangeEvent=function(t){var e;return t&&("object"==typeof t&&(e=t.styles),"string"==typeof t&&(e={textBackgroundColor:t})),this._lastData=e,e},n.prototype.setupControl=function(t,e,i){this.colorChangeHandler=i,this.$toolControl=this.colorControl.createControl(t,this.onInputChange.bind(this)),this.$toolControl.$colorIndicator=this.$toolControl.find(".color-indicator"),this.$toolControl.$colorDropdown=this.$toolControl.find(".color-dropdown"),this.$toolControl.$colorIndicator.attr("data-name","textBackgroundColor"),this.$toolControl.$colorIndicator.addClass("controls-value-item"),this.$toolControl.addClass("editable-canvas-text-option editable-canvas-text-backgroundcolor"),this.colorDropdownVisible=!1},e.TextBackgroundColor=n}(0,e.plugins,e.util,e.plugins.BaseTextOptionTool),function(t,e,i,o){var n=function(t,i){o.call(this,t),this._setupOptions(i),this.colorControl=new e.ColorpickerControl(this.drawer,this.options)};(n.prototype=Object.create(o.prototype)).constructor=o,n.prototype.name="TextColor",n.prototype.optionName="TextColor",n.prototype.focusTextOnChange=!0,n.prototype.onlyPredefined=!0,n.prototype._defaultOptions={colorText:"Font color:",defaultValues:{fill:""}},n.prototype.valueType={fill:"color"},n.prototype.updateSingleControl=function(t,e){"fill"===t&&this.colorControl.setColor(e)},n.prototype.getStylesFromControls=function(){},n.prototype.getStylesFromChangeEvent=function(t){var e;return t&&("object"==typeof t&&(e=t.styles),"string"==typeof t&&(e={fill:t})),this._lastData=e,e},n.prototype.setupControl=function(t,e,i){this.colorChangeHandler=i,this.$toolControl=this.colorControl.createControl(t,this.onInputChange.bind(this)),this.$toolControl.$colorIndicator=this.$toolControl.find(".color-indicator"),this.$toolControl.$colorDropdown=this.$toolControl.find(".color-dropdown"),this.$toolControl.$colorIndicator.attr("data-name","fill"),this.$toolControl.$colorIndicator.addClass("controls-value-item"),this.$toolControl.addClass("editable-canvas-text-option editable-canvas-text-color"),this.colorDropdownVisible=!1},e.TextColor=n}(0,e.plugins,e.util,e.plugins.BaseTextOptionTool),function(t,e,i,o){var n=function(t,e){o.call(this,t),this._setupOptions(e)};(n.prototype=Object.create(o.prototype)).constructor=o,n.prototype.name="TextDecoration",n.prototype.optionName="TextDecoration",n.prototype.focusTextOnChange=!0,n.prototype.onlyPredefined=!0,n.prototype.buttonIconClass="fa-strikethrough",n.prototype.valueType={textDecoration:"string"},n.prototype._defaultOptions={defaultValues:{textDecoration:""},predefined:{textDecoration:["underline","overline","line-through"]}},n.prototype.controlTemplate=function(){var t,e;return t=this.options.predefined.textDecoration.map(function(t,e){return'<option value="'+t+'">'+t+"</option>"}).join(""),e='<select class="editable-canvas-text-decoration-input controls-value-item" name="drawer-size"data-name="textDecoration"value="'+this.options.defaultValues.textDecoration+'">'+t+"</select>",'<li class="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-decoration hidden'+(this.buttonMode?" toolbar-button-item ":"")+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Text Decoration:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+e+"</div></li>"},e.TextDecoration=n}(0,e.plugins,e.util,e.plugins.BaseTextOptionTool),function(t,e,i,o){var n=function(t,e){o.call(this,t),this._setupOptions(e),this.activeFont=this.options.fonts[this.options.defaultFont],this.drawer.on(this.drawer.EVENT_TEXT_GET_STYLES,this._onGetStyles.bind(this))};(n.prototype=Object.create(o.prototype)).constructor=o,n.prototype.name="TextFontFamily",n.prototype.optionName="TextFontFamily",n.prototype.buttonIconClass="fa-font",n.prototype.focusTextOnChange=!0,n.prototype.onlyPredefined=!0,n.prototype.valueType={fontFamily:"string"},n.prototype._defaultOptions={defaultValues:{fontFamily:"Georgia"},fonts:{Georgia:"Georgia, serif",Palatino:"'Palatino Linotype', 'Book Antiqua', Palatino, serif","Times New Roman":"'Times New Roman', Times, serif",Arial:"Arial, Helvetica, sans-serif","Arial Black":"'Arial Black', Gadget, sans-serif","Comic Sans MS":"'Comic Sans MS', cursive, sans-serif",Impact:"Impact, Charcoal, sans-serif","Lucida Grande":"'Lucida Sans Unicode', 'Lucida Grande', sans-serif",Tahoma:"Tahoma, Geneva, sans-serif","Trebuchet MS":"'Trebuchet MS', Helvetica, sans-serif",Verdana:"Verdana, Geneva, sans-serif","Courier New":"'Courier New', Courier, monospace","Lucida Console":"'Lucida Console', Monaco, monospace"},defaultFont:"Georgia"},n.prototype.changeFont=function(t,e){this.activeFont=this.options.fonts[t],e||this.setStyles({fontFamily:this.activeFont}),this.$toolControl.find(".editable-canvas-fontfamily").css("font-family",this.activeFont),this.$toolControl.find(".editable-canvas-fontfamily").text(t||""),this.$toolControl.find(".fonts-dropdown").addClass("hidden")},n.prototype.updateSingleControl=function(t,e){if("fontFamily"===t){var i=this.getFontByCss(e);this.changeFont(i,!0)}},n.prototype._collectDefaultOptions=function(e){var i=this.drawer.getPluginConfig("Text");return{fonts:t.extend(!0,{},i.fonts||{}),defaultFont:i.defaultFont}},n.prototype._onGetStyles=function(t,e,i){(i=i||{}).defaultValues=i.defaultValues||{},i.defaultValues.fontFamily=this.options.fonts[this.options.defaultFont]},n.prototype.getFontByCss=function(e){var i=null;return t.each(this.options.fonts,function(t,o){o==e&&(i=t)}),i},n.prototype.setupControl=function(e,o,n){var r=this;i.bindClick(o.find(".toolbar-label"),"fontFamily",function(){o.find(".fonts-dropdown").toggleClass("hidden")}),o.find("li a").each(function(e,o){var n=t(o);i.bindClick(n,"fontFamily",function(){var e=t(this).data("fontName");r.changeFont(e)})})},n.prototype.controlTemplate=function(){var e,i="";return t.each(this.options.fonts,function(t,e){i+='<option style="font-family: '+e+';"value="'+t+'"data-font-name="'+t+'">'+t+"</option>"}),e='<select class="editable-canvas-text-fontfamily-input controls-value-item" name="drawer-size"data-name="fontFamily"value="'+this.options.defaultValues.fontFamily+'">'+i+"</select>",'<li class="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontfamily hidden'+(this.buttonMode?" toolbar-button-item ":"")+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font family:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+e+"</div></li>"},e.TextFontFamily=n}(t,e.plugins,e.util,e.plugins.BaseTextOptionTool),function(t,e,i,o){var n=function(t,e){o.call(this,t),this._setupOptions(e)};(n.prototype=Object.create(o.prototype)).constructor=o,n.prototype.name="TextFontSize",n.prototype.optionName="TextFontSize",n.prototype.buttonIconClass="fa-text-height",n.prototype.valueType={fontSize:"number"},n.prototype._defaultOptions={defaultValues:{fontSize:48},predefined:{fontSize:[6,12,14,16,20,24,32,40,48,72]}},n.prototype.controlTemplate=function(){var t,e;return t=this.options.predefined.fontSize.map(function(t,e){return'<option value="'+t+'">'+t+"</option>"}).join(""),e='<select class="editable-canvas-text-fontsize-input controls-value-item" name="drawer-size"data-name="fontSize"value="'+this.options.defaultValues.fontSize+'">'+t+"</select>",'<li class="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontsize hidden'+(this.buttonMode?" toolbar-button-item ":"")+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font size:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+e+"</div></li>"},e.TextFontSize=n}(0,e.plugins,e.util,e.plugins.BaseTextOptionTool),function(t,e,i,o){var n=function(t,e){o.call(this,t),this._setupOptions(e)};(n.prototype=Object.create(o.prototype)).constructor=o,n.prototype.name="TextFontStyle",n.prototype.optionName="TextFontStyle",n.prototype.onlyPredefined=!0,n.prototype.focusTextOnChange=!0,n.prototype.buttonIconClass="fa-italic",n.prototype.valueType={fontStyle:"string"},n.prototype._defaultOptions={defaultValues:{fontStyle:""},predefined:{fontStyle:["normal","italic","oblique"]}},n.prototype.controlTemplate=function(){var t,e;return t=this.options.predefined.fontStyle.map(function(t,e){return'<option value="'+t+'">'+t+"</option>"}).join(""),e='<select class="editable-canvas-text-fontstyle-input controls-value-item" name="drawer-size"data-name="fontStyle"value="'+this.options.defaultValues.fontStyle+'">'+t+"</select>",'<li class="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontstyle hidden'+(this.buttonMode?" toolbar-button-item ":"")+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font style:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+e+"</div></li>"},e.TextFontStyle=n}(0,e.plugins,e.util,e.plugins.BaseTextOptionTool),function(t,e,i,o){var n=function(t,e){o.call(this,t),this._setupOptions(e)};(n.prototype=Object.create(o.prototype)).constructor=o,n.prototype.name="TextFontWeight",n.prototype.optionName="TextFontWeight",n.prototype.focusTextOnChange=!0,n.prototype.onlyPredefined=!0,n.prototype.buttonIconClass="fa-bold",n.prototype._defaultOptions={defaultValues:{fontWeight:"normal"},predefined:{fontWeight:["normal","bold","light",100,200,300,400,500,600,700,800,900]}},n.prototype.controlTemplate=function(){var t,e;return t=this.options.predefined.fontWeight.map(function(t,e){return'<option value="'+t+'">'+t+"</option>"}).join(""),e='<select class="editable-canvas-text-fontweight-input controls-value-item" name="drawer-size"data-name="fontWeight"value="'+this.options.defaultValues.fontWeight+'">'+t+"</select>",'<li class="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontweight hidden'+(this.buttonMode?" toolbar-button-item ":"")+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font Weight:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+e+"</div></li>"},e.TextFontWeight=n}(0,e.plugins,e.util,e.plugins.BaseTextOptionTool),function(t,e,i,o){var n=fabric.Text.prototype.lineHeight||1.16,r=function(t,e){o.call(this,t),this._setupOptions(e)};(r.prototype=Object.create(o.prototype)).constructor=o,r.prototype.name="TextLineHeight",r.prototype.optionName="TextLineHeight",r.prototype.showOnEditMode=!1,r.prototype.hideOnEditMode=!0,r.prototype.stylesToObject=!0,r.prototype.preventHightlight=!0,r.prototype.buttonIconClass="fa-arrows-v",r.prototype.onlyPredefined=!0,r.prototype.valueType={lineHeight:"number"},r.prototype._defaultOptions={defaultValues:{lineHeight:n},predefined:{lineHeight:[1,1.16,1.25,1.5,1.75,2,3]}},r.prototype.collectDataFromObject=function(e){var i={lineHeight:e.lineHeight};return this._lastData=this._lastData||{},t.extend(!0,this._lastData,i),i},r.prototype.controlTemplate=function(){var t,e;return t=this.options.predefined.lineHeight.map(function(t,e){return'<option value="'+t+'">'+parseInt(Math.round(100*t),10)+"%</option>"}).join(""),e='<select class="editable-canvas-text-lineheight-input controls-value-item" name="drawer-size"data-name="lineHeight"value="'+this.options.defaultValues.lineHeight+'">'+t+"</select>",'<li class="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-lineheight hidden'+(this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":"")+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Line height:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+e+"</div></li>"},e.TextLineHeight=r}(t,e.plugins,e.util,e.plugins.BaseTextOptionTool),function(t,e,i,o){var n=function(t,n){this.optionName="border",this.name="ShapeBorder",i.call(this,t),this.assetsFolder=o.getDrawerFolderUrl()+"assets/",this._setGlobalClickHandler(),this._completeDefaultOptionsPaths(),this.colorpicker=new e.ColorpickerControl(this.drawer,this.options),this.currentColor=this.options.color,this.currentBorder=this.options.borderTypes[this.options.defaultBorder],this.activeToolIsShape=!1,this.drawer.on(this.drawer.EVENT_CANVAS_START_RESIZE,this.hideStyleDropdown.bind(this))};(n.prototype=Object.create(i.prototype)).constructor=i,n.prototype._defaultOptions={color:"rgba(0, 0, 0, 0)",borderTypes:{None:{width:0,description:"None",color:"transparent"},"Solid thin":{width:1,preview:"border-solid-thin.png"},"Solid bold":{width:5,preview:"border-solid-bold.png"},"Dashed thin":{width:1,dashArray:[8,8],preview:"border-dashed-thin.png"},"Dashed bold":{width:5,dashArray:[8,8],preview:"border-dashed-bold.png"}},defaultBorder:"None"},n.prototype._completeDefaultOptionsPaths=function(){for(var t in this.options.borderTypes){var e=this.options.borderTypes[t];e.preview&&(e.preview=o.assets.urlFor(e.preview))}},n.prototype._setGlobalClickHandler=function(){var e=this;t(window.document).off("click.DrawerShapeBorder").on("click.DrawerShapeBorder",function(i){var o=t(i.target).hasClass("border-type-indicator");e.isDropdownVisible&&!o&&e.hideStyleDropdown()})},n.prototype.updateControlsFromObject=function(t){this.updateColorFromObject(t),this.updateStrokeFromObject(t),this.updateControls()},n.prototype.updateColorFromObject=function(t){var i;i=t.get("stroke"),this.currentColor=i||e.ColorpickerControl.TRANSPARENT},n.prototype.updateStrokeFromObject=function(t){var e=t.get("strokeDashArray"),i=t.get("strokeWidth");for(var o in this.options.borderTypes)if(this.options.borderTypes.hasOwnProperty(o)){var n=this.options.borderTypes[o],r=JSON.stringify(n.dashArray)===JSON.stringify(e);n.dashArray||e||(r=!0),r&&n.width==i&&(this.currentBorder=n)}},n.prototype._onObjectAdded=function(t,e){if(this.drawer.mode==this.drawer.MODE_ACTIVE){var i=e.target;this.applyBorderStyle(i),this.drawer.fCanvas.renderAll()}},n.prototype.onActivateTool=function(t){t instanceof e.Line||t instanceof e.ArrowOneSide||t instanceof e.ArrowTwoSide?(this.colorBeforeLineShape=this.currentColor,this.borderBeforeLineShape=this.currentBorder,this.currentColor=this.drawer.activeColor,this.currentBorder=this.options.borderTypes["Solid thin"],this.updateControls()):void 0!==this.colorBeforeLineShape&&(this.currentColor=this.colorBeforeLineShape,this.currentBorder=this.borderBeforeLineShape,delete this.colorBeforeLineShape,delete this.borderBeforeLineShape,this.updateControls())},n.prototype.createControls=function(e){var i=this;this.colorButton=this.colorpicker.createControl(e,this.onColorSelected.bind(this)),this.colorpicker.setColor(this.options.color),this.colorButton.css("display","inline-block"),this.colorButton.find(".toolbar-label").text(this.drawer.t("Border:")),i.$borderTypeButton=t('<li class="editable-canvas-border-type" data-editable-canvas-sizeable="toolbar-button" ><span class="toolbar-label editable-canvas-border-type-label">'+this.drawer.t("Border type:")+' </span><span class="border-type-indicator" data-editable-canvas-sizeable="toolbar-button" ></span><span class="border-type-dropdown toolbar-dropdown-block hidden" data-editable-canvas-sizeable="toolbar-button" ></span></li>'),i.isDropdownVisible=!1,i.$borderTypeButton.$dropdown=i.$borderTypeButton.find(".border-type-dropdown"),i.$borderTypeButton.$indicator=i.$borderTypeButton.find(".border-type-indicator"),o.bindClick(i.$borderTypeButton,"border-type-dropdown",i.toggleStyleDropdown.bind(i));var n=t("<ul></ul>");i.$borderTypeButton.$dropdown.append(n);var r=function(e){var o=t(e.target).attr("data-border-type");o&&(i.currentBorder=i.options.borderTypes[o],i.onColorSelected(),e.stopPropagation(),e.preventDefault())};for(var s in this.options.borderTypes)if(this.options.borderTypes.hasOwnProperty(s)){var a=this.options.borderTypes[s],h=t('<li data-border-type="'+s+'"data-editable-canvas-sizeable="toolbar-button" </li>');a.preview&&h.css("background-image","url("+a.preview+")"),a.description&&h.text(a.description),o.bindClick(h,"border-type",r),n.append(h)}e.addControl(i.$borderTypeButton,this.options.buttonOrder),i.onColorSelected(),i.hideControls()},n.prototype.onColorSelected=function(t){if(t&&(this.currentColor=t),this.updateControls(),this.drawer.fCanvas){var e=this.drawer.fCanvas.getActiveObject();e&&this.applyBorderStyle(e),this.drawer.fCanvas.renderAll()}},n.prototype.applyBorderStyle=function(t){(o.isShape(t)||t instanceof fabric.Line)&&(this.currentBorder.color?t.set("stroke",this.currentBorder.color):t.set("stroke",this.currentColor),t.set("strokeWidth",this.currentBorder.width),this.currentBorder.dashArray?t.set("strokeDashArray",this.currentBorder.dashArray):t.set("strokeDashArray",null))},n.prototype.updateControls=function(){this.colorpicker.setColor(this.currentColor),this.hideStyleDropdown(),"None"==this.currentBorder.description?this.colorpicker.hideControls():this.colorpicker.showControls();var t=this.$borderTypeButton.find(".border-type-indicator"),e=this.currentBorder.preview?"url("+this.currentBorder.preview+")":"none";t.css("background-image",e),this.currentBorder.description?t.text(this.drawer.t(this.currentBorder.description)):t.text("")},n.prototype.showControls=function(){this.colorpicker.showControls(),this.$borderTypeButton.show()},n.prototype.hideControls=function(){this.colorpicker.hideControls(),this.$borderTypeButton.hide()},n.prototype.toggleStyleDropdown=function(){this.isDropdownVisible?this.hideStyleDropdown():this.showStyleDropdown()},n.prototype.hideStyleDropdown=function(){this.$borderTypeButton.$dropdown.addClass("hidden"),this.isDropdownVisible=!1,this.$clonedDropdown&&this.$clonedDropdown.remove()},n.prototype.showStyleDropdown=function(){this.$borderTypeButton.$dropdown.removeClass("hidden"),this.isDropdownVisible=!0;var t=this.drawer&&this.drawer.toolbars&&this.drawer.toolbars.toolOptionsToolbar,e=t&&t.options,i=e&&"popup"!==e.position,n=e&&"outside"===e.positionType,r=e&&"scrollable"===e.compactType;if(i&&n&&r){var s,a=this.$borderTypeButton.$dropdown;a.removeClass("hidden"),s=a.clone(!0),this.$borderTypeButton.$dropdown.closest(".toolbar-placeholder").append(s),s.addClass("border-type-dropdown-cloned"),this.$clonedDropdown=s;var h=o.getScrollOffset(this.drawer.$canvasEditContainer),l=o.getScrollOffset(this.$borderTypeButton),c=this.drawer.$canvasEditContainer.get(0).getBoundingClientRect(),u=this.$borderTypeButton.get(0).getBoundingClientRect(),p=(u.left,u.width,c.left,l.left,h.left,this.$clonedDropdown.width(),u.left+u.width-c.left-(l.left-h.left)-this.$clonedDropdown.width()-12);this.$clonedDropdown.css({left:p}),a.addClass("hidden")}},e.ShapeBorder=n}(t,e.plugins,e.plugins.BaseToolOptions,e.util),D(0,e.plugins.BaseShape,e.plugins),k(0,e.plugins.BaseShape,e.plugins),function(t,e,i){var o=function(t,i){e.call(this,t),this.name="Circle",this.btnClass="btn-circle",this.faClass="fa-circle",this.tooltip=t.t("Draw a circle"),this.options=i||{},this.centeringMode=this.options.centeringMode||e.CENTERING_MODE.NORMAL};(o.prototype=Object.create(e.prototype)).constructor=o,o.prototype.minShapeSize=5,o.prototype.createShape=function(t,e){return this.startLeft=t,this.startTop=e,new fabric.PCircle({left:t,top:e,radius:1,fill:this.drawerInstance.activeColor,opacity:this.drawerInstance.activeOpacity})},o.prototype.updateShape=function(t,i,o){var n=i-this.startLeft,r=o-this.startTop,s=Math.abs(n),a=Math.abs(r),h=s<a?s:a;h=Math.abs(h),h/=2,this.centeringMode==e.CENTERING_MODE.FROM_CENTER&&(h*=2,t.set("left",this.startLeft-h),t.set("top",this.startTop-h)),this.centeringMode==e.CENTERING_MODE.NORMAL&&(n<0?t.set("left",this.startLeft-2*h):t.set("left",this.startLeft),r<0?t.set("top",this.startTop-2*h):t.set("top",this.startTop)),t.set("radius",h)},i.Circle=o}(0,e.plugins.BaseShape,e.plugins),function(t,e,i,o){var n=function(t,i){e.call(this,t),this.drawer=t,this.name="Image",this.btnClass="btn-image",this.faClass="fa-image",this.tooltip=t.t("Insert an image"),this._setupOptions(i)};(n.prototype=Object.create(e.prototype)).constructor=n,n.prototype._defaultOptions={maxImageSizeKb:5120,scaleDownLargeImage:!0,centerImage:!0,cropIsActive:!0,acceptedMIMETypes:["image/jpeg","image/png","image/gif"]},n.prototype._activateTool=function(){var t=this;this.drawerInstance.log("TOOL","Image._activateTool()"),e.prototype._activateTool.call(this),this._showDialog(),o.setTimeout(function(){t.drawerInstance.trigger(t.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,[t])},300)},n.prototype._showDialog=function(){var e=this.options.acceptedMIMETypes.join(",");$el=t('<input type="file" accept="'+e+'">'),$el.on("change",this._processFileInput.bind(this)),$el.click()},n.prototype._processFileInput=function(t){var e=this,i=t.target.files;if(i.length<1)e.drawerInstance.showError(this.drawerInstance.t("No file was selected!"));else{var o=i[0];if(this._checkFile(o)){var n=new FileReader;n.onload=function(t){e.drawerInstance.log("IMAGE LOADED:",o.name),e.options.cropIsActive&&e.drawer._pluginsInstances.ImageCrop?e._triggerImageCrop(n.result):e.loadImage(n.result)},n.readAsDataURL(o)}}},n.prototype._checkFile=function(t){if(t.type.indexOf("image")<0)return this.drawerInstance.showError(this.drawerInstance.t("Incorrect file type!")),!1;if(this.options.maxImageSizeKb>0&&t.size>1024*this.options.maxImageSizeKb){var e=this.drawerInstance.t("File is to big!. Maximum file size is ");return e=e+this.options.maxImageSizeKb+" KB",this.drawerInstance.showError(e),!1}return!0},n.prototype.loadImage=function(t,e){var i=this,o=new Image;o.onload=function(){i.addImage(o,e)},o.onerror=function(){var t=i.drawerInstance.t("Image failed to create!");i.drawerInstance.showError(t)},o.src=t},n.prototype._triggerImageCrop=function(t){var e={url:t,callback:this.loadImage.bind(this)};this.drawerInstance.trigger(this.drawerInstance.EVENT_IMAGE_CROP,e)},n.prototype.addImage=function(t,e){var i=this.drawerInstance.fCanvas,o=new fabric.ErasableImage(t);(e=e||this.options).scaleDownLargeImage?this._fitLargeImage(o):(o.left=e.left?e.left:0,o.top=e.top?e.top:0,o.scaleX=e.scaleX?e.scaleX:1,o.scaleY=e.scaleY?e.scaleY:1),o.opacity=this.drawerInstance.activeOpacity,e.centerImage&&i.centerObject(o),i.add(o),i.setActiveObject(o)},n.prototype._fitLargeImage=function(t){var e=this.drawerInstance.fCanvas,i=.95*e.width,o=.95*e.height,n=1,r=1;t.width>i&&(n=i/t.width),t.height>o&&(r=o/t.height);var s=Math.min(n,r);t.set({scaleX:s,scaleY:s})},i.Image=n}(t,e.plugins.BaseTool,e.plugins,e.util),function(t){t.prototype.addImageFromUrl=function(t,e){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("Image").loadImage(t,e)},t.prototype.addImage=function(t,e){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("Image").addImage(t,e)}}(e.DrawerApi),function(t,e,i){var o=function(i){e.call(this,i),this.name="Line",this.toolOptionsList=["border","opacity","lineWidth","strokeWidth"],this.btnClass="btn-line",this.faClass="fa-line",this.tooltip=i.t("Draw a line"),this.group={name:"lines",tooltip:i.t("Lines and arrows")},this._setupOptions({}),t.extend(!0,this.options.lineAngleTooltip,i.options.lineAngleTooltip||{}),this.options.lineAngleTooltip.fontFamily+=", "+this._defaultOptions.lineAngleTooltip.fontFamily};(o.prototype=Object.create(e.prototype)).constructor=o,o.prototype.checkOnlyWidthOrHeight=!0,o.prototype._defaultOptions={lineAngleTooltip:{enabled:!1,fontSize:11,fontFamily:"Arial, sans serif",color:"black"}},o.prototype.createShape=function(t,e){var i=new fabric.ErasableLine;return i.set("x1",t),i.set("x2",t+1),i.set("y1",e),i.set("y2",e+1),i.set("stroke",this.drawerInstance.activeColor),i.set("opacity",this.drawerInstance.activeOpacity),i.set("strokeWidth",this.drawerInstance.lineStrokeWidth||2),this.createAngleTooltip(i),i},o.prototype.updateShape=function(t,e,i){t.set("x2",e),t.set("y2",i),this.updateAngleTooltip(t)},o.prototype.finishShape=function(){this.removeAngleTooltip()},o.prototype.createAngleTooltip=function(t){this.options.lineAngleTooltip.enabled&&(this.angleTooltip=new fabric.IText("Text"),this.angleTooltip.set("fontFamily",this.options.lineAngleTooltip.fontFamily),this.angleTooltip.set("fontSize",this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("left",t.x1-10),this.angleTooltip.set("top",t.y1-10),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color),this.angleTooltip.set("text",""),this.drawerInstance.fCanvas.add(this.angleTooltip),this.updateAngleTooltip(t))},o.prototype.updateAngleTooltip=function(t){if(this.options.lineAngleTooltip.enabled){var e=Math.atan((t.y2-t.y1)/(t.x2-t.x1)),i=Math.abs(fabric.util.radiansToDegrees(e));this.angleTooltip.setText(i.toFixed().toString());var o=this.options.lineAngleTooltip.fontSize,n=-this.options.lineAngleTooltip.fontSize;t.x2<t.x1&&(o=-(this.options.lineAngleTooltip.fontSize+10)),t.y2>t.y1&&(n=2),this.angleTooltip.set("left",t.x1+o),this.angleTooltip.set("top",t.y1+n),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color)}},o.prototype.removeAngleTooltip=function(){this.options.lineAngleTooltip.enabled&&this.angleTooltip&&(this.angleTooltip.remove(),delete this.tooltip)},i.Line=o}(t,e.plugins.BaseShape,e.plugins),function(t,e,i){var o=function(t,i){e.call(this,t),this.name="Rectangle",this.btnClass="btn-rectangle",this.faClass="fa-stop",this.tooltip=t.t("Draw a rectangle"),this.options=i||{},this.centeringMode=this.options.centeringMode||e.CENTERING_MODE.NORMAL};(o.prototype=Object.create(e.prototype)).constructor=o,o.prototype.createShape=function(t,e){return this.startLeft=t,this.startTop=e,new fabric.PRect({left:t,top:e,height:1,width:1,fill:this.drawerInstance.activeColor,opacity:this.drawerInstance.activeOpacity})},o.prototype.updateShape=function(t,i,o){var n=i-this.startLeft,r=o-this.startTop;this.centeringMode==e.CENTERING_MODE.FROM_CENTER&&(n*=2,r*=2,t.set("left",i-n),t.set("top",o-r)),n>0?t.set("width",n):(t.set("left",i),t.set("width",-1*n)),r>0?t.set("height",r):(t.set("top",o),t.set("height",-1*r))},i.Rectangle=o}(0,e.plugins.BaseShape,e.plugins),function(t,e,i,o){var n=function(t,i){e.call(this,t),this._setupOptions(i),this.tooltip=this.drawerInstance.t("Draw a text"),this.helpTooltipText=this.drawerInstance.t("Click to place a text"),this.drawerInstance.on(this.drawerInstance.EVENT_OPTIONS_TOOLBAR_CREATED+this.eventNs,this._onOptionsToolbarCreated.bind(this))};(n.prototype=Object.create(e.prototype)).constructor=n,n.prototype.name="Text",n.prototype.toolOptionsList=["color","border","opacity"],n.prototype.eventNs=".textTool",n.prototype.name="Text",n.prototype.btnClass="btn-text",n.prototype.faClass="fa-font",n.prototype._onOptionsToolbarCreated=function(t,e){this.drawerInstance.on(this.drawerInstance.EVENT_TEXT_SELECTION_CHANGED,this._onTextSelectionChanged.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_TEXT_EDITING_ENTERED,this._onTextEditingEntered.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_TEXT_EDITING_EXITED,this._onTextEditingExited.bind(this))},n.prototype._deactivateTool=function(){this.active&&e.prototype._deactivateTool.call(this)},n.prototype.removeTool=function(t){t&&this.drawerInstance.off(this.drawerInstance.EVENT_OPTIONS_TOOLBAR_CREATED+this.eventNs),e.prototype.removeTool.call(this,t)},n.prototype._onTextEditingEntered=function(t,e){console.info("EVENT_TEXT_EDITING_ENTERED"),this._onTextSelectionChanged(t,e)},n.prototype._onTextEditingExited=function(t,e){e&&e.target&&(e.target._lastSelection=void 0,e.target._lastStyles=void 0)},n.prototype._onTextSelectionChanged=function(e,i){var o=i&&i.target||this.drawerInstance.getActiveObject(),n={start:o.selectionStart,end:o.selectionEnd},r=o._lastSelection||{},s=n.start===n.end,a=0===n.start,h=n.start===r.start&&void 0!==n.start,l=n.end===r.end&&void 0!==n.end;if(!h||!l){o._lastSelection=n;var c=o.getObjStyles(),u=o._lastStyles||{},p=s&&!a&&o.getSelectionStyles(n.start-1),d=p||o.getSelectionStyles(),f=o._hasStyleChanged(u,p||d),g=[];if(!s){d=t.extend(!0,{},d);var v=o.getSelectionStyles(n.start,n.end),b=t.extend(!0,{},v[0]);v.forEach(function(t,e){for(var i in c){var o=t[i]!==b[i],n=-1!==g.indexOf(i);o&&!n&&(g.push(i),d[i]=void 0)}}),f=g.length||o._hasStyleChanged(u,d)}if(this.drawerInstance.setTemporaryStyles(d),f){o._lastStyles=d;var m=this.drawerInstance;m.trigger(m.EVENT_TEXT_STYLES_CHANGED,[d,c,g])}}},n.prototype.addShape=function(t,e,i,o){o=o||{},t=(t=parseInt(t,10))||0===t?t:0,e=(e=parseInt(e,10))||0===e?e:0;var n=this.createShape(t,e,i,o);n.set("left",t),n.set("top",e),this.shape=n,this.finishItemDraw(),this.onlyOneItem&&this.drawerInstance.trigger(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,this)},n.prototype.createShape=function(t,e,i,o){o=o||{},i=i||"Text",this.startLeft=t,this.startTop=e,this.text=new fabric.ErasableText(i,{editIconMode:this.options.editIconMode,editIconSize:this.options.editIconSize});var n=this.drawerInstance,r=this.options.defaultValues||{},s={};return n.trigger(n.EVENT_TEXT_GET_STYLES,[this,s]),(s=s||{}).defaultValues=s.defaultValues||{},this.text.set("fontFamily",o.fontFamily||r.fontFamily||s.defaultValues.fontFamily),this.text.set("fontSize",o.fontSize||r.fontSize||s.defaultValues.fontSize),this.text.set("lineHeight",o.lineHeight||r.lineHeight||s.defaultValues.lineHeight),this.text.set("fill",o.fill||r.fill||s.defaultValues.fill||this.drawerInstance.activeColor),this.text.set("opacity",o.opacity||r.opacity||s.defaultValues.opacity||this.drawerInstance.activeOpacity),this.text.set("left",t-this.text.width/2),this.text.set("top",e-this.text.height/2),this.text},n.prototype.updateShape=function(t,e,i){},n.prototype.isObjectText=function(t){return t instanceof fabric.IText},i.Text=n}(t,e.plugins.BaseShape,e.plugins,e.util),function(t,e,i){var o=function(e,i){var o=this;o.drawer=e,o.LOGTAG=o.name,o._setupOptions(i),o.previousWidth=null,o.previousHeight=null,o.previousOffset=null,o.$enterButton=null,o.$exitButton=null,o.onlyForEditing=!1,this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),e.on(e.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),o.drawer.on(o.drawer.EVENT_EDIT_START,function(){o.drawer.$imageElement.attr("data-before-fullscreen")?(o.$enterButton.hide(),o.$exitButton.show()):(o.$enterButton.show(),o.$exitButton.hide())}),o.drawer.on(o.drawer.EVENT_EDIT_STOP,function(){o.onlyForEditing&&o.exitFullscreen()}),t(window).on("resize",function(){o.isInFullscreenMode()&&o.adjustFullscreenSize()})};o.prototype._setupOptions=function(e,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=t.extend(!0,{},this._defaultOptions||{},r||{},e||{});return o||(this.options=s),s},o.prototype._onToolbarCreated=function(t,e){this.toolbar=e;var i={buttonOrder:this.options.buttonOrder,additionalClass:"btn-fullscreen",iconClass:"fa-expand",tooltipText:this.drawer.t("Enter fullscreen mode"),clickHandler:this.enterFullscreen.bind(this)},o={buttonOrder:this.options.buttonOrder,additionalClass:"btn-fullscreen",iconClass:"fa-compress",tooltipText:this.drawer.t("Exit fullscreen mode"),clickHandler:this.exitFullscreen.bind(this)};this.$enterButton=e.addButton(i),this.$exitButton=e.addButton(o),this.$exitButton.hide()},o.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},o.prototype.isInFullscreenMode=function(){return void 0!==this.drawer.$imageElement.attr("data-before-fullscreen")},o.prototype.adjustFullscreenSize=function(){var t=this.drawer.redactorInstance,e=this.drawer.$imageElement,i=this.drawer.options.toolbarSize,o=t.$box.width()-i,n=t.$box.height()-i,r=t.$box.offset();this.drawer.$canvasEditContainer.css({left:r.left+"px",top:r.top+i+"px",width:o+"px",height:n+"px"}),this.drawer.fCanvas.setWidth(o),this.drawer.fCanvas.setHeight(n),this.onlyForEditing||e.css({position:"absolute",left:"0px",top:"0px",width:o+"px",height:n+"px"})},o.prototype.enterFullscreen=function(){var t=this.drawer.redactorInstance,e=this.drawer.$imageElement;if(this.drawer.options.toolbarSize,this.$enterButton.hide(),this.$exitButton.show(),e.attr("data-before-fullscreen",JSON.stringify({imageCss:{position:e.css("position"),display:e.css("display"),left:e.css("float"),top:e.css("top"),"margin-left":e.css("margin-left"),"margin-right":e.css("margin-right"),width:e.css("width"),height:e.css("height")},canvasCss:{width:this.drawer.width,height:this.drawer.height,offset:this.drawer.$canvasEditContainer.offset()}})),this.onlyForEditing||e.css("position","absolute"),this.adjustFullscreenSize(),this.onlyForEditing){var o=i.getTransitionDuration(this.drawer.$canvasEditContainer[0]);i.setTimeout(function(){t.$box.css("opacity","0")},o)}this.drawer.toolbars.toolOptionsToolbar.removeClass("toolbar-bottomLeft").detach(),this.drawer.appendToolbar(this.drawer.toolbars.toolOptionsToolbar,"topRight"),this.drawer.toolbars.setToolbarButtonsSize(),this.drawer.onCanvasModified()},o.prototype.exitFullscreen=function(){var e=this,o=e.drawer.$imageElement;t(".editable-canvas-tooltip").removeClass("active"),e.$enterButton.show(),e.$exitButton.hide();var n=o.attr("data-before-fullscreen"),r=JSON.parse(n);if(o.attr("data-before-fullscreen",null),this.onlyForEditing?e.drawer.redactorInstance.$box.css("opacity","1"):o.css(r.imageCss),e.drawer.$canvasEditContainer){var s=i.getTransitionDuration(e.drawer.$canvasEditContainer[0]),a=r.canvasCss.width,h=r.canvasCss.height;e.drawer.$canvasEditContainer.css({left:r.canvasCss.offset.left+"px",top:r.canvasCss.offset.top+"px",width:a+"px",height:h+"px"}),e.drawer.$canvasEditContainer.find(".canvas-container").css({width:a+"px",height:h+"px"}),i.setTimeout(function(){e.drawer.fCanvas.setWidth(a),e.drawer.fCanvas.setHeight(h)},s),e.drawer.width=a,e.drawer.height=h,e.drawer.adjustEditContainer(!0,!0)}e.drawer.toolbars.toolOptionsToolbar.removeClass("toolbar-topRight").detach(),e.drawer.appendToolbar(e.drawer.toolbars.toolOptionsToolbar,"bottomLeft"),e.drawer.toolbars.setToolbarButtonsSize(),e.drawer.onCanvasModified()},e.Fullscreen=o}(t,e.plugins,e.util),function(t,e,i,o){var n=i.checkBrowser("mozilla"),r=i.checkBrowser("safari"),s=i.checkBrowser("webkit"),a=function(t,e){this.name="FullscreenModeButton",this.drawer=t,this.drawer.touchDevice,this._setupOptions(e),this._attachEvents(),this._setupFullscreenHandlers(),this.drawer.on(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._onConfigToolbarCreated.bind(this))};a.prototype._attachEvents=function(){var e=this,o="onfullscreenchange.FullscreenModeButton webkitfullscreenchange.FullscreenModeButton fullscreenchange.FullscreenModeButton mozfullscreenchange.FullscreenModeButton MSFullscreenChange.FullscreenModeButton ";t(document).off(o).on(o,function(){e.globalFullscreenMode=!e.globalFullscreenMode,e.reactOnResize=!0,i.setTimeout(function(){e.reactOnResize=!1},2e3),e.globalFullscreenMode?e.setFullscreenStateOn(!0):e.setFullscreenStateOff(!0)}),window.removeEventListener("resize",e._onWindowResize.bind(e)),window.addEventListener("resize",e._onWindowResize.bind(e)),t(document).off("keypress.FullscreenModeButton").on("keypress.FullscreenModeButton",function(t){var i=e.globalFullscreenMode&&e.fullscreenMode,o=27==t.keyCode;i&&o&&e.fullscreenOff(!0)})},a.prototype._setupOptions=function(e,i,o){i=i||this.name;var n=this.drawerInstance||this.drawer,r=n&&n.getPluginConfig(i),s=t.extend(!0,{},this._defaultOptions||{},r||{},e||{});return o||(this.options=s),s},a.prototype._onWindowResize=function(){!n||this.reactOnResize||this.globalFullscreenMode||this._saveCurrentSizes(),this.reactOnResize&&(this.globalFullscreenMode?this._refreshFullscreenSize(!1):this._restoreNormalSizes());var t=!this.fullscreenMode&&this.reactOnResize&&n&&!this.globalFullscreenMode,e=this.fullscreenMode&&!this.globalFullscreenMode&&s;(t||e)&&this.setFullscreenStateOff(),this.reactOnResize=!1},a.prototype._saveCurrentSizes=function(t,e){t&&e||(t=this.drawer.$canvasEditContainer.outerWidth(),e=this.drawer.$canvasEditContainer.outerHeight()),this.savedWidth=t,this.savedHeight=e},a.prototype._refreshFullscreenSize=function(e){var i=t(window),o=i.width(),n=i.height(),r=this.drawer.width,s=this.drawer.height,a=this.drawer.$canvasEditContainer,h=a.hasClass("animated");e&&this._saveCurrentSizes(r,s),a.removeClass("animated"),this.drawer.setSize(o,n),this.drawer.trigger(this.drawer.EVENT_RESTORE_DEFAULT_ZOOM),a.toggleClass("animated",!!h)},a.prototype._restoreNormalSizes=function(){var t=this,e=this.drawer.$canvasEditContainer,o=e.hasClass("animated");e.removeClass("animated"),e.css("position",this.savedPosition),console.info(this.savedWidth,this.savedHeight),this.drawer.setSize(this.savedWidth,this.savedHeight),i.setTimeout(function(){t.drawer.adjustEditContainer(),t.drawer.trigger(t.drawer.EVENT_RESTORE_DEFAULT_ZOOM),i.setTimeout(function(){e.toggleClass("animated",!!o)},0)},0)},a.prototype._setupFullscreenHandlers=function(){var t,e=document.documentElement,i=e.requestFullScreen&&function(){e.requestFullScreen()},o=e.msRequestFullscreen&&function(){e.msRequestFullscreen()},n=e.mozRequestFullScreen&&function(){e.mozRequestFullScreen()},r=e.webkitRequestFullScreen&&function(){e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)};this.fullscreenRequest=i||o||n||r||this.setFullscreenStateOn.bind(this),t=document.cancelFullScreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||this.setFullscreenStateOff.bind(this),this.fullscreenCancel=function(){t.call(document)}},a.prototype._onConfigToolbarCreated=function(t,e){this.fullscreenEl=this.drawer.$canvasEditContainer.get(0),this._createAndAddButton(e)},a.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},a.prototype._createAndAddButton=function(t){var e={buttonOrder:10,additionalClass:"btn-fullscreen-canvas",iconClass:"fa-window-restore",tooltipText:this.drawer.t("Toggle fullscreen mode"),clickHandler:this._onFullscreenModeButtonClick.bind(this)},i=t.addButton(e);this.$fullscreenModeButton=i},a.prototype._toggleFullScreen=function(t){var e=document.fullScreenElement&&null!==document.fullScreenElement,i=!document.mozFullScreen&&!document.webkitIsFullScreen;!1===t||!t&&(e||i)?this.fullscreenRequest():this.fullscreenCancel()},a.prototype._onFullscreenModeButtonClick=function(){this.fullscreenMode?this.fullscreenOff():this.fullscreenOn()},a.prototype.setFullscreenStateOff=function(){var t=this.drawer.$canvasEditContainer||this.drawer.$canvasEditContainer.length;if(this.changeStateInProgress=!0,t){this.drawer.trigger(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.drawer.trigger(this.drawer.EVENT_DESTROY_TOOLTIPS);var e=this,o=this.drawer.$canvasEditContainer,n=o.hasClass("animated");this.fullscreenMode=!1,this.drawer.fullscreenMode=!1,o.addClass("fullscreen-in-progress"),o.removeClass("animated"),o.removeClass("fullscreen"),this.drawer.$imageElement.show(),this._restoreNormalSizes(),i.setTimeout(function(){e.drawer.toolbars.resetAllToolbars(),e.$fullscreenModeButton&&e.$fullscreenModeButton.removeClass("active"),r&&e._restoreNormalSizes(),o.toggleClass("animated",!!n),o.removeClass("fullscreen-in-progress"),e.changeStateInProgress=!1},0)}},a.prototype.setFullscreenStateOn=function(){if(this.changeStateInProgress=!0,this.drawer.$canvasEditContainer||this.drawer.$canvasEditContainer.length){this.drawer.trigger(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.drawer.trigger(this.drawer.EVENT_DESTROY_TOOLTIPS);var t=this,e=this.drawer.$canvasEditContainer,o=e.hasClass("animated");this.fullscreenMode=!0,this.drawer.fullscreenMode=!0,this.savedPosition=e.css("position"),e.addClass("fullscreen-in-progress"),e.removeClass("animated"),e.addClass("fullscreen"),this.drawer.$imageElement.hide(),t._refreshFullscreenSize(!n),i.setTimeout(function(){t.drawer.toolbars.resetAllToolbars(),t.drawer.toolbars.settingsToolbar.$toolbar.parent().addClass("fullscreenOverOther"),t.$fullscreenModeButton&&t.$fullscreenModeButton.addClass("active"),e.toggleClass("animated",!!o),e.removeClass("fullscreen-in-progress"),t.changeStateInProgress=!1},50)}},a.prototype.fullscreenOn=function(){this._toggleFullScreen(!1)},a.prototype.fullscreenOff=function(){this._toggleFullScreen(!0)},o.prototype.fullscreenOn=function(){this.drawer.getPluginInstance("FullscreenModeButton").fullscreenOn()},o.prototype.fullscreenOff=function(){this.drawer.getPluginInstance("FullscreenModeButton").fullscreenOff()},e.FullscreenModeButton=a}(t,e.plugins,e.util,e.DrawerApi),function(t,e,i,o){var n=function(t,i){e.call(this,t);var o=this;if(this.drawer=t,this.name="BackgroundImage",this.btnClass="btn-image",this.faClass="fa-image",this.tooltip=t.t("Insert a background image"),this._setupOptions(i),-1!=["stretch","center","bottom-left","bottom-right","top-right"].indexOf(this.options.imagePosition))if(this.options.dynamicRepositionImage){var n,r=this.options.dynamicRepositionImageThrottle>0?parseInt(this.options.dynamicRepositionImageThrottle):0;n=r?this._throttle(this._repositionImage.bind(this),r):this._repositionImage.bind(this),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_RESIZING,n)}else this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_STOP_RESIZE,this._repositionImage.bind(this));this.options.fixedBackgroundUrl&&this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_READY,function(){o.loadImageFromUrl(o.options.fixedBackgroundUrl,i,!0)})};(n.prototype=Object.create(e.prototype)).constructor=n,n.prototype._defaultOptions={cropIsActive:!0,maxImageSizeKb:5120,imagePosition:"stretch",dynamicRepositionImage:!0,dynamicRepositionImageThrottle:100,acceptedMIMETypes:["image/jpeg","image/png","image/gif"]},n.prototype._activateTool=function(){var t=this;this.drawerInstance.log("TOOL","BackgroundImageTool._activateTool()"),e.prototype._activateTool.call(this),this._showDialog(),o.setTimeout(function(){t.drawerInstance.trigger(t.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,[t])},300)},n.prototype._showDialog=function(){var e=this.options.acceptedMIMETypes.join(",");$el=t('<input type="file" accept="'+e+'">'),$el.on("change",this._processFileInput.bind(this)),$el.click()},n.prototype._processFileInput=function(t){var e=t.target.files;if(e.length<1)this.drawerInstance.showError(this.drawerInstance.t("No file selected."));else{var i=e[0];this._checkFile(i)&&(this.options.cropIsActive&&this.drawer._pluginsInstances.ImageCrop?this.readFile(i,this._triggerImageCrop.bind(this)):this.readFile(i,this.loadImageFromUrl.bind(this)))}},n.prototype._triggerImageCrop=function(t,e){var i={url:t,callback:this.loadImageFromUrl.bind(this)};this.drawerInstance.trigger(this.drawerInstance.EVENT_IMAGE_CROP,i)},n.prototype.readFile=function(t,e){var i=this,o=new FileReader;o.onload=function(n){i.drawerInstance.log("IMAGE LOADED:",t.name),e(o.result)},o.readAsDataURL(t)},n.prototype._checkFile=function(t){if(t.type.indexOf("image")<0)return this.drawerInstance.showError(this.drawerInstance.t("Incorrect file type.")),!1;if(this.options.maxImageSizeKb>0&&t.size>1024*this.options.maxImageSizeKb){var e=this.drawerInstance.t("File is to big!. Maximum file size is ");return e=e+this.options.maxImageSizeKb+" KB",this.drawerInstance.showError(e),!1}return!0},n.prototype.loadImageFromUrl=function(t,e,i){var o=this,n=new Image;n.onload=function(){o.makeImageBackground(n,e)},i&&(n.onerror=function(){var t=o.drawerInstance.t("Image failed to create!");o.drawerInstance.showError(t)}),e.crossOrigin&&(n.crossOrigin=e.crossOrigin),n.src=t},n.prototype.makeImageBackground=function(t,e){var i=this.drawerInstance.fCanvas,o=new fabric.Image(t);e=e||this.options;var n=this._calcPositioningOptions(o,e.imagePosition);i.setBackgroundImage(o,function(){i.renderAll()},n)},n.prototype._calcPositioningOptions=function(t,e){var i=this.drawerInstance.fCanvas,o={};switch(e){case"stretch":o.left=0,o.top=0,o.width=i.width,o.height=i.height;break;case"center":o.originX="center",o.originY="center",o.left=i.getCenter().left,o.top=i.getCenter().top;break;case"top-left":o.left=0,o.top=0;break;case"top-right":o.left=i.width-t.width,o.top=0;break;case"bottom-left":o.left=0,o.top=i.height-t.height;break;case"bottom-right":o.left=i.width-t.width,o.top=i.height-t.height;break;case"default":o.left=0,o.top=0,o.width=i.width,o.height=i.height}return o},n.prototype._repositionImage=function(){var t=this.drawerInstance.fCanvas;if(t.backgroundImage){var e=t.backgroundImage,i={};switch(this.options.imagePosition){case"stretch":i.width=t.width,i.height=t.height;break;case"center":i.originX="center",i.originY="center",i.left=t.getCenter().left,i.top=t.getCenter().top;break;case"top-right":i.left=t.width-e.width,i.top=0;break;case"bottom-right":i.left=t.width-e.width,i.top=t.height-e.height;break;default:return}e.set(i),e.setCoords(),t.renderAll()}},n.prototype.createButton=function(t){this.options.fixedBackgroundUrl||e.prototype.createButton.call(this,t)},n.prototype._throttle=function(t,e){var i,n,r=!1;return function s(){if(r)return i=arguments,void(n=this);t.apply(this,arguments),r=!0,o.setTimeout(function(){r=!1,i&&(s.apply(n,i),i=n=null)},e)}},i.BackgroundImage=n}(t,e.plugins.BaseTool,e.plugins,e.util),function(t){t.prototype.setBackgroundImageFromUrl=function(t,e,i){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("BackgroundImage").loadImageFromUrl(t,e)},t.prototype.setBackgroundImage=function(t,e){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("BackgroundImage").makeImageBackground(t,e)}}(e.DrawerApi),function(t,e,i){var o=function(e,o){this.drawer=e,o=o||{},this.options=t.extend(!0,{},this._defaultOptions||{},o||{}),this.hideOnEditMode=!0,this.assetsUrl=i.getDrawerFolderUrl()+"assets/",this.shouldDisplayTransparent=!1,this.colors=this.options.colors,this.colorsInRow=this.options.colorsInRow};o.prototype._defaultOptions={colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],colorsInRow:11,minSwatchSize:10,buttonOrder:6},o.prototype.TRANSPARENT="rgba(0, 0, 0, 0)",o.prototype.defaultPosition="bottom",o.prototype.positions=["bottom","top","left","right"],o.prototype.remove=function(){this.$colorButton&&this.$colorButton.remove()},o.prototype.hideControls=function(){this.$colorButton&&this.$colorButton.addClass("hidden")},o.prototype.showControls=function(){this.$colorButton&&this.$colorButton.removeClass("hidden")},o.prototype.getColor=function(){return this.currentColor},o.prototype.setColor=function(t){t instanceof fabric.Color?this.currentColor=t:this.currentColor=new fabric.Color(t);var e=t;(""===t||t==this.TRANSPARENT||"transparent"==t)&&(e="url("+i.assets.urlFor("transparent.png")+")",this.currentColor=this.TRANSPARENT),this.$colorButton.$colorIndicator.css("background",e)},o.prototype.disableTransparent=function(){this.shouldDisplayTransparent=!1,this.$colorButton&&this.$colorButton.find(".transparent").hide()},o.prototype.enableTransparent=function(){this.shouldDisplayTransparent=!0,this.$colorButton&&this.$colorButton.find(".transparent").show()},o.prototype.onColorSelected=function(t){this.hideColorDropdown(),this.setColor(t),this.colorChangeHandler&&this.colorChangeHandler(t)},o.prototype._setGlobalClickHandler=function(){var e=this;t("html").click(function(t){return e.colorDropdownVisible&&t.target!=e.$colorButton.$colorIndicator.get(0)&&e.hideColorDropdown(),!0})},o.prototype.createControl=function(e,i){return this.$colorButton=t(this._getControlHtml()),this._collectDataFromToolbar(e),this.$colorButton.$colorIndicator=this.$colorButton.find(".color-indicator"),this.$colorButton.$colorDropdown=this.$colorButton.find(".color-dropdown"),this.$colorButton.$colorIndicator.css("background-color",this.drawer.activeColor),this.colorDropdownVisible=!1,this.$colorButton.$colorIndicator.click(this._onButtonClick.bind(this)),this.colorChangeHandler=i,this._buildPicker(this.$colorButton.$colorDropdown),this._setGlobalClickHandler(),e.addControl(this.$colorButton,this.options.buttonOrder),this.$colorButton},o.prototype._onButtonClick=function(e){var i=t(e.currentTarget);this.$lastTrigger=i,this.toggleColorDropdown(i)},o.prototype._collectDataFromToolbar=function(t){if(t){var e=t.options.position;this.isVertical="left"===e||"right"===e,this.$toolbar=t.$toolbar,this.toolbar=t}},o.prototype._buildPicker=function(t){for(var e=0;e<this.colors.length;e++){var i=this.colors[e],o=this._createSwatch(i);t.append(o)}var n=this._createTransparentSwatch();t.append(n)},o.prototype._updateControlsSize=function(){var t=this._calcSwatchSize();this.$colorButton.$colorDropdown.css("fontSize",t+"px");var e=t*this.colorsInRow;this.$colorButton.$colorDropdown.css("width",e+"px")},o.prototype._calcSwatchSize=function(){var t=this.drawer.touchDevice?this.drawer.options.toolbarSize:this.drawer.options.toolbarSizeTouch;t=t||this.options.minSwatchSize;var e=Math.floor(.95*this.drawer.width/this.colorsInRow),i=this.drawer.height+this.drawer.toolbars.toolOptionsToolbar.height(),o=Math.floor(i/(this.colors.length/this.colorsInRow)),n=Math.min(e,o);return t>n&&(t=Math.max(n,this.options.minSwatchSize)),t},o.prototype._getAvailableSpace=function(t){var e;if(t&&t.length){var i=this.drawer.$canvasEditContainer,o=this.$colorButton.$colorDropdown.closest(".popup-content-wrapper"),n=this.$colorButton.$colorDropdown.closest(".toolbar-content-wrapper"),r=i.get(0).getBoundingClientRect(),s=t.get(0).getBoundingClientRect(),a=n.get(0).getBoundingClientRect(),h=o.get(0).getBoundingClientRect(),l=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),c=s.left-r.left,u=s.top-r.top;(e={}).top=u,e.left=c,e.right=r.width-c-s.width,e.bottom=r.height-u-s.height,e.centerX=c+s.width/2,e.centerY=u+s.height/2,e.palette={arrowSize:0,top:l.height,bottom:l.height,left:l.width,right:l.width},e.popupSizes=h,e.toolbarSizes=a,e.paletteSizes=l,e.canvasSizes=r,e.triggerSizes=s}return this.sizes=e,e},o.prototype._resetPalette=function(){this.$colorButton.$colorDropdown.removeClass("palette-with-scroll"),this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.removeAttr("data-position")},o.prototype._setFullSize=function(){var t=this.sizes,e=t.toolbarSizes.left-t.canvasSizes.left,i=t.toolbarSizes.top-t.canvasSizes.top,o={};o.top=-i,o.left=-e,o.width=t.canvasSizes.width,o.height=t.canvasSizes.height,this.$colorButton.$colorDropdown.css(o)},o.prototype._adjustPosition=function(t){this._resetPalette();var e,i=this._getAvailableSpace(t);this.positions.forEach(function(t,o){var n=i[t]&&i.palette[t];if(!e&&n){var r=i.palette[t]+i.palette.arrowSize,s=i[t]-r>0;e=s&&t}}),e?this._movePalette(e):this._setFullSize()},o.prototype._cropSizeOfPalette=function(){var t,e=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),i=this.sizes.canvasSizes,o={},n=i.height-(e.height+e.top-i.top),r=e.top-i.top,s=i.width-(e.width+e.left-i.left),a=e.left-i.left,h=Math.min(n,r),l=Math.min(s,a);h<0&&(t=!0,o.height=e.height+h),l<0&&(t=!0,o.width=e.width+l),t&&this.$colorButton.$colorDropdown.addClass("palette-with-scroll"),this.$colorButton.$colorDropdown.css(o)},o.prototype._movePalette=function(t){var e,i,o,n,r,s,a=this.sizes,h=this.sizes.toolbarSizes.left-this.sizes.canvasSizes.left,l=this.sizes.toolbarSizes.top-this.sizes.canvasSizes.top,c={};switch(a.paletteSizes.width,a.paletteSizes.height,t){case"left":i=a.left-a.paletteSizes.width-a.palette.arrowSize,o=a.centerY-a.paletteSizes.height/2,c.right=a.toolbarSizes.width-(a.left-h);break;case"right":i=a.canvasSizes.width-a.right+a.palette.arrowSize,o=a.centerY-a.paletteSizes.height/2,c.left=a.left-h+a.triggerSizes.width;break;case"top":e=!0,i=a.centerX-a.paletteSizes.width/2,o=a.top-a.paletteSizes.height-a.palette.arrowSize,c.bottom=a.toolbarSizes.height-(a.top-l);break;case"bottom":e=!0,i=a.centerX-a.paletteSizes.width/2,o=a.canvasSizes.height-a.bottom+a.palette.arrowSize,c.top=a.top-l+a.triggerSizes.height}e?(n=i+a.paletteSizes.width-a.canvasSizes.width,r=a.canvasSizes.width-a.paletteSizes.width>0,n>0&&i>0&&!r?c.right=0-h:(i<0&&(i=0),s=!0,c.width=a.canvasSizes.width,c.left=i-h)):(n=o+a.paletteSizes.height-a.canvasSizes.height,r=a.canvasSizes.height-a.paletteSizes.height>0,n>0&&o>0&&!r?c.bottom=0-l:(s=!0,o<0&&(o=0),c.height=a.canvasSizes.width,c.top=o-l)),s&&this.$colorButton.$colorDropdown.addClass("palette-with-scroll"),this.$colorButton.$colorDropdown.attr("data-position",t),this.$colorButton.$colorDropdown.css(c),this._cropSizeOfPalette()},o.prototype._adjustControlsPosition=function(){var t,e=this.drawer.width<375,i=this.drawer.height<375,o=this.isVertical?i:e,n=this.drawer.$canvasEditContainer.get(0).getBoundingClientRect(),r=this.$colorButton.get(0).getBoundingClientRect();if(this.$colorButton.$colorDropdown.removeAttr("style"),t=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),this.isVertical)if(o)this.$colorButton.$colorDropdown.css("top",0);else{var s=r.top-n.top+r.height/2-t.height/2;this.$colorButton.$colorDropdown.css("top",s)}else if(o)this.$colorButton.$colorDropdown.css("left",0);else{var a=r.left-n.left+r.width/2-t.width/2;this.$colorButton.$colorDropdown.css("left",a)}if(!o)if(t=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),this.isVertical){o=375-t.height>10;var h=t.top>n.top,l=t.top+t.height<n.top+n.height&&!o;h||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css("top",0)),l||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css({bottom:0,top:"auto"}))}else{o=375-t.width>10;var c=t.left>n.left,u=t.left+t.width<n.left+n.width&&!o;c||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css("left",0)),u||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css({right:0,left:"auto"}))}},o.prototype._getControlHtml=function(){var t=this.options.colorText||"";return'<li class="colorpicker-control" data-editable-canvas-sizeable="toolbar-button" ><span class="toolbar-label" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height">'+this.drawer.t(t)+' </span><span class="color-indicator" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="width"></span><span class="color-dropdown control-hidden hidden" data-editable-canvas-sizeable="toolbar-button"></span></li>'},o.prototype._createSwatch=function(e,o){var n=t('<a href="#"></a>');return n.attr("rel",e).addClass("color-swatch").css({"background-color":e}),o&&n.addClass(o),i.bindClick(n,"colorpicker",this._swatchClickHandler.bind(this)),n},o.prototype._swatchClickHandler=function(e){e.preventDefault(),e.stopPropagation();var i=t(e.target).attr("rel");return this.onColorSelected(i),!1},o.prototype._createTransparentSwatch=function(){var t=this._createSwatch(this.TRANSPARENT,"transparent");return t.text(this.drawer.t("Transparent")),this.shouldDisplayTransparent||t.hide(),t},o.prototype.showColorDropdown=function(e){this.colorDropdownVisible=!0,this._updateControlsSize();var i=this.$toolbar.closest(".popup-content-wrapper").length;this.$colorButton.$colorDropdown.removeClass("hidden"),i?this._adjustPosition(e):this._adjustControlsPosition(),this.$colorButton.$colorDropdown.removeClass("control-hidden"),"scrollable"===this.toolbar.options.compactType&&(this.$cloneControl=t('<div class="colorpicker-control"></div>'),this.$cloneDropdown=this.$colorButton.$colorDropdown.clone(!0),this.$cloneControl.append(this.$cloneDropdown),this.$toolbar.closest(".toolbar-placeholder").append(this.$cloneControl))},o.prototype.hideColorDropdown=function(){this.colorDropdownVisible=!1,this.$colorButton.$colorDropdown.addClass("hidden"),this.$colorButton.$colorDropdown.addClass("control-hidden"),this.$cloneControl&&this.$cloneControl.remove()},o.prototype.toggleColorDropdown=function(t){this.colorDropdownVisible?this.hideColorDropdown():this.showColorDropdown(t)},e.ColorpickerControl=o}(t,e.plugins,e.util),function(t,e,i){var o=function(e,i){this.drawer=e,this.options=t.extend(!0,{},this._defaultOptions||{},i||{}),this._opacity=this.options.defaultOpacity,this.drawer.on(this.drawer.AFTER_CREATE_TOOLBARS,this._moveControlToEnd.bind(this))};o.prototype._defaultOptions={defaultOpacity:1},o.prototype.remove=function(){this.$opacityControl&&this.$opacityControl.remove()},o.prototype._moveControlToEnd=function(){"popup"===this.toolbar.options.compactType&&this.$opacityControl.parent().append(this.$opacityControl)},o.prototype.hideControls=function(){this.$opacityControl&&this.$opacityControl.addClass("hidden")},o.prototype.showControls=function(){this.$opacityControl&&this.$opacityControl.removeClass("hidden")},o.prototype.getOpacity=function(){return this._opacity},o.prototype.setOpacity=function(t){this._opacity=t,this.$opacityControl.find("input").val(100*t),this.$opacityControl.find(".editable-canvas-opacity-indicator").text(100*t+"%")},o.prototype.onOpacityChange=function(){var e=t(this.$opacityControl).find("input"),i=parseInt(e.val(),10),o="number"==typeof i&&isFinite(i)?i:this.options.defaultOpacity,n=parseInt(o,10)+"%";this._opacity=o/100,this.$opacityIndicator.text(n),this.opacityChangeCallback&&this.opacityChangeCallback(this._opacity)},o.prototype.createControl=function(e,i){return this.toolbar=e,this.opacityChangeCallback=i,this.$opacityControl=t('<li class="editable-canvas-opacity toolbar-item-range"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-opacity-label">'+this.drawer.t("Fill opacity:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-opacity-indicator">100%</span></div><input class="editable-canvas-opacity-input" type="range" name="drawer-size" min="0" max="100"value="100" /></li>'),this.$opacityIndicator=this.$opacityControl.find(".editable-canvas-opacity-indicator"),e.addControl(this.$opacityControl,this.options.buttonOrder),t(this.$opacityControl).on("change",this.onOpacityChange.bind(this)),this.$opacityControl},o.prototype.showControls=function(){this.$opacityControl.show()},o.prototype.hideControls=function(){this.$opacityControl.hide()},e.OpacityControl=o}(t,e.plugins,e.util),function(t,e,i,o){var n=function(t,o){i.call(this,t),this._setupOptions(o),this.colorControl=new e.ColorpickerControl(this.drawer,this.options),this.opacityControl=new e.OpacityControl(this.drawer,this.options)};(n.prototype=Object.create(i.prototype)).constructor=i,n.prototype.optionName="color",n.prototype._defaultOptions={showOpacityControl:!1,alwaysVisible:!0,colorText:"Fill:"},n.prototype.createControls=function(t){this.colorControl.createControl(t,this._onColorSelected.bind(this)),this.opacityControl.createControl(t,this._onOpacityControlChanged.bind(this))},n.prototype._onColorSelected=function(t){if("transparent"==t){var e=this.opacityControl.getOpacity(),i=this._hexToRgba(t,e);this.drawer.setColor(i)}else this.drawer.setColor(t)},n.prototype._onOpacityControlChanged=function(t){var e=this.drawer.activeColor,i=this._hexToRgba(e,t);this.drawer.setColor(i)},n.prototype.updateControlsFromObject=function(t){var e=null;t.path?(e=t.get("stroke"),this.colorControl.disableTransparent()):(e=t.get("fill"),this.colorControl.enableTransparent()),e&&(this.updateControlsWithColor(e),this.drawer.activeColor=e)},n.prototype.updateControlsWithColor=function(t){this.colorControl.setColor(t);var e=new fabric.Color(t)._source[3];this.opacityControl.setOpacity(e)},n.prototype.showControls=function(t){t=void 0!==t?t:!this.options.showOpacityControl,this.colorControl.showControls(),t?this.opacityControl.hideControls():this.opacityControl.showControls()},n.prototype.hideControls=function(t){var e=this.drawer.options.toolbars.popupButtonAlwaysVisible||this.options.alwaysVisible;!t&&e||(this.colorControl.hideControls(),this.opacityControl.hideControls())},n.prototype._hexToRgba=function(t,e){var i=new fabric.Color(t);return i._source[3]=e,i.toRgba()},e.Color=n}(0,e.plugins,e.plugins.BaseToolOptions,e.util),function(t,e){var i=function(t){var e=this;this.drawerInstance=t,this.name="BrushSize",t.on(t.EVENT_OPTIONS_TOOLBAR_CREATED,function(t,i){e.createColorControl(i)})};i.prototype.createColorControl=function(e){var i=this,o=t('<li class="editable-canvas-plugin-color"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="height"><span class="toolbar-label"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="height,line-height">Color: </span><input class="editable-canvas-colorpicker" type="color" value="'+this.drawerInstance.activeColor+'" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="height,width"/></li>');e.addControl(o,this.options.buttonOrder),o.find("input").change(function(t){if(t){var e=t.target.value;i.drawerInstance.setColor(e)}})},e.ColorpickerHtml5=i}(t,e.plugins)};e.default=function(t,e){return window.$||(window.$=t),n.$editor=e,n.texts=r,n.global={fabric:o.fabric},n.clipping={},e.data("assets")&&(n.util.assets=s.init(e.data("assets"))),l(window,t,n),function(t,e){o.fabric.util.getPointer,o.fabric.util.degreesToRadians;var i=o.fabric.util.radiansToDegrees,n=Math.atan2;Math.abs,t.Canvas=o.fabric.util.createClass(o.fabric.Canvas,{initialize:function(t,e){e=e||{},this.preserveObjectStacking=!0,this.callSuper("initialize",t,e)},disableSelection:function(){var t=null,e=this.getObjects();this.deactivateAll();for(var i=0;i<e.length;i++)void 0===(t=e[i]).__evented&&(t.__evented=t.get("evented"),t.set("evented",!1)),void 0===t.__selectable&&(t.__selectable=t.get("selectable"),t.set("selectable",!1))},restoreSelection:function(){for(var t=null,e=this.getObjects(),i=0;i<e.length;i++)void 0!==(t=e[i]).__evented&&(t.set("evented",t.__evented),delete t.__evented),void 0!==t.__selectable&&(t.set("selectable",t.__selectable),delete t.__selectable)},_renderObjects:function(t,i){var n,r,s;for(e.getTemporaryCanvas(this).getContext("2d").clearRect(0,0,this.width,this.height),this.eraserPaths=[],n=0,r=i.length;n<r;++n)(s=i[n])instanceof o.fabric.EraserPath||s.render(t)},_applyEraserPath:function(t,e){t.visible=!0,t.globalCompositeOperation="destination-out",t.render(e),t.visible=!1},_findNewLowerIndex:function(t,e,i){var n;if(i){n=e;for(var r=e-1;r>=0;--r)if(!(this._objects[r]instanceof o.fabric.EraserPath)&&(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t))){n=r;break}}else n=e-1;return n},_findNewUpperIndex:function(t,e,i){var n;if(i){n=e;for(var r=e+1;r<this._objects.length;++r)if(!(this._objects[r]instanceof o.fabric.EraserPath)&&(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t))){n=r;break}}else n=e+1;return n},_rotateObject:function(t,e){var o=this._currentTransform;if(!o.target.get("lockRotation")){var r=n(o.ey-o.top,o.ex-o.left),s=n(e-o.top,t-o.left),a=i(s-r+o.theta);return a<0&&(a=360+a),o.target.set("angle",a%360),!0}}})}(n,n.util),function(t,e){var i=null;e.setDrawerFolderUrl=function(t){i=t.replace(/\/*$/g,"")+"/"},e.getDrawerFolderUrl=function(){if(i)return i;for(var t=document.getElementsByTagName("script"),e=/dist\/(drawer.+\.js)+$/,o=0;o<t.length;o++){var n=t.item(o);if(n.src){var r=n.src.match(e);if(r)return n.src.replace(r[1],"")}}return""},e.unbindClick=function(e,i){var o=i+"drawerBindClick";t(e).off("click."+o),t(e).off("touchstart."+o),t(e).off("touchend."+o)},e.bindClick=function(e,i,o){var n=i+"drawerBindClick";t(e).on("click."+n,function(t){var i=null;if(this.__lastClickTime){if(Date.now()-this.__lastClickTime>500){try{i=o.apply(this,[t])}catch(t){var r="Catched error - click."+n;console.groupCollapsed(r),console.log("%c[Event name]","color: green","click."+n),console.log("%c[Element]","color: green",e),console.error(t),console.groupEnd(r)}if(!1===i)return t.stopPropagation(),t.preventDefault(),!1}}else{try{i=o.apply(this,[t])}catch(t){r="Catched error - click."+n,console.groupCollapsed(r),console.log("%c[Event name]","color: green","click."+n),console.log("%c[Element]","color: green",e),console.error(t),console.groupEnd(r)}if(!1===i)return t.stopPropagation(),t.preventDefault(),!1}}),t(e).on("touchstart."+n,function(i){this.__drawerTouchStartEvent=i,t(e).off("click."+n)}),t(e).on("touchend."+n,function(t){var e;if(this.__drawerTouchStartEvent){if(Math.abs(this.__drawerTouchStartEvent.timeStamp-t.timeStamp)<300){this.__lastClickTime=Date.now();try{e=o.apply(this,[t])}catch(t){var i="Catched error - touchend."+n;console.groupCollapsed(i),console.log("%c[Event name]","color: green","touchend."+n),console.log("%c[Element]","color: green",this),console.error(t),console.groupEnd(i)}if(!1===e)return t.stopPropagation(),t.preventDefault(),!1}delete this.__drawerTouchStartEvent}})},e.bindDoubleTap=function(i,o,n){t(i).on("touchend."+o,function(t){var i,r=this;if(r.__touchEndTime){var s=Date.now()-r.__touchEndTime;i=e.getEventPosition(t);var a,h=Math.abs(r.__touchEndX-i.left),l=Math.abs(r.__touchEndY-i.top);if(s<500&&h<20&&l<20){delete r.__touchEndTime,delete r.__touchEndX,delete r.__touchEndY;try{a=n.apply(r,[t])}catch(t){var c="Catched error - touchend(doubleTap)."+o;console.groupCollapsed(c),console.log("%c[Event name]","color: green","touchend(doubleTap)."+o),console.log("%c[Element]","color: green",r),console.error(t),console.groupEnd(c)}if(!1===a)return t.stopPropagation(),t.preventDefault(),!1}else delete r.__touchEndTime,delete r.__touchEndX,delete r.__touchEndY}else r.__touchEndTime=Date.now(),i=e.getEventPosition(t),r.__touchEndX=i.left,r.__touchEndY=i.top,e.setTimeout(function(){delete r.__touchEndTime,delete r.__touchEndX,delete r.__touchEndY},500)})},e.bindLongPress=function(i,o,n){var r=o+"drawerBindLongPress";t(i).on("touchstart."+r,function(i){var o=this;o.__touchStartTime=Date.now();var s=e.getEventPosition(i);o.__touchStartX=s.left,o.__touchStartY=s.top,o.__longPressCheckTimeout&&clearTimeout(o.__longPressCheckTimeout);var a=function(){delete o.__touchStartTime,delete o.__touchStartX,delete o.__touchStartY,t(o).off("touchmove."+r),t(o).off("touchend."+r)};return t(o).on("touchmove."+r,function(t){var i=e.getEventPosition(t);if(o.__touchStartTime){var n=Math.abs(o.__touchStartX-i.left),r=Math.abs(o.__touchStartY-i.top);(n>10||r>10)&&a()}}),t(o).on("touchend."+r,function(t){a()}),o.__longPressCheckTimeout=setTimeout(function(){if(o.__touchStartTime){a();try{n.apply(o,[i])}catch(e){var t="Catched error - touchstart(bindLongPress)."+r;console.groupCollapsed(t),console.log("%c[Event name]","color: green","touchstart(bindLongPress)."+r),console.log("%c[Element]","color: green",o),console.error(e),console.groupEnd(t)}}},1e3),!0})},e.unbindLongPress=function(e,i){var o=i+"drawerBindLongPress";t(e).off("touchstart."+o),t(e).off("touchmove."+o),t(e).off("touchend."+o)},e.mouseDown=function(t){return"mousedown."+t+this.id+" touchstart."+t+this.id},e.mouseMove=function(t){return"mousemove."+t+this.id+" touchmove."+t+this.id},e.mouseUp=function(t){return"mouseup."+t+this.id+" touchend."+t+this.id},e.getTransitionDuration=function(t,e){var i=window.getComputedStyle(t),o=i.webkitTransitionDuration,n=i.webkitTransitionDelay;return o=o.indexOf("ms")>-1?parseFloat(o):1e3*parseFloat(o),n=n.indexOf("ms")>-1?parseFloat(n):1e3*parseFloat(n),e?o+n:o},e.getEventPosition=function(t,i){var o={},n=function(t,i){var o;if(t){var r=t.type.indexOf("touch")>-1,s=r&&t.touches&&t.touches.length,a=e.eventCoordsAreValid(t);o=r&&s&&!a?t:!i&&n(t.originalEvent,!0)}return o};if(t){i=i||0;var r=n(t),s=r&&e.eventCoordsAreValid(r.touches[i]),a=e.eventCoordsAreValid(t),h=t&&t.originalEvent&&e.eventCoordsAreValid(t.originalEvent),l=s&&r.touches[i]||a&&t||h&&t.originalEvent;l&&(o={left:l.pageX,top:l.pageY})}return o},e.eventCoordsAreValid=function(t){var e;if(t){var i=0!==t.pageX&&0!==t.pageY,o="number"==typeof t.pageX&&"number"==typeof t.pageY,n=o&&isFinite(t.pageX)&&isFinite(t.pageY);e=i&&o&&n}return e},e.isShape=function(t){return(!t.type||"line"!=t.type&&"arrow"!=t.type)&&!t.path},e.__temporaryCanvas=null,e.__latestValidCanvasWidth=null,e.__latestValidCanvasHeight=null,e.getTemporaryCanvas=function(t){e.__temporaryCanvas||(e.__temporaryCanvas=document.createElement("canvas"));var i=t.width,o=t.height,n=i||e.__latestValidCanvasWidth||1,r=o||e.__latestValidCanvasHeight||1;return e.__temporaryCanvas.setAttribute("width",n),e.__temporaryCanvas.setAttribute("height",r),e.__latestValidCanvasWidth=n,e.__latestValidCanvasHeight=r,e.__temporaryCanvas},e.LastCoordsQueue=function(){this.coordsQueue=[],this.length=10,this.pushCoords=function(t,e){this.coordsQueue.length>this.length&&(this.coordsQueue=this.coordsQueue.slice(this.coordsQueue.length-this.length)),this.coordsQueue.push({x:t,y:e})},this.getInterpolatedValues=function(){if(0===this.coordsQueue.length)return[];if(1===this.coordsQueue.length)return[{x:this.coordsQueue[0].x,y:this.coordsQueue[0].y}];for(var t=[],e=this.coordsQueue[this.coordsQueue.length-2].x,i=this.coordsQueue[this.coordsQueue.length-2].y,o=this.coordsQueue[this.coordsQueue.length-1].x-e,n=this.coordsQueue[this.coordsQueue.length-1].y-i,r=Math.abs(o),s=Math.abs(n),a=r>s?r:s,h=0;h<a;h++)t.push({x:e+o/a*h,y:i+n/a*h});return t}},e.addCSSRule=function(t,e,i,o){t&&("insertRule"in t?t.insertRule(e+"{"+i+"}",o):"addRule"in t&&t.addRule(e,i,o))},e.addStyleToStyleSheet=function(i,o,n,r,s){var a=n&&n instanceof jQuery&&n.length,h="string"==typeof n&&t(n).length&&t(n),l=n instanceof Node&&t(n).length&&t(n),c=a||h||l;if(c)e.addCSSRule(c[0].sheet,i,o);else if(r){var u=document.head||document.getElementsByTagName("head")[0],p=document.createElement("style");p.type="text/css",p.id=n,u.appendChild(p),e.addCSSRule(p.sheet,i,o)}else if(s){var d=i+"{"+o+"}";e.addStyle(d)}},e.addStyle=function(t){var e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),e.appendChild(i)},e.isString=function(t){return"string"==typeof t||t instanceof String},e.getScrollTopFromElement=function(t){for(var e=t,i={left:0,top:0},o=!0;o;){o=e&&e.length&&!e.is("body");var n=e.scrollTop(),r=e.scrollLeft();i.top+=n,i.left+=r,e=e.parent()}return i},e.debounce=function(t,i,o){var n;return i=i||0,function(){var r=this,s=arguments,a=o&&!n;clearTimeout(n),n=e.setTimeout(function(){n=null,o||t.apply(r,s)},i),a&&t.apply(r,s)}},e.loadImage=function(t,i,o,n){o=o||{};var r=i||new Image;return r.style.opacity=0,new Promise(function(i){r.src===t?i(r,o):(r.removeAttribute("crossOrigin"),!n&&t.match(/^https?:\/\/|^\/\//)&&r.setAttribute("crossOrigin","anonymous"),r.onload=function(){e.setTimeout(function(){i(r,o)},1)},r.src=t)})},e.checkBrowser=function(t){var e=navigator.userAgent.toLowerCase(),i=/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return"safari"==t?void 0!==i[3]&&"safari"==i[3]:"version"==t?i[2]:"webkit"==t?"chrome"==i[1]||"opr"==i[1]||"webkit"==i[1]:"rv"==i[1]?"msie"==t:"opr"==i[1]?"webkit"==t:t==i[1]},e.getScrollOffset=function(t){var e={},i=!0,o=t,n=0,r=0;if(t&&t.length)for(;i;)i=(o=o.parent())&&o.length&&!o.is("body"),n+=o.scrollLeft(),r+=o.scrollTop();return e.left=n,e.top=r,e},e.setTimeout=function(t,e,i){var o,n=new Error("Parent stack").stack;return o=function(){try{t.apply(window,arguments)}catch(t){console.groupCollapsed("Catched error - setTimeout"),console.log("%c[Parent stack]","color: green",n),console.log("%c[Error stack]","color: green",t.stack),console.error(t),console.groupEnd("Catched error - setTimeout")}},window.setTimeout(o,e,i)},function(){var t,i,o="";window.addEventListener?t="addEventListener":(t="attachEvent",o="on");var n="onwheel"in document.createElement("div")&&"wheel",r=void 0!==document.onmousewheel&&"mousewheel";i=n||r||"DOMMouseScroll";var s=function(t){var e={originalEvent:t=t||window.event,target:t.target||t.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==t.type?0:1,deltaX:0,deltaY:0,deltaZ:0,preventDefault:function(){t.preventDefault?t.preventDefault():t.returnValue=!1}};return"mousewheel"==i?(e.deltaY=-.025*t.wheelDelta,t.wheelDeltaX&&(e.deltaX=-.025*t.wheelDeltaX)):e.deltaY=t.deltaY||t.detail,callback(e)},a=function(e,n,r,a){var h,l=o+n;h="wheel"==i?r:s,e[t](l,h,a||!1)};e.addWheelListener=function(t,e,o){a(t,i,e,o),"DOMMouseScroll"==i&&a(t,"MozMousePixelScroll",e,o)},e.requestAnimationFrame=window.requestAnimationFrame.bind(window)||window.mozRequestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame.bind(window)||window.msRequestAnimationFrame.bind(window)||function(t){t()},e.cancelAnimationFrame=window.cancelAnimationFrame.bind(window)||window.mozCancelAnimationFrame.bind(window)||function(){}}()}(t,n.util),function(){var t=function(t){if(!t)throw new Error("DrawerApi(): no drawer is provided!");this.drawer=t};t.prototype.drawer=null,t.prototype.checkIsActive=function(){if(this.drawer.mode!=this.drawer.MODE_ACTIVE)throw new Error("Drawer is not active!")},t.prototype.startEditing=function(){this.drawer._startEditing()},t.prototype.stopEditing=function(){this.drawer._stopEditing()},t.prototype.getCanvasAsJSON=function(){return this.drawer.api.checkIsActive(),this.drawer.getSerializedCanvas()},t.prototype.saveCanvas=function(){this.drawer.api.checkIsActive(),this.drawer.syncCanvasData()},t.prototype.loadCanvasFromData=function(t){this.drawer.loadCanvas(t)},t.prototype.getCanvasAsImage=function(){return this.drawer.getImageData()},t.prototype.saveCanvasImage=function(){this.drawer.api.checkIsActive(),this.drawer.syncImageData()},t.prototype.getSize=function(){return this.drawer.getSize()},t.prototype.setSize=function(t,e){this.drawer.setSize(t,e)},t.prototype.setActiveColor=function(t){this.drawer.setActiveColor(t)},t.prototype.createText=function(t,e,i,o){this.drawer._pluginsInstances.Text.addShape(t,e,i,o)},t.prototype.updateOptions=function(t){this.drawer.updateOptions(t)},t.prototype.setOptions=function(t){this.drawer.setOptions(t)},t.prototype.loadPlugin=function(t){this.drawer.loadPlugin(t)},t.prototype.unloadPlugin=function(t){this.drawer.unloadPlugin(t)},DrawerJs.DrawerApi=t}(),function(t){t.prototype._checkObject=function(t){if(!t)throw new Error("[Drawer API]  no object provided!");if(!(t instanceof fabric.Object))throw new Error("[Drawer API]  object type is not 'fabric.Object!'")},t.prototype.getSelectedObject=function(){return this.drawer.fCanvas.getActiveObject()},t.prototype.bringObjectForward=function(t){return this._checkObject(t),this.drawer.fCanvas.bringForward(t,!0),this.drawer.syncCanvasData(),t},t.prototype.sendObjectBackwards=function(t){return this._checkObject(t),this.drawer.fCanvas.sendBackwards(t,!0),this.drawer.syncCanvasData(),t},t.prototype.bringObjectToFront=function(t){return this._checkObject(t),this.drawer.fCanvas.bringToFront(t,!0),this.drawer.syncCanvasData(),t},t.prototype.sendObjectToBack=function(t){return this._checkObject(t),this.drawer.fCanvas.sendToBack(t),this.drawer.syncCanvasData(),t},t.prototype.removeObject=function(t){this._checkObject(t),t.remove(),this.drawer.fCanvas.renderAll()},t.prototype.duplicateObject=function(t,e){this._checkObject(t);var i=this,o=function(o){if(!o)throw new Error("[Drawer API] duplicateObject() : Clone failed! Clone source: "+t.toString());return o.set("left",t.get("left")+20),o.set("top",t.get("top")+20),i.drawer.fCanvas.add(o),i.drawer.fCanvas.renderAll(),e&&e(o),o};if(!t.async)return o(t.clone());t.clone(o)}}(n.DrawerApi),function(t,e,i,o,n){var r=function(i,n,r,s){var a=this;if(this.mode=this.MODE_INACTIVE,this.redactorInstance=i,this.id=Math.random().toString().replace("0.",""),this.width=r||0,this.height=s||0,this._eventEmitter=t({}),this.api=new e.DrawerApi(this),this.setOptions(n),this.$imageElement=null,this.$canvasEditContainer=null,this.aligmentCss={},this.toolbars=new O(this),a.options.detectTouch){if("Function"!==a.options.detectTouch.constructor.name)throw new Error("detectTouch should be a function which will be called when Drawer needs to determine whether it is working on touch device");a.touchDevice=a.options.detectTouch(a)}else a.touchDevice=/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent),t("body").on("touchstart.DrawerTouchCheck",function(){a.touchDevice=!0,t("body").off("touchstart.DrawerTouchCheck"),a.log("touch","Found touch screen")});if(a.$canvasDataContainer=null,a.options.contentConfig.canvasDataContainer&&(a.$canvasDataContainer=t(a.options.contentConfig.canvasDataContainer),a.$canvasDataContainer.length<1))throw a.$canvasDataContainer=null,new Error("contentConfig.canvasDataContainer provided but not found in DOM: "+a.options.contentConfig.canvasDataContainer);if(a.$imagesContainer=null,a.options.contentConfig.imagesContainer&&(a.$imagesContainer=t(a.options.contentConfig.imagesContainer),a.$imagesContainer.length<1))throw a.$imagesContainer=null,new Error("contentConfig.imagesContainer provided but not found in DOM: "+a.options.contentConfig.imagesContainer);var h=".editable-canvas-not-edited {background: url("+this.options.defaultImageUrl+") no-repeat !important;background-size: contain !important;}";return o.addStyle(h),this};r.prototype.api={},r.prototype.MODE_PREPARING="mode:preparing",r.prototype.MODE_ACTIVE="mode:active",r.prototype.MODE_INACTIVE="mode:inactive",r.prototype.setOptions=function(e){this.options=t.extend(!0,this.defaultOptions||{},e||{}),this.onOptionsUpdated(!0)},r.prototype.getPluginConfig=function(e){var i={},o=e&&"string"==typeof e&&e.length,n=o&&this.options.pluginsConfig[e],r=o&&this.options.pluginsConfig.Text&&this.options.pluginsConfig.Text[e];return n&&(i=t.extend(!0,i,n)),r&&(i=t.extend(!0,i,r)),i},r.prototype.updateOptions=function(e){e=e||{},this.options=t.extend(!0,this.options,e);var i=!1;e.plugins&&(this.options.plugins=e.plugins,i=!0),this.onOptionsUpdated(i)},r.prototype.onOptionsUpdated=function(t){this.options.basePath&&o.setDrawerFolderUrl(this.options.basePath),this.options.canvasProperties.rotationCursor="url("+o.getDrawerFolderUrl()+"assets/cursor-fa-rotate-right.cur), default",this.activeColor||(this.activeColor=this.options.activeColor||this.defaultOptions.activeColor),void 0===this.activeOpacity&&(this.activeOpacity=this.options.activeOpacity||this.defaultOptions.activeOpacity),t&&(this.loadPlugins(),this.toolbars&&this.toolbars.resetAllToolbars())},r.prototype.unloadPlugins=function(){for(var t in this._pluginsInstances)this.unloadPlugin(t)},r.prototype.unloadPlugin=function(t){if(this._pluginsInstances.hasOwnProperty(t)){var e=this._pluginsInstances[t];e.removeTool&&e.removeTool(!0),delete this._pluginsInstances[t]}},r.prototype.loadPlugin=function(t){if(t&&i[t]){var e=this._pluginsInstances[t],o=this.options.corePlugins&&-1!==this.options.corePlugins.indexOf(t);if(e)o||this.error("Drawer: Load plugin error - "+t+". Plugin should not be specified multiple times.");else try{var n={};this.options.pluginsConfig[t]&&(n=this.options.pluginsConfig[t]);var r=new i[t](this,n);this._pluginsInstances[t]=r}catch(e){this.error("Drawer: Load plugin error - "+t+"."),this.error(e)}}else this.error("Drawer: Load plugin error - "+t+". No such plugin.")},r.prototype.loadPlugins=function(){if(this._pluginsInstances?this.unloadPlugins():this._pluginsInstances={},this.options.corePlugins)for(var t=0;t<this.options.corePlugins.length;t++)this.loadPlugin(this.options.corePlugins[t]);if(this.options.plugins)for(var e=0;e<this.options.plugins.length;e++)this.loadPlugin(this.options.plugins[e])},r.prototype.log=function(t,e){this.options.debug&&console.log("%c["+t+"]","color: green",e)},r.prototype.error=function(t){this.options.debug&&console.error(t)},r.prototype.clickEvent=function(t){return"click."+t+" touchend."+t},r.prototype.getHtml=function(){var e=t("<img>").css({display:"inline-block",width:this.width||this.options.defaultWidth,height:this.height||this.options.defaultHeight,background:this.options.backgroundCss}).addClass("editable-canvas-image").addClass("editable-canvas-not-edited").attr("id","canvas_image_"+this.id).attr("data-redactor-drawer-enabled",!0).attr("src","");return this.options.borderCss&&e.css("border",this.options.borderCss),t(e)[0].outerHTML},r.prototype.updateAligmentCss=function(){this.aligmentCss=this.getAligmentCssFor(this.$imageElement)},r.prototype.getAligmentCssFor=function(t){var e=window.getComputedStyle(t[0]),i={display:e.display,float:e.float,"margin-left":e.marginLeft,"margin-right":e.marginRight,position:e.position,left:e.left,top:e.top};return t.attr("data-margin-left")&&(i["margin-left"]=t.attr("data-margin-left")),t.attr("data-margin-right")&&(i["margin-right"]=t.attr("data-margin-right")),i},r.prototype.setAligmentCssFor=function(t,e){"none"==t.css("display")&&delete e.display,t.css(e),e["margin-left"]&&"auto"==e["margin-left"]&&(t.css("margin-left","auto"),t.attr("data-margin-left","auto")),e["margin-right"]&&"auto"==e["margin-right"]&&(t.css("margin-right","auto"),t.attr("data-margin-right","auto"))},r.prototype.onInsert=function(){var e=this;t(document).off(this.clickEvent("DrawerStop"+this.id));var i=!this.$imageElement;this.$imageElement=t(document.getElementById("canvas_image_"+this.id)),i&&(this.options.align?this.aligmentCss=this._generateAlignCss(this.options.align):this.aligmentCss=this.getAligmentCssFor(this.$imageElement),this.width=this.$imageElement.outerWidth(),this.height=this.$imageElement.outerHeight(),this.$imageElement.removeClass("edit-mode")),this.$imageElement.attr("src").length<1&&!this.$imageElement.hasClass("editable-canvas-not-edited")&&(this.$imageElement.attr("src",this.getImageData()),this.$imageElement.removeClass("editable-canvas-not-edited")),this.setAligmentCssFor(this.$imageElement,this.aligmentCss),this.options.editOnClick?(this.$imageElement.off(),o.bindClick(this.$imageElement,"Drawer",function(t){e._startEditing()})):(this.$imageElement.off(e.clickEvent("Drawer")),this.$imageElement.on(e.clickEvent("Drawer"),function(){e.drawCanvasControls()})),o.bindClick(t(document),"Drawer",this._globalClickHandler.bind(this)),this.on(this.EVENT_OPTIONS_CHANGED,this.onOptionsChange.bind(this)),this.on(this.EVENT_CANVAS_READY,this.onOptionsChange.bind(this))},r.prototype._globalClickHandler=function(e){var i=t(e.target).parents("#redactor-drawer-box");return i.length>0?i.attr("data-canvas-id")==this.id:e.target.id!="canvas_image_"+this.id&&("redactor-image-editter"!=e.target.id||t(e.target).attr("data-canvas-id")!=this.id)&&!(t(e.target).parents("#redactor-modal").length>0)&&void(this.$canvasEditContainer&&this.options.exitOnOutsideClick&&!this.resizingNow&&!this.croppingNow&&!this.movingNow&&!this.fullscreenMode&&!this.drawingInProgress&&!this.isBrushDrawing&&this._stopEditing())},r.prototype.drawCanvasControls=function(){var e=this,i=t("#redactor-image-editter");i.attr("data-canvas-id",this.id),i.text("Edit in Drawer"),i.css("margin-left","-"+i.innerWidth()/2+"px"),i.off("click"),i.on("click",function(){e._startEditing()})},r.prototype._startEditing=function(){this.log("canvasEditMode","startEditing()");var i=this;if(this.mode==this.MODE_INACTIVE){this.mode=this.MODE_PREPARING,i.redactorInstance&&i.redactorInstance.$editor.attr("contenteditable","false"),i._previousFocusedElement=document.activeElement,t(document.activeElement).blur(),this.width=this.$imageElement.outerWidth(),this.height=this.$imageElement.outerHeight(),this.$imageElement.addClass("edit-mode"),this.$imageElement.removeClass("editable-canvas-not-edited");var o=t('<canvas width="'+this.width+'" height="'+this.height+'" />');this.$canvasEditContainer=t('<span id="redactor-drawer-box" data-canvas-id="'+this.id+'" tabindex="0"></span>'),this.$canvasEditContainer=t("<span></span>"),this.$canvasEditContainer.attr("id","redactor-drawer-box"),this.$canvasEditContainer.attr("data-canvas-id",this.id),this.$canvasEditContainer.attr({id:"redactor-drawer-box",class:"drawer-instance-container","data-canvas-id":this.id,tabindex:"0"}),this.options.borderCss&&this.$canvasEditContainer.css("border",this.options.borderCssEditMode),this.touchDevice&&this.$canvasEditContainer.addClass("touch"),this.$canvasEditContainer.css({position:"absolute"}),this.aligmentCss=this.getAligmentCssFor(this.$imageElement),this.$canvasEditContainer.append(o),t("body").append(this.$canvasEditContainer),this.adjustEditContainer(),t(window).on("resize.drawer"+this.id,function(){i.adjustEditContainer(!1,!0)}),this.redactorInstance&&this.redactorInstance.image.hideResize();var n=this.getCanvasData();this.fCanvas=new e.Canvas(o.get(0)),this.fCanvas.selection=!1,this.options&&this.options.canvasProperties&&t.each(this.options.canvasProperties,function(t,e){i.fCanvas[t]=e}),this.$canvasEditContainer.css("background",this.$imageElement.css("background")),this.loadCanvas(n)}else this.log("Drawer.startEditing(): already in active mode")},r.prototype._stopEditing=function(){this.log("canvasEditMode","_stopEditing()"),this.mode!=this.MODE_INACTIVE?(this.redactorInstance&&this.redactorInstance.$editor.attr("contenteditable","true"),this.trigger(this.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.fCanvas&&this.fCanvas.deactivateAll(),this.$imageElement.attr("src",this.getImageData()),this.$imageElement.removeClass("edit-mode"),this.$imageElement.removeClass("editable-canvas-not-edited"),this.syncCanvasData(),this.$imageElement.show(),this.$canvasEditContainer&&(this.$canvasEditContainer.remove(),this.$canvasEditContainer=null),t(window).off("resize.drawer"+this.id),this.trigger(this.EVENT_EDIT_STOP),this.mode=this.MODE_INACTIVE):this.log("canvasEditMode","_stopEditing(): already stopped, mode is INACTIVE")},r.prototype.setActiveColor=function(t){var e=this.fCanvas.getActiveObject(),i=this.activeDrawingTool,o=this._pluginsInstances.Color,n=o&&o.colorControl;this.activeColor=t,this.options.activeColor=t,!e&&n&&n.setColor(t),i&&(i.brush=null,i._activateTool()),this.trigger(this.EVENT_CANVAS_MODIFIED)},r.prototype.setColor=function(t,e){if(t&&(this.activeColor=t),void 0!==e&&(this.activeOpacity=e),this.fCanvas){var i=this.fCanvas.getActiveObject();if(this.setOpacity(this.activeOpacity,!0),i){var o="line"===i.type||"arrow"===i.type,n=i.path;o?i.set("stroke",this.activeColor):n?i.set("stroke",this.activeColor):i.set("fill",this.activeColor),this.fCanvas.renderAll()}this.fCanvas.freeDrawingBrush.color=this.activeColor,this.fCanvas.freeDrawingBrush.fill=this.activeColor,this.trigger(this.EVENT_CANVAS_MODIFIED)}},r.prototype.setOpacity=function(t,e){t=void 0!==t?t:this.activeOpacity,this.activeOpacity=t;var i=this.fCanvas.getActiveObject();i&&i.set("opacity",t),this.fCanvas.freeDrawingBrush.opacity=t,e||(this.fCanvas.renderAll(),this.trigger(this.EVENT_CANVAS_MODIFIED))},r.prototype.setBrushSize=function(t){this.fCanvas&&(this.fCanvas.freeDrawingBrush.width=t),this.trigger(this.EVENT_BRUSH_SIZE_CHANGED)},r.prototype.getBrushSize=function(){var t=0;return this.fCanvas&&(t=this.fCanvas.freeDrawingBrush.width),t},r.prototype.setBrush=function(t){this.fCanvas.freeDrawingBrush=t,this.trigger(this.EVENT_BRUSH_CHANGED)},r.prototype.getBrush=function(){return this.fCanvas?this.fCanvas.freeDrawingBrush:null},r.prototype.getSize=function(){var t={},e=this.$canvasEditContainer,i=e&&e.get(0).getBoundingClientRect(),n=e&&o.getScrollOffset(e);return t.top=i?i.top:null,t.left=i?i.left:null,t.scrollTop=n?n.top:null,t.scrollLeft=n?n.left:null,t.width=this.width,t.height=this.height,t},r.prototype.setSize=function(t,e){this.width=t,this.height=e,this.fCanvas&&(this.fCanvas.setWidth(this.width),this.fCanvas.setHeight(this.height)),this.$imageElement.css("width",this.width),this.$imageElement.css("height",this.height),this.$canvasEditContainer&&(this.$canvasEditContainer.css("width",this.width),this.$canvasEditContainer.css("height",this.height)),this.adjustEditContainer(!1,!0)},r.prototype._generateAlignCss=function(t){var e={};switch(t){case"floating":e.position="absolute",e.display="block",e.float="none",e.left="0px",e.top="0px";break;case"center":e.float="none",e["margin-left"]="auto",e["margin-right"]="auto",e.display="block",e.position="static";break;case"left":case"right":e.display="block",e.float=t,e.position="static";break;case"inline":e.float="none",e.display="inline-block",e.position="static";break;default:e.float="none",e.display="inline-block",e.position="static"}return e},r.prototype.setAlign=function(t){var e=this._generateAlignCss(t);this.setAligmentCssFor(this.$imageElement,e),this.aligmentCss=this.getAligmentCssFor(this.$imageElement),this.adjustEditContainer(),this.trigger(this.EVENT_CANVAS_MODIFIED)},r.prototype.getAlign=function(){var t="inline";return"absolute"==this.aligmentCss.position?t="floating":"left"==this.aligmentCss.float?t="left":"right"==this.aligmentCss.float?t="right":"block"==this.aligmentCss.display&&"auto"==this.aligmentCss["margin-left"]&&(t="center"),t},r.prototype.adjustEditContainer=function(t,e){var i=this,n=this.$canvasEditContainer.hasClass("animated");if(!this.$canvasEditContainer)return!1;var r=this.$imageElement.offset();t||this.$canvasEditContainer.removeClass("animated"),this.$canvasEditContainer.css({top:r.top,left:r.left}),t||(e?i.$canvasEditContainer.toggleClass("animated",!!n):o.setTimeout(function(){i.$canvasEditContainer&&i.$canvasEditContainer.length&&i.$canvasEditContainer.toggleClass("animated",!!n)},0))},r.prototype.destroy=function(){this.trigger(this.EVENT_DESTROY),this._stopEditing(),this.$imageElement.remove(),this.syncCanvasData(!0),this.syncImageData(!0)},r.prototype.activateDefaultPlugin=function(){if(this.options.defaultActivePlugin){var t=this.options.defaultActivePlugin.name,e=this.options.defaultActivePlugin.mode;if("always"==e||"lastUsed"==e||"onNew"==e&&0===this.fCanvas.getObjects().length){this.log("defaultActivePlugin",e+"/"+t),this.lastUsedPluginName&&"lastUsed"==e&&(t=this.lastUsedPluginName);var i=this._pluginsInstances[t];i?this.trigger(this.EVENT_DO_ACTIVATE_TOOL,[i]):this.log("WARNING","options['defaultActivePlugin']['name'] is '"+t+"', but no such plugin found.")}}},r.prototype.onCanvasModified=function(t){var e=this;if(void 0===t&&this.options.contentConfig.saveAfterInactiveSec)return void 0!==this.__activityTimer&&(e.log("saveAfterInactiveSec","Cleaning previous timeout"),clearTimeout(this.__activityTimer)),e.log("saveAfterInactiveSec","Setting up a timeout"),this.__activityTimer=o.setTimeout(function(){e.log("saveAfterInactiveSec","Timeout happened, triggering onCanvasModified"),e.onCanvasModified(!0)},1e3*this.options.contentConfig.saveAfterInactiveSec),!1;this.redactorInstance||this.beforeSync(),this.syncCanvasData(),this.syncImageData(),this.trigger(this.EVENT_CANVAS_MODIFIED),this.redactorInstance||this.afterSync()},r.prototype._updateObjectsControls=function(t){var e=this.options.objectControls;if(this.touchDevice&&this.options.objectControlsTouch&&(e=this.options.objectControlsTouch),e)for(var i in e)e.hasOwnProperty(i)&&t.set(i,e[i])},r.prototype.getPluginInstance=function(t){if(this._pluginsInstances[t])return this._pluginsInstances[t];throw new Error("Plugin not exists: "+t)},r.prototype.onOptionsChange=function(){this.options.transparentBackground?(this.$imageElement.css("background","transparent"),this.$canvasEditContainer.css("background","transparent")):(this.$imageElement.css("background","white"),this.$canvasEditContainer.css("background","white"))},r.prototype.t=function(t){return this.options.texts[t]?this.options.texts[t]:t},r.prototype.showError=function(t){alert(t)},r.prototype.left=function(){return 0|this.$canvasEditContainer.css("left").replace("px","")},r.prototype.top=function(){return 0|this.$canvasEditContainer.css("top").replace("px","")},r.prototype.setTemporaryStyles=function(e){var i=!!(e=e||!1)&&t.extend(!0,{},this.fCanvas._temporaryStyles||{},e||{});for(var o in e)void 0===e[o]&&delete i[o];i?(this.fCanvas._temporaryStyles=i,this.fCanvas.copiedTextStyle={0:i},fabric.copiedTextStyle={0:i}):(this.fCanvas._temporaryStyles=i,this.fCanvas.copiedTextStyle=i,fabric.copiedTextStyle=i)},r.prototype.getRelativeEventPosition=function(t,e){var i={},n=o.getEventPosition(t),r=o.getScrollOffset(this.$canvasEditContainer),s=this.$canvasEditContainer.get(0).getBoundingClientRect();return i.top=n.top-s.top-r.top,i.left=n.left-s.left-r.left,i.scaledTop=i.top,i.scaledLeft=i.left,i},e.Drawer=r}(t,n,n.plugins,n.util,n.texts),function(t,e,i){t.prototype.defaultOptions={captionText:"Drawer",defaultWidth:"100%",defaultHeight:"500px",enableImageCrop:!0,editOnClick:!0,exitOnOutsideClick:!0,activeColor:"#E80F07",activeOpacity:1,toolbarSize:35,toolbarSizeTouch:45,toolbars:{popupButtonAlwaysVisible:!0,drawingTools:{position:"top"},toolOptions:{position:"bottom"},settings:{position:"right"}},tooltipCss:{background:"black",color:"white"},canvasProperties:{selectionColor:"rgba(255, 255, 255, 0.3)",selectionDashArray:[3,8],selectionLineWidth:1,selectionBorderColor:"#5f5f5f"},objectControls:{borderColor:"rgba(102,153,255,0.75)",borderOpacityWhenMoving:.4,cornerColor:"rgba(102,153,255,0.5)",cornerSize:12,hasBorders:!0},objectControlsTouch:{borderColor:"rgba(102,153,255,0.75)",borderOpacityWhenMoving:.4,cornerColor:"rgba(102,153,255,0.5)",cornerSize:20,hasBorders:!0},contentConfig:{saveAfterInactiveSec:null,saveInHtml:!0,canvasDataContainer:null,imagesContainer:null,loadCanvasData:null,saveCanvasData:null,loadImageData:null,saveImageData:null},backgroundCss:"white",borderCss:"1px dashed rgb(195, 194, 194)",borderCssEditMode:"1px dashed rgb(195, 194, 194)",defaultImageUrl:"images/drawer.jpg",plugins:[],pluginsConfig:{},corePlugins:["Zoom"],texts:i,basePath:null,debug:!1}}(n.Drawer,n.util,n.texts),function(t){t.prototype.EVENT_EDIT_START="editStart",t.prototype.EVENT_EDIT_STOP="editStop",t.prototype.EVENT_LOADED_FROM_JSON="loadedFromJson",t.prototype.EVENT_CANVAS_READY="ready",t.prototype.EVENT_CANVAS_START_RESIZE="canvas:resize:start",t.prototype.EVENT_BEFORE_RENDER="before:render",t.prototype.EVENT_AFTER_RENDER="after:render",t.prototype.EVENT_CANVAS_RESIZING="canvas:resize:resizing",t.prototype.EVENT_CANVAS_STOP_RESIZE="canvas:resize:stop",t.prototype.EVENT_BRUSH_SIZE_CHANGED="brushSizeChanged",t.prototype.EVENT_BRUSH_CHANGED="brushChanged",t.prototype.EVENT_DO_ACTIVATE_TOOL="activateTool",t.prototype.EVENT_DO_DEACTIVATE_TOOL="deactivateTool",t.prototype.EVENT_DO_DEACTIVATE_ALL_TOOLS="deactivateAllTools",t.prototype.EVENT_OPTIONS_CHANGED="options.changed",t.prototype.EVENT_DESTROY="destroy",t.prototype.EVENT_TOOL_ACTIVATED="toolActivated",t.prototype.EVENT_TOOL_DEACTIVATED="toolDeactivated",t.prototype.EVENT_TOOLS_TOOLBAR_CREATED="toolsToolbarCreated",t.prototype.BEFORE_CREATE_TOOLBARS="beforeCreateToolbars",t.prototype.AFTER_CREATE_TOOLBARS="afterCreateToolbars",t.prototype.EVENT_OPTIONS_TOOLBAR_CREATED="optionsToolbarCreated",t.prototype.EVENT_CONFIG_TOOLBAR_CREATED="configToolbarCreated",t.prototype.EVENT_IMAGECROP_TOOLBAR_CREATED="imageCropToolbarCreated",t.prototype.EVENT_FLOATING_TOOLBAR_CREATED="floatingToolbarCreated",t.prototype.EVENT_MINIMIZED_TOOLBAR_CREATED="minimizedToolbarCreated",t.prototype.EVENT_TOOLBAR_DESTROYED="toolbarDestroyed",t.prototype.EVENT_TOOLBAR_CHANGE_STATE="toolbarChangeState",t.prototype.EVENT_TOOLBAR_CLEAR_STATE="toolbarClearState",t.prototype.EVENT_TOOLBAR_STATE_HIDDEN_OFF="toolbarShow",t.prototype.EVENT_TOOLBAR_STATE_HIDDEN_ON="toolbarHide",t.prototype.EVENT_TOOLBAR_STATE_OVERLAY_ON="toolbarOverlayShow",t.prototype.EVENT_TOOLBAR_STATE_OVERLAY_OFF="toolbarOverlayHide",t.prototype.EVENT_TOOLBAR_STATE_DISABLED_ON="toolbarDisableOn",t.prototype.EVENT_TOOLBAR_STATE_DISABLED_OFF="toolbarDisableOff",t.prototype.EVENT_RESTORE_DEFAULT_ZOOM="restoreDefaultZoom",t.prototype.EVENT_CONTEXTMENU="contextmenu",t.prototype.EVENT_KEYDOWN="keydown",t.prototype.EVENT_BEFORE_SHAPE_ADD="beforeShapeAdd",t.prototype.EVENT_AFTER_SHAPE_ADD="afterShapeAdd",t.prototype.EVENT_ZOOM_SET="EVENT_ZOOM_SET",t.prototype.EVENT_ZOOM_UNSET="EVENT_ZOOM_UNSET",t.prototype.EVENT_ZOOM_UPPER_SET="EVENT_ZOOM_UPPER_SET",t.prototype.EVENT_ZOOM_UPPER_UNSET="EVENT_ZOOM_UPPER_UNSET",t.prototype.EVENT_ZOOM_UPPER_RESTORE="EVENT_ZOOM_UPPER_RESTORE",t.prototype.EVENT_ZOOM_RESTORE="EVENT_ZOOM_RESTORE",t.prototype.EVENT_ZOOM_CHANGE="zoomChange",t.prototype.EVENT_CANVAS_MODIFIED="canvasModified",t.prototype.EVENT_OBJECT_ADDED="objectAdded",t.prototype.EVENT_OBJECT_SELECTED="objectSelected",t.prototype.EVENT_OBJECT_MOVING="objectMoving",t.prototype.EVENT_SELECTION_CLEARED="selectionCleared",t.prototype.EVENT_TEXT_SELECTION_CHANGED="textSelectionChanged",t.prototype.EVENT_TEXT_EDITING_ENTERED="textEditingEntered",t.prototype.EVENT_TEXT_EDITING_EXITED="textEditingExited",t.prototype.EVENT_TEXT_STYLES_CHANGED="textStylesChanged",t.prototype.EVENT_TEXT_GET_STYLES="textGetStyles",t.prototype.EVENT_OVERCANVAS_POPUP_SHOW="overcanvasPopupShow",t.prototype.EVENT_OVERCANVAS_POPUP_HIDE="overcanvasPopupHide",t.prototype.EVENT_OVERCANVAS_BUTTON_SHOW="overcanvasButtonShow",t.prototype.EVENT_OVERCANVAS_BUTTON_HIDE="overcanvasButtonHide",t.prototype.EVENT_IMAGE_CROP="initImageCrop",t.prototype.EVENT_RESIZER_HIDE="resizerHide",t.prototype.EVENT_RESIZER_SHOW="resizerShow",t.prototype.EVENT_CREATE_TOOLTIP="createTooltip",t.prototype.EVENT_HIDE_TOOLTIPS="hideTooltips",t.prototype.EVENT_DESTROY_TOOLTIPS="destroyTooltips",t.prototype.off=function(t,e){return this._eventEmitter.off(t,e)},t.prototype.on=function(t,e){return this._eventEmitter.on(t,e)},t.prototype.trigger=function(t,e){var i,o=!this.insideEvent;try{this.insideEvent=!0,i=this._eventEmitter.trigger(t,e)}catch(i){if(this.options.debug){var n="Catched error - "+t;console.groupCollapsed(n),this.log("Event name",t),this.log("Arguments",e),this.error(i),console.groupEnd(n)}}return o&&(this.insideEvent=!1),i}}(n.Drawer),E(n.Drawer,n.util),A(n),P(t,n),n}},function(t,e){},function(t,e,i){var o=i(21),n=i(9),r=t.exports;for(var s in o)o.hasOwnProperty(s)&&(r[s]=o[s]);function a(t){if("string"==typeof t&&(t=n.parse(t)),t.protocol||(t.protocol="https:"),"https:"!==t.protocol)throw new Error('Protocol "'+t.protocol+'" not supported. Expected "https:"');return t}r.request=function(t,e){return t=a(t),o.request.call(this,t,e)},r.get=function(t,e){return t=a(t),o.get.call(this,t,e)}},function(t,e){t.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},function(t,e){t.exports=function(){for(var t={},e=0;e<arguments.length;e++){var o=arguments[e];for(var n in o)i.call(o,n)&&(t[n]=o[n])}return t};var i=Object.prototype.hasOwnProperty},function(t,e,i){var o=i(5).Buffer;t.exports=function(t){if(t instanceof Uint8Array){if(0===t.byteOffset&&t.byteLength===t.buffer.byteLength)return t.buffer;if("function"==typeof t.buffer.slice)return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}if(o.isBuffer(t)){for(var e=new Uint8Array(t.length),i=t.length,n=0;n<i;n++)e[n]=t[n];return e.buffer}throw new Error("Argument must be a Buffer")}},function(t,e,i){"use strict";t.exports=r;var o=i(11),n=i(6);function r(t){if(!(this instanceof r))return new r(t);o.call(this,t)}n.inherits=i(2),n.inherits(r,o),r.prototype._transform=function(t,e,i){i(null,t)}},function(t,e,i){(function(e){function i(t){try{if(!e.localStorage)return!1}catch(t){return!1}var i=e.localStorage[t];return null!=i&&"true"===String(i).toLowerCase()}t.exports=function(t,e){if(i("noDeprecation"))return t;var o=!1;return function(){if(!o){if(i("throwDeprecation"))throw new Error(e);i("traceDeprecation")?console.trace(e):console.warn(e),o=!0}return t.apply(this,arguments)}}}).call(this,i(0))},function(t,e,i){(function(t,e){!function(t,i){"use strict";if(!t.setImmediate){var o,n=1,r={},s=!1,a=t.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(t);h=h&&h.setTimeout?h:t,"[object process]"==={}.toString.call(t.process)?o=function(t){e.nextTick(function(){c(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?function(){var e="setImmediate$"+Math.random()+"$",i=function(i){i.source===t&&"string"==typeof i.data&&0===i.data.indexOf(e)&&c(+i.data.slice(e.length))};t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),o=function(i){t.postMessage(e+i,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){c(t.data)},o=function(e){t.port2.postMessage(e)}}():a&&"onreadystatechange"in a.createElement("script")?function(){var t=a.documentElement;o=function(e){var i=a.createElement("script");i.onreadystatechange=function(){c(e),i.onreadystatechange=null,t.removeChild(i),i=null},t.appendChild(i)}}():o=function(t){setTimeout(c,0,t)},h.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var s={callback:t,args:e};return r[n]=s,o(n),n++},h.clearImmediate=l}function l(t){delete r[t]}function c(t){if(s)setTimeout(c,0,t);else{var e=r[t];if(e){s=!0;try{!function(t){var e=t.callback,o=t.args;switch(o.length){case 0:e();break;case 1:e(o[0]);break;case 2:e(o[0],o[1]);break;case 3:e(o[0],o[1],o[2]);break;default:e.apply(i,o)}}(e)}finally{l(t),s=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(0),i(3))},function(t,e,i){(function(t){var o=void 0!==t&&t||"undefined"!=typeof self&&self||window,n=Function.prototype.apply;function r(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new r(n.call(setTimeout,o,arguments),clearTimeout)},e.setInterval=function(){return new r(n.call(setInterval,o,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(o,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},i(31),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(0))},function(t,e){},function(t,e,i){"use strict";var o=i(7).Buffer,n=i(33);function r(t,e,i){t.copy(e,i)}t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i},t.prototype.concat=function(t){if(0===this.length)return o.alloc(0);if(1===this.length)return this.head.data;for(var e=o.allocUnsafe(t>>>0),i=this.head,n=0;i;)r(i.data,e,n),n+=i.data.length,i=i.next;return e},t}(),n&&n.inspect&&n.inspect.custom&&(t.exports.prototype[n.inspect.custom]=function(){var t=n.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,e){},function(t,e,i){(function(e,o,n){var r=i(20),s=i(2),a=i(19),h=i(18),l=i(28),c=a.IncomingMessage,u=a.readyStates;var p=t.exports=function(t){var i,o=this;h.Writable.call(o),o._opts=t,o._body=[],o._headers={},t.auth&&o.setHeader("Authorization","Basic "+new e(t.auth).toString("base64")),Object.keys(t.headers).forEach(function(e){o.setHeader(e,t.headers[e])});var n=!0;if("disable-fetch"===t.mode||"requestTimeout"in t&&!r.abortController)n=!1,i=!0;else if("prefer-streaming"===t.mode)i=!1;else if("allow-wrong-content-type"===t.mode)i=!r.overrideMimeType;else{if(t.mode&&"default"!==t.mode&&"prefer-fast"!==t.mode)throw new Error("Invalid value for opts.mode");i=!0}o._mode=function(t,e){return r.fetch&&e?"fetch":r.mozchunkedarraybuffer?"moz-chunked-arraybuffer":r.msstream?"ms-stream":r.arraybuffer&&t?"arraybuffer":r.vbArray&&t?"text:vbarray":"text"}(i,n),o._fetchTimer=null,o.on("finish",function(){o._onFinish()})};s(p,h.Writable),p.prototype.setHeader=function(t,e){var i=t.toLowerCase();-1===d.indexOf(i)&&(this._headers[i]={name:t,value:e})},p.prototype.getHeader=function(t){var e=this._headers[t.toLowerCase()];return e?e.value:null},p.prototype.removeHeader=function(t){delete this._headers[t.toLowerCase()]},p.prototype._onFinish=function(){var t=this;if(!t._destroyed){var i=t._opts,s=t._headers,a=null;"GET"!==i.method&&"HEAD"!==i.method&&(a=r.arraybuffer?l(e.concat(t._body)):r.blobConstructor?new o.Blob(t._body.map(function(t){return l(t)}),{type:(s["content-type"]||{}).value||""}):e.concat(t._body).toString());var h=[];if(Object.keys(s).forEach(function(t){var e=s[t].name,i=s[t].value;Array.isArray(i)?i.forEach(function(t){h.push([e,t])}):h.push([e,i])}),"fetch"===t._mode){var c=null;if(r.abortController){var p=new AbortController;c=p.signal,t._fetchAbortController=p,"requestTimeout"in i&&0!==i.requestTimeout&&(t._fetchTimer=o.setTimeout(function(){t.emit("requestTimeout"),t._fetchAbortController&&t._fetchAbortController.abort()},i.requestTimeout))}o.fetch(t._opts.url,{method:t._opts.method,headers:h,body:a||void 0,mode:"cors",credentials:i.withCredentials?"include":"same-origin",signal:c}).then(function(e){t._fetchResponse=e,t._connect()},function(e){o.clearTimeout(t._fetchTimer),t._destroyed||t.emit("error",e)})}else{var d=t._xhr=new o.XMLHttpRequest;try{d.open(t._opts.method,t._opts.url,!0)}catch(e){return void n.nextTick(function(){t.emit("error",e)})}"responseType"in d&&(d.responseType=t._mode.split(":")[0]),"withCredentials"in d&&(d.withCredentials=!!i.withCredentials),"text"===t._mode&&"overrideMimeType"in d&&d.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in i&&(d.timeout=i.requestTimeout,d.ontimeout=function(){t.emit("requestTimeout")}),h.forEach(function(t){d.setRequestHeader(t[0],t[1])}),t._response=null,d.onreadystatechange=function(){switch(d.readyState){case u.LOADING:case u.DONE:t._onXHRProgress()}},"moz-chunked-arraybuffer"===t._mode&&(d.onprogress=function(){t._onXHRProgress()}),d.onerror=function(){t._destroyed||t.emit("error",new Error("XHR error"))};try{d.send(a)}catch(e){return void n.nextTick(function(){t.emit("error",e)})}}}},p.prototype._onXHRProgress=function(){(function(t){try{var e=t.status;return null!==e&&0!==e}catch(t){return!1}})(this._xhr)&&!this._destroyed&&(this._response||this._connect(),this._response._onXHRProgress())},p.prototype._connect=function(){var t=this;t._destroyed||(t._response=new c(t._xhr,t._fetchResponse,t._mode,t._fetchTimer),t._response.on("error",function(e){t.emit("error",e)}),t.emit("response",t._response))},p.prototype._write=function(t,e,i){this._body.push(t),i()},p.prototype.abort=p.prototype.destroy=function(){this._destroyed=!0,o.clearTimeout(this._fetchTimer),this._response&&(this._response._destroyed=!0),this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort()},p.prototype.end=function(t,e,i){"function"==typeof t&&(i=t,t=void 0),h.Writable.prototype.end.call(this,t,e,i)},p.prototype.flushHeaders=function(){},p.prototype.setTimeout=function(){},p.prototype.setNoDelay=function(){},p.prototype.setSocketKeepAlive=function(){};var d=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"]}).call(this,i(5).Buffer,i(0),i(3))},function(t,e,i){"use strict";var o=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,i,a){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?r(s(t),function(s){var a=encodeURIComponent(o(s))+i;return n(t[s])?r(t[s],function(t){return a+encodeURIComponent(o(t))}).join(e):a+encodeURIComponent(o(t[s]))}).join(e):a?encodeURIComponent(o(a))+i+encodeURIComponent(o(t)):""};var n=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function r(t,e){if(t.map)return t.map(e);for(var i=[],o=0;o<t.length;o++)i.push(e(t[o],o));return i}var s=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}},function(t,e,i){"use strict";function o(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,i,r){e=e||"&",i=i||"=";var s={};if("string"!=typeof t||0===t.length)return s;var a=/\+/g;t=t.split(e);var h=1e3;r&&"number"==typeof r.maxKeys&&(h=r.maxKeys);var l=t.length;h>0&&l>h&&(l=h);for(var c=0;c<l;++c){var u,p,d,f,g=t[c].replace(a,"%20"),v=g.indexOf(i);v>=0?(u=g.substr(0,v),p=g.substr(v+1)):(u=g,p=""),d=decodeURIComponent(u),f=decodeURIComponent(p),o(s,d)?n(s[d])?s[d].push(f):s[d]=[s[d],f]:s[d]=f}return s};var n=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,e,i){"use strict";e.decode=e.parse=i(38),e.encode=e.stringify=i(37)},function(t,e,i){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){(function(t,o){var n;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(r){"object"==typeof e&&e&&e.nodeType,"object"==typeof t&&t&&t.nodeType;var s="object"==typeof o&&o;s.global!==s&&s.window!==s&&s.self;var a,h=2147483647,l=36,c=1,u=26,p=38,d=700,f=72,g=128,v="-",b=/^xn--/,m=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=l-c,C=Math.floor,T=String.fromCharCode;function S(t){throw new RangeError(_[t])}function O(t,e){for(var i=t.length,o=[];i--;)o[i]=e(t[i]);return o}function E(t,e){var i=t.split("@"),o="";return i.length>1&&(o=i[0]+"@",t=i[1]),o+O((t=t.replace(y,".")).split("."),e).join(".")}function x(t){for(var e,i,o=[],n=0,r=t.length;n<r;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<r?56320==(64512&(i=t.charCodeAt(n++)))?o.push(((1023&e)<<10)+(1023&i)+65536):(o.push(e),n--):o.push(e);return o}function I(t){return O(t,function(t){var e="";return t>65535&&(e+=T((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=T(t)}).join("")}function A(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:l}function D(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function k(t,e,i){var o=0;for(t=i?C(t/d):t>>1,t+=C(t/e);t>w*u>>1;o+=l)t=C(t/w);return C(o+(w+1)*t/(t+p))}function P(t){var e,i,o,n,r,s,a,p,d,b,m=[],y=t.length,_=0,w=g,T=f;for((i=t.lastIndexOf(v))<0&&(i=0),o=0;o<i;++o)t.charCodeAt(o)>=128&&S("not-basic"),m.push(t.charCodeAt(o));for(n=i>0?i+1:0;n<y;){for(r=_,s=1,a=l;n>=y&&S("invalid-input"),((p=A(t.charCodeAt(n++)))>=l||p>C((h-_)/s))&&S("overflow"),_+=p*s,!(p<(d=a<=T?c:a>=T+u?u:a-T));a+=l)s>C(h/(b=l-d))&&S("overflow"),s*=b;T=k(_-r,e=m.length+1,0==r),C(_/e)>h-w&&S("overflow"),w+=C(_/e),_%=e,m.splice(_++,0,w)}return I(m)}function M(t){var e,i,o,n,r,s,a,p,d,b,m,y,_,w,O,E=[];for(y=(t=x(t)).length,e=g,i=0,r=f,s=0;s<y;++s)(m=t[s])<128&&E.push(T(m));for(o=n=E.length,n&&E.push(v);o<y;){for(a=h,s=0;s<y;++s)(m=t[s])>=e&&m<a&&(a=m);for(a-e>C((h-i)/(_=o+1))&&S("overflow"),i+=(a-e)*_,e=a,s=0;s<y;++s)if((m=t[s])<e&&++i>h&&S("overflow"),m==e){for(p=i,d=l;!(p<(b=d<=r?c:d>=r+u?u:d-r));d+=l)O=p-b,w=l-b,E.push(T(D(b+O%w,0))),p=C(O/w);E.push(T(D(p,0))),r=k(i,_,o==n),i=0,++o}++i,++e}return E.join("")}a={version:"1.4.1",ucs2:{decode:x,encode:I},decode:P,encode:M,toASCII:function(t){return E(t,function(t){return m.test(t)?"xn--"+M(t):t})},toUnicode:function(t){return E(t,function(t){return b.test(t)?P(t.slice(4).toLowerCase()):t})}},void 0===(n=function(){return a}.call(e,i,e,t))||(t.exports=n)}()}).call(this,i(41)(t),i(0))},function(t,e){},function(t,e){},function(t,e){e.read=function(t,e,i,o,n){var r,s,a=8*n-o-1,h=(1<<a)-1,l=h>>1,c=-7,u=i?n-1:0,p=i?-1:1,d=t[e+u];for(u+=p,r=d&(1<<-c)-1,d>>=-c,c+=a;c>0;r=256*r+t[e+u],u+=p,c-=8);for(s=r&(1<<-c)-1,r>>=-c,c+=o;c>0;s=256*s+t[e+u],u+=p,c-=8);if(0===r)r=1-l;else{if(r===h)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,o),r-=l}return(d?-1:1)*s*Math.pow(2,r-o)},e.write=function(t,e,i,o,n,r){var s,a,h,l=8*r-n-1,c=(1<<l)-1,u=c>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=o?0:r-1,f=o?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-s))<1&&(s--,h*=2),(e+=s+u>=1?p/h:p*Math.pow(2,1-u))*h>=2&&(s++,h/=2),s+u>=c?(a=0,s=c):s+u>=1?(a=(e*h-1)*Math.pow(2,n),s+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,n),s=0));n>=8;t[i+d]=255&a,d+=f,a/=256,n-=8);for(s=s<<n|a,l+=n;l>0;t[i+d]=255&s,d+=f,s/=256,l-=8);t[i+d-f]|=128*g}},function(t,e,i){"use strict";e.byteLength=function(t){var e=l(t),i=e[0],o=e[1];return 3*(i+o)/4-o},e.toByteArray=function(t){for(var e,i=l(t),o=i[0],s=i[1],a=new r(function(t,e,i){return 3*(e+i)/4-i}(0,o,s)),h=0,c=s>0?o-4:o,u=0;u<c;u+=4)e=n[t.charCodeAt(u)]<<18|n[t.charCodeAt(u+1)]<<12|n[t.charCodeAt(u+2)]<<6|n[t.charCodeAt(u+3)],a[h++]=e>>16&255,a[h++]=e>>8&255,a[h++]=255&e;2===s&&(e=n[t.charCodeAt(u)]<<2|n[t.charCodeAt(u+1)]>>4,a[h++]=255&e);1===s&&(e=n[t.charCodeAt(u)]<<10|n[t.charCodeAt(u+1)]<<4|n[t.charCodeAt(u+2)]>>2,a[h++]=e>>8&255,a[h++]=255&e);return a},e.fromByteArray=function(t){for(var e,i=t.length,n=i%3,r=[],s=0,a=i-n;s<a;s+=16383)r.push(u(t,s,s+16383>a?a:s+16383));1===n?(e=t[i-1],r.push(o[e>>2]+o[e<<4&63]+"==")):2===n&&(e=(t[i-2]<<8)+t[i-1],r.push(o[e>>10]+o[e>>4&63]+o[e<<2&63]+"="));return r.join("")};for(var o=[],n=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,h=s.length;a<h;++a)o[a]=s[a],n[s.charCodeAt(a)]=a;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function c(t){return o[t>>18&63]+o[t>>12&63]+o[t>>6&63]+o[63&t]}function u(t,e,i){for(var o,n=[],r=e;r<i;r+=3)o=(t[r]<<16&16711680)+(t[r+1]<<8&65280)+(255&t[r+2]),n.push(c(o));return n.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63}]).default});
//# sourceMappingURL=index.js.map